<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Realtix Pro - Plateforme de Gestion Immobilière</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- <script src="https://js.stripe.com/v3/"></script> -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Montserrat:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&family=Poppins:wght@300;400;500;600;700&family=Sora:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700;800&family=Raleway:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    /* Variables de thèmes */
    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --accent-primary: #f59e0b;
      --accent-secondary: #d97706;
      --accent-glow: rgba(251, 191, 36, 0.4);
    }

    /* Thème Bleu */
    .theme-blue {
      --bg-primary: #0a1628;
      --bg-secondary: #1a2744;
      --bg-tertiary: #2d3f61;
      --accent-primary: #3b82f6;
      --accent-secondary: #2563eb;
      --accent-glow: rgba(59, 130, 246, 0.4);
    }

    /* Thème Violet */
    .theme-purple {
      --bg-primary: #1e1b3c;
      --bg-secondary: #2e2657;
      --bg-tertiary: #443971;
      --accent-primary: #a855f7;
      --accent-secondary: #9333ea;
      --accent-glow: rgba(168, 85, 247, 0.4);
    }

    /* Thème Vert */
    .theme-green {
      --bg-primary: #0a1f1a;
      --bg-secondary: #1a3329;
      --bg-tertiary: #2a4d3f;
      --accent-primary: #10b981;
      --accent-secondary: #059669;
      --accent-glow: rgba(16, 185, 129, 0.4);
    }

    /* Thème Rouge */
    .theme-red {
      --bg-primary: #1f0a0a;
      --bg-secondary: #331a1a;
      --bg-tertiary: #4d2a2a;
      --accent-primary: #ef4444;
      --accent-secondary: #dc2626;
      --accent-glow: rgba(239, 68, 68, 0.4);
    }

    /* Polices */
    .font-montserrat, .font-montserrat * { font-family: 'Montserrat', sans-serif !important; }
    .font-inter, .font-inter * { font-family: 'Inter', sans-serif !important; }
    .font-roboto, .font-roboto * { font-family: 'Roboto', sans-serif !important; }
    .font-poppins, .font-poppins * { font-family: 'Poppins', sans-serif !important; }
    .font-sora, .font-sora * { font-family: 'Sora', sans-serif !important; }

    body {
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      min-height: 100vh;
      transition: background 0.5s ease;
    }
    
    * {
      font-family: 'Montserrat', sans-serif;
    }
    
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Playfair Display', serif;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .animate-slideUp {
      animation: slideUp 0.6s ease-out forwards;
    }
    
    .animate-fadeIn {
      animation: fadeIn 0.8s ease-out forwards;
    }

    .animate-spin {
      animation: spin 1s linear infinite;
    }
    
    .shimmer {
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      background-size: 1000px 100%;
      animation: shimmer 3s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-slideInUp {
      animation: slideInUp 0.6s ease-out forwards;
    }

    @keyframes waveMove {
      0% {
        transform: translateX(0) translateY(0);
      }
      100% {
        transform: translateX(-50%) translateY(10px);
      }
    }

    @keyframes waveFloat {
      0%, 100% {
        transform: translateY(0) scaleY(1);
      }
      50% {
        transform: translateY(-20px) scaleY(1.1);
      }
    }

    @keyframes buttonPulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 0 20px 10px rgba(251, 191, 36, 0);
      }
    }

    @keyframes buttonShine {
      0% {
        background-position: -200% center;
      }
      100% {
        background-position: 200% center;
      }
    }

    @keyframes logoGlow {
      0%, 100% {
        filter: drop-shadow(0 0 20px rgba(251, 191, 36, 0.3))
                drop-shadow(0 0 40px rgba(251, 191, 36, 0.2))
                drop-shadow(0 0 60px rgba(251, 191, 36, 0.1));
      }
      50% {
        filter: drop-shadow(0 0 30px rgba(251, 191, 36, 0.4))
                drop-shadow(0 0 50px rgba(251, 191, 36, 0.25))
                drop-shadow(0 0 70px rgba(251, 191, 36, 0.15));
      }
    }

    @keyframes logoShimmer {
      0% {
        background-position: -200% center;
      }
      100% {
        background-position: 200% center;
      }
    }

    @keyframes logoFloat {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    /* Bouton de connexion doré avec animations */
    .login-btn-gold {
      background: linear-gradient(135deg, 
        rgba(251, 191, 36, 0.9) 0%, 
        rgba(245, 158, 11, 0.9) 50%, 
        rgba(251, 191, 36, 0.9) 100%
      );
      background-size: 200% 200%;
      border: 2px solid rgba(251, 191, 36, 1);
      color: #1e293b;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
      box-shadow: 
        0 0 20px rgba(251, 191, 36, 0.5),
        0 0 40px rgba(251, 191, 36, 0.3),
        0 4px 20px rgba(0, 0, 0, 0.4);
      animation: goldPulse 3s ease-in-out infinite, goldShine 4s linear infinite;
      cursor: pointer;
      backdrop-filter: blur(10px);
    }

    .login-btn-gold:hover {
      transform: scale(1.05) translateY(-2px);
      box-shadow: 
        0 0 30px rgba(251, 191, 36, 0.7),
        0 0 60px rgba(251, 191, 36, 0.5),
        0 8px 30px rgba(0, 0, 0, 0.5);
      border-color: rgba(255, 215, 0, 1);
    }

    @keyframes goldPulse {
      0%, 100% {
        box-shadow: 
          0 0 20px rgba(251, 191, 36, 0.5),
          0 0 40px rgba(251, 191, 36, 0.3),
          0 4px 20px rgba(0, 0, 0, 0.4);
      }
      50% {
        box-shadow: 
          0 0 30px rgba(251, 191, 36, 0.7),
          0 0 60px rgba(251, 191, 36, 0.5),
          0 4px 25px rgba(0, 0, 0, 0.5);
      }
    }

    @keyframes goldShine {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideInDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-slideInRight {
      animation: slideInRight 0.6s ease-out forwards;
    }

    .animate-slideInDown {
      animation: slideInDown 0.3s ease-out forwards;
    }

    .logo-particles {
      position: absolute;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .logo-particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: radial-gradient(circle, rgba(251, 191, 36, 0.8), transparent);
      border-radius: 50%;
      animation: particleOrbit linear infinite;
    }

    @keyframes particleOrbit {
      0% {
        transform: rotate(0deg) translateX(80px) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: rotate(360deg) translateX(80px) rotate(-360deg);
        opacity: 0;
      }
    }

    .wave-container {
      position: absolute;
      inset: 0;
      overflow: hidden;
      background: linear-gradient(135deg, #000000 0%, #1a0a2e 50%, #0f0520 100%);
    }

    .wave-svg {
      position: absolute;
      width: 200%;
      height: 100%;
      top: 0;
      left: 0;
    }

    .wave-path-1 {
      stroke: rgba(168, 85, 247, 0.7);
      stroke-width: 8;
      fill: none;
      filter: drop-shadow(0 0 20px rgba(168, 85, 247, 0.9));
      animation: waveMove 20s linear infinite, waveFloat 8s ease-in-out infinite;
    }

    .wave-path-2 {
      stroke: rgba(236, 72, 153, 0.6);
      stroke-width: 10;
      fill: none;
      filter: drop-shadow(0 0 25px rgba(236, 72, 153, 0.8));
      animation: waveMove 25s linear infinite, waveFloat 10s ease-in-out infinite 2s;
    }

    .wave-path-3 {
      stroke: rgba(147, 51, 234, 0.5);
      stroke-width: 6;
      fill: none;
      filter: drop-shadow(0 0 18px rgba(147, 51, 234, 0.7));
      animation: waveMove 30s linear infinite reverse, waveFloat 12s ease-in-out infinite 4s;
    }

    .wave-path-4 {
      stroke: rgba(219, 39, 119, 0.45);
      stroke-width: 9;
      fill: none;
      filter: drop-shadow(0 0 22px rgba(219, 39, 119, 0.7));
      animation: waveMove 22s linear infinite, waveFloat 9s ease-in-out infinite 1s;
    }

    .wave-path-5 {
      stroke: rgba(192, 132, 252, 0.5);
      stroke-width: 7;
      fill: none;
      filter: drop-shadow(0 0 20px rgba(192, 132, 252, 0.7));
      animation: waveMove 28s linear infinite reverse, waveFloat 11s ease-in-out infinite 3s;
    }

    /* Thèmes de couleurs pour les vagues */
    /* Violet Rosé (défaut) */
    .wave-container.theme-purple-pink {
      background: linear-gradient(135deg, #000000 0%, #1a0a2e 50%, #0f0520 100%);
    }
    .theme-purple-pink .wave-path-1 {
      stroke: rgba(168, 85, 247, 0.7);
      filter: drop-shadow(0 0 20px rgba(168, 85, 247, 0.9));
    }
    .theme-purple-pink .wave-path-2 {
      stroke: rgba(236, 72, 153, 0.6);
      filter: drop-shadow(0 0 25px rgba(236, 72, 153, 0.8));
    }
    .theme-purple-pink .wave-path-3 {
      stroke: rgba(147, 51, 234, 0.5);
      filter: drop-shadow(0 0 18px rgba(147, 51, 234, 0.7));
    }
    .theme-purple-pink .wave-path-4 {
      stroke: rgba(219, 39, 119, 0.45);
      filter: drop-shadow(0 0 22px rgba(219, 39, 119, 0.7));
    }
    .theme-purple-pink .wave-path-5 {
      stroke: rgba(192, 132, 252, 0.5);
      filter: drop-shadow(0 0 20px rgba(192, 132, 252, 0.7));
    }

    /* Cyan Bleuté */
    .wave-container.theme-cyan-blue {
      background: linear-gradient(135deg, #0a0e27 0%, #0f2027 50%, #203a43 100%);
    }
    .theme-cyan-blue .wave-path-1 {
      stroke: rgba(79, 172, 254, 0.7);
      filter: drop-shadow(0 0 20px rgba(79, 172, 254, 0.9));
    }
    .theme-cyan-blue .wave-path-2 {
      stroke: rgba(0, 242, 254, 0.6);
      filter: drop-shadow(0 0 25px rgba(0, 242, 254, 0.8));
    }
    .theme-cyan-blue .wave-path-3 {
      stroke: rgba(102, 126, 234, 0.5);
      filter: drop-shadow(0 0 18px rgba(102, 126, 234, 0.7));
    }
    .theme-cyan-blue .wave-path-4 {
      stroke: rgba(0, 200, 254, 0.45);
      filter: drop-shadow(0 0 22px rgba(0, 200, 254, 0.7));
    }
    .theme-cyan-blue .wave-path-5 {
      stroke: rgba(140, 200, 255, 0.5);
      filter: drop-shadow(0 0 20px rgba(140, 200, 255, 0.7));
    }

    /* Bleu Lavande */
    .wave-container.theme-blue-purple {
      background: linear-gradient(135deg, #0a0520 0%, #330867 50%, #203550 100%);
    }
    .theme-blue-purple .wave-path-1 {
      stroke: rgba(48, 207, 208, 0.7);
      filter: drop-shadow(0 0 20px rgba(48, 207, 208, 0.9));
    }
    .theme-blue-purple .wave-path-2 {
      stroke: rgba(51, 8, 103, 0.6);
      filter: drop-shadow(0 0 25px rgba(51, 8, 103, 0.8));
    }
    .theme-blue-purple .wave-path-3 {
      stroke: rgba(102, 126, 234, 0.5);
      filter: drop-shadow(0 0 18px rgba(102, 126, 234, 0.7));
    }
    .theme-blue-purple .wave-path-4 {
      stroke: rgba(30, 180, 200, 0.45);
      filter: drop-shadow(0 0 22px rgba(30, 180, 200, 0.7));
    }
    .theme-blue-purple .wave-path-5 {
      stroke: rgba(100, 150, 220, 0.5);
      filter: drop-shadow(0 0 20px rgba(100, 150, 220, 0.7));
    }

    /* Pêche Rosé */
    .wave-container.theme-peach-pink {
      background: linear-gradient(135deg, #2a1810 0%, #3a2520 50%, #2a1a15 100%);
    }
    .theme-peach-pink .wave-path-1 {
      stroke: rgba(255, 236, 210, 0.7);
      filter: drop-shadow(0 0 20px rgba(255, 236, 210, 0.9));
    }
    .theme-peach-pink .wave-path-2 {
      stroke: rgba(252, 182, 159, 0.6);
      filter: drop-shadow(0 0 25px rgba(252, 182, 159, 0.8));
    }
    .theme-peach-pink .wave-path-3 {
      stroke: rgba(255, 200, 180, 0.5);
      filter: drop-shadow(0 0 18px rgba(255, 200, 180, 0.7));
    }
    .theme-peach-pink .wave-path-4 {
      stroke: rgba(250, 170, 150, 0.45);
      filter: drop-shadow(0 0 22px rgba(250, 170, 150, 0.7));
    }
    .theme-peach-pink .wave-path-5 {
      stroke: rgba(255, 220, 200, 0.5);
      filter: drop-shadow(0 0 20px rgba(255, 220, 200, 0.7));
    }

    /* Lavande Rose */
    .wave-container.theme-lavender-rose {
      background: linear-gradient(135deg, #1a0a20 0%, #2a1530 50%, #1f0a25 100%);
    }
    .theme-lavender-rose .wave-path-1 {
      stroke: rgba(252, 203, 144, 0.7);
      filter: drop-shadow(0 0 20px rgba(252, 203, 144, 0.9));
    }
    .theme-lavender-rose .wave-path-2 {
      stroke: rgba(213, 126, 235, 0.6);
      filter: drop-shadow(0 0 25px rgba(213, 126, 235, 0.8));
    }
    .theme-lavender-rose .wave-path-3 {
      stroke: rgba(230, 160, 200, 0.5);
      filter: drop-shadow(0 0 18px rgba(230, 160, 200, 0.7));
    }
    .theme-lavender-rose .wave-path-4 {
      stroke: rgba(200, 110, 220, 0.45);
      filter: drop-shadow(0 0 22px rgba(200, 110, 220, 0.7));
    }
    .theme-lavender-rose .wave-path-5 {
      stroke: rgba(240, 180, 210, 0.5);
      filter: drop-shadow(0 0 20px rgba(240, 180, 210, 0.7));
    }

    /* Océan Violet */
    .wave-container.theme-purple-ocean {
      background: linear-gradient(135deg, #0a1520 0%, #152030 50%, #1a2535 100%);
    }
    .theme-purple-ocean .wave-path-1 {
      stroke: rgba(168, 237, 234, 0.7);
      filter: drop-shadow(0 0 20px rgba(168, 237, 234, 0.9));
    }
    .theme-purple-ocean .wave-path-2 {
      stroke: rgba(254, 214, 227, 0.6);
      filter: drop-shadow(0 0 25px rgba(254, 214, 227, 0.8));
    }
    .theme-purple-ocean .wave-path-3 {
      stroke: rgba(180, 220, 240, 0.5);
      filter: drop-shadow(0 0 18px rgba(180, 220, 240, 0.7));
    }
    .theme-purple-ocean .wave-path-4 {
      stroke: rgba(200, 180, 230, 0.45);
      filter: drop-shadow(0 0 22px rgba(200, 180, 230, 0.7));
    }
    .theme-purple-ocean .wave-path-5 {
      stroke: rgba(200, 230, 240, 0.5);
      filter: drop-shadow(0 0 20px rgba(200, 230, 240, 0.7));
    }

    @keyframes particleFloat {
      0% {
        transform: translateY(100vh) scale(0);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(-100vh) scale(1);
        opacity: 0;
      }
    }

    .particle {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(251,191,36,0.8) 0%, rgba(234,179,8,0.4) 50%, transparent 100%);
      pointer-events: none;
      animation: particleFloat linear infinite;
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes glow {
      0%, 100% {
        box-shadow: 0 0 10px rgba(251, 191, 36, 0.6), 0 0 20px rgba(251, 191, 36, 0.4), 0 0 30px rgba(251, 191, 36, 0.2);
      }
      50% {
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.9), 0 0 40px rgba(251, 191, 36, 0.6), 0 0 60px rgba(251, 191, 36, 0.3);
      }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      33% { transform: translateY(-10px) rotate(1deg); }
      66% { transform: translateY(-5px) rotate(-1deg); }
    }

    @keyframes borderGlow {
      0%, 100% {
        border-color: rgba(251, 191, 36, 0.3);
      }
      50% {
        border-color: rgba(251, 191, 36, 0.8);
      }
    }

    @keyframes textShine {
      0% {
        background-position: 0% center;
      }
      100% {
        background-position: 200% center;
      }
    }

    @keyframes rotateGradient {
      0% {
        filter: hue-rotate(0deg);
      }
      100% {
        filter: hue-rotate(360deg);
      }
    }

    @keyframes bounceIn {
      0% {
        opacity: 0;
        transform: scale(0.3);
      }
      50% {
        transform: scale(1.05);
      }
      70% {
        transform: scale(0.9);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    .animate-scaleIn { animation: scaleIn 0.5s ease-out forwards; }
    .animate-slideInRight { animation: slideInRight 0.6s ease-out forwards; }
    .animate-slideInLeft { animation: slideInLeft 0.6s ease-out forwards; }
    .animate-glow { animation: glow 2s ease-in-out infinite; }
    .animate-float { animation: float 4s ease-in-out infinite; }
    .animate-borderGlow { animation: borderGlow 2s ease-in-out infinite; }
    .animate-bounceIn { animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
    .animate-slideUp { animation: slideUp 0.5s ease-out forwards; }
    .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }

    /* Nouvelles animations modernes */
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes zoomIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.95) translateY(10px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    @keyframes slideInBlur {
      from {
        opacity: 0;
        filter: blur(10px);
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        filter: blur(0);
        transform: translateY(0);
      }
    }

    @keyframes progressBar {
      from {
        transform: translateX(-100%);
      }
      to {
        transform: translateX(100%);
      }
    }

    @keyframes ripple {
      0% {
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
      }
      100% {
        box-shadow: 0 0 0 20px rgba(59, 130, 246, 0);
      }
    }

    @keyframes wiggle {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-3deg); }
      75% { transform: rotate(3deg); }
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      10%, 30% { transform: scale(1.1); }
      20%, 40% { transform: scale(1); }
    }

    @keyframes shimmerGradient {
      0% {
        background-position: -1000px 0;
      }
      100% {
        background-position: 1000px 0;
      }
    }

    .animate-slideInUp { animation: slideInUp 0.6s ease-out forwards; }
    .animate-slideInDown { animation: slideInDown 0.6s ease-out forwards; }
    .animate-zoomIn { animation: zoomIn 0.5s ease-out forwards; }
    .animate-fadeInScale { animation: fadeInScale 0.6s ease-out forwards; }
    .animate-slideInBlur { animation: slideInBlur 0.8s ease-out forwards; }
    .animate-ripple { animation: ripple 1s cubic-bezier(0.4, 0, 0.2, 1); }
    .animate-wiggle { animation: wiggle 0.5s ease-in-out; }
    .animate-heartbeat { animation: heartbeat 1.5s ease-in-out infinite; }

    /* Transitions fluides globales */
    .transition-all-smooth {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .transition-transform-smooth {
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .hover-lift:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
    }

    .hover-scale:hover {
      transform: scale(1.03);
    }

    .hover-glow:hover {
      box-shadow: 0 0 30px rgba(251, 191, 36, 0.5);
    }

    /* Custom scale utilities for subtle effects */
    .hover\:scale-102:hover {
      transform: scale(1.02);
    }

    .hover\:scale-103:hover {
      transform: scale(1.03);
    }

    /* Animation de chargement moderne */
    .loading-dots {
      display: inline-flex;
      gap: 4px;
    }

    .loading-dots span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
      animation: loadingDots 1.4s ease-in-out infinite;
    }

    .loading-dots span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .loading-dots span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes loadingDots {
      0%, 80%, 100% {
        opacity: 0.3;
        transform: scale(0.8);
      }
      40% {
        opacity: 1;
        transform: scale(1.2);
      }
    }

    /* Effet de brillance au survol */
    .shine-effect {
      position: relative;
      overflow: hidden;
    }

    .shine-effect::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.2),
        transparent
      );
      transition: left 0.5s;
    }

    .shine-effect:hover::after {
      left: 100%;
    }
    .animate-bounceIn { animation: bounceIn 0.6s ease-out forwards; }
    
    /* Animated Fluid Background */
    .animated-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      overflow: hidden;
      background: radial-gradient(ellipse at center, #1a1510 0%, #0a0604 100%);
    }

    /* Organic neon flowing waves */
    .neon-wave {
      position: absolute;
      width: 200%;
      height: 150px;
      filter: blur(1px);
      opacity: 0.9;
    }

    .neon-wave svg {
      width: 100%;
      height: 100%;
    }

    /* Wave 1 - Main amber */
    .wave-1 {
      top: 15%;
      animation: wave-flow-1 25s ease-in-out infinite;
    }

    .wave-2 {
      top: 30%;
      animation: wave-flow-2 30s ease-in-out infinite reverse;
    }

    .wave-3 {
      top: 45%;
      animation: wave-flow-3 28s ease-in-out infinite;
    }

    .wave-4 {
      top: 60%;
      animation: wave-flow-4 32s ease-in-out infinite reverse;
    }

    .wave-5 {
      top: 75%;
      animation: wave-flow-5 26s ease-in-out infinite;
    }

    @keyframes wave-flow-1 {
      0%, 100% {
        transform: translateX(0) translateY(0);
      }
      50% {
        transform: translateX(-30%) translateY(-20px);
      }
    }

    @keyframes wave-flow-2 {
      0%, 100% {
        transform: translateX(-40%) translateY(0);
      }
      50% {
        transform: translateX(-10%) translateY(30px);
      }
    }

    @keyframes wave-flow-3 {
      0%, 100% {
        transform: translateX(-20%) translateY(0);
      }
      50% {
        transform: translateX(-50%) translateY(-25px);
      }
    }

    @keyframes wave-flow-4 {
      0%, 100% {
        transform: translateX(-35%) translateY(0);
      }
      50% {
        transform: translateX(-5%) translateY(20px);
      }
    }

    @keyframes wave-flow-5 {
      0%, 100% {
        transform: translateX(-25%) translateY(0);
      }
      50% {
        transform: translateX(-55%) translateY(-15px);
      }
    }

    /* Ambient glow orbs */
    .ambient-glow {
      position: absolute;
      border-radius: 50%;
      filter: blur(100px);
      opacity: 0.2;
      mix-blend-mode: screen;
      animation: ambient-pulse 10s ease-in-out infinite;
    }

    .glow-1 {
      width: 800px;
      height: 800px;
      top: -200px;
      left: -100px;
      background: radial-gradient(circle, rgba(251, 191, 36, 0.6) 0%, transparent 70%);
      animation-delay: 0s;
    }

    .glow-2 {
      width: 600px;
      height: 600px;
      top: 30%;
      right: -150px;
      background: radial-gradient(circle, rgba(245, 158, 11, 0.5) 0%, transparent 70%);
      animation-delay: 3s;
    }

    .glow-3 {
      width: 700px;
      height: 700px;
      bottom: -200px;
      left: 40%;
      background: radial-gradient(circle, rgba(217, 119, 6, 0.4) 0%, transparent 70%);
      animation-delay: 6s;
    }

    @keyframes ambient-pulse {
      0%, 100% {
        transform: scale(1);
        opacity: 0.2;
      }
      50% {
        transform: scale(1.3);
        opacity: 0.35;
      }
    }

    /* Particle sparkles */
    .sparkle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: rgba(251, 191, 36, 0.8);
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(251, 191, 36, 0.8), 0 0 20px rgba(251, 191, 36, 0.4);
      animation: sparkle-twinkle linear infinite;
    }

    @keyframes sparkle-twinkle {
      0%, 100% {
        opacity: 0;
        transform: scale(0) translateY(0);
      }
      50% {
        opacity: 1;
        transform: scale(1) translateY(-50vh);
      }
    }

    /* Improved iframe rendering for crisp display */
    iframe {
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      backface-visibility: hidden;
      transform: translateZ(0);
      will-change: transform;
    }
    
    .glass {
      background: rgba(30, 41, 59, 0.6);
      backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .glass::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;        opacity: 0;
      }
    }
    
    .glass {
      background: rgba(30, 41, 59, 0.6);
      backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .glass::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(251, 191, 36, 0.5), transparent);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .glass:hover::before {
      opacity: 1;
    }

    .glass:hover {
      background: rgba(30, 41, 59, 0.75);
      border-color: rgba(251, 191, 36, 0.4);
      transform: translateY(-4px) scale(1.01);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4), 0 0 30px rgba(251, 191, 36, 0.15);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 50%, var(--accent-primary) 100%);
      background-size: 200% 100%;
      position: relative;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px var(--accent-glow), inset 0 1px 0 rgba(255, 255, 255, 0.2);
      border: 1px solid var(--accent-primary);
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -150%;
      width: 150%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
      transition: left 0.7s ease;
    }

    .btn-primary::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .btn-primary:hover {
      background-position: 100% 0;
      transform: translateY(-2px);
      box-shadow: 0 12px 24px var(--accent-glow), 0 0 20px var(--accent-glow), inset 0 1px 0 rgba(255, 255, 255, 0.3);
      border-color: var(--accent-primary);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 4px 12px var(--accent-glow), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    .btn-primary:hover::before {
      left: 150%;
    }

    .btn-primary:hover::after {
      opacity: 1;
    }

    .btn-primary:active {
      transform: translateY(-2px) scale(1.01);
      box-shadow: 0 10px 25px var(--accent-glow);
    }

    /* Hover sur les stat cards avec transition de couleur */
    .stat-card:hover {
      transform: translateY(-10px) scale(1.03);
      box-shadow: 0 25px 50px rgba(0,0,0,0.4), 0 0 40px var(--accent-glow);
      border-color: var(--accent-primary);
    }

    /* Ajout de transition sur les éléments qui utilisent les variables CSS */
    .glass, .btn-primary, .stat-card, input:focus, textarea:focus, select:focus {
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .stat-card {
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, transparent, rgba(251, 191, 36, 0.2), transparent);
      opacity: 0;
      transition: opacity 0.5s ease;
      border-radius: inherit;
      z-index: -1;
    }

    .stat-card::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(251, 191, 36, 0.2) 0%, transparent 50%);
      opacity: 0;
      transition: opacity 0.5s ease;
      pointer-events: none;
    }

    .stat-card:hover::before {
      opacity: 1;
      animation: rotateGradient 3s linear infinite;
    }

    .stat-card:hover::after {
      opacity: 1;
    }

    /* Input futuriste avec effet néon */
    input, textarea, select {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      background: rgba(30, 41, 59, 0.5);
      border: 1px solid rgba(71, 85, 105, 0.5);
    }

    input:hover, textarea:hover, select:hover {
      background: rgba(30, 41, 59, 0.7);
      border-color: rgba(251, 191, 36, 0.3);
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      background: rgba(30, 41, 59, 0.9);
      border-color: #f59e0b !important;
      box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.15), 
                  0 0 30px rgba(251, 191, 36, 0.3),
                  0 8px 20px rgba(0, 0, 0, 0.3);
      transform: translateY(-2px);
    }

    /* Badge néon premium */
    .badge-glow {
      position: relative;
      box-shadow: 0 0 20px currentColor, 0 0 35px currentColor, inset 0 0 10px currentColor;
      animation: glow 2.5s ease-in-out infinite;
      border: 1px solid currentColor;
    }

    .badge-glow::before {
      content: '';
      position: absolute;
      inset: -2px;
      background: currentColor;
      opacity: 0.1;
      border-radius: inherit;
      animation: pulse 2s ease-in-out infinite;
    }

    /* Texte gradient animé premium */
    .gradient-text {
      background: linear-gradient(90deg, #f59e0b, #fbbf24, #fcd34d, #fbbf24, #f59e0b);
      background-size: 300% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: textShine 4s linear infinite;
      font-weight: 700;
      text-shadow: 0 0 30px rgba(251, 191, 36, 0.3);
    }

    /* Scrollbar ultra moderne */
    ::-webkit-scrollbar {
      width: 12px;
      height: 12px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.8);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, var(--accent-primary), var(--accent-secondary), var(--accent-primary));
      border-radius: 10px;
      border: 2px solid rgba(15, 23, 42, 0.8);
      box-shadow: 0 0 10px var(--accent-glow);
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, var(--accent-primary), var(--accent-secondary));
      box-shadow: 0 0 20px var(--accent-glow);
    }

    /* Effet ripple amélioré */
    button, a {
      position: relative;
      overflow: hidden;
    }

    button:active::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 0%, transparent 70%);
      transform: translate(-50%, -50%);
      animation: ripple 0.7s ease-out;
    }

    @keyframes ripple {
      to {
        width: 400px;
        height: 400px;
        opacity: 0;
      }
    }

    /* Transitions globales ultra fluides */
    * {
      transition-property: background-color, border-color, color, fill, stroke, opacity, box-shadow, transform, filter;
      transition-duration: 300ms;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    }

    button:active, .cursor-pointer:active {
      transform: scale(0.96);
    }

    /* Effet de profondeur pour les modals */
    .modal-backdrop {
      backdrop-filter: blur(15px) saturate(180%);
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body class="bg-slate-900 text-white">
  <div id="app"></div>

  <script>
    // Icônes SVG simplifiées
    const icons = {
      building: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="2" width="16" height="20" rx="2"/><path d="M9 22v-4h6v4M8 6h.01M16 6h.01M12 6h.01M8 10h.01M16 10h.01M12 10h.01M8 14h.01M16 14h.01M12 14h.01"/></svg>',
      aiLogo: '<svg width="32" height="32" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#D4AF37;stop-opacity:1" /><stop offset="50%" style="stop-color:#F4D03F;stop-opacity:1" /><stop offset="100%" style="stop-color:#FFD700;stop-opacity:1" /></linearGradient></defs><path d="M100 30 Q85 35 75 45 Q65 55 60 70 Q58 80 60 90 L65 100 L75 108 Q85 113 95 115" stroke="url(#goldGrad)" stroke-width="4" fill="none" stroke-linecap="round"/><path d="M100 30 Q115 35 125 45 Q135 55 140 70 Q142 80 140 90 L135 100 L125 108 Q115 113 105 115" stroke="url(#goldGrad)" stroke-width="4" fill="none" stroke-linecap="round"/><circle cx="70" cy="55" r="5" fill="url(#goldGrad)"/><circle cx="130" cy="55" r="5" fill="url(#goldGrad)"/><circle cx="60" cy="80" r="4" fill="url(#goldGrad)"/><circle cx="140" cy="80" r="4" fill="url(#goldGrad)"/><circle cx="75" cy="100" r="4" fill="url(#goldGrad)"/><circle cx="125" cy="100" r="4" fill="url(#goldGrad)"/><line x1="100" y1="30" x2="100" y2="120" stroke="url(#goldGrad)" stroke-width="4" stroke-linecap="round"/><line x1="100" y1="120" x2="85" y2="140" stroke="url(#goldGrad)" stroke-width="3" stroke-linecap="round"/><line x1="100" y1="120" x2="100" y2="150" stroke="url(#goldGrad)" stroke-width="3" stroke-linecap="round"/><line x1="100" y1="120" x2="115" y2="140" stroke="url(#goldGrad)" stroke-width="3" stroke-linecap="round"/><circle cx="85" cy="140" r="5" fill="url(#goldGrad)"/><circle cx="100" cy="150" r="5" fill="url(#goldGrad)"/><circle cx="115" cy="140" r="5" fill="url(#goldGrad)"/><line x1="70" y1="55" x2="85" y2="45" stroke="url(#goldGrad)" stroke-width="2.5"/><line x1="130" y1="55" x2="115" y2="45" stroke="url(#goldGrad)" stroke-width="2.5"/><line x1="60" y1="80" x2="75" y2="70" stroke="url(#goldGrad)" stroke-width="2.5"/><line x1="140" y1="80" x2="125" y2="70" stroke="url(#goldGrad)" stroke-width="2.5"/><circle cx="100" cy="30" r="6" fill="url(#goldGrad)"/></svg>',
      home: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>',
      users: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
      calendar: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>',
      chart: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>',
      search: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>',
      plus: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>',
      logout: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>',
      menu: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="18" x2="20" y2="18"/></svg>',
      x: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',
      user: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',
      euro: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"/></svg>',
      mapPin: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>',
      bed: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 4v16"/><path d="M2 8h18a2 2 0 0 1 2 2v10"/><path d="M2 17h20"/><path d="M6 8v9"/></svg>',
      maximize: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>',
      eye: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>',
      edit: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>',
      trash: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>',
      phone: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>',
      mail: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>',
      trendUp: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>',
      trendDown: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>',
      activity: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>',
      fileText: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>',
      dollarSign: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>',
      pieChart: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>',
      userCheck: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><polyline points="17 11 19 13 23 9"/></svg>',
      target: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>',
      brain: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"/><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"/><path d="M3.477 10.896a4 4 0 0 1 .585-.396"/><path d="M19.938 10.5a4 4 0 0 1 .585.396"/><path d="M6 18a4 4 0 0 1-1.967-.516"/><path d="M19.967 17.484A4 4 0 0 1 18 18"/></svg>',
      zap: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>',
      messageSquare: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>',
      checkCircle: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>',
      alertCircle: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>',
      clock: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',
      fileSignature: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="M10 18l5-5"/><path d="M15 18h.01"/></svg>',
      calculator: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="8" y1="10" x2="16" y2="10"/><line x1="8" y1="14" x2="16" y2="14"/><line x1="8" y1="18" x2="12" y2="18"/><line x1="16" y1="18" x2="16" y2="18"/></svg>',
      repeat: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>',
      sparkles: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>',
      trendingUp: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>',
      map: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/><line x1="8" y1="2" x2="8" y2="18"/><line x1="16" y1="6" x2="16" y2="22"/></svg>',
      barChart: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>',
      award: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>',
      creditCard: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>',
      crown: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 8l8 5 2-2 2 2 8-5v13H2V8z"/><path d="M6 3v2"/><path d="M12 3v2"/><path d="M18 3v2"/></svg>',
      package: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>',
      settings: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m5.656-16.971l-4.242 4.243m-2.828 2.828l-4.243 4.243m16.971-.656l-4.243-4.242m-2.828-2.828l-4.243-4.243M23 12h-6m-6 0H1m16.971 5.656l-4.242-4.243m-2.828-2.828l-4.243-4.243m-.656 16.971l4.243-4.242m2.828-2.828l4.243-4.243"/></svg>',
      creditCard: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>',
      check: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>',
      star: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>'
    };

    // État de l'application
    let state = {
      isLoading: true,
      showLoginChoice: false,
      loginEmail: '', // Email pour vérifier le rôle autorisé
      currentUser: null,
      currentPage: 'login',
      showPublicLanding: true,
      showRegistrationModal: false,
      showNewInterventionModal: false,
      syndicTab: 'signalements',
      showNewMessage: false,
      showNewSignalement: false,
      showSignalementDetail: false,
      selectedSignalementId: null,
      showModeleMessages: false,
      showRappelsTravaux: false,
      showDemandeDevis: false,
      showAssignArtisan: false,
      showSendMessage: false,
      showPlanifierIntervention: false,
      showInformerCopro: false,
      selectedCoproCommunication: null,
      communicationRecipients: 'all',
      newSignalement: {
        coproId: null,
        type: '',
        description: '',
        priority: 'moyenne',
        photos: [],
        createIntervention: false,
        informCopro: false
      },
      newMessage: {
        coproId: null,
        recipients: 'all', // all, conseil, specific
        subject: '',
        message: ''
      },
      newIntervention: {
        coproId: null,
        type: '',
        description: '',
        cost: ''
      },
      registrationStep: 1, // 1: choix plan, 2: infos, 3: paiement
      registrationData: {
        selectedPlan: 'pro',
        billingCycle: 'monthly',
        companyName: '',
        name: '',
        email: '',
        phone: '',
        password: ''
      },
      // Tutoriel interactif
      showTutorial: false,
      tutorialStep: 0,
      showChecklist: false,
      onboardingComplete: false,
      onboardingChecklist: {
        profile: false,
        addProperty: false,
        addClient: false,
        scheduleVisit: false,
        exploreAI: false,
        viewReports: false
      },
      // Système de messagerie interne
      showMessaging: false,
      messagingTab: 'compose', // compose, sent, templates
      newMessage: {
        to: [],
        subject: '',
        message: '',
        attachments: [] // properties, clients
      },
      sentMessages: [],
      messageTemplates: [
        {
          id: 1,
          name: 'Relance Client',
          subject: 'Suivi de votre recherche immobilière',
          message: 'Bonjour,\n\nJe me permets de vous recontacter concernant votre projet immobilier.\n\nAvez-vous eu l\'occasion de consulter les biens que je vous ai envoyés ?\n\nJe reste à votre disposition pour organiser des visites.\n\nCordialement'
        },
        {
          id: 2,
          name: 'Nouveau Bien',
          subject: 'Nouveau bien correspondant à vos critères',
          message: 'Bonjour,\n\nJ\'ai le plaisir de vous informer qu\'un nouveau bien correspondant à vos critères est disponible.\n\nVous trouverez les détails ci-joints.\n\nN\'hésitez pas à me contacter pour plus d\'informations ou pour organiser une visite.\n\nCordialement'
        },
        {
          id: 3,
          name: 'Attribution Client',
          subject: 'Nouveau client à contacter',
          message: 'Bonjour,\n\nJe vous attribue un nouveau client potentiel.\n\nMerci de le contacter rapidement et de faire un retour sur son intérêt.\n\nToutes les informations sont en pièce jointe.\n\nBon courage !'
        }
      ],
      // Configuration Email
      emailConfig: {
        isConfigured: false,
        provider: '', // 'gmail', 'outlook', 'custom'
        email: '',
        imapHost: '',
        imapPort: 993,
        smtpHost: '',
        smtpPort: 587,
        password: ''
      },
      showEmailInbox: false,
      emailInbox: [
        {
          id: 1,
          from: 'client@example.com',
          fromName: 'Jean Dupont',
          subject: 'Demande de visite - Villa Provence',
          preview: 'Bonjour, je suis intéressé par la villa à Aix-en-Provence...',
          body: 'Bonjour,\n\nJe suis intéressé par la villa à Aix-en-Provence que j\'ai vue sur votre site.\n\nSerait-il possible d\'organiser une visite ce week-end ?\n\nCordialement,\nJean Dupont',
          date: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
          read: false,
          starred: false
        },
        {
          id: 2,
          from: 'prospect@example.com',
          fromName: 'Sophie Martin',
          subject: 'Recherche appartement 3 pièces',
          preview: 'Bonjour, je recherche un appartement de 3 pièces sur Marseille...',
          body: 'Bonjour,\n\nJe recherche un appartement de 3 pièces sur Marseille avec un budget de 300 000€.\n\nAvez-vous des biens disponibles ?\n\nCordialement,\nSophie Martin',
          date: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(),
          read: false,
          starred: true
        },
        {
          id: 3,
          from: 'notaire@example.com',
          fromName: 'Maître Leroy',
          subject: 'Documents signature - Appartement Centre Ville',
          preview: 'Bonjour, veuillez trouver ci-joint les documents pour la signature...',
          body: 'Bonjour,\n\nVeuillez trouver ci-joint les documents pour la signature de l\'appartement Centre Ville.\n\nLa signature est prévue le 15 février.\n\nCordialement,\nMaître Leroy',
          date: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
          read: true,
          starred: false
        }
      ],
      selectedEmail: null,
      composeEmail: {
        to: '',
        subject: '',
        body: ''
      },
      // Personnalisation de l'interface
      customization: {
        theme: 'dark', // 'dark', 'blue', 'purple', 'green', 'red'
        fontFamily: 'montserrat', // 'montserrat', 'inter', 'roboto', 'poppins', 'sora'
        backgroundScheme: 'amber', // 'amber', 'blue', 'purple', 'green', 'cyan', 'rose'
        backgroundTheme: 'purple-pink', // Nouveau thème de fond
      },
      // Gestion des collaborateurs
      teamMembers: [
        // Exemples de collaborateurs invités
        { 
          id: 1, 
          name: 'Agent Commercial', 
          email: 'agent@agence.com', 
          role: 'agent', 
          phone: '+33 6 12 34 56 78',
          status: 'active',
          invitedBy: 'Philippe Rousseau',
          invitedAt: '2026-01-15'
        },
        { 
          id: 2, 
          name: 'Julie Martin', 
          email: 'julie.martin@agence.com', 
          role: 'agent', 
          phone: '+33 6 23 45 67 89',
          status: 'active',
          invitedBy: 'Philippe Rousseau',
          invitedAt: '2026-01-20'
        }
      ],
      showAddMember: false,
      newMember: {
        name: '',
        email: '',
        role: 'agent',
        phone: ''
      },
      mobileMenuOpen: false,
      searchTerm: '',
      filterType: 'all',
      filterStatus: 'all',
      showAddProperty: false,
      showAddClient: false,
      showAddVisit: false,
      properties: [
        { id: 1, title: 'Villa Moderne Provence', type: 'Villa', price: 850000, surface: 250, rooms: 5, bathrooms: 3, location: 'Aix-en-Provence', status: 'Disponible', image: '🏡', agent: 'Marie Dubois', addedDate: '2026-01-15', visits: 12 },
        { id: 2, title: 'Appartement Centre Ville', type: 'Appartement', price: 320000, surface: 85, rooms: 3, bathrooms: 1, location: 'Marseille', status: 'Sous offre', image: '🏢', agent: 'Jean Martin', addedDate: '2026-01-20', visits: 8 },
        { id: 3, title: 'Maison Provençale', type: 'Maison', price: 650000, surface: 180, rooms: 4, bathrooms: 2, location: 'Luberon', status: 'Disponible', image: '🏘️', agent: 'Marie Dubois', addedDate: '2026-01-10', visits: 15 },
        { id: 4, title: 'Loft Industriel', type: 'Loft', price: 425000, surface: 120, rooms: 2, bathrooms: 2, location: 'Avignon', status: 'Vendu', image: '🏭', agent: 'Jean Martin', addedDate: '2025-12-28', visits: 22 }
      ],
      clients: [
        { 
          id: 1, 
          name: 'Sophie Laurent', 
          email: 'sophie.laurent@email.com', 
          phone: '+33 6 12 34 56 78', 
          type: 'Acheteur', 
          budget: '300-400k€', 
          status: 'Actif', 
          agent: 'Marie Dubois', 
          addedDate: '2026-01-18', 
          lastContact: '2026-01-28',
          // Données IA
          aiScore: 92,
          visitFrequency: 8, // nombre de visites
          responseRate: 95, // % de réponses
          clicks: 42, // clics sur emails/propriétés
          avgResponseTime: 2.5, // heures
          engagement: 'high', // high, medium, low
          tags: ['🔥 Chaud', '⚡ Réactif', '💰 Budget confirmé'],
          completedActions: [] // Actions complétées
        },
        { 
          id: 2, 
          name: 'Thomas Petit', 
          email: 'thomas.petit@email.com', 
          phone: '+33 6 23 45 67 89', 
          type: 'Vendeur', 
          budget: 'N/A', 
          status: 'En attente', 
          agent: 'Jean Martin', 
          addedDate: '2026-01-22', 
          lastContact: '2026-01-25',
          // Données IA
          aiScore: 45,
          visitFrequency: 1,
          responseRate: 40,
          clicks: 8,
          avgResponseTime: 48,
          engagement: 'low',
          tags: ['❄️ Froid', '⏰ Lent', '❓ Indécis'],
          completedActions: []
        },
        { 
          id: 3, 
          name: 'Claire Bernard', 
          email: 'claire.b@email.com', 
          phone: '+33 6 34 56 78 90', 
          type: 'Acheteur', 
          budget: '500-700k€', 
          status: 'Actif', 
          agent: 'Marie Dubois', 
          addedDate: '2026-01-12', 
          lastContact: '2026-01-29',
          // Données IA
          aiScore: 88,
          visitFrequency: 6,
          responseRate: 90,
          clicks: 35,
          avgResponseTime: 4,
          engagement: 'high',
          tags: ['🔥 Chaud', '💎 Premium', '🎯 Ciblé'],
          completedActions: []
        },
        { 
          id: 4, 
          name: 'Lucas Rousseau', 
          email: 'l.rousseau@email.com', 
          phone: '+33 6 45 67 89 01', 
          type: 'Acheteur', 
          budget: '200-300k€', 
          status: 'Converti', 
          agent: 'Jean Martin', 
          addedDate: '2025-12-20', 
          lastContact: '2026-01-15',
          // Données IA
          aiScore: 100,
          visitFrequency: 12,
          responseRate: 100,
          clicks: 58,
          avgResponseTime: 1,
          engagement: 'converted',
          tags: ['✅ Converti', '⭐ Excellent', '🚀 Champion'],
          completedActions: []
        },
        { 
          id: 5, 
          name: 'Emma Dubois', 
          email: 'emma.d@email.com', 
          phone: '+33 6 56 78 90 12', 
          type: 'Acheteur', 
          budget: '400-500k€', 
          status: 'Actif', 
          agent: 'Marie Dubois', 
          addedDate: '2026-01-25', 
          lastContact: '2026-01-29',
          // Données IA
          aiScore: 72,
          visitFrequency: 4,
          responseRate: 75,
          clicks: 22,
          avgResponseTime: 8,
          engagement: 'medium',
          tags: ['🌡️ Tiède', '👀 Observateur', '💭 Réfléchit'],
          completedActions: []
        },
        { 
          id: 6, 
          name: 'Antoine Martin', 
          email: 'a.martin@email.com', 
          phone: '+33 6 67 89 01 23', 
          type: 'Acheteur', 
          budget: '350-450k€', 
          status: 'Actif', 
          agent: 'Jean Martin', 
          addedDate: '2026-01-20', 
          lastContact: '2026-01-27',
          // Données IA
          aiScore: 58,
          visitFrequency: 2,
          responseRate: 60,
          clicks: 15,
          avgResponseTime: 24,
          engagement: 'medium',
          tags: ['🌡️ Tiède', '🐌 Passif', '📅 Planifie'],
          completedActions: []
        }
      ],
      visits: [
        { id: 1, propertyId: 1, clientId: 1, date: '2026-02-02', time: '10:00', status: 'Programmée', notes: 'Première visite', agent: 'Marie Dubois' },
        { id: 2, propertyId: 2, clientId: 3, date: '2026-02-03', time: '14:30', status: 'Programmée', notes: 'Client très intéressé', agent: 'Marie Dubois' },
        { id: 3, propertyId: 3, clientId: 2, date: '2026-01-30', time: '11:00', status: 'Confirmée', notes: 'Seconde visite', agent: 'Jean Martin' },
        { id: 4, propertyId: 1, clientId: 4, date: '2026-01-28', time: '15:00', status: 'Terminée', notes: 'Visite satisfaisante', agent: 'Jean Martin' }
      ],
      newProperty: { 
        title: '', 
        type: 'Appartement', 
        price: '', 
        surface: '', 
        rooms: '', 
        bathrooms: '', 
        bedrooms: '', 
        floor: '', 
        totalFloors: '', 
        location: '', 
        status: 'Disponible', 
        description: '',
        parking: '0',
        balcony: false,
        terrace: false,
        garden: false,
        elevator: false,
        furnished: false,
        newConstruction: false,
        energyClass: '',
        heating: 'Individuel',
        orientation: '',
        yearBuilt: '',
        charges: '',
        propertyTax: '',
        availability: 'Immédiate'
      },
      newClient: { name: '', email: '', phone: '', type: 'Acheteur', budget: '', status: 'Actif', notes: '' },
      newVisit: { propertyId: '', clientId: '', date: '', time: '', notes: '' },
      agents: [
        { name: 'Marie Dubois', sales: 3, revenue: 1820000, clients: 8, performance: 95 },
        { name: 'Jean Martin', sales: 2, revenue: 745000, clients: 6, performance: 88 },
        { name: 'Sophie Bernard', sales: 1, revenue: 320000, clients: 4, performance: 82 }
      ],
      // Gestion des collaborateurs
      collaborators: [
        { id: 1, name: 'Marie Dubois', email: 'marie@agence.com', role: 'agent', status: 'active', invitedDate: '2025-11-15', lastLogin: '2026-01-29' }
      ],
      showAddCollaborator: false,
      newCollaborator: {
        name: '',
        email: '',
        role: 'agent'
      },
      subscription: {
        currentPlan: 'trial', // 'trial', 'starter', 'pro', 'enterprise'
        billingCycle: 'monthly', // 'monthly', 'yearly'
        nextBillingDate: '2026-02-29',
        amount: 99,
        paymentMethod: 'Carte •••• 4242',
        hasUsedFreeTrial: true, // Devient true après avoir utilisé l'essai gratuit
        plans: {
          trial: {
            name: 'Essai Gratuit',
            price: { monthly: 0, yearly: 0 },
            trial: true,
            features: [
              '🎁 7 jours gratuits',
              '✅ TOUTES fonctionnalités Entreprise',
              '♾️ Collaborateurs illimités',
              '♾️ Biens & clients illimités',
              '🤖 IA Lead Scoring avancé',
              '📊 Rapports & Analytics IA',
              '💬 Chat + Tracking emails',
              '📱 SMS automatiques visites',
              '✨ Générateur emails IA',
              '💰 Calcul honoraires auto',
              '📈 Stats avancées par bien',
              '🎯 Prévisions ventes IA',
              '⚡ Support prioritaire avancé',
              '❌ Sans carte bancaire',
              '❌ Sans engagement'
            ],
            limits: { users: -1, properties: -1, clients: -1 }
          },
          starter: {
            name: 'Starter',
            price: { monthly: 29, yearly: 290 },
            features: [
              '1 utilisateur (gérant uniquement)',
              'Aucun collaborateur',
              '30 biens maximum',
              '15 clients maximum',
              'Gestion des visites',
              'Dashboard basique',
              'Support email'
            ],
            limits: { users: 0, properties: 30, clients: 15 }
          },
          pro: {
            name: 'Pro',
            price: { monthly: 79, yearly: 790 },
            popular: true,
            features: [
              'Gérant + 1 collaborateur',
              '50 biens maximum',
              '30 clients maximum',
              'Gestion complète',
              '💬 Chat en direct',
              '📧 Tracking emails',
              'Signature électronique',
              'Calendrier visites',
              'Générateur emails IA basique',
              'Support prioritaire'
            ],
            limits: { users: 1, properties: 50, clients: 30 }
          },
          enterprise: {
            name: 'Entreprise',
            price: { monthly: 149, yearly: 1490 },
            features: [
              '♾️ Collaborateurs illimités',
              '♾️ Biens illimités',
              '♾️ Clients illimités',
              '✅ Toutes fonctionnalités Pro',
              '🤖 Assistant IA avancé',
              '🏢 Module Pro Syndic',
              '📡 Publication Multi-Portails',
              '📧 Tracking Emails',
              '📊 Stats avancées par bien',
              '📱 SMS automatiques visites',
              '💰 Calcul honoraires auto',
              '📈 Rapports & Analytics IA',
              '🎯 Prévisions ventes IA',
              "👥 Gestion d'équipe complète",
              '🔗 API Access',
              '⚡ Support prioritaire 24/7',
              '🎓 Formation personnalisée'
            ],
            limits: { users: -1, properties: -1, clients: -1 }
          }
        }
      },
      aiAnalysisLoading: false,
      lastAIUpdate: null,
      currentSubscription: 'trial', // trial pour démo, starter par défaut en prod
      subscriptionPlans: [
        {
          id: 'starter',
          name: 'Starter',
          price: 29,
          period: 'mois',
          description: 'Pour tester et démarrer',
          popular: false,
          features: [
            '30 biens maximum',
            '15 clients maximum',
            'Calendrier des visites',
            'Dashboard basique',
            'Support email',
            'Gestion simple'
          ]
        },
        {
          id: 'pro',
          name: 'Pro',
          price: 79,
          period: 'mois',
          description: 'Pour petites agences',
          popular: true,
          features: [
            '✨ Tout du plan Starter',
            '1 collaborateur inclus',
            '50 biens • 30 clients',
            '💬 Chat en direct',
            '📧 Tracking emails',
            'Générateur emails IA',
            'Signature électronique',
            'Support prioritaire'
          ]
        },
        {
          id: 'enterprise',
          name: 'Entreprise',
          price: 149,
          period: 'mois',
          description: 'Automatisation & IA complète',
          popular: false,
          features: [
            '🏆 Tout du plan Pro',
            '♾️ Collaborateurs illimités',
            '♾️ Biens & clients illimités',
            '🤖 Assistant IA avancé complet',
            '🏢 Module Pro Syndic inclus',
            '📡 Publication Multi-Portails (15+)',
            '📧 Tracking Emails illimité',
            '📊 Stats avancées par bien',
            '📱 SMS automatiques visites',
            '💰 Calcul honoraires automatique',
            '📈 Rapports & Analytics IA',
            '🎯 Prévisions ventes IA',
            '👥 Gestion équipe complète',
            '📊 Dashboard gérant avancé',
            '🏃 Performance agents en temps réel',
            '🎯 Objectifs et KPIs personnalisés',
            '🔗 API Access complet',
            '🎨 Option White Label',
            '⚡ Support prioritaire 24/7',
            '🎓 Formation personnalisée incluse'
          ]
        }
      ],
      aiSuggestions: {
        urgentTasks: [
          { id: 1, type: 'urgent', priority: 'Haute', title: 'Relance client Sophie Laurent', description: 'Aucun contact depuis 15 jours - Budget 300-400k€', client: 'Sophie Laurent', days: 15, action: 'Appeler' },
          { id: 2, type: 'urgent', priority: 'Haute', title: 'Signature contrat en attente', description: 'Villa Moderne Provence - Offre acceptée', property: 'Villa Moderne Provence', days: 3, action: 'Signature électronique' },
          { id: 3, type: 'medium', priority: 'Moyenne', title: 'Visite de suivi requise', description: 'Claire Bernard - 2ème visite Maison Provençale', client: 'Claire Bernard', days: 7, action: 'Programmer visite' },
          { id: 4, type: 'low', priority: 'Basse', title: 'Mise à jour photos bien', description: 'Loft Industriel - Photos datant de 2 mois', property: 'Loft Industriel', days: 60, action: 'Planifier shooting' }
        ],
        suggestedResponses: [
          { id: 1, client: 'Sophie Laurent', context: 'Demande d\'informations sur financement', response: 'Bonjour Sophie,\n\nMerci pour votre intérêt ! Pour un bien de 350 000 €, avec un apport de 70 000 € (20%), voici une simulation :\n\n• Montant emprunté : 280 000 €\n• Durée : 25 ans\n• Taux estimé : 4.2%\n• Mensualité : ~1 480 €\n\nJe reste à votre disposition pour un rendez-vous avec notre partenaire bancaire.\n\nCordialement,\nMarie Dubois', tone: 'Professionnel' },
          { id: 2, client: 'Thomas Petit', context: 'Relance après visite', response: 'Bonjour Thomas,\n\nSuite à votre visite de la Maison Provençale hier, j\'espère que vous avez apprécié le bien !\n\nJ\'ai remarqué votre intérêt pour le jardin et la luminosité. Souhaitez-vous :\n• Une 2ème visite avec un expert en rénovation ?\n• Des informations complémentaires sur le quartier ?\n• Une estimation de travaux éventuels ?\n\nN\'hésitez pas, je suis là pour vous accompagner.\n\nBien à vous,\nMarie', tone: 'Amical' }
        ],
        financingSimulations: [
          { clientId: 1, client: 'Sophie Laurent', propertyPrice: 350000, downPayment: 70000, loanAmount: 280000, duration: 25, rate: 4.2, monthlyPayment: 1480, totalCost: 444000, status: 'Favorable' },
          { clientId: 3, client: 'Claire Bernard', propertyPrice: 650000, downPayment: 130000, loanAmount: 520000, duration: 25, rate: 4.1, monthlyPayment: 2730, totalCost: 819000, status: 'À valider' }
        ],
        reactivationSuggestions: [
          { id: 1, client: 'Lucas Rousseau', lastContact: '45 jours', budget: '200-300k€', interest: 'Appartement Centre Ville', message: 'Bonjour Lucas ! Je voulais vous informer que nous avons 3 nouveaux appartements dans votre budget à Marseille. Seriez-vous intéressé par une présentation virtuelle cette semaine ?', probability: 85 },
          { id: 2, client: 'Marie Legrand', lastContact: '30 jours', budget: '400-500k€', interest: 'Maison avec jardin', message: 'Bonjour Marie, une magnifique maison avec jardin de 200m² vient d\'arriver sur le marché à Aix. Elle correspond parfaitement à vos critères. Disponible pour une visite ce weekend ?', probability: 72 }
        ],
        marketAnalysis: {
          globalTrend: {
            direction: 'hausse',
            percentage: 5.2,
            period: '3 derniers mois',
            prediction: 'hausse',
            predictionPercentage: 3.8,
            nextPeriod: '6 prochains mois'
          },
          zones: [
            { id: 1, name: 'Aix-en-Provence Centre', trend: 'hausse', percentage: 8.5, avgPrice: 4800, pricePerSqm: true, potential: 'Très élevé', reason: 'Nouvelles infrastructures de transport + zone piétonne étendue', investment: 95 },
            { id: 2, name: 'Marseille - Vieux Port', trend: 'hausse', percentage: 6.2, avgPrice: 3900, pricePerSqm: true, potential: 'Élevé', reason: 'Rénovation urbaine et attractivité touristique croissante', investment: 88 },
            { id: 3, name: 'Avignon - Intra-muros', trend: 'hausse', percentage: 4.1, avgPrice: 3200, pricePerSqm: true, potential: 'Élevé', reason: 'Festival et patrimoine culturel en expansion', investment: 82 },
            { id: 4, name: 'Luberon Villages', trend: 'stable', percentage: 1.2, avgPrice: 4200, pricePerSqm: true, potential: 'Moyen', reason: 'Marché mature avec demande stable', investment: 70 },
            { id: 5, name: 'Marseille - Quartiers Nord', trend: 'baisse', percentage: -2.3, avgPrice: 2100, pricePerSqm: true, potential: 'Faible', reason: 'Problèmes de sécurité et d\'image', investment: 45 }
          ],
          emergingNeighborhoods: [
            { id: 1, name: 'La Joliette - Marseille', status: 'Émergent', score: 92, growth: 12.5, avgPrice: 3100, reasons: ['Euroméditerranée en expansion', 'Nouveaux bureaux et commerces', 'Connexion tramway'], timeframe: '2-3 ans', recommendation: 'Achat fortement recommandé' },
            { id: 2, name: 'Encagnane - Aix-en-Provence', status: 'En développement', score: 87, growth: 9.8, avgPrice: 3600, reasons: ['Nouveau campus universitaire', 'Zone résidentielle calme', 'Proximité centre-ville'], timeframe: '3-5 ans', recommendation: 'Opportunité intéressante' },
            { id: 3, name: 'Monclar - Avignon', status: 'À surveiller', score: 75, growth: 6.2, avgPrice: 2800, reasons: ['Projets de rénovation annoncés', 'Prix encore accessibles', 'Demande locative forte'], timeframe: '5+ ans', recommendation: 'Potentiel à long terme' }
          ],
          propertyTypes: [
            { type: 'Appartement T2/T3', trend: 'hausse', percentage: 7.2, demand: 'Très forte', supply: 'Limitée', recommendation: 'Investissement prioritaire' },
            { type: 'Maison avec jardin', trend: 'hausse', percentage: 5.8, demand: 'Forte', supply: 'Moyenne', recommendation: 'Bon investissement' },
            { type: 'Villa de luxe', trend: 'stable', percentage: 2.1, demand: 'Moyenne', supply: 'Limitée', recommendation: 'Marché de niche' },
            { type: 'Loft/Atelier', trend: 'hausse', percentage: 9.5, demand: 'Croissante', supply: 'Très limitée', recommendation: 'Forte opportunité' }
          ]
        }
      },
      // IA Email Generator
      selectedEmailClient: '',
      emailType: '',
      emailProperty: '',
      emailTone: 'friendly',
      emailAdditionalInfo: '',
      generatedEmail: null,
      // Chat System
      showChat: false,
      chatConversations: [
        {
          id: 1,
          participantId: 1,
          participantName: 'Sophie Laurent',
          participantType: 'client',
          participantAvatar: 'SL',
          lastMessage: 'Merci pour les informations !',
          lastMessageTime: new Date(Date.now() - 30 * 60 * 1000).toISOString(),
          unreadCount: 2,
          messages: [
            { id: 1, senderId: 1, senderName: 'Sophie Laurent', text: 'Bonjour, je suis intéressée par la Villa Moderne', timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(), read: true },
            { id: 2, senderId: 'me', senderName: 'Vous', text: 'Bonjour Sophie ! Avec plaisir, je vous envoie les détails', timestamp: new Date(Date.now() - 1.5 * 60 * 60 * 1000).toISOString(), read: true },
            { id: 3, senderId: 1, senderName: 'Sophie Laurent', text: 'Serait-il possible de visiter ce weekend ?', timestamp: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString(), read: true },
            { id: 4, senderId: 'me', senderName: 'Vous', text: 'Bien sûr ! Samedi 14h vous conviendrait ?', timestamp: new Date(Date.now() - 45 * 60 * 1000).toISOString(), read: true },
            { id: 5, senderId: 1, senderName: 'Sophie Laurent', text: 'Merci pour les informations !', timestamp: new Date(Date.now() - 30 * 60 * 1000).toISOString(), read: false }
          ]
        },
        {
          id: 2,
          participantId: 2,
          participantName: 'Thomas Petit',
          participantType: 'client',
          participantAvatar: 'TP',
          lastMessage: 'Vous : Parfait, je prépare le dossier',
          lastMessageTime: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(),
          unreadCount: 0,
          messages: [
            { id: 1, senderId: 2, senderName: 'Thomas Petit', text: 'Le bien est toujours disponible ?', timestamp: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString(), read: true },
            { id: 2, senderId: 'me', senderName: 'Vous', text: 'Oui ! Souhaitez-vous faire une offre ?', timestamp: new Date(Date.now() - 5.5 * 60 * 60 * 1000).toISOString(), read: true },
            { id: 3, senderId: 2, senderName: 'Thomas Petit', text: 'Oui, je peux proposer 315k€', timestamp: new Date(Date.now() - 5.2 * 60 * 60 * 1000).toISOString(), read: true },
            { id: 4, senderId: 'me', senderName: 'Vous', text: 'Parfait, je prépare le dossier', timestamp: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(), read: true }
          ]
        }
      ],
      activeChatId: null,
      chatMessage: '',
      // Email Tracking
      emailTracking: [
        { id: 1, clientId: 1, clientName: 'Sophie Laurent', subject: 'Villa Moderne Provence - Présentation', sentDate: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(), opened: true, openCount: 3, lastOpened: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(), clicked: true, clickCount: 2 },
        { id: 2, clientId: 2, clientName: 'Thomas Petit', subject: 'Suivi visite Maison Provençale', sentDate: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(), opened: true, openCount: 1, lastOpened: new Date(Date.now() - 18 * 60 * 60 * 1000).toISOString(), clicked: false, clickCount: 0 },
        { id: 3, clientId: 3, clientName: 'Claire Bernard', subject: 'Nouveaux biens disponibles', sentDate: new Date(Date.now() - 12 * 60 * 60 * 1000).toISOString(), opened: false, openCount: 0, lastOpened: null, clicked: false, clickCount: 0 }
      ],
      // SMS Visits
      smsNotifications: [
        { id: 1, clientId: 1, clientName: 'Sophie Laurent', visitId: 1, type: 'confirmation', status: 'sent', sentDate: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(), message: 'Visite confirmée demain 14h - Villa Moderne Provence. À bientôt !' },
        { id: 2, clientId: 2, clientName: 'Thomas Petit', visitId: 2, type: 'reminder', status: 'sent', sentDate: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(), message: 'Rappel : Visite dans 2h - Appartement Centre Ville. RDV sur place !' }
      ],
      smsAutoEnabled: true,
      // Property Stats
      propertyStats: {
        1: { views: 245, favorites: 18, visits: 12, emailsSent: 34, avgTimeOnPage: 185, conversionRate: 4.9, lastActivity: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString() },
        2: { views: 178, favorites: 12, visits: 8, emailsSent: 22, avgTimeOnPage: 142, conversionRate: 4.5, lastActivity: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString() },
        3: { views: 312, favorites: 25, visits: 15, emailsSent: 45, avgTimeOnPage: 203, conversionRate: 4.8, lastActivity: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString() },
        4: { views: 456, favorites: 38, visits: 22, emailsSent: 67, avgTimeOnPage: 178, conversionRate: 4.8, lastActivity: new Date(Date.now() - 12 * 24 * 60 * 60 * 1000).toISOString() }
      },
      // Commission Calculator
      commissionSettings: {
        type: 'percentage', // percentage or fixed
        sellerRate: 5, // %
        buyerRate: 0, // %
        minCommission: 5000, // €
        maxCommission: 50000, // €
        includeTax: true,
        taxRate: 20 // %
      },
      selectedPropertyForCommission: null,
      toolsTab: 'tracking',
      // Multi-portal publication
      multiPortal: {
        selectedProperty: null,
        selectedPortals: ['leboncoin', 'pap', 'paruvendu'], // Portails sélectionnés par défaut
        publishImmediately: true,
        scheduledDate: '',
        scheduledTime: '',
        autoSync: true,
        removeWhenSold: true,
        updatePrice: true,
        sendReport: true,
        alertOnError: true
      },
      publications: [
        // Exemple de publication existante
        {
          id: 1,
          propertyId: 1,
          propertyTitle: 'Villa Moderne Provence',
          publishedDate: '2026-01-28T10:30:00',
          portals: [
            { name: 'leboncoin', status: 'published', views: 3891, contacts: 45, url: 'https://leboncoin.fr/...' },
            { name: 'seloger', status: 'published', views: 1247, contacts: 23, url: 'https://seloger.com/...' },
            { name: 'bienici', status: 'published', views: 567, contacts: 12, url: 'https://bienici.com/...' },
            { name: 'pap', status: 'pending', views: 0, contacts: 0, url: '' },
            { name: 'logic-immo', status: 'published', views: 892, contacts: 18, url: 'https://logic-immo.com/...' },
            { name: 'paruvendu', status: 'published', views: 234, contacts: 5, url: 'https://paruvendu.fr/...' },
            { name: 'figaro', status: 'error', views: 0, contacts: 0, url: '', error: 'Photos insuffisantes (min. 5)' }
          ]
        }
      ],
      availablePortals: [
        // Tier 1 - Gratuits
        { id: 'leboncoin', name: 'LeBonCoin', tier: 'free', status: 'active', logo: '🟡', minPhotos: 1, maxPhotos: 10, maxDescLength: 4000 },
        { id: 'pap', name: 'PAP', tier: 'free', status: 'active', logo: '🏠', minPhotos: 3, maxPhotos: 20, maxDescLength: 500 },
        { id: 'paruvendu', name: 'ParuVendu', tier: 'free', status: 'active', logo: '📰', minPhotos: 1, maxPhotos: 15, maxDescLength: 2000 },
        { id: 'entreparticuliers', name: 'EntreParticuliers', tier: 'free', status: 'active', logo: '🤝', minPhotos: 2, maxPhotos: 12, maxDescLength: 1500 },
        { id: 'immobilier-notaires', name: 'Immobilier Notaires', tier: 'free', status: 'active', logo: '⚖️', minPhotos: 3, maxPhotos: 10, maxDescLength: 1000 },
        // Tier 2 - Premium
        { id: 'seloger', name: 'SeLoger', tier: 'premium', status: 'active', logo: '🔵', minPhotos: 3, maxPhotos: 30, maxDescLength: 3000 },
        { id: 'bienici', name: "Bien\'ici", tier: 'premium', status: 'active', logo: '🟢', minPhotos: 5, maxPhotos: 25, maxDescLength: 2500 },
        { id: 'logic-immo', name: 'Logic-Immo', tier: 'premium', status: 'active', logo: '🔷', minPhotos: 4, maxPhotos: 20, maxDescLength: 2000 },
        { id: 'figaro', name: 'Figaro Propriétés', tier: 'premium', status: 'inactive', logo: '📰', minPhotos: 5, maxPhotos: 15, maxDescLength: 1500 },
        { id: 'belles-demeures', name: 'Belles Demeures', tier: 'premium', status: 'active', logo: '🏰', minPhotos: 8, maxPhotos: 30, maxDescLength: 3000 },
        { id: 'residences-immo', name: 'Résidences Immobilier', tier: 'premium', status: 'active', logo: '🏢', minPhotos: 5, maxPhotos: 20, maxDescLength: 2000 },
        { id: 'lux-residence', name: 'Lux-Residence', tier: 'premium', status: 'active', logo: '💎', minPhotos: 10, maxPhotos: 40, maxDescLength: 4000 },
        { id: 'green-acres', name: 'Green-Acres', tier: 'premium', status: 'active', logo: '🌍', minPhotos: 5, maxPhotos: 25, maxDescLength: 2500 },
        { id: 'immobilier-com', name: 'Immobilier.com', tier: 'premium', status: 'active', logo: '🔶', minPhotos: 3, maxPhotos: 20, maxDescLength: 2000 },
        { id: 'acheter-louer', name: 'Acheter-Louer.fr', tier: 'premium', status: 'active', logo: '🏘️', minPhotos: 4, maxPhotos: 18, maxDescLength: 1800 }
      ],
      // Module Syndic de Copropriété
      syndic: {
        coproperties: [
          {
            id: 1,
            name: 'Résidence Les Oliviers',
            address: '15 Avenue de Provence, 13100 Aix-en-Provence',
            lots: 45,
            residents: 45,
            budget: 125000,
            nextAG: '2026-03-15',
            status: 'active'
          },
          {
            id: 2,
            name: 'Le Clos des Vignes',
            address: '8 Rue du Château, 84000 Avignon',
            lots: 28,
            residents: 28,
            budget: 78000,
            nextAG: '2026-04-20',
            status: 'active'
          }
        ],
        charges: [
          { id: 1, coproId: 1, month: '2026-01', amount: 10500, paid: 9800, pending: 700 },
          { id: 2, coproId: 1, month: '2026-02', amount: 10500, paid: 10200, pending: 300 },
          { id: 3, coproId: 2, month: '2026-01', amount: 6500, paid: 6500, pending: 0 },
          { id: 4, coproId: 2, month: '2026-02', amount: 6500, paid: 6200, pending: 300 }
        ],
        interventions: [
          { id: 1, coproId: 1, type: 'Plomberie', description: 'Fuite hall entrée', date: '2026-02-10', status: 'completed', cost: 450 },
          { id: 2, coproId: 1, type: 'Électricité', description: 'Éclairage parking', date: '2026-02-15', status: 'pending', cost: 1200 },
          { id: 3, coproId: 2, type: 'Espaces verts', description: 'Taille haies', date: '2026-02-05', status: 'completed', cost: 380 }
        ],
        documents: [
          { id: 1, coproId: 1, name: 'PV Assemblée Générale 2025', type: 'pv', date: '2025-12-10', size: '2.4 MB' },
          { id: 2, coproId: 1, name: 'Contrat Ascensoriste', type: 'contrat', date: '2025-01-15', size: '890 KB' },
          { id: 3, coproId: 2, name: 'Règlement Copropriété', type: 'reglement', date: '2024-06-20', size: '1.2 MB' }
        ],
        messages: [
          { id: 1, coproId: 1, subject: 'Travaux ascenseur planifiés', content: 'Chers copropriétaires,\\n\\nNous vous informons que des travaux de maintenance sur l\'ascenseur sont prévus du 10 au 12 février.\\n\\nMerci de votre compréhension.', date: '2026-02-02', recipients: 45, readBy: 38, author: 'Marie Dubois', hasAttachments: true },
          { id: 2, coproId: 2, subject: 'Fermeture parking temporaire', content: 'Bonjour,\\n\\nLe parking sera fermé le 15 février pour travaux de réfection. Merci de prévoir un stationnement alternatif.', date: '2026-01-30', recipients: 28, readBy: 25, author: 'Marie Dubois', hasAttachments: false },
          { id: 3, coproId: 1, subject: 'Coupure d\'eau programmée', content: 'Une intervention sur le réseau d\'eau nécessite une coupure le 8 février de 9h à 12h. Merci de votre compréhension.', date: '2026-02-05', recipients: 45, readBy: 18, author: 'Marie Dubois', hasAttachments: true }
        ],
        residents: [
          { id: 1, coproId: 1, name: 'Jean Dupont', lot: 'A12', email: 'jean.dupont@email.com', phone: '06 12 34 56 78', role: 'coproprietaire' },
          { id: 2, coproId: 1, name: 'Sophie Martin', lot: 'B05', email: 'sophie.martin@email.com', phone: '06 23 45 67 89', role: 'coproprietaire' },
          { id: 3, coproId: 1, name: 'Pierre Lefebvre', lot: 'C08', email: 'p.lefebvre@email.com', phone: '06 34 56 78 90', role: 'conseil' },
          { id: 4, coproId: 1, name: 'Marie Dubois', lot: 'Gestionnaire', email: 'marie@realtix.com', phone: '06 11 22 33 44', role: 'gestionnaire' },
          { id: 5, coproId: 2, name: 'Marie Legrand', lot: '101', email: 'marie.l@email.com', phone: '06 45 67 89 01', role: 'coproprietaire' }
        ],
        signalements: [
          { 
            id: 1, 
            coproId: 1, 
            type: 'Fuite', 
            description: 'Fuite d\'eau hall entrée', 
            status: 'En cours', 
            priority: 'haute',
            date: '2026-02-03',
            author: 'Jean Dupont',
            authorId: 1,
            photos: ['fuite1.jpg'],
            createIntervention: true,
            informCopro: true,
            interventionId: 1,
            readBy: [1, 3, 4],
            relancesSent: 0,
            nextRelance: '2026-02-10',
            comments: [
              { id: 1, author: 'Marie Dubois', role: 'gestionnaire', text: 'Plombier contacté, intervention prévue demain', date: '2026-02-03 15:30' }
            ]
          },
          { 
            id: 2, 
            coproId: 1, 
            type: 'Nuisance', 
            description: 'Bruit excessif appartement 12', 
            status: 'Reçu', 
            priority: 'moyenne',
            date: '2026-02-04',
            author: 'Sophie Martin',
            authorId: 2,
            photos: [],
            createIntervention: false,
            informCopro: false,
            interventionId: null,
            readBy: [4],
            relancesSent: 1,
            nextRelance: '2026-02-08',
            comments: []
          },
          { 
            id: 3, 
            coproId: 1, 
            type: 'Panne', 
            description: 'Ascenseur en panne', 
            status: 'Résolu', 
            priority: 'haute',
            date: '2026-01-28',
            author: 'Pierre Lefebvre',
            authorId: 3,
            photos: ['ascenseur.jpg'],
            createIntervention: true,
            informCopro: true,
            interventionId: 2,
            readBy: [1, 2, 3, 4, 5],
            relancesSent: 2,
            nextRelance: null,
            comments: [
              { id: 1, author: 'Marie Dubois', role: 'gestionnaire', text: 'Intervention effectuée, ascenseur réparé', date: '2026-01-29 10:15' }
            ]
          }
        ]
      }
    };

    function setState(updates) {
      state = { ...state, ...updates };
      render();
    }

    // Fonction pour mettre à jour les inputs sans re-render (évite le rechargement à chaque lettre)
    function updateInput(path, value) {
      // Met à jour l'état sans re-render pour les inputs
      const keys = path.split('.');
      let current = state;
      
      for (let i = 0; i < keys.length - 1; i++) {
        current = current[keys[i]];
      }
      
      current[keys[keys.length - 1]] = value;
    }

    // Fonction pour vérifier si un email correspond à un agent invité
    function isInvitedAgent(email) {
      return state.teamMembers.some(member => 
        member.email.toLowerCase() === email.toLowerCase() && 
        member.role === 'agent'
      );
    }

    // Fonction pour obtenir les infos d'un membre par email
    function getMemberByEmail(email) {
      return state.teamMembers.find(member => 
        member.email.toLowerCase() === email.toLowerCase()
      );
    }

    // Helper: Vérifie si l'utilisateur a accès aux fonctionnalités Entreprise
    function hasEnterpriseAccess() {
      return state.subscription.currentPlan === 'enterprise' || state.subscription.currentPlan === 'trial';
    }

    function hasProAccess() {
      return state.subscription.currentPlan === 'pro' || state.subscription.currentPlan === 'enterprise' || state.subscription.currentPlan === 'trial';
    }

    // Fonction d'analyse du marché par IA en temps réel
    async function analyzeMarketWithAI() {
      setState({ aiAnalysisLoading: true });
      
      try {
        // Préparer les données pour l\'analyse
        const marketData = {
          properties: state.properties.map(p => ({
            type: p.type,
            price: p.price,
            location: p.location,
            status: p.status,
            surface: p.surface,
            addedDate: p.addedDate
          })),
          clients: state.clients.map(c => ({
            type: c.type,
            budget: c.budget,
            status: c.status
          })),
          totalRevenue: state.properties.filter(p => p.status === 'Vendu').reduce((sum, p) => sum + p.price, 0),
          avgPrice: Math.round(state.properties.reduce((sum, p) => sum + p.price, 0) / state.properties.length)
        };

        console.log('📊 Envoi des données au backend pour analyse...');

        // Appel au backend local au lieu de l'API directe
        const response = await fetch("http://localhost:3001/api/analyze-market", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ marketData })
        });

        if (!response.ok) {
          const errorData = await response.json();
          console.error('❌ Erreur backend:', errorData);
          throw new Error(errorData.error || 'Erreur lors de l\'analyse');
        }

        const data = await response.json();
        console.log('✅ Analyse reçue du backend');
        
        if (!data.success || !data.analysis) {
          throw new Error('Format de réponse invalide');
        }
        
        // Mettre à jour l'état avec l\'analyse IA
        setState({
          aiSuggestions: {
            ...state.aiSuggestions,
            marketAnalysis: data.analysis
          },
          aiAnalysisLoading: false,
          lastAIUpdate: new Date().toLocaleString('fr-FR')
        });
        
        console.log('✅ Analyse du marché mise à jour par IA');
        
      } catch (error) {
        console.error('❌ Erreur lors de l\'analyse IA:', error);
        setState({ aiAnalysisLoading: false });
        
        // Message d'erreur plus explicite
        if (error.message.includes('Failed to fetch')) {
          alert('❌ Impossible de contacter le serveur backend.\n\n' +
                '⚠️ Assurez-vous que le backend est démarré :\n' +
                '1. Ouvrez un terminal\n' +
                '2. Exécutez : node ai-backend.js\n' +
                '3. Le serveur doit tourner sur http://localhost:3001');
        } else {
          alert('❌ Erreur lors de l\'analyse IA.\n\n' + error.message);
        }
      }
    }


    function login(role) {
      const user = role === 'manager' 
        ? { name: 'Philippe Rousseau', role: 'manager', email: 'p.rousseau@agence.com' }
        : { name: 'Marie Dubois', role: 'agent', email: 'marie@agence.com' };
      setState({ currentUser: user, currentPage: 'dashboard' });
    }

    function handleLogin(event) {
      event.preventDefault();
      
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      // Simuler une base de données d'utilisateurs
      const users = {
        // Gérants
        'gerant@agence.com': { name: 'Philippe Rousseau', role: 'manager', email: 'gerant@agence.com' },
        'manager@realtix.com': { name: 'Sophie Martin', role: 'manager', email: 'manager@realtix.com' },
        // Collaborateurs (exemples - normalement ils viennent du système d'invitation)
        'marie@agence.com': { name: 'Marie Dubois', role: 'agent', email: 'marie@agence.com' },
        'jean@agence.com': { name: 'Jean Martin', role: 'agent', email: 'jean@agence.com' },
      };

      // Vérifier si l\'email existe
      if (users[email.toLowerCase()]) {
        const user = users[email.toLowerCase()];
        
        // En production, on vérifierait le mot de passe
        // Pour la démo, on accepte n\'importe quel mot de passe non vide
        if (password.length > 0) {
          setState({ 
            currentUser: user, 
            currentPage: 'dashboard' 
          });
          
          // Message de bienvenue
          setTimeout(() => {
            alert(`👋 Bienvenue ${user.name} !\n\n${user.role === 'manager' ? '🎯 Vous êtes connecté en tant que Gérant.\nVous avez accès à toutes les fonctionnalités.' : '👤 Vous êtes connecté en tant que Collaborateur.'}`);
          }, 500);
        } else {
          alert('⚠️ Veuillez entrer un mot de passe');
        }
      } else {
        alert('❌ Email ou mot de passe incorrect\n\nComptes de démonstration :\n• gerant@agence.com\n• marie@agence.com\n\nMot de passe : n\'importe lequel');
      }
    }

    function addProperty() {
      if (state.newProperty.title && state.newProperty.price && state.newProperty.location) {
        const property = {
          ...state.newProperty,
          id: state.properties.length + 1,
          price: parseInt(state.newProperty.price),
          surface: parseInt(state.newProperty.surface),
          rooms: parseInt(state.newProperty.rooms),
          bathrooms: parseInt(state.newProperty.bathrooms),
          image: '🏠',
          agent: state.currentUser.name,
          addedDate: new Date().toISOString().split('T')[0],
          visits: 0
        };
        setState({
          properties: [...state.properties, property],
          showAddProperty: false,
          newProperty: { title: '', type: 'Appartement', price: '', surface: '', rooms: '', bathrooms: '', location: '', status: 'Disponible', description: '' },
          onboardingChecklist: { ...state.onboardingChecklist, addProperty: true } // Auto-cocher
        });
      }
    }

    function addClient() {
      if (state.newClient.name && state.newClient.email && state.newClient.phone) {
        const client = {
          ...state.newClient,
          id: state.clients.length + 1,
          agent: state.currentUser.name,
          addedDate: new Date().toISOString().split('T')[0],
          lastContact: new Date().toISOString().split('T')[0]
        };
        setState({
          clients: [...state.clients, client],
          showAddClient: false,
          newClient: { name: '', email: '', phone: '', type: 'Acheteur', budget: '', status: 'Actif', notes: '' },
          onboardingChecklist: { ...state.onboardingChecklist, addClient: true } // Auto-cocher
        });
      }
    }

    function addVisit() {
      if (state.newVisit.propertyId && state.newVisit.clientId && state.newVisit.date && state.newVisit.time) {
        const visit = {
          ...state.newVisit,
          id: state.visits.length + 1,
          propertyId: parseInt(state.newVisit.propertyId),
          clientId: parseInt(state.newVisit.clientId),
          status: 'Programmée',
          agent: state.currentUser.name
        };
        setState({
          visits: [...state.visits, visit],
          showAddVisit: false,
          newVisit: { propertyId: '', clientId: '', date: '', time: '', notes: '' },
          onboardingChecklist: { ...state.onboardingChecklist, scheduleVisit: true } // Auto-cocher
        });
      }
    }

    function getAdvancedStats() {
      const totalRevenue = state.properties.filter(p => p.status === 'Vendu').reduce((sum, p) => sum + p.price, 0);
      const avgDaysToSell = 18; // Simulation
      const conversionRate = ((state.properties.filter(p => p.status === 'Vendu').length / state.properties.length) * 100).toFixed(1);
      const monthlyRevenue = totalRevenue / 3; // Simulation sur 3 mois
      const topAgent = state.agents.reduce((max, agent) => agent.revenue > max.revenue ? agent : max, state.agents[0]);
      const totalCommissions = totalRevenue * 0.05; // 5% commission
      const activeListings = state.properties.filter(p => p.status === 'Disponible').length;
      const pendingDeals = state.properties.filter(p => p.status === 'Sous offre').length;
      
      return {
        totalRevenue,
        avgDaysToSell,
        conversionRate,
        monthlyRevenue,
        topAgent,
        totalCommissions,
        activeListings,
        pendingDeals
      };
    }

    function getStats() {
      const totalProperties = state.properties.length;
      const availableProperties = state.properties.filter(p => p.status === 'Disponible').length;
      const soldProperties = state.properties.filter(p => p.status === 'Vendu').length;
      const totalClients = state.clients.length;
      const activeClients = state.clients.filter(c => c.status === 'Actif').length;
      const upcomingVisits = state.visits.filter(v => v.status === 'Programmée' || v.status === 'Confirmée').length;
      const totalValue = state.properties.reduce((sum, p) => sum + p.price, 0);
      const avgPrice = Math.round(totalValue / totalProperties);
      
      return { totalProperties, availableProperties, soldProperties, totalClients, activeClients, upcomingVisits, totalValue, avgPrice };
    }

    function getFilteredProperties() {
      return state.properties.filter(p => {
        const matchSearch = p.title.toLowerCase().includes(state.searchTerm.toLowerCase()) || 
                           p.location.toLowerCase().includes(state.searchTerm.toLowerCase());
        const matchType = state.filterType === 'all' || p.type === state.filterType;
        const matchStatus = state.filterStatus === 'all' || p.status === state.filterStatus;
        const matchAgent = state.currentUser.role === 'manager' || p.agent === state.currentUser.name;
        return matchSearch && matchType && matchStatus && matchAgent;
      });
    }

    function getFilteredClients() {
      return state.clients.filter(c => {
        const matchSearch = c.name.toLowerCase().includes(state.searchTerm.toLowerCase()) || 
                           c.email.toLowerCase().includes(state.searchTerm.toLowerCase());
        const matchAgent = state.currentUser.role === 'manager' || c.agent === state.currentUser.name;
        return matchSearch && matchAgent;
      });
    }

    // Helper: Render animated neon background
    function renderNeonBackground() {
      const theme = state.customization?.backgroundTheme || 'purple-pink';
      return `
        <!-- Animated Waves Background -->
        <div class="wave-container theme-${theme}">
          <svg class="wave-svg" viewBox="0 0 2000 1000" preserveAspectRatio="none">
            <!-- Wave 1 - Purple -->
            <path class="wave-path-1" d="M 0 500 Q 250 300, 500 500 T 1000 500 T 1500 500 T 2000 500" />
            <path class="wave-path-1" d="M 0 450 Q 300 250, 600 450 T 1200 450 T 1800 450 T 2400 450" />
            
            <!-- Wave 2 - Pink -->
            <path class="wave-path-2" d="M 0 550 Q 200 700, 400 550 T 800 550 T 1200 550 T 1600 550 T 2000 550" />
            <path class="wave-path-2" d="M 0 600 Q 350 750, 700 600 T 1400 600 T 2100 600" />
            
            <!-- Wave 3 - Deep Purple -->
            <path class="wave-path-3" d="M 0 400 Q 280 200, 560 400 T 1120 400 T 1680 400 T 2240 400" />
            
            <!-- Wave 4 - Deep Pink -->
            <path class="wave-path-4" d="M 0 650 Q 220 800, 440 650 T 880 650 T 1320 650 T 1760 650 T 2200 650" />
            
            <!-- Wave 5 - Light Purple -->
            <path class="wave-path-5" d="M 0 350 Q 320 180, 640 350 T 1280 350 T 1920 350" />
            <path class="wave-path-5" d="M 0 700 Q 240 850, 480 700 T 960 700 T 1440 700 T 1920 700" />
          </svg>
        </div>
      `;
    }

    function renderPublicLandingPage() {
      return `
        <div class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 relative">
          ${renderNeonBackground()}

          <!-- Content overlay -->
          <div class="relative z-10">
            <!-- Navigation -->
            <nav class="fixed top-0 w-full glass border-b border-slate-700 z-50">
              <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                  ${icons.aiLogo}
                  <span class="text-2xl font-bold text-white">Realtix Pro</span>
                </div>
                <div class="flex items-center gap-4">
                  <button onclick="setState({showPublicLanding: false})" class="text-slate-300 hover:text-white transition-all">
                    Connexion
                  </button>
                  <button onclick="setState({showRegistrationModal: true})" class="btn-primary px-6 py-2 rounded-lg font-semibold">
                    S'inscrire
                  </button>
                </div>
              </div>
            </nav>

            <!-- Hero Section -->
            <div class="pt-32 pb-20 px-6">
              <div class="max-w-7xl mx-auto">
                <div class="text-center mb-16 animate-slideUp">
                  <h1 class="text-6xl font-bold text-white mb-6">
                    La plateforme <span class="text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-purple-500">tout-en-un</span><br/>pour agences immobilières
                  </h1>
                  <p class="text-2xl text-slate-300 mb-8 max-w-3xl mx-auto">
                    Gérez vos biens, clients et visites avec l'IA. Gagnez du temps et boostez vos ventes.
                  </p>
                <div class="flex items-center justify-center gap-4">
                  <button onclick="setState({showRegistrationModal: true, registrationData: {...state.registrationData, selectedPlan: 'pro'}})" class="btn-primary px-8 py-4 rounded-xl font-bold text-lg">
                    🚀 Commencer maintenant
                  </button>
                  <button onclick="document.getElementById('pricing').scrollIntoView({behavior: 'smooth'})" class="bg-slate-700 hover:bg-slate-600 text-white px-8 py-4 rounded-xl font-bold text-lg transition-all">
                    Voir les tarifs
                  </button>
                </div>
              </div>

              <!-- Features -->
              <div class="grid md:grid-cols-3 gap-8 mb-20">
                <!-- IA Feature - HIGHLIGHTED -->
                <div class="glass rounded-2xl p-8 hover:scale-110 transition-all ring-2 ring-amber-400/50 bg-gradient-to-br from-amber-500/10 to-amber-600/10">
                  <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center text-white mb-6 shadow-xl">
                    ${icons.brain}
                  </div>
                  <div class="flex items-center gap-2 mb-4">
                    <h3 class="text-3xl font-bold bg-gradient-to-r from-amber-400 to-yellow-500 bg-clip-text text-transparent">Assistant IA</h3>
                    <span class="text-2xl">✨</span>
                  </div>
                  <p class="text-slate-200 text-lg font-medium">Réponses automatiques, simulations de financement et analyse de marché par intelligence artificielle.</p>
                </div>

                <div class="glass rounded-2xl p-8 hover:scale-105 transition-all">
                  <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white mb-6">
                    ${icons.chart}
                  </div>
                  <h3 class="text-2xl font-bold text-white mb-4">Analytics Avancées</h3>
                  <p class="text-slate-300">Tableaux de bord en temps réel, rapports de performance et suivi des objectifs.</p>
                </div>

                <div class="glass rounded-2xl p-8 hover:scale-105 transition-all">
                  <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-white mb-6">
                    ${icons.zap}
                  </div>
                  <h3 class="text-2xl font-bold text-white mb-4">Automatisation</h3>
                  <p class="text-slate-300">Relances automatiques, signature électronique et gestion des visites simplifiée.</p>
                </div>
              </div>

              <!-- Additional Features - Real Advantages -->
              <div class="grid md:grid-cols-3 gap-8 mb-20">
                <!-- Syndic Feature - HIGHLIGHTED -->
                <div class="glass rounded-2xl p-8 hover:scale-110 transition-all ring-2 ring-amber-400/50 bg-gradient-to-br from-amber-500/10 to-amber-600/10">
                  <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center text-white text-3xl mb-6 shadow-xl">
                    🏢
                  </div>
                  <div class="flex items-center gap-2 mb-4">
                    <h3 class="text-3xl font-bold bg-gradient-to-r from-amber-400 to-yellow-500 bg-clip-text text-transparent">Pro Syndic</h3>
                    <span class="text-2xl">✨</span>
                  </div>
                  <p class="text-slate-200 text-lg font-medium">Gestion complète de vos copropriétés : charges, interventions, documents et AG en toute simplicité.</p>
                </div>

                <div class="glass rounded-2xl p-8 hover:scale-105 transition-all">
                  <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center text-white mb-6">
                    💰
                  </div>
                  <h3 class="text-2xl font-bold text-white mb-4">Gain de Temps</h3>
                  <p class="text-slate-300">Économisez jusqu\'à 10h par semaine grâce à l'automatisation des tâches répétitives et la centralisation des données.</p>
                </div>

                <div class="glass rounded-2xl p-8 hover:scale-105 transition-all">
                  <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-pink-500 to-pink-600 flex items-center justify-center text-white mb-6">
                    📈
                  </div>
                  <h3 class="text-2xl font-bold text-white mb-4">Augmentation des Ventes</h3>
                  <p class="text-slate-300">+35% de conversions en moyenne grâce au lead scoring IA et aux recommandations d'actions personnalisées.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Pricing Section -->
          <div id="pricing" class="py-20 px-6 bg-slate-800/50">
            <div class="max-w-7xl mx-auto">
              <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-white mb-4">Tarifs transparents</h2>
                <p class="text-xl text-slate-300">Choisissez le plan adapté à votre agence</p>
              </div>

              <div class="grid lg:grid-cols-4 gap-6">
                ${Object.entries(state.subscription.plans).map(([planKey, plan], index) => `
                  <div class='glass rounded-2xl p-8 ${plan.trial ? "ring-2 ring-green-400 bg-gradient-to-br from-green-500/5 to-blue-500/5" : plan.popular ? "ring-2 ring-amber-400 scale-105" : ""} hover-lift transition-all-smooth flex flex-col animate-slideInUp shine-effect' style="animation-delay: ${index * 0.1}s">
                    ${plan.trial ? '<div class="text-center mb-4"><span bg-gradient-to-r from-green-500 to-blue-500 text-white px-4 py-1 rounded-full text-sm font-bold">🎁 GRATUIT</span></div>' : plan.popular ? '<div text-center mb-4"><span bg-gradient-to-r from-amber-500 to-purple-500 text-white px-4 py-1 rounded-full text-sm font-bold">⭐ POPULAIRE</span></div>' : ''}
                    
                    <div class="text-center mb-8">
                      <h3 class="text-3xl font-bold text-white mb-4">${plan.name}</h3>
                      ${plan.trial ? `
                        <div class="text-5xl font-bold text-green-400 mb-2">GRATUIT</div>
                        <div class="text-slate-400">pendant 7 jours</div>
                      ` : `
                        <div class="text-5xl font-bold text-amber-400 mb-2">${plan.price.monthly}€</div>
                        <div class="text-slate-400">par mois</div>
                        <div class="text-sm text-green-400 mt-2">ou ${plan.price.yearly}€/an (-17%)</div>
                      `}
                    </div>

                    <ul class="space-y-3 mb-8 flex-grow">
                      ${plan.features.map(feature => `
                        <li class="flex items-start gap-2 text-slate-300">
                          <div class='${plan.trial ? "text-green-400" : "text-green-400"} mt-1'>${icons.checkCircle}</div>
                          <span>${feature}</span>
                        </li>
                      `).join('')}
                    </ul>

                    <button 
                      data-plan="${planKey}"
                      data-is-trial="${plan.trial ? 'true' : 'false'}"
                      onclick="handlePlanClick(this)"
                      class="btn-primary w-full px-6 py-4 rounded-xl text-white font-bold text-lg transition-all mt-auto"
                    >
                      ${plan.trial ? '🚀 Commencer Gratuitement' : 'Commencer'}
                    </button>
                  </div>
                `).join('')}
              </div>

              <p class="text-center text-slate-400 mt-12">
                💳 <strong class="text-white">Paiement sécurisé par Stripe</strong> • Sans engagement • Annulation à tout moment
              </p>
            </div>
          </div>

          <!-- Footer -->
          <div class="py-12 px-6 border-t border-slate-700">
            <div class="max-w-7xl mx-auto text-center text-slate-400">
              <p>© 2026 Realtix Pro - Tous droits réservés</p>
              <div class="flex items-center justify-center gap-6 mt-4">
                <a href="#" onclick="setState({currentPage: 'cgu'}); return false;" class="hover:text-white transition-all">CGU</a>
                <a href="#" onclick="setState({currentPage: 'privacy'}); return false;" class="hover:text-white transition-all">Politique de confidentialité</a>
                <a href="#" onclick="setState({currentPage: 'contact'}); return false;" class="hover:text-white transition-all">Contact</a>
              </div>
            </div>
          </div>
          </div>
          <!-- End Content Overlay -->

          ${state.showRegistrationModal ? renderRegistrationModal() : ''}
          ${state.showNewInterventionModal ? renderNewInterventionModal() : ''}
          ${state.showNewMessage ? renderNewMessageModal() : ''}
          ${state.showNewSignalement ? renderNewSignalementModal() : ''}
          ${state.showSignalementDetail ? renderSignalementDetail() : ''}
          ${state.showModeleMessages ? renderModeleMessagesModal() : ''}
          ${state.showRappelsTravaux ? renderRappelsTravauxModal() : ''}
          ${state.showDemandeDevis ? renderDemandeDevisModal() : ''}
          ${state.showAssignArtisan ? renderAssignArtisanModal() : ''}
          ${state.showSendMessage ? renderSendMessageModal() : ''}
          ${state.showPlanifierIntervention ? renderPlanifierInterventionModal() : ''}
          ${state.showInformerCopro ? renderInformerCoproModal() : ''}
        </div>
      `;
    }

    function renderNewInterventionModal() {
      return `
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fadeIn" onclick="if(event.target === event.currentTarget) setState({showNewInterventionModal: false})">
          <div class="glass rounded-2xl p-8 max-w-2xl w-full animate-slideInUp" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-bold text-white">✨ Nouvelle Intervention</h2>
              <button onclick="setState({showNewInterventionModal: false})" class="text-slate-400 hover:text-white transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <div class="space-y-4">
              <!-- Copropriété -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Copropriété *</label>
                <select 
                  onchange="setState({newIntervention: {...state.newIntervention, coproId: parseInt(event.target.value)}})"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                >
                  <option value="">Sélectionner une copropriété</option>
                  ${state.syndic.coproperties.map(copro => `
                    <option value="${copro.id}">${copro.name}</option>
                  `).join('')}
                </select>
              </div>

              <!-- Type d'intervention -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Type d'intervention *</label>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                  ${['Plomberie', 'Électricité', 'Chauffage', 'Ascenseur', 'Espaces verts', 'Toiture', 'Peinture', 'Serrurerie', 'Autre'].map(type => {
                    const isSelected = state.newIntervention.type === type;
                    const buttonClass = isSelected 
                      ? 'px-4 py-3 rounded-xl font-semibold transition-all bg-amber-500 text-slate-900' 
                      : 'px-4 py-3 rounded-xl font-semibold transition-all bg-slate-700 text-slate-300 hover:bg-slate-600';
                    return `
                      <button
                        onclick="setState({newIntervention: {...state.newIntervention, type: '${type}'}})"
                        class="${buttonClass}"
                      >
                        ${type}
                      </button>
                    `;
                  }).join('')}
                </div>
              </div>

              <!-- Description -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Description *</label>
                <textarea
                  onchange="setState({newIntervention: {...state.newIntervention, description: event.target.value}})"
                  placeholder="Décrivez l'intervention nécessaire..."
                  rows="3"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400 resize-none"
                >${state.newIntervention.description}</textarea>
              </div>

              <!-- Coût estimé -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Coût estimé (€)</label>
                <input
                  type="number"
                  onchange="setState({newIntervention: {...state.newIntervention, cost: event.target.value}})"
                  value="${state.newIntervention.cost}"
                  placeholder="Ex: 450"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                />
              </div>

              <!-- Actions -->
              <div class="flex gap-4 pt-4">
                <button
                  onclick="createIntervention()"
                  class="flex-1 px-6 py-3 bg-gradient-to-r from-amber-400 to-amber-600 hover:from-amber-500 hover:to-amber-700 text-slate-900 rounded-xl font-bold transition-all shadow-lg"
                >
                  ✅ Créer l'intervention
                </button>
                <button
                  onclick="setState({showNewInterventionModal: false, newIntervention: {coproId: null, type: '', description: '', cost: ''}})"
                  class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all"
                >
                  Annuler
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderNewMessageModal() {
      return `
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fadeIn" onclick="if(event.target === event.currentTarget) setState({showNewMessage: false})">
          <div class="glass rounded-2xl p-8 max-w-3xl w-full animate-slideInUp max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-bold text-white">✉️ Nouveau Message aux Copropriétaires</h2>
              <button onclick="setState({showNewMessage: false})" class="text-slate-400 hover:text-white transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <div class="space-y-5">
              <!-- Copropriété -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Copropriété *</label>
                <select 
                  onchange="setState({newMessage: {...state.newMessage, coproId: parseInt(event.target.value)}})"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-400"
                >
                  <option value="">Sélectionner une copropriété</option>
                  ${state.syndic.coproperties.map(copro => `
                    <option value="${copro.id}" ${state.newMessage.coproId === copro.id ? 'selected' : ''}>
                      ${copro.name} (${copro.lots} lots)
                    </option>
                  `).join('')}
                </select>
              </div>

              <!-- Destinataires -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Destinataires *</label>
                <div class="grid grid-cols-3 gap-3">
                  <button
                    onclick="setState({newMessage: {...state.newMessage, recipients: 'all'}})"
                    class="px-4 py-3 rounded-xl font-semibold transition-all ${state.newMessage.recipients === 'all' ? 'bg-blue-500 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}"
                  >
                    👥 Tous les copropriétaires
                  </button>
                  <button
                    onclick="setState({newMessage: {...state.newMessage, recipients: 'conseil'}})"
                    class="px-4 py-3 rounded-xl font-semibold transition-all ${state.newMessage.recipients === 'conseil' ? 'bg-blue-500 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}"
                  >
                    🏛️ Conseil syndical
                  </button>
                  <button
                    onclick="setState({newMessage: {...state.newMessage, recipients: 'specific'}})"
                    class="px-4 py-3 rounded-xl font-semibold transition-all ${state.newMessage.recipients === 'specific' ? 'bg-blue-500 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}"
                  >
                    🎯 Sélection manuelle
                  </button>
                </div>
              </div>

              ${state.newMessage.recipients === 'specific' && state.newMessage.coproId ? `
                <div>
                  <label class="block text-slate-300 font-semibold mb-2">Sélectionner les destinataires</label>
                  <div class="glass rounded-xl p-4 max-h-48 overflow-y-auto space-y-2">
                    ${state.syndic.residents.filter(r => r.coproId === state.newMessage.coproId).map(resident => `
                      <label class="flex items-center gap-3 p-2 hover:bg-slate-700/50 rounded-lg cursor-pointer">
                        <input type="checkbox" class="w-4 h-4" />
                        <div class="flex-1">
                          <span class="text-white font-semibold">${resident.name}</span>
                          <span class="text-slate-400 text-sm ml-2">(Lot ${resident.lot})</span>
                        </div>
                      </label>
                    `).join('')}
                  </div>
                </div>
              ` : ''}

              <!-- Sujet -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Sujet *</label>
                <input
                  type="text"
                  onchange="setState({newMessage: {...state.newMessage, subject: event.target.value}})"
                  value="${state.newMessage.subject}"
                  placeholder="Ex: Travaux ascenseur prévus"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-400"
                />
              </div>

              <!-- Message -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Message *</label>
                <textarea
                  onchange="setState({newMessage: {...state.newMessage, message: event.target.value}})"
                  placeholder="Rédigez votre message aux copropriétaires..."
                  rows="6"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-400 resize-none"
                >${state.newMessage.message}</textarea>
                <p class="text-slate-400 text-xs mt-2">Le message sera publié dans le portail copropriétaire et chaque résident recevra une notification.</p>
              </div>

              <!-- Actions -->
              <div class="flex gap-4 pt-4">
                <button
                  onclick="sendMessage()"
                  class="flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl font-bold transition-all shadow-lg"
                >
                  ✅ Envoyer le message
                </button>
                <button
                  onclick="setState({showNewMessage: false, newMessage: {coproId: null, recipients: 'all', subject: '', message: ''}})"
                  class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all"
                >
                  Annuler
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderNewSignalementModal() {
      return `
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fadeIn" onclick="if(event.target === event.currentTarget) setState({showNewSignalement: false})">
          <div class="glass rounded-2xl p-8 max-w-3xl w-full animate-slideInUp max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-bold text-white">🚨 Nouveau Signalement</h2>
              <button onclick="setState({showNewSignalement: false})" class="text-slate-400 hover:text-white transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <div class="space-y-5">
              <!-- Copropriété -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Copropriété *</label>
                <select 
                  onchange="setState({newSignalement: {...state.newSignalement, coproId: parseInt(event.target.value)}})"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-red-400"
                >
                  <option value="">Sélectionner une copropriété</option>
                  ${state.syndic.coproperties.map(copro => `
                    <option value="${copro.id}" ${state.newSignalement.coproId === copro.id ? 'selected' : ''}>
                      ${copro.name}
                    </option>
                  `).join('')}
                </select>
              </div>

              <!-- Appartement -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Appartement *</label>
                <input
                  type="text"
                  onchange="setState({newSignalement: {...state.newSignalement, apartment: event.target.value}})"
                  placeholder="Ex: Appt 12, Bât A - 3ème étage"
                  value="${state.newSignalement.apartment || ''}"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-red-400"
                />
              </div>

              <!-- Type de signalement -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Type de signalement *</label>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                  ${['Fuite', 'Nuisance', 'Panne', 'Dégradation', 'Sécurité', 'Autre'].map(type => `
                    <button
                      onclick="setState({newSignalement: {...state.newSignalement, type: '${type}'}})"
                      class="px-4 py-3 rounded-xl font-semibold transition-all ${state.newSignalement.type === type ? 'bg-red-500 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}"
                    >
                      ${type}
                    </button>
                  `).join('')}
                </div>
              </div>

              <!-- Priorité -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Priorité *</label>
                <div class="grid grid-cols-3 gap-3">
                  <button
                    onclick="setState({newSignalement: {...state.newSignalement, priority: 'basse'}})"
                    class="px-4 py-3 rounded-xl font-semibold transition-all ${state.newSignalement.priority === 'basse' ? 'bg-blue-500 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}"
                  >
                    🔵 Basse
                  </button>
                  <button
                    onclick="setState({newSignalement: {...state.newSignalement, priority: 'moyenne'}})"
                    class="px-4 py-3 rounded-xl font-semibold transition-all ${state.newSignalement.priority === 'moyenne' ? 'bg-amber-500 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}"
                  >
                    🟡 Moyenne
                  </button>
                  <button
                    onclick="setState({newSignalement: {...state.newSignalement, priority: 'haute'}})"
                    class="px-4 py-3 rounded-xl font-semibold transition-all ${state.newSignalement.priority === 'haute' ? 'bg-red-500 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}"
                  >
                    🔴 Haute
                  </button>
                </div>
              </div>

              <!-- Description -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Description *</label>
                <textarea
                  onchange="setState({newSignalement: {...state.newSignalement, description: event.target.value}})"
                  placeholder="Décrivez le problème en détail..."
                  rows="4"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-red-400 resize-none"
                >${state.newSignalement.description}</textarea>
              </div>

              <!-- Artisan / Prestataire -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Artisan / Prestataire</label>
                <select 
                  onchange="setState({newSignalement: {...state.newSignalement, artisan: event.target.value}})"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
                >
                  <option value="">Aucun artisan assigné</option>
                  <option value="Plomberie Martin">🔧 Plomberie Martin</option>
                  <option value="Électricité Dupont">⚡ Électricité Dupont</option>
                  <option value="Serrurier Express">🔑 Serrurier Express</option>
                  <option value="Vitrier Pro">🪟 Vitrier Pro</option>
                  <option value="Chauffage Services">🔥 Chauffage Services</option>
                  <option value="Autre">Autre prestataire</option>
                </select>
              </div>

              <!-- Date intervention planifiée -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Date intervention prévue</label>
                <input
                  type="date"
                  onchange="setState({newSignalement: {...state.newSignalement, interventionDate: event.target.value}})"
                  value="${state.newSignalement.interventionDate || ''}"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
                />
              </div>

              <!-- Photos fuite -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Photos du problème</label>
                <input type="file" multiple accept="image/*" class="hidden" id="signalement-photos" />
                <label for="signalement-photos" class="block w-full px-4 py-3 bg-slate-800 border-2 border-dashed border-slate-600 rounded-xl text-center cursor-pointer hover:border-purple-400 transition-all">
                  <span class="text-slate-400">📷 Ajouter des photos de la fuite/problème</span>
                </label>
              </div>

              <!-- Upload devis -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Devis (PDF)</label>
                <input type="file" accept=".pdf" class="hidden" id="signalement-devis" />
                <label for="signalement-devis" class="block w-full px-4 py-3 bg-slate-800 border-2 border-dashed border-slate-600 rounded-xl text-center cursor-pointer hover:border-amber-400 transition-all">
                  <span class="text-slate-400">📄 Joindre un devis</span>
                </label>
              </div>

              <!-- Commentaire syndic -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">💼 Commentaire interne syndic</label>
                <textarea
                  onchange="setState({newSignalement: {...state.newSignalement, syndicComment: event.target.value}})"
                  placeholder="Notes privées du syndic (non visible par les copropriétaires)..."
                  rows="3"
                  class="w-full px-4 py-3 bg-slate-800/50 border border-amber-500/30 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400 resize-none"
                >${state.newSignalement.syndicComment || ''}</textarea>
                <p class="text-xs text-slate-500 mt-1">🔒 Note confidentielle - réservée au syndic</p>
              </div>

              <!-- Options avancées -->
              <div class="glass rounded-xl p-5 bg-purple-500/5 border-purple-500/20">
                <h3 class="text-white font-bold mb-4">⚙️ Options</h3>
                
                <div class="space-y-3">
                  <!-- Créer intervention -->
                  <label class="flex items-start gap-3 cursor-pointer group">
                    <input 
                      type="checkbox" 
                      checked="${state.newSignalement.createIntervention}"
                      onchange="setState({newSignalement: {...state.newSignalement, createIntervention: event.target.checked}})"
                      class="w-5 h-5 mt-0.5"
                    />
                    <div class="flex-1">
                      <div class="text-white font-semibold group-hover:text-purple-300 transition-colors">
                        🔧 Créer intervention associée
                      </div>
                      <div class="text-slate-400 text-sm">
                        Une fiche intervention sera automatiquement créée pour ce signalement
                      </div>
                    </div>
                  </label>

                  <!-- Informer copro -->
                  <label class="flex items-start gap-3 cursor-pointer group">
                    <input 
                      type="checkbox"
                      checked="${state.newSignalement.informCopro}"
                      onchange="setState({newSignalement: {...state.newSignalement, informCopro: event.target.checked}})"
                      class="w-5 h-5 mt-0.5"
                    />
                    <div class="flex-1">
                      <div class="text-white font-semibold group-hover:text-purple-300 transition-colors">
                        📢 Informer la copropriété
                      </div>
                      <div class="text-slate-400 text-sm">
                        Un message sera envoyé à tous les copropriétaires avec accusé de lecture
                      </div>
                    </div>
                  </label>
                </div>
              </div>

              <!-- Actions -->
              <div class="flex gap-4 pt-4">
                <button
                  onclick="createSignalement()"
                  class="flex-1 px-6 py-4 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-xl font-bold transition-all shadow-lg text-lg"
                >
                  ✅ Créer le signalement
                </button>
                <button
                  onclick="setState({showNewSignalement: false, newSignalement: {coproId: null, type: '', description: '', priority: 'moyenne', photos: [], createIntervention: false, informCopro: false}})"
                  class="px-6 py-4 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all"
                >
                  Annuler
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // ===== MODAL DEMANDER DEVIS =====
    function renderDemandeDevisModal() {
      return `
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fadeIn" onclick="if(event.target === event.currentTarget) setState({showDemandeDevis: false})">
          <div class="glass rounded-2xl p-8 max-w-2xl w-full animate-slideInUp max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-bold text-white">📄 Demander un Devis</h2>
              <button onclick="setState({showDemandeDevis: false})" class="text-slate-400 hover:text-white transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <div class="space-y-5">
              <!-- Signalement concerné -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Signalement concerné</label>
                <div class="p-4 bg-slate-800/50 border border-purple-500/30 rounded-xl">
                  <p class="text-white font-semibold">Fuite d'eau - Résidence Les Oliviers</p>
                  <p class="text-slate-400 text-sm">Appartement 12B</p>
                </div>
              </div>

              <!-- Sélection artisans -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Artisans à contacter *</label>
                <div class="space-y-2">
                  ${[
                    {name: 'Plomberie Martin', specialty: 'Plomberie', rating: '4.8/5', icon: '🔧'},
                    {name: 'Électricité Dupont', specialty: 'Électricité', rating: '4.9/5', icon: '⚡'},
                    {name: 'Chauffage Services', specialty: 'Chauffage', rating: '4.7/5', icon: '🔥'}
                  ].map(artisan => `
                    <label class="flex items-center gap-4 p-4 bg-slate-700 rounded-xl cursor-pointer hover:bg-slate-600 transition-all">
                      <input type="checkbox" class="w-5 h-5" />
                      <div class="flex-1">
                        <div class="flex items-center gap-2">
                          <span class="text-xl">${artisan.icon}</span>
                          <span class="text-white font-semibold">${artisan.name}</span>
                        </div>
                        <div class="flex items-center gap-3 mt-1">
                          <span class="text-slate-400 text-sm">${artisan.specialty}</span>
                          <span class="text-amber-400 text-sm">⭐ ${artisan.rating}</span>
                        </div>
                      </div>
                    </label>
                  `).join('')}
                </div>
              </div>

              <!-- Description des travaux -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Description des travaux *</label>
                <textarea
                  placeholder="Décrivez les travaux à effectuer pour le devis..."
                  rows="4"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400 resize-none"
                ></textarea>
              </div>

              <!-- Délai souhaité -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Délai de réponse souhaité</label>
                <select class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400">
                  <option>24 heures</option>
                  <option>48 heures</option>
                  <option>72 heures</option>
                  <option>1 semaine</option>
                </select>
              </div>

              <!-- Actions -->
              <div class="flex gap-4 pt-4">
                <button
                  onclick="sendDevisRequest(); setState({showDemandeDevis: false})"
                  class="flex-1 px-6 py-4 bg-gradient-to-r from-amber-500 to-yellow-500 hover:from-amber-600 hover:to-yellow-600 text-white rounded-xl font-bold transition-all shadow-lg"
                >
                  📄 Envoyer les demandes de devis
                </button>
                <button
                  onclick="setState({showDemandeDevis: false})"
                  class="px-6 py-4 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all"
                >
                  Annuler
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // ===== MODAL ASSIGNER ARTISAN =====
    function renderAssignArtisanModal() {
      return `
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fadeIn" onclick="if(event.target === event.currentTarget) setState({showAssignArtisan: false})">
          <div class="glass rounded-2xl p-8 max-w-2xl w-full animate-slideInUp max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-bold text-white">🔧 Assigner un Artisan</h2>
              <button onclick="setState({showAssignArtisan: false})" class="text-slate-400 hover:text-white transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <div class="space-y-5">
              <!-- Signalement concerné -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Signalement concerné</label>
                <div class="p-4 bg-slate-800/50 border border-blue-500/30 rounded-xl">
                  <p class="text-white font-semibold">Fuite d'eau - Résidence Les Oliviers</p>
                  <p class="text-slate-400 text-sm">Appartement 12B - Priorité HAUTE</p>
                </div>
              </div>

              <!-- Sélection artisan -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Choisir un artisan *</label>
                <div class="space-y-3">
                  ${[
                    {name: 'Plomberie Martin', specialty: 'Plomberie', phone: '06 12 34 56 78', rating: '4.8/5', icon: '🔧', available: 'Disponible demain'},
                    {name: 'Électricité Dupont', specialty: 'Électricité', phone: '06 98 76 54 32', rating: '4.9/5', icon: '⚡', available: 'Disponible aujourd\'hui'},
                    {name: 'Chauffage Services', specialty: 'Chauffage', phone: '06 45 67 89 01', rating: '4.7/5', icon: '🔥', available: 'Disponible la semaine prochaine'}
                  ].map((artisan, idx) => `
                    <label class="flex items-start gap-4 p-5 bg-slate-700 rounded-xl cursor-pointer hover:bg-slate-600 transition-all border-2 border-transparent hover:border-blue-400">
                      <input type="radio" name="artisan" value="${idx}" class="w-5 h-5 mt-1" />
                      <div class="flex-1">
                        <div class="flex items-center gap-2 mb-2">
                          <span class="text-2xl">${artisan.icon}</span>
                          <span class="text-white font-bold text-lg">${artisan.name}</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                          <div class="text-slate-400">${artisan.specialty}</div>
                          <div class="text-amber-400">⭐ ${artisan.rating}</div>
                          <div class="text-slate-400">📞 ${artisan.phone}</div>
                          <div class="text-green-400">✓ ${artisan.available}</div>
                        </div>
                      </div>
                    </label>
                  `).join('')}
                </div>
              </div>

              <!-- Date d'intervention -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Date d'intervention souhaitée</label>
                <input
                  type="date"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-400"
                />
              </div>

              <!-- Notes -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Notes pour l'artisan</label>
                <textarea
                  placeholder="Instructions spéciales, accès, contact..."
                  rows="3"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-400 resize-none"
                ></textarea>
              </div>

              <!-- Actions -->
              <div class="flex gap-4 pt-4">
                <button
                  onclick="assignArtisan(); setState({showAssignArtisan: false})"
                  class="flex-1 px-6 py-4 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white rounded-xl font-bold transition-all shadow-lg"
                >
                  🔧 Assigner l'artisan
                </button>
                <button
                  onclick="setState({showAssignArtisan: false})"
                  class="px-6 py-4 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all"
                >
                  Annuler
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // ===== MODAL ENVOYER MESSAGE (Depuis détail signalement) =====
    function renderSendMessageModal() {
      return `
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fadeIn" onclick="if(event.target === event.currentTarget) setState({showSendMessage: false})">
          <div class="glass rounded-2xl p-8 max-w-2xl w-full animate-slideInUp max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-bold text-white">💬 Envoyer un Message</h2>
              <button onclick="setState({showSendMessage: false})" class="text-slate-400 hover:text-white transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <div class="space-y-5">
              <!-- Concernant -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Concernant</label>
                <div class="p-4 bg-slate-800/50 border border-purple-500/30 rounded-xl">
                  <p class="text-white font-semibold">Fuite d'eau - Résidence Les Oliviers</p>
                  <p class="text-slate-400 text-sm">Appartement 12B</p>
                </div>
              </div>

              <!-- Destinataires -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Destinataires *</label>
                <div class="grid grid-cols-3 gap-3">
                  <button class="p-4 rounded-xl bg-purple-500 text-white border-2 border-purple-400 hover:bg-purple-600 transition-all">
                    <div class="text-2xl mb-2">👥</div>
                    <div class="font-medium text-sm">Tous les copropriétaires</div>
                  </button>
                  <button class="p-4 rounded-xl bg-slate-700 text-white border-2 border-transparent hover:bg-slate-600 transition-all">
                    <div class="text-2xl mb-2">🏛️</div>
                    <div class="font-medium text-sm">Conseil syndical</div>
                  </button>
                  <button class="p-4 rounded-xl bg-slate-700 text-white border-2 border-transparent hover:bg-slate-600 transition-all">
                    <div class="text-2xl mb-2">🏠</div>
                    <div class="font-medium text-sm">Résident concerné</div>
                  </button>
                </div>
              </div>

              <!-- Objet -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Objet *</label>
                <input
                  type="text"
                  placeholder="Ex: Point sur l'intervention de plomberie"
                  value="Intervention prévue pour fuite d'eau"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
                />
              </div>

              <!-- Message -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Message *</label>
                <textarea
                  placeholder="Rédigez votre message..."
                  rows="6"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-400 resize-none"
                >Bonjour,

Suite au signalement de fuite d'eau dans l'appartement 12B, une intervention est programmée demain à 14h00 avec Plomberie Martin.

L'accès aux parties communes pourrait être nécessaire.

Cordialement,
Le Syndic</textarea>
              </div>

              <!-- Actions -->
              <div class="flex gap-4 pt-4">
                <button
                  onclick="sendMessage(); setState({showSendMessage: false})"
                  class="flex-1 px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-xl font-bold transition-all shadow-lg"
                >
                  💬 Envoyer le message
                </button>
                <button
                  onclick="setState({showSendMessage: false})"
                  class="px-6 py-4 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all"
                >
                  Annuler
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // ===== MODAL PLANIFIER INTERVENTION =====
    function renderPlanifierInterventionModal() {
      return `
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fadeIn" onclick="if(event.target === event.currentTarget) setState({showPlanifierIntervention: false})">
          <div class="glass rounded-2xl p-8 max-w-2xl w-full animate-slideInUp max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-bold text-white">📅 Planifier une Intervention</h2>
              <button onclick="setState({showPlanifierIntervention: false})" class="text-slate-400 hover:text-white transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <div class="space-y-5">
              <!-- Signalement concerné -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Signalement concerné</label>
                <div class="p-4 bg-slate-800/50 border border-green-500/30 rounded-xl">
                  <p class="text-white font-semibold">Fuite d'eau - Résidence Les Oliviers</p>
                  <p class="text-slate-400 text-sm">Appartement 12B</p>
                </div>
              </div>

              <!-- Artisan -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Artisan assigné</label>
                <div class="p-4 bg-slate-700 rounded-xl flex items-center gap-3">
                  <span class="text-2xl">🔧</span>
                  <div class="flex-1">
                    <p class="text-white font-semibold">Plomberie Martin</p>
                    <p class="text-slate-400 text-sm">📞 06 12 34 56 78</p>
                  </div>
                  <button class="text-blue-400 hover:text-blue-300 text-sm font-semibold">Changer</button>
                </div>
              </div>

              <!-- Date et heure -->
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-slate-300 font-semibold mb-2">Date *</label>
                  <input
                    type="date"
                    value="2026-02-07"
                    class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-green-400"
                  />
                </div>
                <div>
                  <label class="block text-slate-300 font-semibold mb-2">Heure *</label>
                  <input
                    type="time"
                    value="14:00"
                    class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-green-400"
                  />
                </div>
              </div>

              <!-- Durée estimée -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Durée estimée</label>
                <select class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-green-400">
                  <option>30 minutes</option>
                  <option selected>1 heure</option>
                  <option>2 heures</option>
                  <option>3 heures</option>
                  <option>Demi-journée</option>
                  <option>Journée complète</option>
                </select>
              </div>

              <!-- Coût estimé -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Coût estimé</label>
                <input
                  type="text"
                  placeholder="Ex: 450"
                  value="450"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-green-400"
                />
              </div>

              <!-- Notes intervention -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Notes intervention</label>
                <textarea
                  placeholder="Détails de l'intervention, matériel nécessaire..."
                  rows="3"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-green-400 resize-none"
                >Réparation fuite au niveau du raccordement. Prévoir accès compteur d'eau.</textarea>
              </div>

              <!-- Notification -->
              <div class="flex items-center gap-3 p-4 bg-green-500/10 border border-green-500/30 rounded-xl">
                <input type="checkbox" checked class="w-5 h-5" />
                <label class="text-white font-semibold">Notifier le résident et la copropriété</label>
              </div>

              <!-- Actions -->
              <div class="flex gap-4 pt-4">
                <button
                  onclick="planifierIntervention(); setState({showPlanifierIntervention: false})"
                  class="flex-1 px-6 py-4 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white rounded-xl font-bold transition-all shadow-lg"
                >
                  📅 Confirmer l'intervention
                </button>
                <button
                  onclick="setState({showPlanifierIntervention: false})"
                  class="px-6 py-4 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all"
                >
                  Annuler
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // ===== MODAL INFORMER COPROPRIÉTAIRES =====
    function renderInformerCoproModal() {
      return `
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fadeIn" onclick="if(event.target === event.currentTarget) setState({showInformerCopro: false})">
          <div class="glass rounded-2xl p-8 max-w-3xl w-full animate-slideInUp max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-bold text-white">📢 Informer les Copropriétaires</h2>
              <button onclick="setState({showInformerCopro: false})" class="text-slate-400 hover:text-white transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <div class="space-y-5">
              <!-- Signalement concerné -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Signalement concerné</label>
                <div class="p-4 bg-slate-800/50 border border-purple-500/30 rounded-xl">
                  <p class="text-white font-semibold">Fuite d'eau - Résidence Les Oliviers</p>
                  <p class="text-slate-400 text-sm">Appartement 12B - Priorité HAUTE</p>
                </div>
              </div>

              <!-- Copropriété -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Copropriété</label>
                <div class="p-4 bg-slate-700 rounded-xl flex items-center justify-between">
                  <div>
                    <p class="text-white font-semibold">Résidence Les Oliviers</p>
                    <p class="text-slate-400 text-sm">45 copropriétaires</p>
                  </div>
                  <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm font-semibold">
                    Tous les résidents
                  </span>
                </div>
              </div>

              <!-- Objet -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Objet *</label>
                <input
                  type="text"
                  value="Mise à jour : Intervention fuite d'eau Appt 12B"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
                />
              </div>

              <!-- Message pré-rempli -->
              <div>
                <label class="block text-slate-300 font-semibold mb-2">Message *</label>
                <textarea
                  rows="8"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-400 resize-none"
                >Chers copropriétaires,

Nous vous informons de l'avancement concernant le signalement de fuite d'eau dans l'appartement 12B.

État actuel :
✅ Signalement traité (03/02/2026)
✅ Devis demandé et reçu - Plomberie Martin : 450€ TTC
✅ Intervention planifiée le 10/02/2026 à 14h00

L'accès aux parties communes pourrait être nécessaire durant l'intervention.

Nous vous tiendrons informés de l'évolution de la situation.

Cordialement,
Le Syndic</textarea>
              </div>

              <!-- Options -->
              <div class="glass rounded-xl p-5 bg-purple-500/5 border-purple-500/20">
                <h3 class="text-white font-bold mb-4">Options d'envoi</h3>
                <div class="space-y-3">
                  <label class="flex items-start gap-3 cursor-pointer group">
                    <input type="checkbox" checked class="w-5 h-5 mt-0.5" />
                    <div class="flex-1">
                      <div class="text-white font-semibold group-hover:text-purple-300 transition-colors">
                        📧 Envoyer par email
                      </div>
                      <div class="text-slate-400 text-sm">
                        Tous les copropriétaires recevront un email
                      </div>
                    </div>
                  </label>

                  <label class="flex items-start gap-3 cursor-pointer group">
                    <input type="checkbox" checked class="w-5 h-5 mt-0.5" />
                    <div class="flex-1">
                      <div class="text-white font-semibold group-hover:text-purple-300 transition-colors">
                        📱 Notification app mobile
                      </div>
                      <div class="text-slate-400 text-sm">
                        Push notification pour les utilisateurs de l'app
                      </div>
                    </div>
                  </label>

                  <label class="flex items-start gap-3 cursor-pointer group">
                    <input type="checkbox" class="w-5 h-5 mt-0.5" />
                    <div class="flex-1">
                      <div class="text-white font-semibold group-hover:text-purple-300 transition-colors">
                        📄 Joindre le devis
                      </div>
                      <div class="text-slate-400 text-sm">
                        Ajouter le devis de 450€ en pièce jointe
                      </div>
                    </div>
                  </label>

                  <label class="flex items-start gap-3 cursor-pointer group">
                    <input type="checkbox" class="w-5 h-5 mt-0.5" />
                    <div class="flex-1">
                      <div class="text-white font-semibold group-hover:text-purple-300 transition-colors">
                        📷 Joindre les photos
                      </div>
                      <div class="text-slate-400 text-sm">
                        Inclure les 3 photos du signalement
                      </div>
                    </div>
                  </label>
                </div>
              </div>

              <!-- Actions -->
              <div class="flex gap-4 pt-4">
                <button
                  onclick="informerCoproprieteaires(); setState({showInformerCopro: false})"
                  class="flex-1 px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-xl font-bold transition-all shadow-lg"
                >
                  📢 Envoyer la mise à jour
                </button>
                <button
                  onclick="setState({showInformerCopro: false})"
                  class="px-6 py-4 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all"
                >
                  Annuler
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderSignalementDetail() {
      const sig = state.syndic.signalements.find(s => s.id === state.selectedSignalementId);
      if (!sig) return '';
      
      const copro = state.syndic.coproperties.find(c => c.id === sig.coproId);
      const totalResidents = state.syndic.residents.filter(r => r.coproId === sig.coproId).length;
      const readRate = Math.floor((sig.readBy.length / totalResidents) * 100);
      const unreadResidents = state.syndic.residents.filter(r => r.coproId === sig.coproId && !sig.readBy.includes(r.id));
      
      return `
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fadeIn" onclick="if(event.target === event.currentTarget) setState({showSignalementDetail: false})">
          <div class="glass rounded-2xl p-8 max-w-5xl w-full animate-slideInUp max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            
            <!-- Header -->
            <div class="flex items-start justify-between mb-6">
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <h2 class="text-2xl font-bold text-white">📋 Fiche Signalement #${sig.id}</h2>
                  <span class="px-4 py-2 ${
                    sig.status === 'Résolu' ? 'bg-green-500/20 text-green-400' :
                    sig.status === 'En cours' ? 'bg-amber-500/20 text-amber-400' :
                    'bg-blue-500/20 text-blue-400'
                  } rounded-lg font-semibold">${sig.status}</span>
                </div>
                <p class="text-slate-400">${copro?.name || '-'}</p>
              </div>
              <button onclick="setState({showSignalementDetail: false})" class="text-slate-400 hover:text-white transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <div class="grid md:grid-cols-3 gap-6">
              
              <!-- Colonne principale -->
              <div class="md:col-span-2 space-y-6">
                
                <!-- Informations principales -->
                <div class="glass rounded-xl p-6">
                  <h3 class="text-xl font-bold text-white mb-4">📝 Détails</h3>
                  <div class="space-y-3">
                    <div class="flex items-start gap-3">
                      <span class="px-3 py-1 ${sig.priority === 'haute' ? 'bg-red-500/20 text-red-400' : sig.priority === 'moyenne' ? 'bg-amber-500/20 text-amber-400' : 'bg-blue-500/20 text-blue-400'} rounded-full text-sm font-bold">${sig.type}</span>
                      <span class="px-3 py-1 ${sig.priority === 'haute' ? 'bg-red-500/20 text-red-400' : sig.priority === 'moyenne' ? 'bg-amber-500/20 text-amber-400' : 'bg-blue-500/20 text-blue-400'} rounded-full text-sm font-bold">Priorité: ${sig.priority}</span>
                    </div>
                    <p class="text-white text-lg">${sig.description}</p>
                    <div class="grid grid-cols-2 gap-4 pt-3 border-t border-slate-700">
                      <div>
                        <p class="text-slate-400 text-sm">Date de création</p>
                        <p class="text-white font-semibold">${new Date(sig.date).toLocaleDateString('fr-FR')}</p>
                      </div>
                      <div>
                        <p class="text-slate-400 text-sm">Auteur</p>
                        <p class="text-white font-semibold">${sig.author}</p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Options actives -->
                ${(sig.createIntervention || sig.informCopro) ? `
                  <div class="glass rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4">⚙️ Options activées</h3>
                    <div class="space-y-3">
                      ${sig.createIntervention ? `
                        <div class="flex items-center justify-between p-4 bg-purple-500/10 border border-purple-500/20 rounded-lg">
                          <div>
                            <p class="text-white font-semibold">🔧 Intervention créée</p>
                            <p class="text-slate-400 text-sm">Fiche intervention #${sig.interventionId}</p>
                          </div>
                          <button class="px-4 py-2 bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 rounded-lg font-semibold">
                            Voir →
                          </button>
                        </div>
                      ` : ''}
                      ${sig.informCopro ? `
                        <div class="p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg">
                          <p class="text-white font-semibold mb-2">📢 Copropriété informée</p>
                          <div class="flex items-center gap-2">
                            <div class="w-full bg-slate-700 rounded-full h-3">
                              <div class="bg-green-400 h-3 rounded-full" style="width: ${readRate}%"></div>
                            </div>
                            <span class="text-green-400 font-bold text-sm">${readRate}%</span>
                          </div>
                          <p class="text-slate-400 text-xs mt-2">${sig.readBy.length}/${totalResidents} copropriétaires ont lu</p>
                        </div>
                      ` : ''}
                    </div>
                  </div>
                ` : ''}

                <!-- Journal / Commentaires -->
                <div class="glass rounded-xl p-6">
                  <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-white">💬 Journal & Commentaires</h3>
                    <button class="px-4 py-2 bg-green-500/20 hover:bg-green-500/30 text-green-400 rounded-lg font-semibold text-sm">
                      + Ajouter
                    </button>
                  </div>
                  <div class="space-y-3">
                    ${sig.comments.length > 0 ? sig.comments.map(comment => `
                      <div class="p-4 bg-slate-800/50 rounded-lg border-l-4 ${comment.role === 'gestionnaire' ? 'border-purple-500' : comment.role === 'conseil' ? 'border-blue-500' : 'border-slate-600'}">
                        <div class="flex items-center gap-2 mb-2">
                          <span class="text-white font-semibold">${comment.author}</span>
                          <span class="px-2 py-1 ${comment.role === 'gestionnaire' ? 'bg-purple-500/20 text-purple-400' : comment.role === 'conseil' ? 'bg-blue-500/20 text-blue-400' : 'bg-slate-700 text-slate-300'} rounded text-xs">
                            ${comment.role === 'gestionnaire' ? '🔑 Gestionnaire' : comment.role === 'conseil' ? '🏛️ Conseil' : '👤 Copropriétaire'}
                          </span>
                          <span class="text-slate-400 text-xs ml-auto">${comment.date}</span>
                        </div>
                        <p class="text-slate-300 text-sm">${comment.text}</p>
                      </div>
                    `).join('') : '<p class="text-slate-400 text-center py-4">Aucun commentaire pour le moment</p>'}
                  </div>
                </div>

              </div>

              <!-- Colonne sidebar -->
              <div class="space-y-6">
                
                <!-- Actions rapides -->
                <div class="glass rounded-xl p-5">
                  <h3 class="text-lg font-bold text-white mb-4">⚡ Actions</h3>
                  <div class="space-y-2">
                    <button class="w-full px-4 py-3 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 rounded-xl font-semibold transition-all">
                      🔄 Changer statut
                    </button>
                    <button class="w-full px-4 py-3 bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 rounded-xl font-semibold transition-all">
                      🔧 Créer intervention
                    </button>
                    <button class="w-full px-4 py-3 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 rounded-xl font-semibold transition-all">
                      📢 Informer copro
                    </button>
                    <button class="w-full px-4 py-3 bg-green-500/20 hover:bg-green-500/30 text-green-400 rounded-xl font-semibold transition-all">
                      ✓ Marquer résolu
                    </button>
                  </div>
                </div>

                <!-- Accusé de lecture -->
                ${sig.informCopro ? `
                  <div class="glass rounded-xl p-5">
                    <h3 class="text-lg font-bold text-white mb-4">📊 Accusés lecture</h3>
                    <div class="space-y-3">
                      <div class="text-center p-4 bg-green-500/10 rounded-lg">
                        <div class="text-3xl font-bold text-green-400">${sig.readBy.length}</div>
                        <div class="text-slate-400 text-sm">Ont lu</div>
                      </div>
                      <div class="text-center p-4 bg-red-500/10 rounded-lg">
                        <div class="text-3xl font-bold text-red-400">${unreadResidents.length}</div>
                        <div class="text-slate-400 text-sm">N'ont pas lu</div>
                      </div>
                      ${unreadResidents.length > 0 ? `
                        <button class="w-full px-4 py-3 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 rounded-xl font-semibold transition-all">
                          🔔 Relancer (${sig.relancesSent})
                        </button>
                        ${sig.nextRelance ? `
                          <p class="text-slate-400 text-xs text-center">
                            Prochaine relance: ${new Date(sig.nextRelance).toLocaleDateString('fr-FR')}
                          </p>
                        ` : ''}
                      ` : ''}
                    </div>
                  </div>
                ` : ''}

                <!-- Photos -->
                ${sig.photos.length > 0 ? `
                  <div class="glass rounded-xl p-5">
                    <h3 class="text-lg font-bold text-white mb-4">📷 Photos (${sig.photos.length})</h3>
                    <div class="grid grid-cols-2 gap-2">
                      ${sig.photos.map(photo => `
                        <div class="aspect-square bg-slate-800 rounded-lg flex items-center justify-center text-4xl">
                          📷
                        </div>
                      `).join('')}
                    </div>
                  </div>
                ` : ''}

              </div>
            </div>

          </div>
        </div>
      `;
    }


    function renderRegistrationModal() {
      const selectedPlan = state.subscription.plans[state.registrationData.selectedPlan];
      const price = selectedPlan.price[state.registrationData.billingCycle];
      
      return `
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fadeIn" onclick="if(event.target === event.currentTarget) setState({showRegistrationModal: false})">
          <div class="bg-slate-800 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-8 animate-slideUp">
            <div class="flex justify-between items-center mb-6">
              <div>
                <h3 class="text-2xl font-bold text-white">Créer votre compte</h3>
                <p class="text-slate-400">Étape ${state.registrationStep}/3</p>
              </div>
              <button onclick="setState({showRegistrationModal: false})" class="text-slate-400 hover:text-white">
                ${icons.x}
              </button>
            </div>

            ${state.registrationStep === 1 ? `
              <!-- Étape 1: Choix du plan -->
              <div class="space-y-6">
                <div class="text-center mb-6">
                  <h4 class="text-xl font-bold text-white mb-2">Choisissez votre plan</h4>
                  <div class="inline-flex glass rounded-full p-1">
                    <button onclick="setState({registrationData: {...state.registrationData, billingCycle: 'monthly'}})" class='px-4 py-2 rounded-full transition-all ${state.registrationData.billingCycle === "monthly" ? "bg-amber-400 text-slate-900 font-semibold" : "text-slate-400"}'>
                      Mensuel
                    </button>
                    <button onclick="setState({registrationData: {...state.registrationData, billingCycle: 'yearly'}})" class='px-4 py-2 rounded-full transition-all ${state.registrationData.billingCycle === "yearly" ? "bg-amber-400 text-slate-900 font-semibold" : "text-slate-400"}'>
                      Annuel <span class="text-green-400 text-xs">-17%</span>
                    </button>
                  </div>
                </div>

                <div class="grid gap-4">
                  ${Object.entries(state.subscription.plans).map(([planKey, plan]) => {
                    const planPrice = plan.price[state.registrationData.billingCycle];
                    const isSelected = state.registrationData.selectedPlan === planKey;
                    return `
                      <div onclick="setState({registrationData: {...state.registrationData, selectedPlan: '${planKey}'}})" class='cursor-pointer border-2 ${isSelected ? "border-amber-400 bg-amber-400/10" : "border-slate-700 hover:border-slate-600"} rounded-xl p-6 transition-all'>
                        <div class="flex items-center justify-between mb-4">
                          <div>
                            <h5 class="text-xl font-bold text-white">${plan.name}</h5>
                            <div class="text-2xl font-bold text-amber-400">${planPrice}€ <span text-sm text-slate-400">/${state.registrationData.billingCycle === 'monthly' ? 'mois' : 'an'}</span></div>
                          </div>
                          <div class='w-6 h-6 rounded-full border-2 ${isSelected ? "border-amber-400 bg-amber-400" : "border-slate-600"} flex items-center justify-center'>
                            ${isSelected ? '<div class="w-3 h-3 bg-white rounded-full"></div>' : ''}
                          </div>
                        </div>
                        <div class="text-sm text-slate-300">${plan.features.slice(0, 3).join(' • ')}</div>
                      </div>
                    `;
                  }).join('')}
                </div>

                <button onclick="setState({registrationStep: 2})" class="w-full btn-primary px-6 py-4 rounded-xl text-white font-bold">
                  Continuer
                </button>
              </div>
            ` : state.registrationStep === 2 ? `
              <!-- Étape 2: Informations -->
              <div class="space-y-4">
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Nom de l'agence *</label>
                  <input
                    type="text"
                    value="${state.registrationData.companyName}"
                    onchange="setState({registrationData: {...state.registrationData, companyName: event.target.value}})"
                    placeholder="Agence Immobilière Provence"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  />
                </div>
                
                <div class="grid md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-slate-400 text-sm mb-2">Votre nom *</label>
                    <input
                      type="text"
                      value="${state.registrationData.name}"
                      onchange="setState({registrationData: {...state.registrationData, name: event.target.value}})"
                      placeholder="Jean Dupont"
                      class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    />
                  </div>
                  <div>
                    <label class="block text-slate-400 text-sm mb-2">Téléphone *</label>
                    <input
                      type="tel"
                      value="${state.registrationData.phone}"
                      onchange="setState({registrationData: {...state.registrationData, phone: event.target.value}})"
                      placeholder="+33 6 12 34 56 78"
                      class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    />
                  </div>
                </div>

                <div>
                  <label class="block text-slate-400 text-sm mb-2">Email professionnel *</label>
                  <input
                    type="email"
                    value="${state.registrationData.email}"
                    onchange="setState({registrationData: {...state.registrationData, email: event.target.value}})"
                    placeholder="contact@agence.com"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  />
                </div>

                <div>
                  <label class="block text-slate-400 text-sm mb-2">Mot de passe *</label>
                  <input
                    type="password"
                    value="${state.registrationData.password}"
                    onchange="setState({registrationData: {...state.registrationData, password: event.target.value}})"
                    placeholder="••••••••"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  />
                  <p class="text-xs text-slate-400 mt-1">Minimum 8 caractères</p>
                </div>

                <div class="flex gap-3 pt-4">
                  <button onclick="setState({registrationStep: 1})" class="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all">
                    Retour
                  </button>
                  <button onclick="setState({registrationStep: 3})" class="flex-1 btn-primary px-6 py-3 rounded-xl text-white font-semibold">
                    Continuer
                  </button>
                </div>
              </div>
            ` : `
              <!-- Étape 3: Confirmation et Paiement -->
              <div class="space-y-6">
                <div class="bg-gradient-to-r from-amber-500/10 to-purple-500/10 border border-amber-500/20 rounded-xl p-6 text-center">
                  <div class="text-5xl mb-4">💳</div>
                  <h4 class="text-2xl font-bold text-white mb-2">Confirmation de votre abonnement</h4>
                  <p class="text-slate-300 mb-4">Récapitulatif de votre commande</p>
                </div>

                <div class="glass rounded-xl p-6">
                  <h5 class="text-lg font-bold text-white mb-4">Récapitulatif</h5>
                  <div class="space-y-3 text-sm">
                    <div class="flex justify-between">
                      <span class="text-slate-400">Plan</span>
                      <span class="text-white font-semibold">${selectedPlan.name}</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-slate-400">Agence</span>
                      <span class="text-white font-semibold">${state.registrationData.companyName || 'Non renseigné'}</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-slate-400">Email</span>
                      <span class="text-white font-semibold">${state.registrationData.email || 'Non renseigné'}</span>
                    </div>
                    <div class="border-t border-slate-700 pt-3 mt-3 flex justify-between">
                      <span class="text-slate-400">Facturation ${state.registrationData.billingCycle === 'monthly' ? 'mensuelle' : 'annuelle'}</span>
                      <span class="text-amber-400 font-bold text-xl">${price}€</span>
                    </div>
                  </div>
                </div>

                <div class="bg-blue-500/10 border border-blue-500/20 rounded-xl p-4">
                  <p class="text-sm text-slate-300">
                    ✓ Accès immédiat à toutes les fonctionnalités<br/>
                    ✓ Paiement sécurisé par Stripe<br/>
                    ✓ Annulation possible à tout moment<br/>
                    ✓ Facturation : ${price}€/${state.registrationData.billingCycle === 'monthly' ? 'mois' : 'an'}
                  </p>
                </div>

                <div class="flex gap-3 pt-4">
                  <button onclick="setState({registrationStep: 2})" class="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all">
                    Retour
                  </button>
                  <button onclick="handleRegistrationComplete()" class="flex-1 btn-primary px-6 py-3 rounded-xl text-white font-semibold">
                    💳 Procéder au paiement
                  </button>
                </div>
              </div>
            `}
          </div>
        </div>
      `;
    }

    // Tutoriel interactif - Étapes guidées
    const tutorialSteps = [
      {
        title: "🎉 Bienvenue sur Realtix Pro !",
        description: "Découvrons ensemble les fonctionnalités principales de votre nouvelle plateforme immobilière.",
        target: null,
        position: "center"
      },
      {
        title: "🏢 Pro Syndic - Nouveau !",
        description: "Gérez vos copropriétés en toute simplicité : charges, interventions, documents et assemblées générales. Disponible en PRO et ENTREPRISE.",
        target: "syndic",
        position: "right"
      },
      {
        title: "📊 Votre Tableau de bord",
        description: "Ici vous avez une vue d'ensemble de votre activité : biens actifs, clients, visites programmées et ventes.",
        target: "dashboard",
        position: "center"
      },
      {
        title: "🏡 Gestion des Biens",
        description: "Ajoutez et gérez tous vos biens immobiliers. Recherchez, filtrez et organisez votre catalogue.",
        target: "properties",
        position: "right"
      },
      {
        title: "👥 Gestion des Clients",
        description: "Gérez vos clients acheteurs et vendeurs. Suivez leur budget, statut et historique de contact.",
        target: "clients",
        position: "right"
      },
      {
        title: "📅 Calendrier des Visites",
        description: "Planifiez et suivez toutes vos visites avec vos clients. Ne ratez plus jamais un rendez-vous !",
        target: "visits",
        position: "right"
      },
      {
        title: "🤖 Assistant IA",
        description: "Votre assistant intelligent : réponses suggérées, simulations de financement et relances automatiques.",
        target: "ai",
        position: "right"
      },
      {
        title: "✅ Checklist de démarrage",
        description: "Utilisez la checklist pour ne rien oublier lors de votre première utilisation. Cliquez sur l'icône ✓ en haut à droite !",
        target: "checklist",
        position: "left"
      }
    ];

    function startTutorial() {
      setState({ 
        showTutorial: true, 
        tutorialStep: 0,
        showChecklist: false 
      });
    }

    function nextTutorialStep() {
      if (state.tutorialStep < tutorialSteps.length - 1) {
        setState({ tutorialStep: state.tutorialStep + 1 });
      } else {
        completeTutorial();
      }
    }

    function previousTutorialStep() {
      if (state.tutorialStep > 0) {
        setState({ tutorialStep: state.tutorialStep - 1 });
      }
    }

    function skipTutorial() {
      setState({ 
        showTutorial: false,
        showChecklist: true 
      });
    }

    function completeTutorial() {
      setState({ 
        showTutorial: false,
        showChecklist: true 
      });
    }

    function toggleChecklist() {
      setState({ showChecklist: !state.showChecklist });
    }

    function checkTask(task) {
      setState({
        onboardingChecklist: {
          ...state.onboardingChecklist,
          [task]: !state.onboardingChecklist[task]
        }
      });
      
      // Vérifier si toutes les tâches sont complétées
      const allCompleted = Object.values({
        ...state.onboardingChecklist,
        [task]: !state.onboardingChecklist[task]
      }).every(v => v === true);
      
      if (allCompleted && !state.onboardingComplete) {
        setTimeout(() => {
          alert('🎉 Félicitations ! Vous avez terminé la checklist de démarrage.\n\nVous maîtrisez maintenant Realtix Pro !');
          setState({ onboardingComplete: true });
        }, 300);
      }
    }

    // Fonctions de personnalisation
    function changeTheme(theme) {
      setState({
        customization: {
          ...state.customization,
          theme: theme
        }
      });
    }

    function changeFont(font) {
      setState({
        customization: {
          ...state.customization,
          fontFamily: font
        }
      });
    }

    // Fonctions de messagerie
    function toggleMessaging() {
      setState({ showMessaging: !state.showMessaging });
    }

    function toggleAgentSelection(agentName) {
      const currentTo = state.newMessage.to;
      const index = currentTo.indexOf(agentName);
      
      if (index > -1) {
        setState({
          newMessage: {
            ...state.newMessage,
            to: currentTo.filter(name => name !== agentName)
          }
        });
      } else {
        setState({
          newMessage: {
            ...state.newMessage,
            to: [...currentTo, agentName]
          }
        });
      }
    }

    function selectAllAgents() {
      const allAgents = state.agents.map(a => a.name);
      setState({
        newMessage: {
          ...state.newMessage,
          to: allAgents
        }
      });
    }

    function attachProperty(propertyId) {
      const attached = state.newMessage.attachments.find(a => a.type === 'property' && a.id === propertyId);
      
      if (attached) {
        setState({
          newMessage: {
            ...state.newMessage,
            attachments: state.newMessage.attachments.filter(a => !(a.type === 'property' && a.id === propertyId))
          }
        });
      } else {
        setState({
          newMessage: {
            ...state.newMessage,
            attachments: [...state.newMessage.attachments, { type: 'property', id: propertyId }]
          }
        });
      }
    }

    function attachClient(clientId) {
      const attached = state.newMessage.attachments.find(a => a.type === 'client' && a.id === clientId);
      
      if (attached) {
        setState({
          newMessage: {
            ...state.newMessage,
            attachments: state.newMessage.attachments.filter(a => !(a.type === 'client' && a.id === clientId))
          }
        });
      } else {
        setState({
          newMessage: {
            ...state.newMessage,
            attachments: [...state.newMessage.attachments, { type: 'client', id: clientId }]
          }
        });
      }
    }

    function useTemplate(templateId) {
      const template = state.messageTemplates.find(t => t.id === templateId);
      if (template) {
        setState({
          newMessage: {
            ...state.newMessage,
            subject: template.subject,
            message: template.message
          },
          messagingTab: 'compose'
        });
      }
    }

    function sendMessage() {
      if (state.newMessage.to.length === 0) {
        alert('⚠️ Veuillez sélectionner au moins un destinataire');
        return;
      }
      
      if (!state.newMessage.subject || !state.newMessage.message) {
        alert('⚠️ Veuillez remplir le sujet et le message');
        return;
      }

      const message = {
        id: state.sentMessages.length + 1,
        from: state.currentUser.name,
        to: state.newMessage.to,
        subject: state.newMessage.subject,
        message: state.newMessage.message,
        attachments: state.newMessage.attachments,
        sentDate: new Date().toISOString(),
        read: false
      };

      setState({
        sentMessages: [message, ...state.sentMessages],
        newMessage: {
          to: [],
          subject: '',
          message: '',
          attachments: []
        },
        messagingTab: 'sent'
      });

      alert(`✅ Message envoyé avec succès à ${message.to.length} agent(s) !`);
    }

    function renderMessaging() {
      if (!state.showMessaging) return '';
      
      return `
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50" onclick="if(event.target === event.currentTarget) toggleMessaging()">
          <div class="bg-slate-800 rounded-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Header -->
            <div class="p-6 border-b border-slate-700 flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white text-2xl">
                  📧
                </div>
                <div>
                  <h3 class="text-2xl font-bold text-white">Messagerie Agents</h3>
                  <p class="text-slate-400 text-sm">Envoyez des mails, biens et profils clients</p>
                </div>
              </div>
              <button onclick="toggleMessaging()" class="text-slate-400 hover:text-white transition-all">
                ${icons.x}
              </button>
            </div>

            <!-- Tabs -->
            <div class="flex border-b border-slate-700 px-6">
              <button 
                onclick="setState({messagingTab: 'compose'})"
                class='px-6 py-3 font-semibold transition-all ${state.messagingTab === "compose" ? "text-amber-400 border-b-2 border-amber-400" : "text-slate-400 hover:text-white"}'
              >
                ✍️ Composer
              </button>
              <button 
                onclick="setState({messagingTab: 'sent'})"
                class='px-6 py-3 font-semibold transition-all ${state.messagingTab === "sent" ? "text-amber-400 border-b-2 border-amber-400" : "text-slate-400 hover:text-white"}'
              >
                📤 Envoyés (${state.sentMessages.length})
              </button>
              <button 
                onclick="setState({messagingTab: 'templates'})"
                class='px-6 py-3 font-semibold transition-all ${state.messagingTab === "templates" ? "text-amber-400 border-b-2 border-amber-400" : "text-slate-400 hover:text-white"}'
              >
                📋 Modèles
              </button>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto p-6">
              ${state.messagingTab === 'compose' ? `
                <div class="space-y-6">
                  <!-- Destinataires -->
                  <div>
                    <div class="flex items-center justify-between mb-3">
                      <label class="text-white font-semibold">Destinataires (Agents)</label>
                      <div class="flex gap-2">
                        <button onclick="selectAllAgents()" class="text-sm text-blue-400 hover:text-blue-300">Tout sélectionner</button>
                        <span class="text-slate-600">|</span>
                        <button onclick="setState({newMessage: {...state.newMessage, to: []}})" class="text-sm text-slate-400 hover:text-slate-300">Tout désélectionner</button>
                      </div>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                      ${state.agents.map(agent => {
                        const isSelected = state.newMessage.to.includes(agent.name);
                        return `
                          <div 
                            onclick="toggleAgentSelection('${agent.name}')"
                            class='flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all ${
                              isSelected 
                                ? "bg-amber-500/20 border-2 border-amber-400" 
                                : "bg-slate-700/50 border-2 border-slate-600 hover:border-slate-500"
                            }'
                          >
                            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm">
                              ${agent.name.charAt(0)}
                            </div>
                            <div class="flex-1">
                              <div class="text-white font-semibold text-sm">${agent.name}</div>
                              <div class="text-slate-400 text-xs">${agent.sales} ventes</div>
                            </div>
                            ${isSelected ? '<div class="text-amber-400">✓</div>' : ''}
                          </div>
                        `;
                      }).join('')}
                    </div>
                    ${state.newMessage.to.length > 0 ? `
                      <div class="mt-3 text-sm text-slate-400">
                        ${state.newMessage.to.length} agent(s) sélectionné(s) : ${state.newMessage.to.join(', ')}
                      </div>
                    ` : ''}
                  </div>

                  <!-- Sujet -->
                  <div>
                    <label class="block text-white font-semibold mb-2">Sujet</label>
                    <input
                      type="text"
                      value="${state.newMessage.subject}"
                      onchange="setState({newMessage: {...state.newMessage, subject: event.target.value}})"
                      placeholder="Sujet du message..."
                      class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    />
                  </div>

                  <!-- Message -->
                  <div>
                    <label class="block text-white font-semibold mb-2">Message</label>
                    <textarea
                      value="${state.newMessage.message}"
                      onchange="setState({newMessage: {...state.newMessage, message: event.target.value}})"
                      placeholder="Écrivez votre message ici..."
                      rows="8"
                      class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400 resize-none"
                    ></textarea>
                  </div>

                  <!-- Pièces jointes -->
                  <div>
                    <label class="block text-white font-semibold mb-3">Pièces jointes</label>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                      <!-- Biens -->
                      <div class="bg-slate-700/30 rounded-xl p-4">
                        <h4 class="text-white font-semibold mb-3 flex items-center gap-2">
                          🏡 Biens (${state.newMessage.attachments.filter(a => a.type === 'property').length})
                        </h4>
                        <div class="space-y-2 max-h-48 overflow-y-auto">
                          ${state.properties.slice(0, 5).map(property => {
                            const isAttached = state.newMessage.attachments.find(a => a.type === 'property' && a.id === property.id);
                            return `
                              <div 
                                onclick="attachProperty(${property.id})"
                                class='flex items-center justify-between p-2 rounded-lg cursor-pointer transition-all ${
                                  isAttached ? "bg-green-500/20 border border-green-500/50" : "bg-slate-700/50 hover:bg-slate-700"
                                }'
                              >
                                <div class="flex items-center gap-2 flex-1">
                                  <span class="text-2xl">${property.image}</span>
                                  <div>
                                    <div class="text-white text-sm font-semibold">${property.title}</div>
                                    <div class="text-slate-400 text-xs">${property.price.toLocaleString()} €</div>
                                  </div>
                                </div>
                                ${isAttached ? '<span class="text-green-400">✓</span>' : ''}
                              </div>
                            `;
                          }).join('')}
                        </div>
                      </div>

                      <!-- Clients -->
                      <div class="bg-slate-700/30 rounded-xl p-4">
                        <h4 class="text-white font-semibold mb-3 flex items-center gap-2">
                          👥 Clients (${state.newMessage.attachments.filter(a => a.type === 'client').length})
                        </h4>
                        <div class="space-y-2 max-h-48 overflow-y-auto">
                          ${state.clients.slice(0, 5).map(client => {
                            const isAttached = state.newMessage.attachments.find(a => a.type === 'client' && a.id === client.id);
                            return `
                              <div 
                                onclick="attachClient(${client.id})"
                                class='flex items-center justify-between p-2 rounded-lg cursor-pointer transition-all ${
                                  isAttached ? "bg-green-500/20 border border-green-500/50" : "bg-slate-700/50 hover:bg-slate-700"
                                }'
                              >
                                <div class="flex-1">
                                  <div class="text-white text-sm font-semibold">${client.name}</div>
                                  <div class="text-slate-400 text-xs">${client.type} - ${client.budget.toLocaleString()} €</div>
                                </div>
                                ${isAttached ? '<span class="text-green-400">✓</span>' : ''}
                              </div>
                            `;
                          }).join('')}
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Actions -->
                  <div class="flex gap-3 pt-4">
                    <button onclick="toggleMessaging()" class="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all">
                      Annuler
                    </button>
                    <button onclick="sendMessage()" class="flex-1 px-6 py-3 btn-primary rounded-xl font-semibold">
                      📤 Envoyer
                    </button>
                  </div>
                </div>
              ` : state.messagingTab === 'sent' ? `
                <div class="space-y-4">
                  ${state.sentMessages.length === 0 ? `
                    <div class="text-center py-12 text-slate-400">
                      <div class="text-6xl mb-4">📭</div>
                      <p>Aucun message envoyé</p>
                    </div>
                  ` : state.sentMessages.map(msg => `
                    <div class="bg-slate-700/50 rounded-xl p-5 border border-slate-600">
                      <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                          <div class="text-white font-bold text-lg mb-1">${msg.subject}</div>
                          <div class="text-slate-400 text-sm">
                            À: ${msg.to.join(', ')} • ${new Date(msg.sentDate).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' })}
                          </div>
                        </div>
                        <span class="text-2xl">📤</span>
                      </div>
                      <p class="text-slate-300 text-sm whitespace-pre-line mb-3">${msg.message}</p>
                      ${msg.attachments.length > 0 ? `
                        <div class="flex flex-wrap gap-2">
                          ${msg.attachments.map(att => {
                            if (att.type === 'property') {
                              const prop = state.properties.find(p => p.id === att.id);
                              return prop ? `<span class="inline-flex items-center gap-1 px-3 py-1 bg-blue-500/20 text-blue-400 rounded-full text-xs">🏡 ${prop.title}</span>` : '';
                            } else {
                              const client = state.clients.find(c => c.id === att.id);
                              return client ? `<span class="inline-flex items-center gap-1 px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full text-xs">👤 ${client.name}</span>` : '';
                            }
                          }).join('')}
                        </div>
                      ` : ''}
                    </div>
                  `).join('')}
                </div>
              ` : `
                <div class="grid md:grid-cols-2 gap-4">
                  ${state.messageTemplates.map(template => `
                    <div class="bg-slate-700/50 rounded-xl p-5 border border-slate-600 hover:border-amber-400/50 transition-all cursor-pointer" onclick="useTemplate(${template.id})">
                      <h4 class="text-white font-bold text-lg mb-2">${template.name}</h4>
                      <div class="text-slate-400 text-sm mb-3 font-semibold">Sujet: ${template.subject}</div>
                      <p class="text-slate-300 text-sm whitespace-pre-line line-clamp-4">${template.message}</p>
                      <button class="mt-4 w-full px-4 py-2 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 rounded-lg font-semibold transition-all">
                        Utiliser ce modèle
                      </button>
                    </div>
                  `).join('')}
                </div>
              `}
            </div>
          </div>
        </div>
      `;
    }

    function renderTutorial() {
      if (!state.showTutorial) return '';
      
      const step = tutorialSteps[state.tutorialStep];
      const progress = ((state.tutorialStep + 1) / tutorialSteps.length) * 100;
      
      return `
        <div class="fixed inset-0 z-50">
          <!-- Overlay -->
          <div class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
          
          <!-- Tutorial Card -->
          <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-2xl p-6">
            <div class="glass rounded-2xl p-8 border-2 border-amber-400/50 animate-slideUp">
              <!-- Progress Bar -->
              <div class="mb-6">
                <div class="flex justify-between text-sm text-slate-400 mb-2">
                  <span>Étape ${state.tutorialStep + 1} sur ${tutorialSteps.length}</span>
                  <span>${Math.round(progress)}%</span>
                </div>
                <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-amber-400 to-amber-500 transition-all duration-500" style="width: ${progress}%"></div>
                </div>
              </div>

              <!-- Content -->
              <div class="text-center mb-8">
                <h3 class="text-3xl font-bold text-white mb-4">${step.title}</h3>
                <p class="text-lg text-slate-300">${step.description}</p>
              </div>

              <!-- Navigation -->
              <div class="flex items-center justify-between gap-4">
                <button 
                  onclick="skipTutorial()" 
                  class="text-slate-400 hover:text-white transition-all"
                >
                  Passer le tutoriel
                </button>
                
                <div class="flex gap-3">
                  ${state.tutorialStep > 0 ? `
                    <button 
                      onclick="previousTutorialStep()" 
                      class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all"
                    >
                      ← Précédent
                    </button>
                  ` : ''}
                  
                  <button 
                    onclick="nextTutorialStep()" 
                    class="px-6 py-3 btn-primary rounded-xl font-semibold"
                  >
                    ${state.tutorialStep === tutorialSteps.length - 1 ? 'Terminer ✓' : 'Suivant →'}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderChecklist() {
      if (!state.showChecklist) return '';
      
      const tasks = [
        { key: 'profile', icon: '👤', title: 'Compléter mon profil', description: 'Ajoutez vos informations personnelles' },
        { key: 'addProperty', icon: '🏡', title: 'Ajouter un bien', description: 'Créez votre première annonce' },
        { key: 'addClient', icon: '👥', title: 'Ajouter un client', description: 'Enregistrez votre premier contact' },
        { key: 'scheduleVisit', icon: '📅', title: 'Programmer une visite', description: 'Planifiez un rendez-vous' },
        { key: 'exploreAI', icon: '🤖', title: 'Explorer l\'Assistant IA', description: 'Découvrez les fonctionnalités IA' },
        { key: 'viewReports', icon: '📊', title: 'Voir les rapports', description: 'Consultez vos analytics' }
      ];
      
      const completedCount = Object.values(state.onboardingChecklist).filter(v => v).length;
      const totalCount = tasks.length;
      const progressPercent = (completedCount / totalCount) * 100;
      
      return `
        <div class="fixed top-20 right-6 w-96 glass rounded-2xl p-6 border border-amber-400/30 z-40 animate-slideUp">
          <!-- Header -->
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="text-xl font-bold text-white mb-1">Checklist de démarrage</h3>
              <p class="text-sm text-slate-400">${completedCount}/${totalCount} tâches complétées</p>
            </div>
            <button onclick="toggleChecklist()" class="text-slate-400 hover:text-white transition-all">
              ${icons.x}
            </button>
          </div>

          <!-- Progress -->
          <div class="mb-6">
            <div class="h-3 bg-slate-700 rounded-full overflow-hidden">
              <div class="h-full bg-gradient-to-r from-green-500 to-emerald-500 transition-all duration-500" style="width: ${progressPercent}%"></div>
            </div>
            ${progressPercent === 100 ? `
              <div class="mt-3 bg-green-500/20 border border-green-500/50 rounded-lg p-3 text-center">
                <span class="text-green-400 font-semibold">🎉 Bravo ! Checklist terminée !</span>
              </div>
            ` : ''}
          </div>

          <!-- Tasks -->
          <div class="space-y-3">
            ${tasks.map(task => {
              const isCompleted = state.onboardingChecklist[task.key];
              return `
                <div 
                  onclick="checkTask('${task.key}')" 
                  class='flex items-start gap-3 p-4 rounded-xl cursor-pointer transition-all ${
                    isCompleted 
                      ? "bg-green-500/10 border border-green-500/30" 
                      : "bg-slate-800/50 border border-slate-700 hover:border-amber-400/50"
                  }'
                >
                  <div class='flex-shrink-0 w-6 h-6 rounded-full border-2 ${
                    isCompleted 
                      ? "bg-green-500 border-green-500" 
                      : "border-slate-600"
                  } flex items-center justify-center transition-all'>
                    ${isCompleted ? '<span class="text-white text-sm">✓</span>' : ''}
                  </div>
                  <div class="flex-1">
                    <div class="flex items-center gap-2 mb-1">
                      <span class="text-lg">${task.icon}</span>
                      <span class='text-white font-semibold ${isCompleted ? "line-through opacity-60" : ""}'>${task.title}</span>
                    </div>
                    <p class='text-sm text-slate-400 ${isCompleted ? "line-through opacity-60" : ""}'>${task.description}</p>
                  </div>
                </div>
              `;
            }).join('')}
          </div>

          <!-- Actions -->
          <div class="mt-6 pt-6 border-t border-slate-700">
            <button onclick="startTutorial()" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 rounded-xl font-semibold transition-all">
              🎓 Revoir le tutoriel
            </button>
          </div>
        </div>
      `;
    }

    function handleRegistrationComplete() {
      const selectedPlan = state.subscription.plans[state.registrationData.selectedPlan];
      const price = selectedPlan ? selectedPlan.price[state.registrationData.billingCycle] : 149;
      
      // MODE DÉMO - Bypass du paiement
      // En production, vous intégreriez vraiment Stripe Checkout
      
      // Simuler le succès du paiement directement
      showToast('✅ Compte créé avec succès ! Bienvenue sur Realtix Pro.');
      
      // Créer un utilisateur manager par défaut et connecter
      setTimeout(() => {
        setState({
          currentUser: { 
            name: state.registrationData.name || 'Philippe Rousseau', 
            role: 'manager', 
            email: state.registrationData.email || 'contact@agence.com'
          },
          currentPage: 'dashboard',
          showRegistrationModal: false,
          showPublicLanding: false,
          registrationStep: 1,
          subscription: {
            ...state.subscription,
            currentPlan: state.registrationData.selectedPlan,
            billingCycle: state.registrationData.billingCycle,
            amount: price
          },
          showTutorial: true, // Lancer le tutoriel pour les nouveaux utilisateurs
          tutorialStep: 0
        });
      }, 1000);
    }
    
    // Fonction pour créer une vraie session Stripe (à implémenter côté serveur)
    async function createStripeCheckoutSession() {
      // Cette fonction devrait appeler votre backend pour créer une session Stripe
      // Exemple d'implémentation :
      
      const selectedPlan = state.subscription.plans[state.registrationData.selectedPlan];
      const price = selectedPlan.price[state.registrationData.billingCycle];
      
      try {
        // Appel à votre API backend
        const response = await fetch('/api/create-checkout-session', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            plan: state.registrationData.selectedPlan,
            billingCycle: state.registrationData.billingCycle,
            email: state.registrationData.email,
            customerData: {
              name: state.registrationData.name,
              company: state.registrationData.companyName,
              phone: state.registrationData.phone
            }
          })
        });
        
        const session = await response.json();
        
        // Rediriger vers Stripe Checkout
        const stripe = Stripe('pk_test_51QdVNqP5g8YlXKFvQqGhzXrAdjBKh0Kb3mVh6JQa8kNGK0DL8TgJ5pGqHlDCuLBQzqEcQ6k0Y9sDFwHFmXjYG8vB00E1K7gHJK');
        const { error } = await stripe.redirectToCheckout({
          sessionId: session.id
        });
        
        if (error) {
          alert('Erreur lors de la redirection vers Stripe : ' + error.message);
        }
      } catch (error) {
        console.error('Erreur Stripe:', error);
        alert('Une erreur est survenue. Veuillez réessayer.');
      }
    }

    function renderLoginPage() {
      return `
        <div class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4">
          <div class="max-w-5xl w-full glass rounded-3xl shadow-2xl overflow-hidden animate-fadeIn">
            <div class="grid md:grid-cols-2">
              <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-12 flex flex-col justify-center text-white">
                <div class="animate-slideUp" style="animation-delay: 0.2s; opacity: 0">
                  <div class="text-amber-400 mb-6">${icons.aiLogo}</div>
                  <h1 class="text-4xl font-bold mb-4">Realtix Pro</h1>
                  <p class="text-slate-300 text-lg leading-relaxed mb-8">
                    La plateforme complète pour gérer votre agence immobilière avec élégance et efficacité.
                  </p>
                  <div class="space-y-4">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 rounded-full bg-amber-400/20 flex items-center justify-center text-amber-400">
                        🤖
                      </div>
                      <span class="text-slate-200 font-medium">Assistant IA intelligent</span>
                    </div>
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 rounded-full bg-amber-400/20 flex items-center justify-center text-amber-400">
                        ${icons.chart}
                      </div>
                      <span class="text-slate-200 font-medium">Analytics en temps réel</span>
                    </div>
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 rounded-full bg-amber-400/20 flex items-center justify-center text-amber-400">
                        📧
                      </div>
                      <span class="text-slate-200 font-medium">Email professionnel intégré</span>
                    </div>
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 rounded-full bg-amber-400/20 flex items-center justify-center text-amber-400">
                        👥
                      </div>
                      <span class="text-slate-200 font-medium">Gestion d'équipe collaborative</span>
                    </div>
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 rounded-full bg-amber-400/20 flex items-center justify-center text-amber-400">
                        ${icons.calendar}
                      </div>
                      <span class="text-slate-200 font-medium">Calendrier de visites automatisé</span>
                    </div>
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 rounded-full bg-amber-400/20 flex items-center justify-center text-amber-400">
                        📊
                      </div>
                      <span class="text-slate-200 font-medium">Rapports & tableaux de bord</span>
                    </div>
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 rounded-full bg-amber-400/20 flex items-center justify-center text-amber-400">
                        🔒
                      </div>
                      <span class="text-slate-200 font-medium">Sécurité & confidentialité garanties</span>
                    </div>
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 rounded-full bg-amber-400/20 flex items-center justify-center text-amber-400">
                        ⚡
                      </div>
                      <span class="text-slate-200 font-medium">Interface ultra-rapide</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="bg-white p-12 flex flex-col justify-center">
                <div class="animate-slideUp" style="animation-delay: 0.4s; opacity: 0">
                  <div class="text-center mb-8">
                    <div class="inline-block p-4 bg-gradient-to-br from-amber-500 to-orange-500 rounded-2xl mb-4">
                      ${icons.aiLogo}
                    </div>
                    <h2 class="text-3xl font-bold text-slate-800 mb-2">Bienvenue sur Realtix Pro</h2>
                    <p class="text-slate-600">Connectez-vous à votre compte</p>
                  </div>
                  
                  <form onsubmit="handleLogin(event)" class="space-y-4">
                    <div>
                      <label class="block text-slate-700 font-semibold mb-2">Adresse email</label>
                      <input
                        type="email"
                        id="loginEmail"
                        placeholder="votre@email.com"
                        required
                        class="w-full px-4 py-3 bg-slate-50 border border-slate-300 rounded-xl text-slate-800 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent transition-all"
                      />
                    </div>

                    <div>
                      <label class="block text-slate-700 font-semibold mb-2">Mot de passe</label>
                      <input
                        type="password"
                        id="loginPassword"
                        placeholder="••••••••"
                        required
                        class="w-full px-4 py-3 bg-slate-50 border border-slate-300 rounded-xl text-slate-800 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-transparent transition-all"
                      />
                    </div>

                    <div class="flex items-center justify-between text-sm">
                      <label class="flex items-center gap-2 text-slate-600 cursor-pointer">
                        <input type="checkbox" class="rounded border-slate-300 text-amber-500 focus:ring-amber-400" />
                        <span>Se souvenir de moi</span>
                      </label>
                      <button type="button" class="text-amber-600 hover:text-amber-700 font-semibold">
                        Mot de passe oublié ?
                      </button>
                    </div>

                    <button type="submit" class="w-full btn-primary text-white px-8 py-4 rounded-xl font-semibold flex items-center justify-center gap-2 group">
                      <span>Se connecter</span>
                      <div class="transform group-hover:translate-x-1 transition-transform">→</div>
                    </button>
                  </form>

                  <div class="mt-4 text-center">
                    <button onclick="setState({currentPage: 'login', showPublicLanding: true})" class="text-slate-600 hover:text-amber-600 font-semibold text-sm flex items-center justify-center gap-2 mx-auto transition-colors">
                      ← Retour aux tarifs
                    </button>
                  </div>

                  <div class="mt-6 p-4 bg-blue-50 rounded-xl">
                    <p class="text-sm text-slate-600">
                      <strong>👥 Nouveau collaborateur ?</strong><br/>
                      Utilisez le lien d'invitation envoyé par email pour créer votre compte.
                    </p>
                  </div>

                  <div class="mt-8 pt-8 border-t border-slate-200">
                    <p class="text-sm text-slate-500 text-center">
                      © 2026 Realtix Pro - Tous droits réservés
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderLeadScoringWidget() {
      const hotLeads = state.clients.filter(c => (c.aiScore || 0) >= 85).sort((a, b) => (b.aiScore || 0) - (a.aiScore || 0)).slice(0, 3);
      
      if (hotLeads.length === 0) {
        return `
          <div class="text-center py-8">
            <div class="text-5xl mb-3">🎯</div>
            <p class="text-slate-400">Aucun prospect chaud pour le moment</p>
          </div>
        `;
      }

      return `
        <div class="grid md:grid-cols-3 gap-4 mb-4">
          ${hotLeads.map((client, index) => `
            <div class="bg-slate-800/50 rounded-xl p-4 border-l-4 border-green-500 hover:bg-slate-800 transition-all cursor-pointer">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-green-400 to-green-500 flex items-center justify-center text-white font-bold text-lg shadow-lg">
                  ${client.name.charAt(0)}
                </div>
                <div class="flex-1">
                  <div class="text-white font-semibold text-sm">${client.name}</div>
                  <div class="text-slate-400 text-xs">${client.budget}</div>
                </div>
                <div class="text-center">
                  <div class="text-2xl font-bold text-green-400">${client.aiScore}</div>
                  <div class="text-xs text-slate-400">Score</div>
                </div>
              </div>
              
              <div class="grid grid-cols-2 gap-2 mb-3 p-2 bg-slate-900/50 rounded">
                <div class="text-center">
                  <div class="text-xs font-bold text-green-400">${client.visitFrequency}</div>
                  <div class="text-xs text-slate-400">Visites</div>
                </div>
                <div class="text-center">
                  <div class="text-xs font-bold text-green-400">${client.responseRate}%</div>
                  <div class="text-xs text-slate-400">Réponses</div>
                </div>
              </div>

              <div class="flex gap-2">
                <button class="flex-1 px-3 py-2 bg-green-500/20 hover:bg-green-500/30 text-green-400 rounded-lg text-xs font-semibold transition-all flex items-center justify-center gap-1">
                  📞 Appeler
                </button>
                <button class="flex-1 px-3 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 rounded-lg text-xs font-semibold transition-all flex items-center justify-center gap-1">
                  📧 Email
                </button>
              </div>
            </div>
          `).join('')}
        </div>

        <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-3">
          <p class="text-green-400 text-sm">
            <strong>🔥 ${hotLeads.length} prospects chauds</strong> avec un score ≥85. 
            Ces leads ont une <strong>probabilité de conversion très élevée</strong>. Contactez-les en priorité !
          </p>
        </div>
      `;
    }

    function getHotLeadsCount() {
      return state.clients.filter(c => (c.aiScore || 0) >= 85).length;
    }

    function renderDashboard() {
      const stats = getStats();
      return `
        <div class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="stat-card glass rounded-2xl p-6 animate-slideUp" style="animation-delay: 0.1s; opacity: 0">
              <div class="flex items-start justify-between mb-4">
                <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white">
                  ${icons.home}
                </div>
                <div class="flex items-center gap-1 text-sm font-semibold text-green-500">
                  ${icons.trendUp}
                  12%
                </div>
              </div>
              <div class="text-3xl font-bold text-white mb-1">${stats.availableProperties}</div>
              <div class="text-slate-400 text-sm">Biens actifs</div>
            </div>

            <div class="stat-card glass rounded-2xl p-6 animate-slideUp" style="animation-delay: 0.2s; opacity: 0">
              <div class="flex items-start justify-between mb-4">
                <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center text-white">
                  ${icons.users}
                </div>
                <div class="flex items-center gap-1 text-sm font-semibold text-green-500">
                  ${icons.trendUp}
                  8%
                </div>
              </div>
              <div class="text-3xl font-bold text-white mb-1">${stats.activeClients}</div>
              <div class="text-slate-400 text-sm">Clients actifs</div>
            </div>

            <div class="stat-card glass rounded-2xl p-6 animate-slideUp" style="animation-delay: 0.3s; opacity: 0">
              <div class="flex items-start justify-between mb-4">
                <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-white">
                  ${icons.calendar}
                </div>
                <div class="flex items-center gap-1 text-sm font-semibold text-red-500">
                  ${icons.trendDown}
                  5%
                </div>
              </div>
              <div class="text-3xl font-bold text-white mb-1">${stats.upcomingVisits}</div>
              <div class="text-slate-400 text-sm">Visites programmées</div>
            </div>

            <div class="stat-card glass rounded-2xl p-6 animate-slideUp" style="animation-delay: 0.4s; opacity: 0">
              <div class="flex items-start justify-between mb-4">
                <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-white">
                  ${icons.activity}
                </div>
                <div class="flex items-center gap-1 text-sm font-semibold text-green-500">
                  ${icons.trendUp}
                  15%
                </div>
              </div>
              <div class="text-3xl font-bold text-white mb-1">${stats.soldProperties}</div>
              <div class="text-slate-400 text-sm">Biens vendus ce mois</div>
            </div>
          </div>

          <div class='grid ${state.currentUser.role === "manager" ? "lg:grid-cols-2" : "lg:grid-cols-1"} gap-6'>
            ${state.currentUser.role === 'manager' ? `
            <div class="glass rounded-2xl p-6">
              <h3 class="text-xl font-bold text-white mb-6">Valeur du portefeuille</h3>
              <div class="text-4xl font-bold text-amber-400 mb-2">${(stats.totalValue / 1000000).toFixed(1)}M €</div>
              <div class="text-slate-400 mb-6">Prix moyen: ${(stats.avgPrice / 1000).toFixed(0)}k €</div>
              <div class="space-y-3">
                <div>
                  <div class="flex justify-between text-sm mb-1">
                    <span class="text-slate-400">Disponibles</span>
                    <span class="text-white font-semibold">${stats.availableProperties}</span>
                  </div>
                  <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-green-500 to-green-400" style="width: ${(stats.availableProperties / stats.totalProperties) * 100}%"></div>
                  </div>
                </div>
                <div>
                  <div class="flex justify-between text-sm mb-1">
                    <span class="text-slate-400">Sous offre</span>
                    <span class="text-white font-semibold">${state.properties.filter(p => p.status === 'Sous offre').length}</span>
                  </div>
                  <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-yellow-500 to-yellow-400" style="width: ${(state.properties.filter(p => p.status === 'Sous offre').length / stats.totalProperties) * 100}%"></div>
                  </div>
                </div>
                <div>
                  <div class="flex justify-between text-sm mb-1">
                    <span class="text-slate-400">Vendus</span>
                    <span class="text-white font-semibold">${stats.soldProperties}</span>
                  </div>
                  <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-blue-500 to-blue-400" style="width: ${(stats.soldProperties / stats.totalProperties) * 100}%"></div>
                  </div>
                </div>
              </div>
            </div>
            ` : ''}

            <div class="glass rounded-2xl p-6">
              <h3 class="text-xl font-bold text-white mb-6">Dernières activités</h3>
              <div class="space-y-4">
                ${state.visits.slice(-5).reverse().map(visit => {
                  const property = state.properties.find(p => p.id === visit.propertyId);
                  const client = state.clients.find(c => c.id === visit.clientId);
                  const statusColors = {
                    'Terminée': 'bg-green-500/20 text-green-400',
                    'Programmée': 'bg-blue-500/20 text-blue-400',
                    'Confirmée': 'bg-purple-500/20 text-purple-400'
                  };
                  return `
                    <div class="flex items-start gap-3 pb-4 border-b border-slate-700 last:border-0">
                      <div class="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center flex-shrink-0 text-purple-400">
                        ${icons.calendar}
                      </div>
                      <div class="flex-1 min-w-0">
                        <div class="text-white font-medium text-sm truncate">${property?.title}</div>
                        <div class="text-slate-400 text-xs">${client?.name}</div>
                        <div class="text-slate-500 text-xs mt-1">${visit.date} à ${visit.time}</div>
                      </div>
                      <div class="text-xs px-2 py-1 rounded-full font-semibold ${statusColors[visit.status]}">
                        ${visit.status}
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          </div>

          ${hasEnterpriseAccess() ? `
          <!-- Lead Scoring IA Widget -->
          <div class="glass rounded-2xl p-6 bg-gradient-to-r from-purple-500/10 to-blue-500/10 border-purple-500/20">
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-white text-xl animate-float">
                  🎯
                </div>
                <div>
                  <h3 class="text-xl font-bold text-white">IA Assistant</h3>
                  <p class="text-slate-400 text-sm">Prospects prioritaires à contacter</p>
                </div>
              </div>
              <button onclick="setState({currentPage: 'ai'})" class="text-purple-400 hover:text-purple-300 text-sm font-semibold flex items-center gap-1">
                Voir tout →
              </button>
            </div>

            ${renderLeadScoringWidget()}
          </div>
          ` : ''}

        </div>
      `;
    }

    function renderProperties() {
      const filteredProperties = getFilteredProperties();
      return `
        <div class="space-y-6">
          <div class="flex flex-col sm:flex-row gap-4">
            <div class="flex-1 relative">
              <div class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">${icons.search}</div>
              <input
                type="text"
                placeholder="Rechercher un bien..."
                value="${state.searchTerm}"
                oninput="setState({searchTerm: event.target.value})"
                class="w-full pl-12 pr-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-amber-400"
              />
            </div>
            <select
              value="${state.filterType}"
              onchange="setState({filterType: event.target.value})"
              class="px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
            >
              <option value="all">Tous les types</option>
              <option value="Appartement">Appartement</option>
              <option value="Maison">Maison</option>
              <option value="Villa">Villa</option>
              <option value="Loft">Loft</option>
            </select>
            <select
              value="${state.filterStatus}"
              onchange="setState({filterStatus: event.target.value})"
              class="px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
            >
              <option value="all">Tous les statuts</option>
              <option value="Disponible">Disponible</option>
              <option value="Sous offre">Sous offre</option>
              <option value="Vendu">Vendu</option>
            </select>
            <button
              onclick="setState({showAddProperty: true})"
              class="btn-primary px-6 py-3 rounded-xl text-white font-semibold flex items-center gap-2 whitespace-nowrap"
            >
              ${icons.plus}
              Ajouter un bien
            </button>
          </div>

          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${filteredProperties.map(property => {
              const statusColors = {
                'Disponible': 'bg-green-500/20 text-green-400',
                'Sous offre': 'bg-yellow-500/20 text-yellow-400',
                'Vendu': 'bg-blue-500/20 text-blue-400'
              };
              return `
                <div class="glass rounded-2xl overflow-hidden hover:shadow-2xl transition-all group">
                  <div class="bg-gradient-to-br from-slate-700 to-slate-800 p-8 flex items-center justify-center text-6xl">
                    ${property.image}
                  </div>
                  <div class="p-6">
                    <div class="flex justify-between items-start mb-3">
                      <div>
                        <h3 class="text-lg font-bold text-white mb-1">${property.title}</h3>
                        <div class="flex items-center gap-2 text-slate-400 text-sm">
                          ${icons.mapPin}
                          ${property.location}
                        </div>
                      </div>
                      <div class="px-2 py-1 rounded-lg text-xs font-semibold ${statusColors[property.status]}">
                        ${property.status}
                      </div>
                    </div>
                    
                    <div class="flex items-center gap-2 text-amber-400 font-bold text-2xl mb-4">
                      ${property.price.toLocaleString()} <span class="text-2xl">€</span>
                    </div>

                    <div class="grid grid-cols-3 gap-3 mb-4 pb-4 border-b border-slate-700">
                      <div class="text-center">
                        <div class="flex items-center justify-center gap-1 text-slate-400 mb-1">
                          ${icons.maximize}
                        </div>
                        <div class="text-white font-semibold">${property.surface}m²</div>
                      </div>
                      <div class="text-center">
                        <div class="flex items-center justify-center gap-1 text-slate-400 mb-1">
                          ${icons.bed}
                        </div>
                        <div class="text-white font-semibold">${property.rooms} pcs</div>
                      </div>
                      <div class="text-center">
                        <div class="flex items-center justify-center gap-1 text-slate-400 mb-1">
                          ${icons.bed}
                        </div>
                        <div class="text-white font-semibold">${property.bathrooms}</div>
                      </div>
                    </div>

                    <div class="flex items-center justify-between text-sm text-slate-400 mb-4">
                      <div class="flex items-center gap-2">
                        ${icons.user}
                        ${property.agent}
                      </div>
                      <div class="flex items-center gap-2">
                        ${icons.eye}
                        ${property.visits} vues
                      </div>
                    </div>

                    <div class="flex gap-2">
                      <button class="flex-1 bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg transition-all flex items-center justify-center gap-2">
                        ${icons.eye}
                        Voir
                      </button>
                      <button class="flex-1 bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg transition-all flex items-center justify-center gap-2">
                        ${icons.edit}
                        Modifier
                      </button>
                    </div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;
    }

    function renderClients() {
      const filteredClients = getFilteredClients();
      
      // Trier les clients par score IA (du plus élevé au plus bas)
      const sortedClients = [...filteredClients].sort((a, b) => (b.aiScore || 0) - (a.aiScore || 0));
      
      return `
        <div class="space-y-6">
          ${hasEnterpriseAccess() ? `
          <!-- AI Scoring Header -->
          <div class="glass rounded-2xl p-6 bg-gradient-to-r from-purple-500/10 to-blue-500/10 border-purple-500/20">
            <div class="flex items-center gap-4 mb-4">
              <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-white text-2xl">
                🤖
              </div>
              <div>
                <h3 class="text-xl font-bold text-white mb-1">Analyse IA des Clients</h3>
                <p class="text-slate-300 text-sm">Score intelligent basé sur l'engagement et le comportement</p>
              </div>
            </div>
            
            <div class="grid md:grid-cols-4 gap-4">
              <div class="bg-slate-800/50 rounded-xl p-4">
                <div class="text-green-400 font-bold mb-1">🔥 Chauds (85-100)</div>
                <div class="text-slate-400 text-sm">Très réactifs, forte probabilité d'achat</div>
              </div>
              <div class="bg-slate-800/50 rounded-xl p-4">
                <div class="text-amber-400 font-bold mb-1">🌡️ Tièdes (70-84)</div>
                <div class="text-slate-400 text-sm">Intéressés, à suivre activement</div>
              </div>
              <div class="bg-slate-800/50 rounded-xl p-4">
                <div class="text-blue-400 font-bold mb-1">❄️ Froids (50-69)</div>
                <div class="text-slate-400 text-sm">Peu réactifs, relance nécessaire</div>
              </div>
              <div class="bg-slate-800/50 rounded-xl p-4">
                <div class="text-slate-400 font-bold mb-1">💤 Inactifs (<50)</div>
                <div class="text-slate-400 text-sm">Très peu engagés, faible priorité</div>
              </div>
            </div>

            <div class="mt-4 bg-blue-500/10 border border-blue-500/30 rounded-lg p-3">
              <p class="text-blue-400 text-sm">
                💡 <strong>Le score IA analyse :</strong> Fréquence des visites • Taux de réponse • Clics sur emails/biens • Temps de réponse moyen
              </p>
            </div>
          </div>
          ` : ''}

          <div class="flex flex-col sm:flex-row gap-4">
            <div class="flex-1 relative">
              <div class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">${icons.search}</div>
              <input
                type="text"
                placeholder="Rechercher un client..."
                value="${state.searchTerm}"
                oninput="setState({searchTerm: event.target.value})"
                class="w-full pl-12 pr-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-amber-400"
              />
            </div>
            <button
              onclick="setState({showAddClient: true})"
              class="btn-primary px-6 py-3 rounded-xl text-white font-semibold flex items-center gap-2 whitespace-nowrap"
            >
              ${icons.plus}
              Ajouter un client
            </button>
          </div>

          <div class="glass rounded-2xl overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-slate-800">
                  <tr>
                    <th class="text-left px-6 py-4 text-slate-400 font-semibold text-sm">Nom</th>
                    ${hasEnterpriseAccess() ? '<th class="text-left px-6 py-4 text-slate-400 font-semibold text-sm">Score IA</th>' : ''}
                    <th class="text-left px-6 py-4 text-slate-400 font-semibold text-sm">Contact</th>
                    <th class="text-left px-6 py-4 text-slate-400 font-semibold text-sm">Type</th>
                    <th class="text-left px-6 py-4 text-slate-400 font-semibold text-sm">Budget</th>
                    <th class="text-left px-6 py-4 text-slate-400 font-semibold text-sm">Statut</th>
                    <th class="text-left px-6 py-4 text-slate-400 font-semibold text-sm">Agent</th>
                    <th class="text-left px-6 py-4 text-slate-400 font-semibold text-sm">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  ${sortedClients.map(client => {
                    const typeColors = {
                      'Acheteur': 'bg-green-500/20 text-green-400',
                      'Vendeur': 'bg-blue-500/20 text-blue-400'
                    };
                    const statusColors = {
                      'Actif': 'bg-green-500/20 text-green-400',
                      'Converti': 'bg-blue-500/20 text-blue-400',
                      'En attente': 'bg-yellow-500/20 text-yellow-400'
                    };
                    
                    // Déterminer la couleur du score IA
                    const getScoreColor = (score) => {
                      if (score >= 85) return { bg: 'bg-gradient-to-br from-green-500 to-green-600', text: 'text-white', border: 'border-green-400' };
                      if (score >= 70) return { bg: 'bg-gradient-to-br from-amber-500 to-orange-500', text: 'text-white', border: 'border-amber-400' };
                      if (score >= 50) return { bg: 'bg-gradient-to-br from-blue-500 to-blue-600', text: 'text-white', border: 'border-blue-400' };
                      return { bg: 'bg-gradient-to-br from-slate-600 to-slate-700', text: 'text-slate-300', border: 'border-slate-500' };
                    };
                    
                    const scoreColors = getScoreColor(client.aiScore || 0);
                    
                    return `
                      <tr class="border-t border-slate-700 hover:bg-slate-800/50 transition-colors">
                        <td class="px-6 py-4">
                          <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-amber-400 to-amber-500 flex items-center justify-center text-white font-bold">
                              ${client.name.charAt(0)}
                            </div>
                            <div class="text-white font-semibold">${client.name}</div>
                          </div>
                        </td>
                        ${hasEnterpriseAccess() ? `
                        <td class="px-6 py-4">
                          <div class="flex flex-col gap-2">
                            <div class="relative">
                              <div class="${scoreColors.bg} ${scoreColors.text} px-4 py-2 rounded-lg font-bold text-center shadow-lg border-2 ${scoreColors.border}">
                                <div class="text-2xl">${client.aiScore || 0}</div>
                                <div class="text-xs opacity-90">Score IA</div>
                              </div>
                            </div>
                            ${client.aiScore ? `
                              <div class="text-xs text-slate-400 space-y-0.5">
                                <div class="flex justify-between">
                                  <span>📅 Visites:</span>
                                  <span class="text-white font-semibold">${client.visitFrequency}</span>
                                </div>
                                <div class="flex justify-between">
                                  <span>✅ Réponses:</span>
                                  <span class="text-white font-semibold">${client.responseRate}%</span>
                                </div>
                                <div class="flex justify-between">
                                  <span>👆 Clics:</span>
                                  <span class="text-white font-semibold">${client.clicks}</span>
                                </div>
                                <div class="flex justify-between">
                                  <span>⏱️ Délai:</span>
                                  <span class="text-white font-semibold">${client.avgResponseTime}h</span>
                                </div>
                              </div>
                            ` : ''}
                          </div>
                        </td>
                        ` : ''}
                        <td class="px-6 py-4">
                          <div class="space-y-1">
                            <div class="flex items-center gap-2 text-slate-300 text-sm">
                              ${icons.mail}
                              ${client.email}
                            </div>
                            <div class="flex items-center gap-2 text-slate-300 text-sm">
                              ${icons.phone}
                              ${client.phone}
                            </div>
                          </div>
                        </td>
                        <td class="px-6 py-4">
                          <span class="px-3 py-1 rounded-full text-xs font-semibold ${typeColors[client.type]}">
                            ${client.type}
                          </span>
                        </td>
                        <td class="px-6 py-4 text-white font-medium">${client.budget}</td>
                        <td class="px-6 py-4">
                          <span class="px-3 py-1 rounded-full text-xs font-semibold ${statusColors[client.status]}">
                            ${client.status}
                          </span>
                        </td>
                        <td class="px-6 py-4 text-slate-300 text-sm">${client.agent}</td>
                        <td class="px-6 py-4">
                          <div class="flex gap-2">
                            <button class="p-2 hover:bg-slate-700 rounded-lg transition-colors text-slate-400 hover:text-white">
                              ${icons.eye}
                            </button>
                            <button class="p-2 hover:bg-slate-700 rounded-lg transition-colors text-slate-400 hover:text-white">
                              ${icons.edit}
                            </button>
                          </div>
                        </td>
                      </tr>
                    `;
                  }).join('')}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      `;
    }


    function renderMarketAnalysis() {
      return `
        <div class="space-y-6">
          <!-- Market Analysis Header -->
          <div class="glass rounded-2xl p-6 bg-gradient-to-r from-blue-500/10 to-green-500/10 border-blue-500/20">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-4">
                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-green-500 flex items-center justify-center text-white">
                  ${icons.trendingUp}
                </div>
                <div>
                  <h2 class="text-2xl font-bold text-white mb-1">Analyse du Marché Immobilier</h2>
                  <p class="text-slate-300">
                    ${state.lastAIUpdate ? 
                      `Dernière analyse IA : ${state.lastAIUpdate}` : 
                      'Analyse automatique par intelligence artificielle'}
                  </p>
                </div>
              </div>
              <button 
                onclick="analyzeMarketWithAI()"
                ${state.aiAnalysisLoading ? 'disabled' : ''}
                class='btn-primary px-6 py-3 rounded-xl text-white font-semibold flex items-center gap-2 ${state.aiAnalysisLoading ? "opacity-50 cursor-not-allowed" : ""}'
              >
                ${state.aiAnalysisLoading ? `
                  <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  <span>Analyse en cours...</span>
                ` : `
                  ${icons.sparkles}
                  <span>Actualiser l\'analyse</span>
                `}
              </button>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
              <div class="bg-slate-800/50 rounded-xl p-3 text-center">
                <div class="text-2xl font-bold text-blue-400">${state.aiSuggestions.marketAnalysis.zones?.length || 5}</div>
                <div class="text-slate-400 text-xs">Zones analysées</div>
              </div>
              <div class="bg-slate-800/50 rounded-xl p-3 text-center">
                <div class="text-2xl font-bold text-purple-400">${state.aiSuggestions.marketAnalysis.emergingNeighborhoods?.length || 3}</div>
                <div class="text-slate-400 text-xs">Quartiers émergents</div>
              </div>
              <div class="bg-slate-800/50 rounded-xl p-3 text-center">
                <div class="text-2xl font-bold text-green-400">${state.aiSuggestions.marketAnalysis.propertyTypes?.length || 4}</div>
                <div class="text-slate-400 text-xs">Types de biens</div>
              </div>
            </div>
          </div>

          ${state.aiAnalysisLoading ? `
            <div class="glass rounded-2xl p-12 text-center">
              <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-br from-blue-500 to-green-500 flex items-center justify-center">
                <svg class="animate-spin h-12 w-12 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </div>
              <h3 class="text-2xl font-bold text-white mb-3">🤖 Analyse en cours...</h3>
              <p class="text-slate-400 text-lg mb-6">L'intelligence artificielle Claude analyse vos données immobilières en temps réel</p>
              <div class="inline-flex items-center gap-2 bg-blue-500/20 border border-blue-500/30 rounded-full px-6 py-2">
                <div class="w-2 h-2 rounded-full bg-blue-400 animate-pulse"></div>
                <span class="text-blue-400 text-sm font-semibold">Traitement en cours</span>
              </div>
            </div>
          ` : `
            <!-- Tendance globale -->
            <div class="bg-gradient-to-r from-blue-500/10 to-green-500/10 border border-blue-500/20 rounded-xl p-5 mb-6">
              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                  <div class='w-12 h-12 rounded-xl ${state.aiSuggestions.marketAnalysis.globalTrend.direction === "hausse" ? "bg-green-500/20" : "bg-red-500/20"} flex items-center justify-center'>
                    ${state.aiSuggestions.marketAnalysis.globalTrend.direction === 'hausse' ? 
                      '<div class="text-green-400">' + icons.trendUp + '</div>' : 
                      '<div class="text-red-400">' + icons.trendDown + '</div>'}
                  </div>
                  <div>
                    <h4 class="text-white font-bold text-lg">Tendance du marché</h4>
                    <p class="text-slate-400 text-sm">${state.aiSuggestions.marketAnalysis.globalTrend.period}</p>
                  </div>
                </div>
                <div class="text-right">
                  <div class='text-3xl font-bold ${state.aiSuggestions.marketAnalysis.globalTrend.direction === "hausse" ? "text-green-400" : "text-red-400"}'>
                    ${state.aiSuggestions.marketAnalysis.globalTrend.direction === 'hausse' ? '+' : ''}${state.aiSuggestions.marketAnalysis.globalTrend.percentage}%
                  </div>
                  <div class="text-slate-400 text-sm capitalize">${state.aiSuggestions.marketAnalysis.globalTrend.direction}</div>
                </div>
              </div>
              <div class="bg-slate-900/50 rounded-lg p-4 border border-slate-700">
                <div class="flex items-start gap-2">
                  <div class="text-blue-400 mt-1">${icons.sparkles}</div>
                  <div class="flex-1">
                    <div class="text-white font-semibold mb-1">Prévision IA</div>
                    <div class="text-slate-300 text-sm">
                      Le marché devrait connaître une <span class='font-bold ${state.aiSuggestions.marketAnalysis.globalTrend.prediction === "hausse" ? "text-green-400" : "text-red-400"}'>${state.aiSuggestions.marketAnalysis.globalTrend.prediction}</span> 
                      de <span class="font-bold text-white">${state.aiSuggestions.marketAnalysis.globalTrend.predictionPercentage}%</span> 
                      sur les ${state.aiSuggestions.marketAnalysis.globalTrend.nextPeriod}.
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Zones à fort potentiel -->
            <div class="glass rounded-2xl p-6 mb-6">
              <div class="flex items-center gap-2 mb-4">
                <div class="text-amber-400">${icons.map}</div>
                <h4 class="text-lg font-bold text-white">Zones à fort potentiel</h4>
              </div>
              <div class="space-y-3">
                ${state.aiSuggestions.marketAnalysis.zones.map(zone => {
                  const trendColors = {
                    'hausse': 'border-green-500/50 bg-green-500/5',
                    'stable': 'border-yellow-500/50 bg-yellow-500/5',
                    'baisse': 'border-red-500/50 bg-red-500/5'
                  };
                  const trendBadge = {
                    'hausse': 'bg-green-500/20 text-green-400',
                    'stable': 'bg-yellow-500/20 text-yellow-400',
                    'baisse': 'bg-red-500/20 text-red-400'
                  };
                  const potentialColors = {
                    'Très élevé': 'bg-green-500/20 text-green-400',
                    'Élevé': 'bg-blue-500/20 text-blue-400',
                    'Moyen': 'bg-yellow-500/20 text-yellow-400',
                    'Faible': 'bg-slate-500/20 text-slate-400'
                  };
                  return `
                    <div class="border-2 ${trendColors[zone.trend]} rounded-xl p-4 hover:bg-slate-800/30 transition-all">
                      <div class="flex items-start justify-between mb-3">
                        <div class="flex-1">
                          <div class="flex items-center gap-3 mb-2">
                            <h5 class="text-white font-bold text-lg">${zone.name}</h5>
                            <span class="px-3 py-1 rounded-full text-xs font-bold ${trendBadge[zone.trend]} capitalize">
                              ${zone.trend === 'hausse' ? '+' : zone.trend === 'baisse' ? '' : ''}${zone.percentage}%
                            </span>
                            <span class="px-3 py-1 rounded-full text-xs font-bold ${potentialColors[zone.potential]}">
                              ${zone.potential}
                            </span>
                          </div>
                          <p class="text-slate-300 text-sm mb-3">${zone.reason}</p>
                          <div class="flex items-center gap-4 text-sm">
                            <div class="text-slate-400">
                              Prix moyen : <span class="text-white font-semibold">${zone.avgPrice} €/m²</span>
                            </div>
                            <div class="flex items-center gap-2">
                              <div class="text-amber-400">${icons.target}</div>
                              <div class="text-slate-400">
                                Score investissement : <span class="text-white font-semibold">${zone.investment}/100</span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-amber-500 to-amber-400" style="width: ${zone.investment}%"></div>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>

            <!-- Quartiers émergents -->
            <div class="glass rounded-2xl p-6 mb-6">
              <div class="flex items-center gap-2 mb-4">
                <div class="text-purple-400">${icons.award}</div>
                <h4 class="text-lg font-bold text-white">Quartiers émergents</h4>
              </div>
              <div class="grid lg:grid-cols-3 gap-4">
                ${state.aiSuggestions.marketAnalysis.emergingNeighborhoods.map((hood, idx) => {
                  const statusColors = {
                    'Émergent': 'from-green-500 to-emerald-500',
                    'En développement': 'from-blue-500 to-cyan-500',
                    'À surveiller': 'from-purple-500 to-pink-500'
                  };
                  return `
                    <div class="bg-slate-800/50 rounded-xl p-5 border border-slate-700 hover:border-purple-500/50 transition-all">
                      <div class="flex items-center justify-between mb-3">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br ${statusColors[hood.status]} flex items-center justify-center text-white font-bold text-lg">
                          ${idx + 1}
                        </div>
                        <div class="text-right">
                          <div class="text-2xl font-bold text-purple-400">${hood.score}</div>
                          <div class="text-slate-400 text-xs">Score</div>
                        </div>
                      </div>
                      
                      <h5 class="text-white font-bold mb-2">${hood.name}</h5>
                      <div class="inline-block px-2 py-1 rounded-full text-xs font-semibold mb-3" style="background: linear-gradient(to right, var(--tw-gradient-stops)); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; --tw-gradient-from: rgb(34 197 94); --tw-gradient-to: rgb(16 185 129); --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to);">
                        ${hood.status}
                      </div>
                      
                      <div class="space-y-2 mb-4">
                        <div class="flex justify-between text-sm">
                          <span class="text-slate-400">Croissance</span>
                          <span class="text-green-400 font-bold">+${hood.growth}%</span>
                        </div>
                        <div class="flex justify-between text-sm">
                          <span class="text-slate-400">Prix moyen</span>
                          <span class="text-white font-semibold">${hood.avgPrice} €/m²</span>
                        </div>
                        <div class="flex justify-between text-sm">
                          <span class="text-slate-400">Horizon</span>
                          <span class="text-slate-300">${hood.timeframe}</span>
                        </div>
                      </div>

                      <div class="bg-slate-900/50 rounded-lg p-3 mb-3 border border-slate-700">
                        <div class="text-slate-400 text-xs mb-2">Facteurs clés :</div>
                        <ul class="space-y-1">
                          ${hood.reasons.map(reason => `
                            <li class="text-slate-300 text-xs flex items-start gap-2">
                              <span class="text-purple-400 mt-0.5">•</span>
                              <span>${reason}</span>
                            </li>
                          `).join('')}
                        </ul>
                      </div>

                      <div class="bg-gradient-to-r from-purple-500/10 to-blue-500/10 border border-purple-500/20 rounded-lg p-2 text-center">
                        <div class="text-purple-400 text-xs font-semibold">${hood.recommendation}</div>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>

            <!-- Tendances par type de bien -->
            <div class="glass rounded-2xl p-6">
              <div class="flex items-center gap-2 mb-4">
                <div class="text-blue-400">${icons.barChart}</div>
                <h4 class="text-lg font-bold text-white">Tendances par type de bien</h4>
              </div>
              <div class="grid md:grid-cols-2 gap-4">
                ${state.aiSuggestions.marketAnalysis.propertyTypes.map(type => {
                  const trendColors = {
                    'hausse': 'bg-green-500/20 text-green-400',
                    'stable': 'bg-yellow-500/20 text-yellow-400',
                    'baisse': 'bg-red-500/20 text-red-400'
                  };
                  const demandColors = {
                    'Très forte': 'text-green-400',
                    'Forte': 'text-blue-400',
                    'Croissante': 'text-purple-400',
                    'Moyenne': 'text-yellow-400',
                    'Faible': 'text-slate-400'
                  };
                  return `
                    <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700 hover:border-blue-500/50 transition-all">
                      <div class="flex items-center justify-between mb-3">
                        <h5 class="text-white font-bold">${type.type}</h5>
                        <span class="px-3 py-1 rounded-full text-xs font-bold ${trendColors[type.trend]} capitalize">
                          ${type.trend === 'hausse' ? '+' : ''}${type.percentage}%
                        </span>
                      </div>
                      <div class="grid grid-cols-2 gap-3 mb-3">
                        <div>
                          <div class="text-slate-400 text-xs mb-1">Demande</div>
                          <div class="font-semibold ${demandColors[type.demand]}">${type.demand}</div>
                        </div>
                        <div>
                          <div class="text-slate-400 text-xs mb-1">Offre</div>
                          <div class="text-white font-semibold">${type.supply}</div>
                        </div>
                      </div>
                      <div class="bg-blue-500/10 border border-blue-500/20 rounded-lg p-2 text-center">
                        <div class="text-blue-400 text-xs font-semibold">${type.recommendation}</div>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          `}
        </div>
      `;
    }

    function renderAI() {
      // Vérifier si l'utilisateur a l'abonnement Enterprise
      if (!hasEnterpriseAccess()) {
        return `
          <div class="flex items-center justify-center min-h-[60vh]">
            <div class="glass rounded-2xl p-8 max-w-2xl text-center border-2 border-purple-500/30">
              <div class="w-20 h-20 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center">
                ${icons.brain}
              </div>
              <h3 class="text-3xl font-bold text-white mb-4">IA Assistant</h3>
              <p class="text-slate-300 text-lg mb-6">
                Cette fonctionnalité est réservée aux abonnés <strong class="text-purple-400">Entreprise</strong>.
              </p>
              <div class="bg-slate-800/50 rounded-xl p-6 mb-6">
                <h4 class="text-white font-bold mb-3">Avec l'IA Assistant, bénéficiez de :</h4>
                <ul class="text-slate-300 space-y-2 text-left">
                  <li>✅ Score prédictif de conversion</li>
                  <li>✅ Priorisation automatique des prospects</li>
                  <li>✅ Recommandations d'actions personnalisées</li>
                  <li>✅ Analyse comportementale avancée</li>
                  <li>✅ Alertes prospects chauds en temps réel</li>
                </ul>
              </div>
              <button onclick="setState({currentPage: 'subscription'})" class="btn-primary px-8 py-4 rounded-xl font-bold text-lg">
                ⬆️ Passer à Entreprise
              </button>
            </div>
          </div>
        `;
      }
      
      // Calculer les statistiques de lead scoring
      const hotLeads = state.clients.filter(c => c.aiScore >= 85);
      const warmLeads = state.clients.filter(c => c.aiScore >= 70 && c.aiScore < 85);
      const coldLeads = state.clients.filter(c => c.aiScore >= 50 && c.aiScore < 70);
      const inactiveLeads = state.clients.filter(c => c.aiScore < 50);
      
      const avgScore = state.clients.reduce((acc, c) => acc + (c.aiScore || 0), 0) / state.clients.length;
      const topLeads = [...state.clients].sort((a, b) => (b.aiScore || 0) - (a.aiScore || 0)).slice(0, 5);
      
      // Helper pour obtenir les classes de couleur complètes
      const getScoreColorClasses = (score) => {
        if (score >= 85) {
          return {
            border: 'border-green-500',
            bgGradient: 'bg-gradient-to-br from-green-400 to-green-500',
            text: 'text-green-400'
          };
        } else if (score >= 70) {
          return {
            border: 'border-amber-500',
            bgGradient: 'bg-gradient-to-br from-amber-400 to-amber-500',
            text: 'text-amber-400'
          };
        } else if (score >= 50) {
          return {
            border: 'border-blue-500',
            bgGradient: 'bg-gradient-to-br from-blue-400 to-blue-500',
            text: 'text-blue-400'
          };
        } else {
          return {
            border: 'border-slate-500',
            bgGradient: 'bg-gradient-to-br from-slate-400 to-slate-500',
            text: 'text-slate-400'
          };
        }
      };
      
      // Recommandations d'actions basées sur le scoring
      const getActionRecommendations = (client) => {
        if (client.aiScore >= 85) {
          return [
            { icon: '📞', action: 'Appel prioritaire', urgency: 'high', description: 'Contactez ce prospect dans les 2h' },
            { icon: '🏠', action: 'Proposer visite', urgency: 'high', description: 'Forte probabilité de conversion' },
            { icon: '💰', action: 'Offre personnalisée', urgency: 'medium', description: 'Préparer une proposition commerciale' }
          ];
        } else if (client.aiScore >= 70) {
          return [
            { icon: '📧', action: 'Email de suivi', urgency: 'medium', description: 'Envoyer une sélection de biens' },
            { icon: '📅', action: 'Planifier visite', urgency: 'medium', description: 'Proposer plusieurs créneaux' },
            { icon: '📊', action: 'Partager analyses', urgency: 'low', description: 'Rapport de marché personnalisé' }
          ];
        } else if (client.aiScore >= 50) {
          return [
            { icon: '🔔', action: 'Relance douce', urgency: 'low', description: 'Email automatisé personnalisé' },
            { icon: '📱', action: 'SMS informatif', urgency: 'low', description: 'Nouveaux biens disponibles' },
            { icon: '👀', action: 'Nurturing', urgency: 'low', description: 'Ajouter au parcours automatique' }
          ];
        } else {
          return [
            { icon: '💤', action: 'Archiver', urgency: 'none', description: 'Prospect inactif - vérifier données' },
            { icon: '🔄', action: 'Réengagement', urgency: 'low', description: 'Campagne de réactivation' }
          ];
        }
      };
      
      return `
        <div class="space-y-6">
          <!-- Lead Scoring Header -->
          <div class="glass rounded-2xl p-6 bg-gradient-to-r from-purple-500/10 to-blue-500/10 border-purple-500/20">
            <div class="flex items-center gap-4 mb-6">
              <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-white text-2xl animate-float">
                🎯
              </div>
              <div>
                <h2 class="text-2xl font-bold text-white mb-1">IA Assistant & Priorisation</h2>
                <p class="text-slate-300">Analyse prédictive et recommandations commerciales intelligentes</p>
              </div>
            </div>
            
            <!-- KPIs -->
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
              <div class="bg-gradient-to-br from-green-500/20 to-green-600/20 border border-green-500/30 rounded-xl p-4 text-center animate-scaleIn">
                <div class="text-3xl font-bold text-green-400 mb-1">${hotLeads.length}</div>
                <div class="text-slate-300 text-sm">🔥 Prospects Chauds</div>
                <div class="text-green-400 text-xs mt-1">Score ≥ 85</div>
              </div>
              <div class="bg-gradient-to-br from-amber-500/20 to-orange-500/20 border border-amber-500/30 rounded-xl p-4 text-center animate-scaleIn" style="animation-delay: 0.1s">
                <div class="text-3xl font-bold text-amber-400 mb-1">${warmLeads.length}</div>
                <div class="text-slate-300 text-sm">🌡️ Prospects Tièdes</div>
                <div class="text-amber-400 text-xs mt-1">Score 70-84</div>
              </div>
              <div class="bg-gradient-to-br from-blue-500/20 to-blue-600/20 border border-blue-500/30 rounded-xl p-4 text-center animate-scaleIn" style="animation-delay: 0.2s">
                <div class="text-3xl font-bold text-blue-400 mb-1">${coldLeads.length}</div>
                <div class="text-slate-300 text-sm">❄️ Prospects Froids</div>
                <div class="text-blue-400 text-xs mt-1">Score 50-69</div>
              </div>
              <div class="bg-gradient-to-br from-slate-500/20 to-slate-600/20 border border-slate-500/30 rounded-xl p-4 text-center animate-scaleIn" style="animation-delay: 0.3s">
                <div class="text-3xl font-bold text-slate-400 mb-1">${inactiveLeads.length}</div>
                <div class="text-slate-300 text-sm">💤 Inactifs</div>
                <div class="text-slate-400 text-xs mt-1">Score < 50</div>
              </div>
              <div class="bg-gradient-to-br from-purple-500/20 to-purple-600/20 border border-purple-500/30 rounded-xl p-4 text-center animate-scaleIn" style="animation-delay: 0.4s">
                <div class="text-3xl font-bold text-purple-400 mb-1">${Math.round(avgScore)}</div>
                <div class="text-slate-300 text-sm">📊 Score Moyen</div>
                <div class="text-purple-400 text-xs mt-1">Global</div>
              </div>
            </div>
          </div>

          <!-- Top 5 Prospects à Contacter -->
          <div class="glass rounded-2xl p-6">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-xl font-bold text-white flex items-center gap-2">
                <span class="text-2xl">🎯</span>
                Top 5 - Prospects Prioritaires
              </h3>
              <span class="px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm font-semibold animate-pulse">
                ⚡ Action Requise
              </span>
            </div>

            <div class="space-y-3">
              ${topLeads.map((client, index) => {
                const recommendations = getActionRecommendations(client);
                const colorClasses = getScoreColorClasses(client.aiScore || 0);
                
                return `
                  <div class="bg-slate-800/50 rounded-xl p-5 hover:bg-slate-800 transition-all border-l-4 ${colorClasses.border} animate-slideInRight" style="animation-delay: ${index * 0.1}s; opacity: 0">
                    <div class="flex items-start gap-4">
                      <!-- Avatar & Score -->
                      <div class="flex-shrink-0">
                        <div class="w-16 h-16 rounded-full ${colorClasses.bgGradient} flex items-center justify-center text-white font-bold text-xl shadow-lg">
                          ${client.name.charAt(0)}
                        </div>
                        <div class="mt-2 text-center">
                          <div class="text-2xl font-bold ${colorClasses.text}">${client.aiScore}</div>
                          <div class="text-xs text-slate-400">Score</div>
                        </div>
                      </div>

                      <!-- Client Info -->
                      <div class="flex-1">
                        <div class="flex items-center justify-between mb-2">
                          <div>
                            <h4 class="text-lg font-bold text-white">${client.name}</h4>
                            <p class="text-slate-400 text-sm">${client.email} • ${client.phone}</p>
                          </div>
                          <div class="text-right">
                            <div class="text-white font-semibold">${client.budget}</div>
                            <div class="text-slate-400 text-xs">${client.type}</div>
                          </div>
                        </div>

                        <!-- Métriques -->
                        <div class="grid grid-cols-4 gap-3 mb-3 p-3 bg-slate-900/50 rounded-lg">
                          <div class="text-center">
                            <div class="text-sm font-bold ${colorClasses.text}">${client.visitFrequency}</div>
                            <div class="text-xs text-slate-400">Visites</div>
                          </div>
                          <div class="text-center">
                            <div class="text-sm font-bold ${colorClasses.text}">${client.responseRate}%</div>
                            <div class="text-xs text-slate-400">Réponses</div>
                          </div>
                          <div class="text-center">
                            <div class="text-sm font-bold ${colorClasses.text}">${client.clicks}</div>
                            <div class="text-xs text-slate-400">Clics</div>
                          </div>
                          <div class="text-center">
                            <div class="text-sm font-bold ${colorClasses.text}">${client.avgResponseTime}h</div>
                            <div class="text-xs text-slate-400">Délai</div>
                          </div>
                        </div>

                        <!-- Actions Recommandées -->
                        <div class="space-y-2">
                          <div class="text-xs font-semibold text-slate-400 uppercase tracking-wide">Actions Recommandées IA :</div>
                          <div class="flex flex-wrap gap-2">
                            ${recommendations.map((rec, recIndex) => {
                              const urgencyColors = {
                                high: 'bg-red-500/20 text-red-400 border-red-500/40',
                                medium: 'bg-amber-500/20 text-amber-400 border-amber-500/40',
                                low: 'bg-blue-500/20 text-blue-400 border-blue-500/40',
                                none: 'bg-slate-500/20 text-slate-400 border-slate-500/40'
                              };
                              
                              const actionKey = 'action_' + client.id + '_' + recIndex;
                              const isCompleted = client.completedActions?.includes(actionKey) || false;
                              
                              return `
                                <div class="relative group">
                                  <button 
                                    onclick="toggleActionCompletion(${client.id}, '${actionKey}', '${rec.action.replace(/'/g, "\'")}' )"
                                    class='px-3 py-2 rounded-lg border ${urgencyColors[rec.urgency]} hover:scale-105 transition-all flex items-center gap-2 text-sm font-semibold ${isCompleted ? "opacity-50 line-through" : ""}'
                                  >
                                    <span class="text-lg">${isCompleted ? '✅' : rec.icon}</span>
                                    <span>${rec.action}</span>
                                  </button>
                                  <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 bg-slate-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none z-10">
                                    ${isCompleted ? 'Action complétée ✓' : rec.description}
                                  </div>
                                </div>
                              `;
                            }).join('')}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>

          <!-- Analyse & Insights -->
          <div class="grid md:grid-cols-2 gap-6">
            <!-- Distribution des Scores -->
            <div class="glass rounded-2xl p-6">
              <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                📊 Distribution des Scores
              </h3>
              <div class="space-y-3">
                <div>
                  <div class="flex justify-between text-sm mb-2">
                    <span class="text-green-400 font-semibold">🔥 Chauds (85-100)</span>
                    <span class="text-white font-bold">${hotLeads.length} clients</span>
                  </div>
                  <div class="w-full bg-slate-700 rounded-full h-3">
                    <div class="bg-gradient-to-r from-green-500 to-green-600 h-3 rounded-full transition-all" style="width: ${(hotLeads.length / state.clients.length * 100)}%"></div>
                  </div>
                </div>
                <div>
                  <div class="flex justify-between text-sm mb-2">
                    <span class="text-amber-400 font-semibold">🌡️ Tièdes (70-84)</span>
                    <span class="text-white font-bold">${warmLeads.length} clients</span>
                  </div>
                  <div class="w-full bg-slate-700 rounded-full h-3">
                    <div class="bg-gradient-to-r from-amber-500 to-orange-500 h-3 rounded-full transition-all" style="width: ${(warmLeads.length / state.clients.length * 100)}%"></div>
                  </div>
                </div>
                <div>
                  <div class="flex justify-between text-sm mb-2">
                    <span class="text-blue-400 font-semibold">❄️ Froids (50-69)</span>
                    <span class="text-white font-bold">${coldLeads.length} clients</span>
                  </div>
                  <div class="w-full bg-slate-700 rounded-full h-3">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full transition-all" style="width: ${(coldLeads.length / state.clients.length * 100)}%"></div>
                  </div>
                </div>
                <div>
                  <div class="flex justify-between text-sm mb-2">
                    <span class="text-slate-400 font-semibold">💤 Inactifs (<50)</span>
                    <span class="text-white font-bold">${inactiveLeads.length} clients</span>
                  </div>
                  <div class="w-full bg-slate-700 rounded-full h-3">
                    <div class="bg-gradient-to-r from-slate-500 to-slate-600 h-3 rounded-full transition-all" style="width: ${(inactiveLeads.length / state.clients.length * 100)}%"></div>
                  </div>
                </div>
              </div>
            </div>

          <!-- Info IA -->
          <div class="bg-purple-500/10 border border-purple-500/30 rounded-xl p-5">
            <div class="flex items-start gap-3">
              <span class="text-3xl">🤖</span>
              <div class="flex-1">
                <h4 class="text-white font-bold mb-2">Comment fonctionne le Lead Scoring IA ?</h4>
                <p class="text-slate-300 text-sm mb-3">
                  Notre algorithme d'intelligence artificielle analyse en temps réel <strong>4 critères clés</strong> 
                  pour prédire la probabilité de conversion de chaque prospect :
                </p>
                <div class="grid md:grid-cols-4 gap-3">
                  <div class="bg-slate-800/50 rounded-lg p-3">
                    <div class="text-purple-400 font-bold text-sm mb-1">📅 Engagement</div>
                    <div class="text-slate-400 text-xs">Fréquence des visites et interactions</div>
                  </div>
                  <div class="bg-slate-800/50 rounded-lg p-3">
                    <div class="text-purple-400 font-bold text-sm mb-1">⚡ Réactivité</div>
                    <div class="text-slate-400 text-xs">Taux de réponse et délai moyen</div>
                  </div>
                  <div class="bg-slate-800/50 rounded-lg p-3">
                    <div class="text-purple-400 font-bold text-sm mb-1">👆 Intérêt</div>
                    <div class="text-slate-400 text-xs">Clics emails et propriétés consultées</div>
                  </div>
                  <div class="bg-slate-800/50 rounded-lg p-3">
                    <div class="text-purple-400 font-bold text-sm mb-1">🎯 Maturité</div>
                    <div class="text-slate-400 text-xs">Comportement d'achat et progression</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderEmailAI() {
      return `
        <div class="space-y-6">
          <!-- Header -->
          <div class="glass rounded-2xl p-6 bg-gradient-to-r from-blue-500/10 to-purple-500/10 border-blue-500/20">
            <div class="flex items-center gap-4 mb-4">
              <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white text-3xl animate-float">
                ✉️
              </div>
              <div>
                <h2 class="text-2xl font-bold text-white mb-1">IA Email - Générateur Automatique</h2>
                <p class="text-slate-300">Créez des emails personnalisés en un clic avec l'intelligence artificielle</p>
              </div>
            </div>

            <div class="grid md:grid-cols-3 gap-4">
              <div class="bg-slate-800/50 rounded-xl p-4 text-center">
                <div class="text-3xl mb-2">📧</div>
                <div class="text-white font-bold mb-1">Emails Personnalisés</div>
                <div class="text-slate-400 text-sm">Adaptés à chaque client</div>
              </div>
              <div class="bg-slate-800/50 rounded-xl p-4 text-center">
                <div class="text-3xl mb-2">⚡</div>
                <div class="text-white font-bold mb-1">Génération Instantanée</div>
                <div class="text-slate-400 text-sm">En moins de 5 secondes</div>
              </div>
              <div class="bg-slate-800/50 rounded-xl p-4 text-center">
                <div class="text-3xl mb-2">🎯</div>
                <div class="text-white font-bold mb-1">Taux de Conversion</div>
                <div class="text-slate-400 text-sm">+40% de réponses</div>
              </div>
            </div>
          </div>

          <!-- Email Generator -->
          <div class="grid lg:grid-cols-2 gap-6">
            <!-- Left: Configuration -->
            <div class="glass rounded-2xl p-6">
              <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                <span>⚙️</span>
                Configuration de l'Email
              </h3>

              <div class="space-y-4">
                <!-- Destinataire -->
                <div>
                  <label class="block text-slate-400 text-sm mb-2 font-semibold">Destinataire *</label>
                  <select class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-400" onchange="setState({selectedEmailClient: event.target.value})">
                    <option value="">-- Sélectionner un client --</option>
                    ${state.clients.map(c => `
                      <option value="${c.id}">${c.name} - ${c.email}</option>
                    `).join('')}
                  </select>
                </div>

                <!-- Type d\'email -->
                <div>
                  <label class="block text-slate-400 text-sm mb-2 font-semibold">Type d'Email *</label>
                  <select class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-400" onchange="setState({emailType: event.target.value})">
                    <option value="">-- Sélectionner un type --</option>
                    <option value="presentation">🏠 Présentation de bien</option>
                    <option value="followup">📞 Suivi de visite</option>
                    <option value="relance">🔔 Relance prospect</option>
                    <option value="offre">💰 Proposition d'offre</option>
                    <option value="newsletter">📰 Newsletter mensuelle</option>
                    <option value="remerciement">🙏 Remerciement</option>
                  </select>
                </div>

                <!-- Bien associé (optionnel) -->
                <div>
                  <label class="block text-slate-400 text-sm mb-2 font-semibold">Bien associé (optionnel)</label>
                  <select class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-400" onchange="setState({emailProperty: event.target.value})">
                    <option value="">-- Aucun bien spécifique --</option>
                    ${state.properties.filter(p => p.status === 'Disponible').map(p => `
                      <option value="${p.id}">${p.title} - ${p.price.toLocaleString()}€</option>
                    `).join('')}
                  </select>
                </div>

                <!-- Ton -->
                <div>
                  <label class="block text-slate-400 text-sm mb-2 font-semibold">Ton de l\'email</label>
                  <div class="grid grid-cols-3 gap-2">
                    <button onclick="setState({emailTone: 'formal'})" class='px-4 py-2 rounded-lg transition-all ${ state.emailTone === "formal" ? "bg-blue-500 text-white" : "bg-slate-800 text-slate-300 hover:bg-slate-700"}'>
                      👔 Formel
                    </button>
                    <button onclick="setState({emailTone: 'friendly'})" class='px-4 py-2 rounded-lg transition-all ${state.emailTone === "friendly" ? "bg-blue-500 text-white" : "bg-slate-800 text-slate-300 hover:bg-slate-700"}'>
                      😊 Amical
                    </button>
                    <button onclick="setState({emailTone: 'casual'})" class='px-4 py-2 rounded-lg transition-all ${state.emailTone === "casual" ? "bg-blue-500 text-white" : "bg-slate-800 text-slate-300 hover:bg-slate-700"}'>
                      💬 Décontracté
                    </button>
                  </div>
                </div>

                <!-- Infos additionnelles -->
                <div>
                  <label class="block text-slate-400 text-sm mb-2 font-semibold">Informations additionnelles</label>
                  <textarea 
                    placeholder="Ex: Le client recherche un appartement avec balcon, budget flexible..."
                    rows="3"
                    class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-400 resize-none"
                    onchange="setState({emailAdditionalInfo: event.target.value})"
                  ></textarea>
                </div>

                <!-- Bouton Générer -->
                <button 
                  onclick="generateAIEmail()"
                  class="w-full btn-primary px-6 py-4 rounded-xl text-white font-bold text-lg flex items-center justify-center gap-2 hover:scale-105 transition-all shadow-lg"
                >
                  <span>✨</span>
                  Générer l'Email avec l'IA
                  <span>🚀</span>
                </button>
              </div>
            </div>

            <!-- Right: Preview -->
            <div class="glass rounded-2xl p-6">
              <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                <span>👁️</span>
                Aperçu de l'Email
              </h3>

              ${state.generatedEmail ? `
                <div class="space-y-4">
                  <!-- Email Header -->
                  <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                    <div class="text-slate-400 text-sm mb-1">De:</div>
                    <div class="text-white font-semibold">${state.currentUser.name} - Realtix Pro</div>
                    <div class="text-slate-400 text-sm">${state.emailSettings?.email || 'votre-email@realtix.com'}</div>
                  </div>

                  <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                    <div class="text-slate-400 text-sm mb-1">À:</div>
                    <div class="text-white font-semibold">${state.generatedEmail.recipientName}</div>
                    <div class="text-slate-400 text-sm">${state.generatedEmail.recipientEmail}</div>
                  </div>

                  <div class="bg-slate-800/50 rounded-xl p-4 border border-slate-700">
                    <div class="text-slate-400 text-sm mb-1">Objet:</div>
                    <div class="text-white font-semibold">${state.generatedEmail.subject}</div>
                  </div>

                  <!-- Email Body -->
                  <div class="bg-white rounded-xl p-6 text-slate-800 min-h-[300px]" style="font-family: Arial, sans-serif;">
                    <div style="white-space: pre-wrap;">${state.generatedEmail.body}</div>
                  </div>

                  <!-- Actions -->
                  <div class="flex gap-3">
                    <button 
                      onclick="copyEmailToClipboard()"
                      class="flex-1 px-4 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold flex items-center justify-center gap-2 transition-all"
                    >
                      📋 Copier
                    </button>
                    <button 
                      onclick="openInGmail()"
                      class="flex-1 px-4 py-3 bg-red-500 hover:bg-red-600 text-white rounded-xl font-semibold flex items-center justify-center gap-2 transition-all"
                    >
                      📧 Ouvrir dans Gmail
                    </button>
                  </div>

                  <button 
                    onclick="regenerateEmail()"
                    class="w-full px-4 py-3 bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all border border-purple-500/30"
                  >
                    🔄 Régénérer l'Email
                  </button>
                </div>
              ` : `
                <div class="flex flex-col items-center justify-center h-[500px] text-center">
                  <div class="text-8xl mb-6 opacity-50">📧</div>
                  <p class="text-slate-400 text-lg mb-2">Aucun email généré</p>
                  <p class="text-slate-500 text-sm">Configurez les paramètres et cliquez sur "Générer"</p>
                </div>
              `}
            </div>
          </div>

          <!-- Info Box -->
          <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-5">
            <div class="flex items-start gap-3">
              <span class="text-3xl">💡</span>
              <div class="flex-1">
                <h4 class="text-white font-bold mb-2">Comment ça marche ?</h4>
                <p class="text-slate-300 text-sm mb-3">
                  L'IA analyse le profil de votre client, son historique d'interactions, et le contexte pour générer un email parfaitement adapté et personnalisé.
                </p>
                <div class="grid md:grid-cols-2 gap-3">
                  <div class="flex items-center gap-2 text-sm">
                    <span class="text-green-400">✓</span>
                    <span class="text-slate-300">Personnalisation automatique</span>
                  </div>
                  <div class="flex items-center gap-2 text-sm">
                    <span class="text-green-400">✓</span>
                    <span class="text-slate-300">Ton adapté au client</span>
                  </div>
                  <div class="flex items-center gap-2 text-sm">
                    <span class="text-green-400">✓</span>
                    <span class="text-slate-300">Intégration Gmail</span>
                  </div>
                  <div class="flex items-center gap-2 text-sm">
                    <span class="text-green-400">✓</span>
                    <span class="text-slate-300">Génération instantanée</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderTools() {
      return `
        <div class="space-y-6">
          <!-- Header -->
          <div class="glass rounded-2xl p-6 bg-gradient-to-r from-green-500/10 to-blue-500/10 border-green-500/20">
            <h2 class="text-2xl font-bold text-white mb-2">🛠️ Outils Avancés</h2>
            <p class="text-slate-300">Tracking emails, SMS automatiques, statistiques et calcul d'honoraires</p>
          </div>

          <!-- Tabs -->
          <div class="glass rounded-2xl p-2 flex gap-2 flex-wrap">
            <button onclick="setState({toolsTab: 'multiportal'})" class='flex-1 min-w-[140px] px-4 py-3 rounded-xl font-semibold transition-all ${(state.toolsTab || "multiportal") === "multiportal" ? "bg-blue-500 text-white" : "text-slate-300 hover:bg-slate-700"}'>
              📡 Multi-Portails
              <div class="text-xs opacity-70">PRO</div>
            </button>
            <button onclick="setState({toolsTab: 'sms'})" class='flex-1 min-w-[140px] px-4 py-3 rounded-xl font-semibold transition-all ${state.toolsTab === "sms" ? "bg-blue-500 text-white" : "text-slate-300 hover:bg-slate-700"}'>
              📱 SMS Auto
              <div class="text-xs opacity-70">ENTREPRISE</div>
            </button>
            <button onclick="setState({toolsTab: 'stats'})" class='flex-1 min-w-[140px] px-4 py-3 rounded-xl font-semibold transition-all ${state.toolsTab === "stats" ? "bg-blue-500 text-white" : "text-slate-300 hover:bg-slate-700"}'>
              📊 Stats Biens
              <div class="text-xs opacity-70">PRO</div>
            </button>
            <button onclick="setState({toolsTab: 'commission'})" class='flex-1 min-w-[140px] px-4 py-3 rounded-xl font-semibold transition-all ${state.toolsTab === "commission" ? "bg-blue-500 text-white" : "text-slate-300 hover:bg-slate-700"}'>
              💰 Honoraires
              <div class="text-xs opacity-70">ENTREPRISE</div>
            </button>
            <button onclick="setState({toolsTab: 'dvf'})" class='flex-1 min-w-[140px] px-4 py-3 rounded-xl font-semibold transition-all ${state.toolsTab === "dvf" ? "bg-blue-500 text-white" : "text-slate-300 hover:bg-slate-700"}'>
              🏘️ DVF Etalab
              <div class="text-xs opacity-70">GRATUIT</div>
            </button>
          </div>

          ${state.toolsTab === 'multiportal' && !hasProAccess() ? `
            <!-- Multi-Portal Paywall -->
            <div class="glass rounded-2xl p-8 text-center">
              <div class="text-6xl mb-4">🔒</div>
              <h3 class="text-2xl font-bold text-white mb-2">Publication Multi-Portails - PRO</h3>
              <p class="text-slate-300 mb-6">Diffusez vos biens sur des dizaines de portails immobiliers en 1 clic</p>
              <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4 mb-6 max-w-md mx-auto">
                <h4 class="text-white font-semibold mb-2">✨ Fonctionnalités PRO :</h4>
                <ul class="text-slate-300 text-sm space-y-1 text-left">
                  <li>✓ Publication simultanée sur 15+ portails</li>
                  <li>✓ Synchronisation automatique des modifications</li>
                  <li>✓ Tableau de bord centralisé (vues, contacts)</li>
                  <li>✓ Gestion des publications actives</li>
                  <li>✓ Export flux XML pour portails tiers</li>
                </ul>
              </div>
              <button onclick="setState({currentPage: 'subscription'})" class="btn-primary px-8 py-3 rounded-xl font-bold">
                Passer à PRO (79€/mois)
              </button>
            </div>
          ` : state.toolsTab === 'multiportal' && hasProAccess() ? `
            <!-- Multi-Portal Publication -->
            <div class="space-y-6">
              
              <!-- Step 1: Select Property -->
              <div class="glass rounded-2xl p-6">
                <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                  1️⃣ Sélectionner le bien
                </h3>
                
                <div class="relative mb-4">
                  <input
                    type="text"
                    placeholder="🔍 Rechercher un bien par titre, ville ou type..."
                    class="w-full px-4 py-3 pl-12 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    oninput="setState({multiPortal: {...state.multiPortal, searchQuery: event.target.value}})"
                  />
                  <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400">
                    🔍
                  </div>
                </div>

                ${state.multiPortal.selectedProperty ? `
                  <div class="bg-gradient-to-r from-green-500/10 to-blue-500/10 border-2 border-green-500/30 rounded-xl p-4">
                    <div class="flex items-start justify-between">
                      <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                          <div class="text-3xl">${state.properties.find(p => p.id === state.multiPortal.selectedProperty)?.image || '🏠'}</div>
                          <div>
                            <h4 class="text-white font-bold text-lg">${state.properties.find(p => p.id === state.multiPortal.selectedProperty)?.title}</h4>
                            <p class="text-slate-300">${state.properties.find(p => p.id === state.multiPortal.selectedProperty)?.price.toLocaleString()}€ • ${state.properties.find(p => p.id === state.multiPortal.selectedProperty)?.location}</p>
                          </div>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mt-3">
                          <div class="text-center p-2 bg-slate-800/50 rounded-lg">
                            <div class="text-xs text-slate-400">Surface</div>
                            <div class="text-white font-bold">${state.properties.find(p => p.id === state.multiPortal.selectedProperty)?.surface}m²</div>
                          </div>
                          <div class="text-center p-2 bg-slate-800/50 rounded-lg">
                            <div class="text-xs text-slate-400">Pièces</div>
                            <div class="text-white font-bold">${state.properties.find(p => p.id === state.multiPortal.selectedProperty)?.rooms}</div>
                          </div>
                          <div class="text-center p-2 bg-slate-800/50 rounded-lg">
                            <div class="text-xs text-slate-400">Photos</div>
                            <div class="text-white font-bold">12</div>
                          </div>
                          <div class="text-center p-2 bg-slate-800/50 rounded-lg">
                            <div class="text-xs text-slate-400">Description</div>
                            <div class="text-white font-bold">380 chars</div>
                          </div>
                        </div>
                      </div>
                      <button onclick="setState({multiPortal: {...state.multiPortal, selectedProperty: null}})" class="ml-4 text-slate-400 hover:text-red-400 transition-all">
                        ✕
                      </button>
                    </div>
                  </div>
                ` : `
                  <div class="grid md:grid-cols-2 gap-4">
                    ${state.properties.map(property => `
                      <button
                        onclick="setState({multiPortal: {...state.multiPortal, selectedProperty: ${property.id}}})"
                        class="flex items-start gap-4 p-4 bg-slate-700/50 hover:bg-slate-700 border border-slate-600 hover:border-amber-400 rounded-xl transition-all text-left"
                      >
                        <div class="text-4xl flex-shrink-0">${property.image}</div>
                        <div class="flex-1 min-w-0">
                          <h4 class="text-white font-bold mb-1 truncate">${property.title}</h4>
                          <p class="text-amber-400 font-bold mb-1">${property.price.toLocaleString()}€</p>
                          <p class="text-slate-400 text-sm">${property.location} • ${property.surface}m² • ${property.rooms} pièces</p>
                        </div>
                        <div class="text-slate-400">→</div>
                      </button>
                    `).join('')}
                  </div>
                `}
              </div>

              ${state.multiPortal.selectedProperty ? `
                <!-- Step 2: Select Portals -->
                <div class="glass rounded-2xl p-6">
                  <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-white flex items-center gap-2">
                      2️⃣ Choisir les portails
                    </h3>
                    <div class="flex gap-2">
                      <button onclick="selectAllPortals()" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm font-semibold transition-all">
                        Tout sélectionner
                      </button>
                      <button onclick="selectPremiumPortals()" class="px-4 py-2 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 rounded-lg text-sm font-semibold transition-all">
                        Portails Premium
                      </button>
                      <button onclick="selectFreePortals()" class="px-4 py-2 bg-green-500/20 hover:bg-green-500/30 text-green-400 rounded-lg text-sm font-semibold transition-all">
                        Gratuits
                      </button>
                    </div>
                  </div>

                  <div class="grid md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6">
                    ${state.availablePortals.map(portal => {
                      const isSelected = state.multiPortal.selectedPortals.includes(portal.id);
                      const property = state.properties.find(p => p.id === state.multiPortal.selectedProperty);
                      const photoCount = 12; // Simulé
                      const descLength = 380; // Simulé
                      const hasEnoughPhotos = photoCount >= portal.minPhotos;
                      const descOk = descLength <= portal.maxDescLength;
                      const canPublish = hasEnoughPhotos && descOk && portal.status === 'active';
                      
                      return `
                        <button
                          onclick="togglePortal('${portal.id}')"
                          class='relative p-4 rounded-xl transition-all ${
                            isSelected 
                              ? "bg-gradient-to-br from-amber-500/20 to-amber-600/20 border-2 border-amber-400 ring-2 ring-amber-400/30" 
                              : "bg-slate-700/50 border-2 border-slate-600 hover:border-slate-500"
                          } ${!canPublish ? "opacity-50" : ""}'
                          ${!canPublish ? 'disabled' : ''}
                        >
                          ${isSelected ? '<div class="absolute top-2 right-2 w-6 h-6 bg-amber-400 rounded-full flex items-center justify-center text-white font-bold text-xs">✓</div>' : ''}
                          
                          <div class="text-center">
                            <div class="text-3xl mb-2">${portal.logo}</div>
                            <div class="text-white font-bold text-sm mb-1">${portal.name}</div>
                            <div class='text-xs ${portal.tier === "premium" ? "text-amber-400" : "text-green-400"} font-semibold mb-2'>
                              ${portal.tier === 'premium' ? '⭐ Premium' : '🆓 Gratuit'}
                            </div>
                            
                            ${portal.status === 'active' ? `
                              <div class="text-xs space-y-1">
                                <div class='${hasEnoughPhotos ? "text-green-400" : "text-red-400"}'>
                                  📸 ${photoCount}/${portal.minPhotos} photos ${hasEnoughPhotos ? '✓' : '✗'}
                                </div>
                                <div class='${descOk ? "text-green-400" : "text-red-400"}'>
                                  ✍️ ${descLength}/${portal.maxDescLength} chars ${descOk ? '✓' : '✗'}
                                </div>
                              </div>
                            ` : `
                              <div class="text-xs text-red-400">
                                🔴 Inactif
                              </div>
                            `}
                          </div>
                        </button>
                      `;
                    }).join('')}
                  </div>

                  <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
                    <div class="flex items-center justify-between">
                      <div>
                        <span class="text-white font-bold text-lg">${state.multiPortal.selectedPortals.length}</span>
                        <span class="text-slate-300"> portails sélectionnés</span>
                      </div>
                      <div class="text-slate-400 text-sm">
                        ${state.availablePortals.filter(p => state.multiPortal.selectedPortals.includes(p.id) && p.tier === 'premium').length} Premium • 
                        ${state.availablePortals.filter(p => state.multiPortal.selectedPortals.includes(p.id) && p.tier === 'free').length} Gratuits
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Step 3: Publication Options -->
                <div class="glass rounded-2xl p-6">
                  <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                    3️⃣ Options de publication
                  </h3>

                  <div class="space-y-6">
                    <!-- Scheduling -->
                    <div>
                      <h4 class="text-white font-semibold mb-3">⏰ Planification</h4>
                      <div class="space-y-2">
                        <label class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-800 transition-all">
                          <input
                            type="radio"
                            name="scheduling"
                            checked="${state.multiPortal.publishImmediately}"
                            onchange="setState({multiPortal: {...state.multiPortal, publishImmediately: true}})"
                            class="w-5 h-5 accent-amber-500"
                          />
                          <span class="text-white font-semibold">Publier immédiatement</span>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-800 transition-all">
                          <input
                            type="radio"
                            name="scheduling"
                            checked="${!state.multiPortal.publishImmediately}"
                            onchange="setState({multiPortal: {...state.multiPortal, publishImmediately: false}})"
                            class="w-5 h-5 accent-amber-500"
                          />
                          <span class="text-white font-semibold">Planifier</span>
                          <input type="date" class="ml-auto px-3 py-1 bg-slate-700 border border-slate-600 rounded-lg text-white text-sm" />
                          <input type="time" class="px-3 py-1 bg-slate-700 border border-slate-600 rounded-lg text-white text-sm" />
                        </label>
                      </div>
                    </div>

                    <!-- Auto-sync -->
                    <div>
                      <h4 class="text-white font-semibold mb-3">🔄 Mise à jour automatique</h4>
                      <div class="space-y-2">
                        <label class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-800 transition-all">
                          <div>
                            <div class="text-white font-semibold">Synchroniser les modifications</div>
                            <div class="text-slate-400 text-sm">Les changements seront appliqués sur tous les portails</div>
                          </div>
                          <input
                            type="checkbox"
                            checked="${state.multiPortal.autoSync}"
                            onchange="setState({multiPortal: {...state.multiPortal, autoSync: event.target.checked}})"
                            class="w-5 h-5 rounded accent-green-500"
                          />
                        </label>
                        <label class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-800 transition-all">
                          <div>
                            <div class="text-white font-semibold">Retirer si vendu/loué</div>
                            <div class="text-slate-400 text-sm">Retire automatiquement des portails</div>
                          </div>
                          <input
                            type="checkbox"
                            checked="${state.multiPortal.removeWhenSold}"
                            onchange="setState({multiPortal: {...state.multiPortal, removeWhenSold: event.target.checked}})"
                            class="w-5 h-5 rounded accent-green-500"
                          />
                        </label>
                        <label class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-800 transition-all">
                          <div>
                            <div class="text-white font-semibold">Actualiser prix si changement</div>
                            <div class="text-slate-400 text-sm">Met à jour le prix partout automatiquement</div>
                          </div>
                          <input
                            type="checkbox"
                            checked="${state.multiPortal.updatePrice}"
                            onchange="setState({multiPortal: {...state.multiPortal, updatePrice: event.target.checked}})"
                            class="w-5 h-5 rounded accent-green-500"
                          />
                        </label>
                      </div>
                    </div>

                    <!-- Notifications -->
                    <div>
                      <h4 class="text-white font-semibold mb-3">📧 Notifications</h4>
                      <div class="space-y-2">
                        <label class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-800 transition-all">
                          <span class="text-white font-semibold">M'envoyer un rapport après publication</span>
                          <input
                            type="checkbox"
                            checked="${state.multiPortal.sendReport}"
                            onchange="setState({multiPortal: {...state.multiPortal, sendReport: event.target.checked}})"
                            class="w-5 h-5 rounded accent-green-500"
                          />
                        </label>
                        <label class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-800 transition-all">
                          <span class="text-white font-semibold">Alertes si erreur sur un portail</span>
                          <input
                            type="checkbox"
                            checked="${state.multiPortal.alertOnError}"
                            onchange="setState({multiPortal: {...state.multiPortal, alertOnError: event.target.checked}})"
                            class="w-5 h-5 rounded accent-green-500"
                          />
                        </label>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Step 4: Preview & Warnings -->
                <div class="glass rounded-2xl p-6">
                  <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                    4️⃣ Prévisualisation & Validation
                  </h3>

                  <div class="flex gap-3 mb-6">
                    <button class="flex-1 px-4 py-3 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 rounded-xl font-semibold transition-all">
                      👁️ Prévisualiser SeLoger
                    </button>
                    <button class="flex-1 px-4 py-3 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 rounded-xl font-semibold transition-all">
                      👁️ Prévisualiser LeBonCoin
                    </button>
                  </div>

                  ${(() => {
                    const property = state.properties.find(p => p.id === state.multiPortal.selectedProperty);
                    const photoCount = 12;
                    const descLength = 380;
                    const warnings = [];
                    const errors = [];
                    
                    state.multiPortal.selectedPortals.forEach(portalId => {
                      const portal = state.availablePortals.find(p => p.id === portalId);
                      if (portal) {
                        if (photoCount < portal.minPhotos) {
                          errors.push(`${portal.name}: Photos insuffisantes (minimum ${portal.minPhotos}, vous: ${photoCount})`);
                        }
                        if (descLength > portal.maxDescLength) {
                          errors.push(`${portal.name}: Description trop longue (max ${portal.maxDescLength} chars, vous: ${descLength})`);
                        }
                        if (portal.status !== 'active') {
                          errors.push(`${portal.name}: Portail inactif - configuration requise`);
                        }
                      }
                    });
                    
                    return errors.length > 0 ? `
                      <div class="bg-red-500/10 border border-red-500/30 rounded-xl p-4 mb-4">
                        <h4 class="text-red-400 font-semibold mb-2 flex items-center gap-2">
                          ⚠️ Erreurs bloquantes (${errors.length})
                        </h4>
                        <ul class="text-red-300 text-sm space-y-1">
                          ${errors.map(err => `<li>• ${err}</li>`).join('')}
                        </ul>
                      </div>
                    ` : `
                      <div class="bg-green-500/10 border border-green-500/30 rounded-xl p-4 mb-4">
                        <h4 class="text-green-400 font-semibold flex items-center gap-2">
                          ✅ Validation réussie - Prêt à publier !
                        </h4>
                        <p class="text-green-300 text-sm mt-1">Toutes les conditions sont remplies pour les portails sélectionnés.</p>
                      </div>
                    `;
                  })()}

                  <div class="flex gap-4">
                    <button
                      onclick="publishToPortals()"
                      class="flex-1 btn-primary px-8 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2"
                    >
                      📡 PUBLIER SUR ${state.multiPortal.selectedPortals.length} PORTAILS
                    </button>
                    <button
                      onclick="saveDraft()"
                      class="px-8 py-4 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-bold transition-all"
                    >
                      💾 Enregistrer comme brouillon
                    </button>
                  </div>
                </div>
              ` : ''}

              <!-- Publications History -->
              ${state.publications.length > 0 ? `
                <div class="glass rounded-2xl p-6">
                  <h3 class="text-xl font-bold text-white mb-6">📊 Suivi des Publications</h3>
                  
                  ${state.publications.map(pub => {
                    const totalViews = pub.portals.reduce((sum, p) => sum + p.views, 0);
                    const totalContacts = pub.portals.reduce((sum, p) => sum + p.contacts, 0);
                    const publishedCount = pub.portals.filter(p => p.status === 'published').length;
                    const errorCount = pub.portals.filter(p => p.status === 'error').length;
                    const pendingCount = pub.portals.filter(p => p.status === 'pending').length;
                    
                    return `
                      <div class="bg-slate-700/50 rounded-xl p-6 mb-4">
                        <div class="flex items-center justify-between mb-4">
                          <div>
                            <h4 class="text-white font-bold text-lg">${pub.propertyTitle}</h4>
                            <p class="text-slate-400 text-sm">Publié le ${new Date(pub.publishedDate).toLocaleDateString('fr-FR')} à ${new Date(pub.publishedDate).toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})}</p>
                          </div>
                          <div class="text-right">
                            <div class="text-white font-bold text-2xl">${totalViews.toLocaleString()}</div>
                            <div class="text-slate-400 text-sm">vues totales</div>
                          </div>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                          <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-3 text-center">
                            <div class="text-green-400 font-bold text-xl">${publishedCount}</div>
                            <div class="text-slate-300 text-xs">Publiés</div>
                          </div>
                          <div class="bg-amber-500/10 border border-amber-500/30 rounded-lg p-3 text-center">
                            <div class="text-amber-400 font-bold text-xl">${pendingCount}</div>
                            <div class="text-slate-300 text-xs">En cours</div>
                          </div>
                          <div class="bg-red-500/10 border border-red-500/30 rounded-lg p-3 text-center">
                            <div class="text-red-400 font-bold text-xl">${errorCount}</div>
                            <div class="text-slate-300 text-xs">Erreurs</div>
                          </div>
                          <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 text-center">
                            <div class="text-blue-400 font-bold text-xl">${totalContacts}</div>
                            <div class="text-slate-300 text-xs">Contacts</div>
                          </div>
                        </div>

                        <div class="overflow-x-auto">
                          <table class="w-full">
                            <thead>
                              <tr class="text-left text-slate-400 text-sm border-b border-slate-600">
                                <th class="py-2 px-3">Portail</th>
                                <th class="py-2 px-3">Statut</th>
                                <th class="py-2 px-3 text-right">Vues</th>
                                <th class="py-2 px-3 text-right">Contacts</th>
                                <th class="py-2 px-3 text-center">Action</th>
                              </tr>
                            </thead>
                            <tbody>
                              ${pub.portals.map(portal => {
                                const portalInfo = state.availablePortals.find(p => p.id === portal.name);
                                return `
                                  <tr class="text-white border-b border-slate-700/50">
                                    <td class="py-3 px-3">
                                      <div class="flex items-center gap-2">
                                        <span class="text-xl">${portalInfo?.logo || '📍'}</span>
                                        <span class="font-semibold">${portalInfo?.name || portal.name}</span>
                                      </div>
                                    </td>
                                    <td class="py-3 px-3">
                                      ${portal.status === 'published' ? '<span class="px-2 py-1 bg-green-500/20 text-green-400 rounded text-xs font-semibold">🟢 Publié</span>' : ''}
                                      ${portal.status === 'pending' ? '<span class="px-2 py-1 bg-amber-500/20 text-amber-400 rounded text-xs font-semibold">⏳ En cours</span>' : ''}
                                      ${portal.status === 'error' ? '<span class="px-2 py-1 bg-red-500/20 text-red-400 rounded text-xs font-semibold">🔴 Erreur</span>' : ''}
                                      ${portal.error ? `<div class="text-xs text-red-300 mt-1">${portal.error}</div>` : ''}
                                    </td>
                                    <td class="py-3 px-3 text-right font-bold">${portal.views.toLocaleString()}</td>
                                    <td class="py-3 px-3 text-right font-bold">${portal.contacts}</td>
                                    <td class="py-3 px-3 text-center">
                                      ${portal.url ? `<a href="${portal.url}" target="_blank" class="text-blue-400 hover:text-blue-300">🔗</a>` : '-'}
                                    </td>
                                  </tr>
                                `;
                              }).join('')}
                            </tbody>
                          </table>
                        </div>

                        <div class="flex gap-3 mt-4">
                          <button class="px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 rounded-lg text-sm font-semibold transition-all">
                            📧 Voir tous les contacts
                          </button>
                          <button class="px-4 py-2 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 rounded-lg text-sm font-semibold transition-all">
                            ♻️ Republier
                          </button>
                          <button class="px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg text-sm font-semibold transition-all">
                            🗑️ Retirer partout
                          </button>
                        </div>
                      </div>
                    `;
                  }).join('')}
                </div>
              ` : ''}
            </div>
          ` : ''}

          ${state.toolsTab === 'sms' && !hasEnterpriseAccess() ? `
            <!-- SMS Paywall -->
            <div class="glass rounded-2xl p-8 text-center">
              <div class="text-6xl mb-4">🔒</div>
              <h3 class="text-2xl font-bold text-white mb-2">SMS Automatiques - Entreprise</h3>
              <p class="text-slate-300 mb-6">Gagnez du temps avec les SMS automatiques avant chaque visite</p>
              <button onclick="setState({currentPage: 'subscription'})" class="btn-primary px-8 py-3 rounded-xl font-bold">
                Passer à Entreprise (149€/mois)
              </button>
            </div>
          ` : state.toolsTab === 'commission' && !hasEnterpriseAccess() ? `
            <!-- Commission Paywall -->
            <div class="glass rounded-2xl p-8 text-center">
              <div class="text-6xl mb-4">🔒</div>
              <h3 class="text-2xl font-bold text-white mb-2">Calcul Honoraires - Entreprise</h3>
              <p class="text-slate-300 mb-6">Calculez vos honoraires instantanément selon votre barème</p>
              <button onclick="setState({currentPage: 'subscription'})" class="btn-primary px-8 py-3 rounded-xl font-bold">
                Passer à Entreprise (149€/mois)
              </button>
            </div>
          ` : ''}

          ${state.toolsTab === 'sms' && hasEnterpriseAccess() ? `
            <!-- SMS Automatiques -->
            <div class="glass rounded-2xl p-6">
              <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white flex items-center gap-2">
                  📱 SMS Automatiques Visites
                </h3>
                <label class="flex items-center gap-2 cursor-pointer">
                  <input type="checkbox" ${state.smsAutoEnabled ? 'checked' : ''} onchange="setState({smsAutoEnabled: event.target.checked})" class="w-5 h-5 rounded accent-green-500" />
                  <span class="text-white font-semibold">${state.smsAutoEnabled ? 'Activé ✅' : 'Désactivé'}</span>
                </label>
              </div>

              ${state.smsAutoEnabled ? `
                <div class="bg-green-500/10 border border-green-500/30 rounded-xl p-4 mb-6">
                  <p class="text-green-400 mb-2">✅ Les SMS sont envoyés automatiquement :</p>
                  <ul class="text-slate-300 text-sm space-y-1 ml-4">
                    <li>• 24h avant la visite (confirmation)</li>
                    <li>• 2h avant la visite (rappel)</li>
                    <li>• En cas de modification ou annulation</li>
                  </ul>
                </div>
              ` : `
                <div class="bg-amber-500/10 border border-amber-500/30 rounded-xl p-4 mb-6">
                  <p class="text-amber-400">⚠️ SMS automatiques désactivés. Activez pour gagner du temps !</p>
                </div>
              `}

              <h4 class="text-white font-bold mb-4">📨 Historique SMS</h4>
              <div class="space-y-3">
                ${state.smsNotifications.map(sms => `
                  <div class="bg-slate-700/50 rounded-xl p-4">
                    <div class="flex items-center justify-between mb-2">
                      <div class="flex items-center gap-3">
                        <span class="text-2xl">📱</span>
                        <div>
                          <h5 class="text-white font-bold">${sms.clientName}</h5>
                          <span class='text-xs px-2 py-1 rounded ${sms.type === "confirmation" ? "bg-blue-500/20 text-blue-400" : "bg-purple-500/20 text-purple-400"}'>${sms.type === 'confirmation' ? 'Confirmation' : 'Rappel'}</span>
                        </div>
                      </div>
                      <div class="text-right">
                        <div class="text-xs text-slate-400">${new Date(sms.sentDate).toLocaleDateString('fr-FR')}</div>
                        <div class="text-xs text-green-400">${sms.status === 'sent' ? '✅ Envoyé' : '⏳ En attente'}</div>
                      </div>
                    </div>
                    <div class="bg-slate-800 rounded-lg p-3">
                      <p class="text-slate-300 text-sm">${sms.message}</p>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          ` : ''}

          ${state.toolsTab === 'stats' && !hasProAccess() ? `
            <!-- Stats Biens Paywall -->
            <div class="glass rounded-2xl p-8 text-center">
              <div class="text-6xl mb-4">🔒</div>
              <h3 class="text-2xl font-bold text-white mb-2">Statistiques Biens - PRO</h3>
              <p class="text-slate-300 mb-6">Analysez la performance de chaque bien avec des stats détaillées</p>
              <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4 mb-6 max-w-md mx-auto">
                <h4 class="text-white font-semibold mb-2">✨ Fonctionnalités PRO :</h4>
                <ul class="text-slate-300 text-sm space-y-1 text-left">
                  <li>✓ Nombre de vues par bien</li>
                  <li>✓ Favoris et visites planifiées</li>
                  <li>✓ Emails envoyés et temps moyen</li>
                  <li>✓ Taux de conversion détaillé</li>
                  <li>✓ Détection biens populaires 🔥</li>
                </ul>
              </div>
              <button onclick="setState({currentPage: 'subscription'})" class="btn-primary px-8 py-3 rounded-xl font-bold">
                Passer à PRO (79€/mois)
              </button>
            </div>
          ` : state.toolsTab === 'stats' && hasProAccess() ? `
            <!-- Stats Détaillées par Bien -->
            <div class="glass rounded-2xl p-6">
              <h3 class="text-xl font-bold text-white mb-6">📊 Statistiques Détaillées par Bien</h3>
              <div class="space-y-4">
                ${state.properties.map(property => {
                  const stats = state.propertyStats[property.id] || {};
                  return `
                    <div class="bg-slate-700/50 rounded-xl p-4 border border-slate-600">
                      <div class="flex items-center justify-between mb-4">
                        <div>
                          <h4 class="text-white font-bold">${property.title}</h4>
                          <p class="text-slate-400 text-sm">${property.price.toLocaleString()}€ • ${property.location}</p>
                        </div>
                        <span class='px-3 py-1 rounded-full text-xs font-bold ${property.status === "Disponible" ? "bg-green-500/20 text-green-400" : property.status === "Sous offre" ? "bg-amber-500/20 text-amber-400" : "bg-slate-500/20 text-slate-400"}'>${property.status}</span>
                      </div>
                      
                      <div class="grid grid-cols-3 md:grid-cols-6 gap-3">
                        <div class="bg-slate-800 rounded-lg p-3 text-center">
                          <div class="text-2xl mb-1">👁️</div>
                          <div class="text-xs text-slate-400">Vues</div>
                          <div class="text-white font-bold">${stats.views || 0}</div>
                        </div>
                        <div class="bg-slate-800 rounded-lg p-3 text-center">
                          <div class="text-2xl mb-1">⭐</div>
                          <div class="text-xs text-slate-400">Favoris</div>
                          <div class="text-white font-bold">${stats.favorites || 0}</div>
                        </div>
                        <div class="bg-slate-800 rounded-lg p-3 text-center">
                          <div class="text-2xl mb-1">📅</div>
                          <div class="text-xs text-slate-400">Visites</div>
                          <div class="text-white font-bold">${stats.visits || property.visits || 0}</div>
                        </div>
                        <div class="bg-slate-800 rounded-lg p-3 text-center">
                          <div class="text-2xl mb-1">📧</div>
                          <div class="text-xs text-slate-400">Emails</div>
                          <div class="text-white font-bold">${stats.emailsSent || 0}</div>
                        </div>
                        <div class="bg-slate-800 rounded-lg p-3 text-center">
                          <div class="text-2xl mb-1">⏱️</div>
                          <div class="text-xs text-slate-400">Temps moy</div>
                          <div class="text-white font-bold text-xs">${stats.avgTimeOnPage || 0}s</div>
                        </div>
                        <div class="bg-slate-800 rounded-lg p-3 text-center">
                          <div class="text-2xl mb-1">🎯</div>
                          <div class="text-xs text-slate-400">Conversion</div>
                          <div class="text-white font-bold">${stats.conversionRate || 0}%</div>
                        </div>
                      </div>

                      <div class="mt-4 flex items-center justify-between">
                        <span class="text-xs text-slate-400">Dernière activité : ${stats.lastActivity ? formatTimeSince(stats.lastActivity) : 'N/A'}</span>
                        ${stats.views > 200 ? `<span class="text-xs text-green-400 font-bold">🔥 Bien populaire !</span>` : ''}
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          ` : ''}

          ${state.toolsTab === 'commission' && hasEnterpriseAccess() ? `
            <!-- Calculateur d'Honoraires -->
            <div class="glass rounded-2xl p-6">
              <h3 class="text-xl font-bold text-white mb-6">💰 Calculateur d'Honoraires</h3>
              
              <div class="grid md:grid-cols-2 gap-6">
                <!-- Configuration -->
                <div class="space-y-4">
                  <h4 class="text-white font-semibold mb-3">⚙️ Configuration Barème</h4>
                  
                  <div>
                    <label class="block text-slate-400 text-sm mb-2">Type de commission</label>
                    <select onchange="setState({commissionSettings: {...state.commissionSettings, type: event.target.value}})" class="w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-xl text-white">
                      <option value="percentage" ${state.commissionSettings.type === 'percentage' ? 'selected' : ''}>Pourcentage</option>
                      <option value="fixed" ${state.commissionSettings.type === 'fixed' ? 'selected' : ''}>Montant fixe</option>
                    </select>
                  </div>

                  ${state.commissionSettings.type === 'percentage' ? `
                    <div>
                      <label class="block text-slate-400 text-sm mb-2">Taux vendeur (%)</label>
                      <input type="number" value="${state.commissionSettings.sellerRate}" onchange="setState({commissionSettings: {...state.commissionSettings, sellerRate: parseFloat(event.target.value)}})" class="w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-xl text-white" />
                    </div>
                    <div>
                      <label class="block text-slate-400 text-sm mb-2">Taux acquéreur (%)</label>
                      <input type="number" value="${state.commissionSettings.buyerRate}" onchange="setState({commissionSettings: {...state.commissionSettings, buyerRate: parseFloat(event.target.value)}})" class="w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-xl text-white" />
                    </div>
                  ` : ''}

                  <div>
                    <label class="block text-slate-400 text-sm mb-2">Commission minimum (€)</label>
                    <input type="number" value="${state.commissionSettings.minCommission}" onchange="setState({commissionSettings: {...state.commissionSettings, minCommission: parseFloat(event.target.value)}})" class="w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-xl text-white" />
                  </div>

                  <div>
                    <label class="block text-slate-400 text-sm mb-2">Commission maximum (€)</label>
                    <input type="number" value="${state.commissionSettings.maxCommission}" onchange="setState({commissionSettings: {...state.commissionSettings, maxCommission: parseFloat(event.target.value)}})" class="w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-xl text-white" />
                  </div>

                  <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" ${state.commissionSettings.includeTax ? 'checked' : ''} onchange="setState({commissionSettings: {...state.commissionSettings, includeTax: event.target.checked}})" class="w-5 h-5 rounded accent-blue-500" />
                    <span class="text-white">Inclure TVA (${state.commissionSettings.taxRate}%)</span>
                  </label>
                </div>

                <!-- Calcul -->
                <div class="space-y-4">
                  <h4 class="text-white font-semibold mb-3">🧮 Calculer pour un bien</h4>
                  
                  <div>
                    <label class="block text-slate-400 text-sm mb-2">Sélectionner un bien</label>
                    <select onchange="setState({selectedPropertyForCommission: parseInt(event.target.value)})" class="w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-xl text-white">
                      <option value="">-- Choisir --</option>
                      ${state.properties.map(p => `
                        <option value="${p.id}" ${state.selectedPropertyForCommission === p.id ? 'selected' : ''}>${p.title} - ${p.price.toLocaleString()}€</option>
                      `).join('')}
                    </select>
                  </div>

                  ${state.selectedPropertyForCommission ? `
                    ${(() => {
                      const property = state.properties.find(p => p.id === state.selectedPropertyForCommission);
                      const commissionHT = Math.max(state.commissionSettings.minCommission, Math.min(state.commissionSettings.maxCommission, property.price * (state.commissionSettings.sellerRate + state.commissionSettings.buyerRate) / 100));
                      const tax = state.commissionSettings.includeTax ? commissionHT * state.commissionSettings.taxRate / 100 : 0;
                      const commissionTTC = commissionHT + tax;
                      
                      return `
                        <div class="bg-gradient-to-br from-green-500/20 to-blue-500/20 border border-green-500/30 rounded-xl p-6 mt-4">
                          <h5 class="text-white font-bold mb-4">${property.title}</h5>
                          
                          <div class="space-y-3">
                            <div class="flex justify-between">
                              <span class="text-slate-300">Prix de vente</span>
                              <span class="text-white font-bold">${property.price.toLocaleString()} €</span>
                            </div>
                            <div class="flex justify-between">
                              <span class="text-slate-300">Taux total</span>
                              <span class="text-white font-bold">${state.commissionSettings.sellerRate + state.commissionSettings.buyerRate}%</span>
                            </div>
                            <div class="h-px bg-slate-600"></div>
                            <div class="flex justify-between">
                              <span class="text-slate-300">Commission HT</span>
                              <span class="text-white font-bold">${commissionHT.toLocaleString()} €</span>
                            </div>
                            ${state.commissionSettings.includeTax ? `
                              <div class="flex justify-between text-sm">
                                <span class="text-slate-400">TVA (${state.commissionSettings.taxRate}%)</span>
                                <span class="text-slate-400">${tax.toLocaleString()} €</span>
                              </div>
                            ` : ''}
                            <div class="h-px bg-slate-600"></div>
                            <div class="flex justify-between text-lg">
                              <span class="text-green-400 font-bold">Commission ${state.commissionSettings.includeTax ? 'TTC' : 'HT'}</span>
                              <span class="text-green-400 font-bold">${commissionTTC.toLocaleString()} €</span>
                            </div>
                          </div>
                        </div>
                      `;
                    })()}
                  ` : `
                    <div class="text-center py-12 text-slate-400">
                      <div class="text-6xl mb-4">💰</div>
                      <p>Sélectionnez un bien pour calculer les honoraires</p>
                    </div>
                  `}
                </div>
              </div>
            </div>
          ` : ''}

          ${state.toolsTab === 'dvf' ? `
            <!-- DVF Etalab -->
            <div class="glass rounded-2xl p-6">
              <div class="flex items-center justify-between mb-6">
                <div>
                  <h3 class="text-xl font-bold text-white mb-2 flex items-center gap-2">
                    🏘️ DVF - Demande de Valeurs Foncières
                  </h3>
                  <p class="text-slate-300 text-sm">Consultez les transactions immobilières réelles partout en France</p>
                </div>
                <a href="https://explore.data.gouv.fr/fr/immobilier?onglet=carte&filtre=tous" target="_blank" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-all flex items-center gap-2">
                  🔗 Ouvrir dans un nouvel onglet
                </a>
              </div>

              <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4 mb-4">
                <h4 class="text-white font-semibold mb-2">📊 Qu'est-ce que DVF ?</h4>
                <ul class="text-slate-300 text-sm space-y-1">
                  <li>✓ Consultez les prix de vente réels des 5 dernières années</li>
                  <li>✓ Analysez le marché immobilier local par commune</li>
                  <li>✓ Données officielles des notaires et impôts</li>
                  <li>✓ Estimez vos biens avec des données fiables</li>
                </ul>
              </div>

              <div class="rounded-xl overflow-hidden border-2 border-slate-700 bg-white" style="height: 800px;">
                <iframe 
                  src="https://explore.data.gouv.fr/fr/immobilier?onglet=carte&filtre=tous" 
                  class="w-full h-full"
                  frameborder="0"
                  allowfullscreen
                  title="DVF Etalab - Demande de Valeurs Foncières"
                  style="transform: scale(1); transform-origin: 0 0; image-rendering: -webkit-optimize-contrast; image-rendering: crisp-edges;"
                ></iframe>
              </div>

              <div class="mt-4 text-center text-slate-400 text-sm">
                <p>🔒 Service fourni par <a href="https://www.etalab.gouv.fr/" target="_blank" class="text-blue-400 hover:text-blue-300">Etalab</a> - Données publiques officielles</p>
              </div>
            </div>
          ` : ''}
        </div>
      `;
    }

    function renderSyndic() {
      const selectedTab = state.syndicTab || 'signalements';
      
      return `
        <div class="space-y-6">
          <!-- En-tête Espace Syndic -->
          <div class="glass rounded-2xl p-8">
            <div class="flex items-start justify-between">
              <div>
                <h1 class="text-4xl font-bold text-white mb-3" style="font-family: 'Poppins', sans-serif;">
                  🏢 Espace Syndic – Gestion des copropriétés
                </h1>
                <p class="text-slate-300 text-lg" style="font-family: 'Inter', sans-serif;">
                  Centralisez signalements, interventions et communication copropriétaires
                </p>
              </div>
              
              <!-- Boutons principaux -->
              <div class="flex items-center gap-3">
                <button 
                  onclick="setState({showNewSignalement: true})"
                  class="px-6 py-3 rounded-xl bg-gradient-to-r from-yellow-500 to-yellow-600 text-white font-bold hover:scale-105 transition-all shadow-lg hover:shadow-yellow-500/50"
                  style="font-family: 'Poppins', sans-serif;"
                >
                  🟡 + Nouveau signalement
                </button>
                <button 
                  onclick="setState({showNewMessage: true})"
                  class="px-6 py-3 rounded-xl bg-gradient-to-r from-purple-500 to-purple-600 text-white font-bold hover:scale-105 transition-all shadow-lg hover:shadow-purple-500/50"
                  style="font-family: 'Poppins', sans-serif;"
                >
                  🟣 Envoyer un message
                </button>
                <button 
                  onclick="setState({showNewInterventionModal: true})"
                  class="px-6 py-3 rounded-xl bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold hover:scale-105 transition-all shadow-lg hover:shadow-blue-500/50"
                  style="font-family: 'Poppins', sans-serif;"
                >
                  🔵 Planifier intervention
                </button>
              </div>
            </div>
          </div>

          <!-- 4 Onglets internes -->
          <div class="glass rounded-2xl overflow-hidden">
            <!-- Tabs navigation -->
            <div class="flex border-b border-slate-700 overflow-x-auto">
              <button 
                onclick="setState({syndicTab: 'signalements'})"
                class="flex-1 px-6 py-4 font-bold transition-all whitespace-nowrap ${selectedTab === 'signalements' ? 'bg-amber-500/20 text-amber-400 border-b-2 border-amber-400' : 'text-slate-400 hover:text-white hover:bg-slate-700/30'}"
                style="font-family: 'Poppins', sans-serif;"
              >
                📋 SIGNALEMENTS
              </button>
              <button 
                onclick="setState({syndicTab: 'detail-signalement'})"
                class="flex-1 px-6 py-4 font-bold transition-all whitespace-nowrap ${selectedTab === 'detail-signalement' ? 'bg-amber-500/20 text-amber-400 border-b-2 border-amber-400' : 'text-slate-400 hover:text-white hover:bg-slate-700/30'}"
                style="font-family: 'Poppins', sans-serif;"
              >
                📝 DÉTAIL SIGNALEMENT
              </button>
              <button 
                onclick="setState({syndicTab: 'journal'})"
                class="flex-1 px-6 py-4 font-bold transition-all whitespace-nowrap ${selectedTab === 'journal' ? 'bg-amber-500/20 text-amber-400 border-b-2 border-amber-400' : 'text-slate-400 hover:text-white hover:bg-slate-700/30'}"
                style="font-family: 'Poppins', sans-serif;"
              >
                📖 JOURNAL D'ACTIVITÉ
              </button>
              <button 
                onclick="setState({syndicTab: 'interventions'})"
                class="flex-1 px-6 py-4 font-bold transition-all whitespace-nowrap ${selectedTab === 'interventions' ? 'bg-amber-500/20 text-amber-400 border-b-2 border-amber-400' : 'text-slate-400 hover:text-white hover:bg-slate-700/30'}"
                style="font-family: 'Poppins', sans-serif;"
              >
                🔧 INTERVENTIONS
              </button>
              <button 
                onclick="setState({syndicTab: 'communication'})"
                class="flex-1 px-6 py-4 font-bold transition-all whitespace-nowrap ${selectedTab === 'communication' ? 'bg-amber-500/20 text-amber-400 border-b-2 border-amber-400' : 'text-slate-400 hover:text-white hover:bg-slate-700/30'}"
                style="font-family: 'Poppins', sans-serif;"
              >
                📨 COMMUNICATION
              </button>
              <button 
                onclick="setState({syndicTab: 'historique'})"
                class="flex-1 px-6 py-4 font-bold transition-all whitespace-nowrap ${selectedTab === 'historique' ? 'bg-amber-500/20 text-amber-400 border-b-2 border-amber-400' : 'text-slate-400 hover:text-white hover:bg-slate-700/30'}"
                style="font-family: 'Poppins', sans-serif;"
              >
                📜 HISTORIQUE
              </button>
            </div>

            <!-- Tab content -->
            <div class="p-6">
              ${selectedTab === 'signalements' ? renderSyndicSignalements() : ''}
              ${selectedTab === 'detail-signalement' ? renderSyndicDetailSignalement() : ''}
              ${selectedTab === 'journal' ? renderSyndicJournalActivite() : ''}
              ${selectedTab === 'interventions' ? renderSyndicInterventions() : ''}
              ${selectedTab === 'communication' ? renderSyndicCommunication() : ''}
              ${selectedTab === 'historique' ? renderSyndicHistorique() : ''}
            </div>
          </div>
        </div>
      `;
    }

    // A) ONGLET SIGNALEMENTS
    function renderSyndicSignalements() {
      const signalements = state.syndic?.signalements || [];
      
      return `
        <div class="space-y-4">
          <h2 class="text-2xl font-bold text-white mb-4" style="font-family: 'Poppins', sans-serif;">
            Liste des signalements
          </h2>

          <!-- Tableau des signalements -->
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="border-b border-slate-700">
                  <th class="text-left p-4 text-slate-400 font-semibold" style="font-family: 'Inter', sans-serif;">Copropriété</th>
                  <th class="text-left p-4 text-slate-400 font-semibold" style="font-family: 'Inter', sans-serif;">Type</th>
                  <th class="text-left p-4 text-slate-400 font-semibold" style="font-family: 'Inter', sans-serif;">Priorité</th>
                  <th class="text-left p-4 text-slate-400 font-semibold" style="font-family: 'Inter', sans-serif;">Date</th>
                  <th class="text-left p-4 text-slate-400 font-semibold" style="font-family: 'Inter', sans-serif;">Statut</th>
                  <th class="text-left p-4 text-slate-400 font-semibold" style="font-family: 'Inter', sans-serif;">Actions</th>
                </tr>
              </thead>
              <tbody>
                ${signalements.length === 0 ? `
                  <tr>
                    <td colspan="6" class="text-center p-8 text-slate-400">
                      Aucun signalement pour le moment
                    </td>
                  </tr>
                ` : signalements.map(sig => {
                  const copro = state.syndic.coproperties.find(c => c.id === sig.coproId);
                  const priorityColors = {
                    'haute': 'bg-red-500/20 text-red-400',
                    'moyenne': 'bg-yellow-500/20 text-yellow-400',
                    'basse': 'bg-green-500/20 text-green-400'
                  };
                  const statusColors = {
                    'Nouveau': 'bg-blue-500/20 text-blue-400',
                    'Reçu': 'bg-cyan-500/20 text-cyan-400',
                    'En cours': 'bg-purple-500/20 text-purple-400',
                    'Résolu': 'bg-green-500/20 text-green-400'
                  };
                  
                  return `
                    <tr class="border-b border-slate-700/50 hover:bg-slate-700/30 transition-all cursor-pointer" onclick="setState({showSignalementDetail: true, selectedSignalementId: ${sig.id}})">
                      <td class="p-4">
                        <div class="text-white font-medium" style="font-family: 'Inter', sans-serif;">${copro?.name || 'N/A'}</div>
                        <div class="text-sm text-slate-400">${sig.description?.substring(0, 30)}...</div>
                      </td>
                      <td class="p-4">
                        <span class="px-3 py-1 rounded-full bg-slate-700 text-slate-300 text-sm" style="font-family: 'Inter', sans-serif;">
                          ${sig.type}
                        </span>
                      </td>
                      <td class="p-4">
                        <span class="px-3 py-1 rounded-full ${priorityColors[sig.priority]} text-sm font-semibold" style="font-family: 'Inter', sans-serif;">
                          ${sig.priority === 'haute' ? '🔴' : sig.priority === 'moyenne' ? '🟡' : '🟢'} ${sig.priority.toUpperCase()}
                        </span>
                      </td>
                      <td class="p-4 text-slate-300" style="font-family: 'Inter', sans-serif;">
                        ${new Date(sig.date).toLocaleDateString('fr-FR')}
                      </td>
                      <td class="p-4">
                        <span class="px-3 py-1 rounded-full ${statusColors[sig.status]} text-sm font-semibold" style="font-family: 'Inter', sans-serif;">
                          ${sig.status}
                        </span>
                      </td>
                      <td class="p-4">
                        <button class="text-amber-400 hover:text-amber-300 font-medium" style="font-family: 'Inter', sans-serif;">
                          Voir détails →
                        </button>
                      </td>
                    </tr>
                  `;
                }).join('')}
              </tbody>
            </table>
          </div>
        </div>
      `;
    }

    // A2) ONGLET DÉTAIL SIGNALEMENT
    function renderSyndicDetailSignalement() {
      return `
        <div class="space-y-6">
          <h2 class="text-2xl font-bold text-white mb-6" style="font-family: 'Poppins', sans-serif;">
            📝 Détail du Signalement
          </h2>

          <!-- Info Signalement Sélectionné -->
          <div class="glass rounded-xl p-6 bg-gradient-to-r from-purple-500/10 to-blue-500/10 border-purple-500/20">
            <div class="flex items-start justify-between">
              <div>
                <h3 class="text-xl font-bold text-white mb-2">Fuite d'eau - Résidence Les Oliviers</h3>
                <p class="text-slate-300 mb-3">Appartement 12B - Fuite d'eau hall entrée</p>
                <div class="flex items-center gap-3">
                  <span class="px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm font-bold">🔴 HAUTE</span>
                  <span class="px-3 py-1 bg-amber-500/20 text-amber-400 rounded-full text-sm font-bold">En cours</span>
                  <span class="text-slate-400 text-sm">📅 03/02/2026</span>
                </div>
              </div>
              <button class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold transition-all">
                Changer de signalement
              </button>
            </div>
          </div>

          <!-- 4 Actions Principales -->
          <div class="grid md:grid-cols-2 gap-6">
            
            <!-- 1. Demander devis -->
            <div class="glass rounded-xl p-6 hover:border-amber-400/50 transition-all cursor-pointer" onclick="setState({showDemandeDevis: true})">
              <div class="flex items-start gap-4">
                <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-amber-500/20 to-yellow-500/20 flex items-center justify-center text-3xl">
                  📄
                </div>
                <div class="flex-1">
                  <h3 class="text-xl font-bold text-white mb-2" style="font-family: 'Poppins', sans-serif;">
                    Demander un devis
                  </h3>
                  <p class="text-slate-300 text-sm">
                    Solliciter un ou plusieurs artisans pour obtenir un devis détaillé
                  </p>
                </div>
              </div>
            </div>

            <!-- 2. Assigner artisan -->
            <div class="glass rounded-xl p-6 hover:border-blue-400/50 transition-all cursor-pointer" onclick="setState({showAssignArtisan: true})">
              <div class="flex items-start gap-4">
                <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-blue-500/20 to-cyan-500/20 flex items-center justify-center text-3xl">
                  🔧
                </div>
                <div class="flex-1">
                  <h3 class="text-xl font-bold text-white mb-2" style="font-family: 'Poppins', sans-serif;">
                    Assigner un artisan
                  </h3>
                  <p class="text-slate-300 text-sm">
                    Attribuer ce signalement à un artisan ou prestataire de confiance
                  </p>
                </div>
              </div>
            </div>

            <!-- 3. Envoyer message -->
            <div class="glass rounded-xl p-6 hover:border-purple-400/50 transition-all cursor-pointer" onclick="setState({showSendMessage: true})">
              <div class="flex items-start gap-4">
                <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center text-3xl">
                  💬
                </div>
                <div class="flex-1">
                  <h3 class="text-xl font-bold text-white mb-2" style="font-family: 'Poppins', sans-serif;">
                    Envoyer un message
                  </h3>
                  <p class="text-slate-300 text-sm">
                    Informer les copropriétaires, le conseil syndical ou un résident
                  </p>
                </div>
              </div>
            </div>

            <!-- 4. Planifier intervention -->
            <div class="glass rounded-xl p-6 hover:border-green-400/50 transition-all cursor-pointer" onclick="setState({showPlanifierIntervention: true})">
              <div class="flex items-start gap-4">
                <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-green-500/20 to-emerald-500/20 flex items-center justify-center text-3xl">
                  📅
                </div>
                <div class="flex-1">
                  <h3 class="text-xl font-bold text-white mb-2" style="font-family: 'Poppins', sans-serif;">
                    Planifier intervention
                  </h3>
                  <p class="text-slate-300 text-sm">
                    Fixer une date et créer une fiche d'intervention complète
                  </p>
                </div>
              </div>
            </div>

          </div>

          <!-- Informations complémentaires -->
          <div class="glass rounded-xl p-6">
            <h3 class="text-lg font-bold text-white mb-4">📋 Informations du signalement</h3>
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <p class="text-slate-400 text-sm mb-1">Auteur du signalement</p>
                <p class="text-white font-semibold">Marie Dubois (Appt 12B)</p>
              </div>
              <div>
                <p class="text-slate-400 text-sm mb-1">Artisan assigné</p>
                <p class="text-white font-semibold">Plomberie Martin</p>
              </div>
              <div>
                <p class="text-slate-400 text-sm mb-1">Date intervention prévue</p>
                <p class="text-white font-semibold">05/02/2026 à 14h00</p>
              </div>
              <div>
                <p class="text-slate-400 text-sm mb-1">Devis</p>
                <p class="text-white font-semibold">450€ TTC</p>
              </div>
            </div>
          </div>

          <!-- Description complète -->
          <div class="glass rounded-xl p-6">
            <h3 class="text-lg font-bold text-white mb-3">📝 Description</h3>
            <p class="text-slate-300 leading-relaxed">
              Fuite d'eau importante au niveau du hall d'entrée de l'appartement 12B. 
              L'eau s'écoule depuis le plafond, probablement depuis l'appartement du dessus. 
              Intervention urgente nécessaire pour éviter des dégâts supplémentaires.
            </p>
          </div>

          <!-- Photos -->
          <div class="glass rounded-xl p-6">
            <h3 class="text-lg font-bold text-white mb-4">📷 Photos jointes</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              ${[1,2,3].map(i => `
                <div class="aspect-square bg-slate-700 rounded-xl flex items-center justify-center text-slate-500 hover:scale-105 transition-all cursor-pointer">
                  📷 Photo ${i}
                </div>
              `).join('')}
            </div>
          </div>

          <!-- Action rapide : Informer les copropriétaires -->
          <div class="glass rounded-xl p-6 bg-gradient-to-r from-purple-500/10 to-pink-500/10 border-purple-500/20">
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2">
                  📢 Communication
                </h3>
                <p class="text-slate-300 text-sm">
                  Envoyez une mise à jour sur l'avancement de ce signalement à tous les copropriétaires concernés
                </p>
              </div>
              <button 
                onclick="setState({showInformerCopro: true})"
                class="ml-4 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-xl font-bold transition-all shadow-lg hover:scale-105 flex items-center gap-2"
              >
                📢 Informer les copropriétaires
              </button>
            </div>
          </div>

        </div>
      `;
    }

    // A3) ONGLET JOURNAL D'ACTIVITÉ
    function renderSyndicJournalActivite() {
      // Données d'activité avec rôles
      const activities = [
        {
          date: '06/02/2026',
          time: '14:35',
          action: 'Intervention planifiée pour le 10/02',
          actor: 'Sophie Martin',
          role: 'gestionnaire',
          signalement: 'Fuite d\'eau - Appt 12B',
          icon: '📅',
          color: 'blue'
        },
        {
          date: '05/02/2026',
          time: '16:20',
          action: 'Devis reçu - 450€ TTC',
          actor: 'Plomberie Martin',
          role: 'artisan',
          signalement: 'Fuite d\'eau - Appt 12B',
          icon: '📄',
          color: 'green'
        },
        {
          date: '05/02/2026',
          time: '10:15',
          action: 'Commentaire ajouté : "Intervention urgente requise"',
          actor: 'Jean Dupont',
          role: 'conseil',
          signalement: 'Fuite d\'eau - Appt 12B',
          icon: '💬',
          color: 'purple'
        },
        {
          date: '04/02/2026',
          time: '09:45',
          action: 'Devis demandé à Plomberie Martin',
          actor: 'Sophie Martin',
          role: 'gestionnaire',
          signalement: 'Fuite d\'eau - Appt 12B',
          icon: '📨',
          color: 'amber'
        },
        {
          date: '03/02/2026',
          time: '18:30',
          action: 'Signalement créé avec priorité HAUTE',
          actor: 'Marie Dubois',
          role: 'coproprietaire',
          signalement: 'Fuite d\'eau - Appt 12B',
          icon: '🚨',
          color: 'red'
        },
        {
          date: '03/02/2026',
          time: '14:20',
          action: 'Message envoyé à tous les copropriétaires',
          actor: 'Sophie Martin',
          role: 'gestionnaire',
          signalement: 'Travaux façade',
          icon: '📧',
          color: 'blue'
        },
        {
          date: '02/02/2026',
          time: '11:00',
          action: 'Intervention complétée',
          actor: 'Électricité Dupont',
          role: 'artisan',
          signalement: 'Panne ascenseur',
          icon: '✅',
          color: 'green'
        },
        {
          date: '01/02/2026',
          time: '16:45',
          action: 'Validation du budget annuel',
          actor: 'Jean Dupont',
          role: 'conseil',
          signalement: 'Budget 2026',
          icon: '💰',
          color: 'purple'
        }
      ];

      // Fonction pour obtenir le badge de rôle
      const getRoleBadge = (role) => {
        const roles = {
          'gestionnaire': { label: 'Gestionnaire', color: 'bg-blue-500/20 text-blue-400 border-blue-500/30', icon: '👔' },
          'conseil': { label: 'Conseil syndical', color: 'bg-purple-500/20 text-purple-400 border-purple-500/30', icon: '🏛️' },
          'artisan': { label: 'Artisan', color: 'bg-amber-500/20 text-amber-400 border-amber-500/30', icon: '🔧' },
          'coproprietaire': { label: 'Copropriétaire', color: 'bg-green-500/20 text-green-400 border-green-500/30', icon: '🏠' }
        };
        return roles[role] || roles['coproprietaire'];
      };

      return `
        <div class="space-y-6">
          <div class="flex items-center justify-between">
            <h2 class="text-2xl font-bold text-white" style="font-family: 'Poppins', sans-serif;">
              📖 Journal d'activité
            </h2>
            <button class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold transition-all flex items-center gap-2">
              📥 Exporter PDF
            </button>
          </div>

          <!-- Filtres -->
          <div class="glass rounded-xl p-4">
            <div class="grid md:grid-cols-4 gap-3">
              <select class="px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-amber-400">
                <option>Tous les signalements</option>
                <option>Fuite d'eau - Appt 12B</option>
                <option>Travaux façade</option>
                <option>Panne ascenseur</option>
              </select>
              <select class="px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-amber-400">
                <option>Tous les rôles</option>
                <option>👔 Gestionnaire</option>
                <option>🏛️ Conseil syndical</option>
                <option>🔧 Artisan</option>
                <option>🏠 Copropriétaire</option>
              </select>
              <select class="px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-amber-400">
                <option>Toutes les actions</option>
                <option>Signalements</option>
                <option>Devis</option>
                <option>Interventions</option>
                <option>Messages</option>
              </select>
              <input type="date" class="px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-amber-400" />
            </div>
          </div>

          <!-- Timeline -->
          <div class="space-y-4">
            ${activities.map((activity, index) => {
              const roleBadge = getRoleBadge(activity.role);
              return `
                <div class="glass rounded-xl p-5 hover:border-${activity.color}-400/50 transition-all" style="animation: slideInUp 0.4s ease-out ${index * 0.05}s both;">
                  <div class="flex gap-4">
                    <!-- Icône et ligne temporelle -->
                    <div class="flex flex-col items-center">
                      <div class="w-12 h-12 rounded-full bg-${activity.color}-500/20 border-2 border-${activity.color}-500/50 flex items-center justify-center text-2xl flex-shrink-0">
                        ${activity.icon}
                      </div>
                      ${index < activities.length - 1 ? `
                        <div class="w-0.5 flex-1 bg-slate-700 mt-2"></div>
                      ` : ''}
                    </div>

                    <!-- Contenu -->
                    <div class="flex-1 pb-4">
                      <!-- Date et heure -->
                      <div class="flex items-center gap-3 mb-2">
                        <span class="text-slate-400 text-sm font-semibold">${activity.date}</span>
                        <span class="text-slate-500 text-xs">${activity.time}</span>
                      </div>

                      <!-- Action -->
                      <h3 class="text-white font-bold text-lg mb-2">${activity.action}</h3>

                      <!-- Acteur avec badge de rôle -->
                      <div class="flex items-center gap-2 mb-2">
                        <span class="text-slate-400 text-sm">Par</span>
                        <span class="text-white font-semibold text-sm">${activity.actor}</span>
                        <span class="px-3 py-1 ${roleBadge.color} border rounded-full text-xs font-semibold flex items-center gap-1">
                          ${roleBadge.icon} ${roleBadge.label}
                        </span>
                      </div>

                      <!-- Signalement concerné -->
                      <div class="flex items-center gap-2 mt-3">
                        <span class="text-slate-500 text-xs">Concerne :</span>
                        <span class="px-3 py-1 bg-slate-700 text-slate-300 rounded-lg text-xs font-semibold">
                          ${activity.signalement}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>

          <!-- Pagination -->
          <div class="flex items-center justify-between mt-6">
            <p class="text-slate-400 text-sm">
              Affichage de ${activities.length} activités sur ${activities.length}
            </p>
            <div class="flex gap-2">
              <button class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold transition-all">
                ← Précédent
              </button>
              <button class="px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg font-semibold transition-all">
                Suivant →
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // B) ONGLET INTERVENTIONS
    function renderSyndicInterventions() {
      const interventions = state.syndic?.interventions || [];
      
      return `
        <div class="space-y-4">
          <h2 class="text-2xl font-bold text-white mb-4" style="font-family: 'Poppins', sans-serif;">
            Planning des interventions
          </h2>

          <!-- Grille de cartes -->
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
            ${interventions.length === 0 ? `
              <div class="col-span-full text-center p-8 glass rounded-xl">
                <p class="text-slate-400">Aucune intervention planifiée</p>
              </div>
            ` : interventions.map(inter => {
              const copro = state.syndic.coproperties.find(c => c.id === inter.coproId);
              const statusColors = {
                'pending': 'bg-yellow-500/20 text-yellow-400 border-yellow-500/50',
                'completed': 'bg-green-500/20 text-green-400 border-green-500/50',
                'cancelled': 'bg-red-500/20 text-red-400 border-red-500/50'
              };
              
              return `
                <div class="glass rounded-xl p-6 hover:scale-105 transition-all border-2 ${statusColors[inter.status]}">
                  <!-- En-tête -->
                  <div class="flex items-start justify-between mb-4">
                    <div>
                      <h3 class="text-lg font-bold text-white mb-1" style="font-family: 'Poppins', sans-serif;">
                        ${inter.type}
                      </h3>
                      <p class="text-sm text-slate-400" style="font-family: 'Inter', sans-serif;">
                        ${copro?.name || 'N/A'}
                      </p>
                    </div>
                    <span class="px-3 py-1 rounded-full ${statusColors[inter.status]} text-xs font-semibold">
                      ${inter.status === 'pending' ? '🟡 En attente' : inter.status === 'completed' ? '✅ Terminé' : '❌ Annulé'}
                    </span>
                  </div>

                  <!-- Détails -->
                  <div class="space-y-2 mb-4">
                    <div class="flex items-center gap-2 text-sm text-slate-300">
                      <span>📅</span>
                      <span style="font-family: 'Inter', sans-serif;">${new Date(inter.date).toLocaleDateString('fr-FR')}</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm text-slate-300">
                      <span>📍</span>
                      <span style="font-family: 'Inter', sans-serif;">${inter.description}</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm text-slate-300">
                      <span>💰</span>
                      <span class="font-semibold text-amber-400" style="font-family: 'Inter', sans-serif;">${inter.cost}€</span>
                    </div>
                  </div>

                  <!-- Actions -->
                  <div class="flex gap-2">
                    <button class="flex-1 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm font-medium transition-all">
                      Modifier
                    </button>
                    <button class="px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg text-sm font-medium transition-all">
                      📄
                    </button>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;
    }

    // C) ONGLET COMMUNICATION
    function renderSyndicCommunication() {
      const messages = state.syndic?.messages || [];
      const coproperties = state.syndic?.coproperties || [];
      
      return `
        <div class="space-y-6">
          <h2 class="text-2xl font-bold text-white mb-4" style="font-family: 'Poppins', sans-serif;">
            Communication copropriétaires
          </h2>

          <!-- Section Envoyer un message -->
          <div class="glass rounded-xl p-6">
            <h3 class="text-xl font-bold text-white mb-4" style="font-family: 'Poppins', sans-serif;">
              📨 Envoyer un message
            </h3>
            
            <div class="space-y-4">
              <!-- Sélection Copropriété -->
              <div>
                <label class="block text-slate-300 font-medium mb-2" style="font-family: 'Inter', sans-serif;">
                  🏢 Copropriété * <span class="text-slate-500 text-sm">(sélectionnez la résidence concernée)</span>
                </label>
                <select 
                  onchange="setState({selectedCoproCommunication: parseInt(event.target.value)})"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
                >
                  <option value="">⚠️ Sélectionner une copropriété</option>
                  ${coproperties.map(copro => `
                    <option value="${copro.id}" ${state.selectedCoproCommunication === copro.id ? 'selected' : ''}>
                      🏢 ${copro.name} - ${copro.residents || 0} résidents actifs
                    </option>
                  `).join('')}
                </select>
                ${state.selectedCoproCommunication ? `
                  <div class="mt-2 p-3 bg-purple-500/10 border border-purple-500/30 rounded-lg">
                    <p class="text-sm text-purple-300">
                      ✓ Copropriété sélectionnée : <strong>${coproperties.find(c => c.id === state.selectedCoproCommunication)?.name}</strong>
                    </p>
                    <p class="text-xs text-purple-400 mt-1">
                      👥 ${coproperties.find(c => c.id === state.selectedCoproCommunication)?.residents || 0} résidents recevront ce message
                    </p>
                  </div>
                ` : ''}
              </div>

              <!-- Destinataires -->
              <div>
                <label class="block text-slate-300 font-medium mb-2" style="font-family: 'Inter', sans-serif;">
                  Destinataires
                </label>
                <div class="grid grid-cols-3 gap-3">
                  <button 
                    onclick="setState({communicationRecipients: 'all'})"
                    class="p-4 rounded-xl ${state.communicationRecipients === 'all' ? 'bg-purple-500 text-white border-2 border-purple-400' : 'bg-slate-700 text-white border-2 border-transparent'} hover:bg-slate-600 transition-all hover:border-amber-400"
                  >
                    <div class="text-2xl mb-2">👥</div>
                    <div class="font-medium text-sm">Tous les copropriétaires</div>
                  </button>
                  <button 
                    onclick="setState({communicationRecipients: 'conseil'})"
                    class="p-4 rounded-xl ${state.communicationRecipients === 'conseil' ? 'bg-purple-500 text-white border-2 border-purple-400' : 'bg-slate-700 text-white border-2 border-transparent'} hover:bg-slate-600 transition-all hover:border-amber-400"
                  >
                    <div class="text-2xl mb-2">🏛️</div>
                    <div class="font-medium text-sm">Conseil syndical</div>
                  </button>
                  <button 
                    onclick="setState({communicationRecipients: 'specific'})"
                    class="p-4 rounded-xl ${state.communicationRecipients === 'specific' ? 'bg-purple-500 text-white border-2 border-purple-400' : 'bg-slate-700 text-white border-2 border-transparent'} hover:bg-slate-600 transition-all hover:border-amber-400"
                  >
                    <div class="text-2xl mb-2">🏠</div>
                    <div class="font-medium text-sm">Lot précis</div>
                  </button>
                </div>
              </div>

              <!-- Objet du message -->
              <div>
                <label class="block text-slate-300 font-medium mb-2" style="font-family: 'Inter', sans-serif;">
                  Objet *
                </label>
                <input
                  type="text"
                  placeholder="Ex: Travaux de réfection de la toiture"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
                />
              </div>

              <!-- Message -->
              <div>
                <label class="block text-slate-300 font-medium mb-2" style="font-family: 'Inter', sans-serif;">
                  Message *
                </label>
                <textarea
                  placeholder="Rédigez votre message..."
                  rows="6"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-400 resize-none"
                ></textarea>
              </div>

              <!-- Pièces jointes -->
              <div>
                <label class="block text-slate-300 font-medium mb-2" style="font-family: 'Inter', sans-serif;">
                  📎 Pièces jointes <span class="text-slate-500 text-sm">(optionnel - max 5 fichiers)</span>
                </label>
                <input type="file" multiple class="hidden" id="communication-attachments" onchange="displaySelectedFiles(event)" />
                <label 
                  for="communication-attachments" 
                  class="flex items-center justify-center gap-3 w-full px-4 py-4 bg-slate-800 border-2 border-dashed border-slate-600 rounded-xl cursor-pointer hover:border-purple-400 hover:bg-slate-700 transition-all group"
                >
                  <svg class="w-6 h-6 text-slate-400 group-hover:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>
                  </svg>
                  <span class="text-slate-400 group-hover:text-purple-400 font-medium">Cliquez pour ajouter des fichiers</span>
                </label>
                <p class="text-xs text-slate-500 mt-2">
                  ✓ Formats acceptés : PDF, JPEG, PNG, DOCX • Max 10 Mo par fichier • Jusqu'à 5 fichiers
                </p>
                
                <!-- Zone d'affichage des fichiers sélectionnés -->
                <div id="selected-files-preview" class="mt-3 space-y-2 hidden">
                  <p class="text-sm text-white font-semibold mb-2">📎 Fichiers sélectionnés :</p>
                  <!-- Les fichiers apparaîtront ici dynamiquement -->
                </div>
                
                <!-- Exemple de fichiers pour la démo -->
                <div class="mt-3 space-y-2">
                  <div class="flex items-center justify-between p-3 bg-slate-700/50 rounded-lg border border-slate-600">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 bg-red-500/20 rounded-lg flex items-center justify-center">
                        <span class="text-red-400 font-bold text-xs">PDF</span>
                      </div>
                      <div>
                        <p class="text-white text-sm font-semibold">Règlement_copropriété.pdf</p>
                        <p class="text-slate-400 text-xs">2.4 Mo</p>
                      </div>
                    </div>
                    <button class="text-red-400 hover:text-red-300 p-2">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                      </svg>
                    </button>
                  </div>
                  <div class="flex items-center justify-between p-3 bg-slate-700/50 rounded-lg border border-slate-600">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
                        <span class="text-blue-400 font-bold text-xs">IMG</span>
                      </div>
                      <div>
                        <p class="text-white text-sm font-semibold">Photo_travaux.jpg</p>
                        <p class="text-slate-400 text-xs">1.8 Mo</p>
                      </div>
                    </div>
                    <button class="text-red-400 hover:text-red-300 p-2">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Modèles prêts -->
              <div>
                <label class="block text-slate-300 font-medium mb-2" style="font-family: 'Inter', sans-serif;">
                  📋 Modèles prêts
                </label>
                <div class="grid grid-cols-2 gap-3">
                  ${[
                    {icon: '⏰', title: 'Retard travaux', desc: 'Informer d\'un report'},
                    {icon: '✅', title: 'Devis accepté', desc: 'Validation effectuée'},
                    {icon: '💧', title: 'Coupure d\'eau', desc: 'Maintenance programmée'},
                    {icon: '📅', title: 'Rappel AG', desc: 'Assemblée générale'}
                  ].map(model => `
                    <button class="p-4 rounded-xl bg-slate-700 hover:bg-slate-600 text-left transition-all border-2 border-transparent hover:border-amber-400">
                      <div class="flex items-center gap-3 mb-2">
                        <span class="text-2xl">${model.icon}</span>
                        <span class="text-white font-semibold">${model.title}</span>
                      </div>
                      <p class="text-sm text-slate-400">${model.desc}</p>
                    </button>
                  `).join('')}
                </div>
              </div>

              <button class="w-full px-6 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white font-bold rounded-xl hover:scale-105 transition-all shadow-lg">
                📨 Envoyer le message
              </button>
            </div>
          </div>

          <!-- Historique messages -->
          <div class="glass rounded-xl p-6">
            <h3 class="text-xl font-bold text-white mb-4" style="font-family: 'Poppins', sans-serif;">
              📜 Historique des messages
            </h3>
            
            <div class="space-y-3">
              ${messages.length === 0 ? `
                <p class="text-center text-slate-400 py-8">Aucun message envoyé</p>
              ` : messages.map(msg => {
                const readPercentage = Math.round((msg.readBy / msg.recipients) * 100);
                const copro = coproperties.find(c => c.id === msg.coproId);
                
                return `
                <div class="p-5 bg-slate-700/50 rounded-xl hover:bg-slate-700 transition-all border border-slate-600">
                  <div class="flex items-start justify-between mb-3">
                    <div class="flex-1">
                      <div class="flex items-center gap-2 mb-1">
                        <h4 class="font-bold text-white text-lg">${msg.subject}</h4>
                        ${msg.hasAttachments ? '<span class="text-amber-400 text-sm">📎</span>' : ''}
                      </div>
                      <p class="text-xs text-slate-400 mb-2">🏢 ${copro?.name || 'Copropriété'}</p>
                    </div>
                    <span class="text-xs text-slate-400">${new Date(msg.date).toLocaleDateString('fr-FR')}</span>
                  </div>
                  
                  <p class="text-sm text-slate-300 mb-3">${msg.content.substring(0, 150)}...</p>
                  
                  <!-- Indicateur de lecture -->
                  <div class="space-y-2">
                    <div class="flex items-center justify-between text-xs">
                      <span class="text-slate-400">
                        👥 ${msg.recipients} destinataires
                      </span>
                      <span class="${readPercentage >= 80 ? 'text-green-400' : readPercentage >= 50 ? 'text-amber-400' : 'text-red-400'} font-bold text-sm">
                        ✓ ${msg.readBy} / ${msg.recipients} lus (${readPercentage}%)
                      </span>
                    </div>
                    
                    <!-- Barre de progression de lecture -->
                    <div class="w-full bg-slate-800 rounded-full h-3 overflow-hidden border border-slate-700">
                      <div 
                        class="h-full ${readPercentage >= 80 ? 'bg-gradient-to-r from-green-500 to-green-400' : readPercentage >= 50 ? 'bg-gradient-to-r from-amber-500 to-amber-400' : 'bg-gradient-to-r from-red-500 to-red-400'} transition-all duration-500 flex items-center justify-end pr-2"
                        style="width: ${readPercentage}%"
                      >
                        <span class="text-white text-xs font-bold">${readPercentage}%</span>
                      </div>
                    </div>
                    
                    <!-- Statut de lecture visuel -->
                    <div class="flex items-center gap-2 text-xs">
                      ${readPercentage >= 80 ? `
                        <span class="px-2 py-1 bg-green-500/20 text-green-400 rounded-full font-semibold">
                          ✅ Excellente visibilité
                        </span>
                      ` : readPercentage >= 50 ? `
                        <span class="px-2 py-1 bg-amber-500/20 text-amber-400 rounded-full font-semibold">
                          ⚠️ Visibilité moyenne
                        </span>
                      ` : `
                        <span class="px-2 py-1 bg-red-500/20 text-red-400 rounded-full font-semibold">
                          ❌ Faible visibilité
                        </span>
                      `}
                    </div>
                    
                    <!-- Détails des non-lecteurs si faible taux -->
                    ${readPercentage < 70 ? `
                      <button 
                        onclick="showNonReaders(${msg.id})" 
                        class="text-xs text-amber-400 hover:text-amber-300 font-medium flex items-center gap-2 mt-2 px-3 py-2 bg-amber-500/10 rounded-lg hover:bg-amber-500/20 transition-all"
                      >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                        Voir qui n'a pas encore lu (${msg.recipients - msg.readBy} personnes)
                      </button>
                    ` : ''}
                  </div>
                </div>
              `}).join('')}
            </div>
          </div>
        </div>
      `;
    }

    // D) ONGLET HISTORIQUE
    function renderSyndicHistorique() {
      const signalements = state.syndic?.signalements || [];
      
      return `
        <div class="space-y-4">
          <h2 class="text-2xl font-bold text-white mb-4" style="font-family: 'Poppins', sans-serif;">
            Historique et traçabilité
          </h2>

          <div class="space-y-4">
            ${signalements.length === 0 ? `
              <div class="text-center p-8 glass rounded-xl">
                <p class="text-slate-400">Aucun historique disponible</p>
              </div>
            ` : signalements.map(sig => {
              const copro = state.syndic.coproperties.find(c => c.id === sig.coproId);
              
              return `
                <div class="glass rounded-xl p-6">
                  <div class="flex items-start gap-4">
                    <div class="w-1 bg-amber-400 rounded-full"></div>
                    <div class="flex-1">
                      <div class="flex items-start justify-between mb-3">
                        <div>
                          <h3 class="text-lg font-bold text-white mb-1">${sig.type} - ${copro?.name}</h3>
                          <p class="text-sm text-slate-400">${sig.description}</p>
                        </div>
                        <span class="text-xs text-slate-500">${new Date(sig.date).toLocaleDateString('fr-FR')}</span>
                      </div>

                      <!-- Timeline -->
                      <div class="space-y-3 pl-4 border-l-2 border-slate-700">
                        ${(sig.timeline || []).map((event, idx) => `
                          <div class="relative">
                            <div class="absolute -left-[21px] w-3 h-3 rounded-full bg-amber-400"></div>
                            <div class="ml-2">
                              <div class="text-sm font-medium text-white">${event.action}</div>
                              <div class="text-xs text-slate-400">${event.user} • ${new Date(event.date).toLocaleString('fr-FR')}</div>
                            </div>
                          </div>
                        `).join('')}
                      </div>

                      ${sig.comments && sig.comments.length > 0 ? `
                        <div class="mt-4 pt-4 border-t border-slate-700">
                          <div class="text-sm font-semibold text-slate-300 mb-2">💬 Commentaires</div>
                          ${sig.comments.map(comment => `
                            <div class="text-sm text-slate-400 mb-1">
                              <span class="text-amber-400">${comment.author}:</span> ${comment.text}
                            </div>
                          `).join('')}
                        </div>
                      ` : ''}
                    </div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;
    }



    function renderSettings() {
      return `
        <div class="space-y-6">
          <!-- Settings Header -->
          <div class="glass rounded-2xl p-6 bg-gradient-to-r from-slate-700/50 to-slate-800/50">
            <div class="flex items-center gap-4">
              <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-slate-600 to-slate-700 flex items-center justify-center text-white">
                <div class="w-8 h-8">${icons.settings}</div>
              </div>
              <div>
                <h2 class="text-2xl font-bold text-white mb-1">Paramètres du compte</h2>
                <p class="text-slate-300">Gérez vos informations personnelles et préférences</p>
              </div>
            </div>
          </div>

          <!-- Profile Settings -->
          <div class="glass rounded-2xl p-6">
            <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-3">
              <div class="w-5 h-5">${icons.user}</div>
              Informations personnelles
            </h3>
            <div class="space-y-4">
              <div class="grid md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Nom complet</label>
                  <input
                    type="text"
                    value="${state.currentUser.name}"
                    class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  />
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Email</label>
                  <input
                    type="email"
                    value="${state.currentUser.email}"
                    class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  />
                </div>
              </div>
              <div>
                <label class="block text-slate-400 text-sm mb-2">Téléphone</label>
                <input
                  type="tel"
                  placeholder="+33 6 12 34 56 78"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                />
              </div>
              <div class="pt-4">
                <button class="btn-primary px-6 py-3 rounded-xl text-white font-semibold">
                  Enregistrer les modifications
                </button>
              </div>
            </div>
          </div>

          <!-- Password Change -->
          <div class="glass rounded-2xl p-6">
            <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-3">
              🔒 Sécurité
            </h3>
            <div class="space-y-4">
              <div>
                <label class="block text-slate-400 text-sm mb-2">Mot de passe actuel</label>
                <input
                  type="password"
                  placeholder="••••••••"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                />
              </div>
              <div class="grid md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Nouveau mot de passe</label>
                  <input
                    type="password"
                    placeholder="••••••••"
                    class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  />
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Confirmer le mot de passe</label>
                  <input
                    type="password"
                    placeholder="••••••••"
                    class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  />
                </div>
              </div>
              <div class="pt-4">
                <button class="bg-slate-700 hover:bg-slate-600 px-6 py-3 rounded-xl text-white font-semibold transition-all">
                  Changer le mot de passe
                </button>
              </div>
            </div>
          </div>

          <!-- Notifications -->
          <div class="glass rounded-2xl p-6">
            <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-3">
              🔔 Notifications
            </h3>
            <div class="space-y-4">
              <div class="flex items-center justify-between p-4 bg-slate-800/50 rounded-xl">
                <div>
                  <div class="text-white font-semibold">Notifications par email</div>
                  <div class="text-slate-400 text-sm">Recevoir les alertes importantes par email</div>
                </div>
                <label class="relative inline-block w-14 h-8">
                  <input type="checkbox" checked class="opacity-0 w-0 h-0 peer">
                  <span class="absolute cursor-pointer inset-0 bg-slate-700 rounded-full transition-all peer-checked:bg-amber-400"></span>
                  <span class="absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-all peer-checked:translate-x-6"></span>
                </label>
              </div>
              <div class="flex items-center justify-between p-4 bg-slate-800/50 rounded-xl">
                <div>
                  <div class="text-white font-semibold">Nouvelles visites</div>
                  <div class="text-slate-400 text-sm">Être notifié des nouvelles demandes de visite</div>
                </div>
                <label class="relative inline-block w-14 h-8">
                  <input type="checkbox" checked class="opacity-0 w-0 h-0 peer">
                  <span class="absolute cursor-pointer inset-0 bg-slate-700 rounded-full transition-all peer-checked:bg-amber-400"></span>
                  <span class="absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-all peer-checked:translate-x-6"></span>
                </label>
              </div>
              <div class="flex items-center justify-between p-4 bg-slate-800/50 rounded-xl">
                <div>
                  <div class="text-white font-semibold">Nouveaux clients</div>
                  <div class="text-slate-400 text-sm">Alertes pour les nouveaux prospects</div>
                </div>
                <label class="relative inline-block w-14 h-8">
                  <input type="checkbox" class="opacity-0 w-0 h-0 peer">
                  <span class="absolute cursor-pointer inset-0 bg-slate-700 rounded-full transition-all peer-checked:bg-amber-400"></span>
                  <span class="absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-all peer-checked:translate-x-6"></span>
                </label>
              </div>
            </div>
          </div>

          <!-- Personnalisation de l'interface -->
          <div class="glass rounded-2xl p-6">
            <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-3">
              🎨 Personnalisation de l'interface
            </h3>
            
            <div class="space-y-6">
              <!-- Thème de couleur -->
              <div>
                <label class="block text-white font-semibold mb-4">Couleur du fond animé</label>
                <div class="grid grid-cols-3 md:grid-cols-6 gap-3">
                  ${[
                    {
                      id: 'purple-pink',
                      name: 'Violet Rosé',
                      gradient: 'linear-gradient(135deg, #7c3aed 0%, #c026d3 100%)',
                      icon: '🟣'
                    },
                    {
                      id: 'cyan-blue',
                      name: 'Cyan Bleuté',
                      gradient: 'linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%)',
                      icon: '🔵'
                    },
                    {
                      id: 'blue-purple',
                      name: 'Bleu Lavande',
                      gradient: 'linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%)',
                      icon: '💙'
                    },
                    {
                      id: 'peach-pink',
                      name: 'Pêche Rosé',
                      gradient: 'linear-gradient(135deg, #fb923c 0%, #f472b6 100%)',
                      icon: '🍑'
                    },
                    {
                      id: 'lavender-rose',
                      name: 'Lavande Rose',
                      gradient: 'linear-gradient(135deg, #f59e0b 0%, #ec4899 100%)',
                      icon: '🌸'
                    },
                    {
                      id: 'purple-ocean',
                      name: 'Océan Violet',
                      gradient: 'linear-gradient(135deg, #22d3ee 0%, #a78bfa 100%)',
                      icon: '🌊'
                    }
                  ].map(theme => `
                    <div 
                      onclick="setBackgroundTheme('${theme.id}')"
                      class="relative cursor-pointer group"
                    >
                      <div class="aspect-square rounded-xl overflow-hidden border-3 ${state.customization?.backgroundTheme === theme.id ? 'border-amber-400 shadow-lg shadow-amber-400/50 ring-2 ring-amber-400/30' : 'border-slate-600 hover:border-slate-400 hover:scale-105'} transition-all">
                        <div style="background: ${theme.gradient}" class="w-full h-full"></div>
                      </div>
                      <div class="mt-1.5 text-center">
                        <div class="text-white font-semibold text-xs flex items-center justify-center gap-0.5">
                          <span class="text-sm">${theme.icon}</span>
                        </div>
                        ${state.customization?.backgroundTheme === theme.id ? `
                          <div class="text-amber-400 text-xs font-bold mt-0.5">✓</div>
                        ` : ''}
                      </div>
                    </div>
                  `).join('')}
                </div>
                <p class="text-slate-400 text-xs mt-3 flex items-center gap-2">
                  ✨ La couleur du fond animé change en temps réel sur toutes les pages
                </p>
              </div>
            </div>
          </div>

          <!-- Configuration Email Professionnelle -->
          <div class="glass rounded-2xl p-6">
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
                  📧
                </div>
                <div>
                  <h3 class="text-xl font-bold text-white">Configuration Email Professionnelle</h3>
                  <p class="text-slate-400 text-sm">Connectez votre boîte email pour gérer vos messages</p>
                </div>
              </div>
              ${state.emailConfig.isConfigured ? `
                <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm font-semibold">
                  ✓ Configuré
                </span>
              ` : `
                <span class="px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full text-sm font-semibold">
                  ⚠ Non configuré
                </span>
              `}
            </div>

            ${!state.emailConfig.isConfigured ? `
              <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4 mb-6">
                <h4 class="text-white font-semibold mb-2">📮 Pourquoi configurer votre email ?</h4>
                <ul class="text-slate-300 text-sm space-y-1">
                  <li>✓ Gérez tous vos emails directement dans l'app</li>
                  <li>✓ Répondez aux demandes clients instantanément</li>
                  <li>✓ Envoyez des biens et documents par email</li>
                  <li>✓ Gardez tout centralisé au même endroit</li>
                </ul>
              </div>
            ` : ''}

            <div class="space-y-4">
              <!-- Provider Selection -->
              <div>
                <label class="block text-slate-400 text-sm mb-2">Fournisseur d\'email</label>
                <select
                  onchange="setState({emailConfig: {...state.emailConfig, provider: event.target.value}})"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                >
                  <option value="">Sélectionnez un fournisseur</option>
                  <option value="gmail" ${state.emailConfig.provider === 'gmail' ? 'selected' : ''}>Gmail / Google Workspace</option>
                  <option value="outlook" ${state.emailConfig.provider === 'outlook' ? 'selected' : ''}>Outlook / Microsoft 365</option>
                  <option value="custom" ${state.emailConfig.provider === 'custom' ? 'selected' : ''}>Autre (Configuration manuelle)</option>
                </select>
              </div>

              <!-- Email Address -->
              <div>
                <label class="block text-slate-400 text-sm mb-2">Adresse email professionnelle</label>
                <input
                  type="email"
                  value="${state.emailConfig.email}"
                  oninput="setState({emailConfig: {...state.emailConfig, email: event.target.value}})"
                  placeholder="contact@votre-agence.com"
                  class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                />
              </div>

              ${state.emailConfig.provider === 'custom' ? `
                <!-- Custom IMAP/SMTP Settings -->
                <div class="grid md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-slate-400 text-sm mb-2">Serveur IMAP</label>
                    <input
                      type="text"
                      value="${state.emailConfig.imapHost}"
                      oninput="setState({emailConfig: {...state.emailConfig, imapHost: event.target.value}})"
                      placeholder="imap.exemple.com"
                      class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    />
                  </div>
                  <div>
                    <label class="block text-slate-400 text-sm mb-2">Port IMAP</label>
                    <input
                      type="number"
                      value="${state.emailConfig.imapPort}"
                      oninput="setState({emailConfig: {...state.emailConfig, imapPort: parseInt(event.target.value)}})"
                      placeholder="993"
                      class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    />
                  </div>
                  <div>
                    <label class="block text-slate-400 text-sm mb-2">Serveur SMTP</label>
                    <input
                      type="text"
                      value="${state.emailConfig.smtpHost}"
                      oninput="setState({emailConfig: {...state.emailConfig, smtpHost: event.target.value}})"
                      placeholder="smtp.exemple.com"
                      class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    />
                  </div>
                  <div>
                    <label class="block text-slate-400 text-sm mb-2">Port SMTP</label>
                    <input
                      type="number"
                      value="${state.emailConfig.smtpPort}"
                      oninput="setState({emailConfig: {...state.emailConfig, smtpPort: parseInt(event.target.value)}})"
                      placeholder="587"
                      class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    />
                  </div>
                </div>
              ` : state.emailConfig.provider ? `
                <div class="bg-slate-800/50 rounded-xl p-4">
                  <p class="text-slate-300 text-sm">
                    <strong class="text-white">${state.emailConfig.provider === 'gmail' ? 'Gmail' : 'Outlook'}</strong> détecté automatiquement.
                    Les paramètres IMAP/SMTP seront configurés automatiquement.
                  </p>
                </div>
              ` : ''}

              <!-- Password -->
              ${state.emailConfig.provider ? `
                <div>
                  <label class="block text-slate-400 text-sm mb-2">
                    ${state.emailConfig.provider === 'gmail' ? 'Mot de passe d\'application Gmail' : 'Mot de passe'}
                  </label>
                  <input
                    type="password"
                    value="${state.emailConfig.password}"
                    oninput="setState({emailConfig: {...state.emailConfig, password: event.target.value}})"
                    placeholder="••••••••••••••••"
                    class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  />
                  ${state.emailConfig.provider === 'gmail' ? `
                    <p class="text-xs text-slate-400 mt-2">
                      💡 <a href="https://myaccount.google.com/apppasswords" target="_blank" class="text-blue-400 hover:underline">Créer un mot de passe d\'application Gmail</a>
                    </p>
                  ` : ''}
                </div>
              ` : ''}

              <!-- Action Buttons -->
              ${state.emailConfig.provider && state.emailConfig.email ? `
                <div class="flex gap-3 pt-4">
                  ${state.emailConfig.isConfigured ? `
                    <button onclick="setState({emailConfig: {...state.emailConfig, isConfigured: false}, showEmailInbox: false})" class="px-6 py-3 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-xl font-semibold transition-all">
                      Déconnecter
                    </button>
                    <button onclick="setState({showEmailInbox: true, currentPage: 'inbox'})" class="flex-1 btn-primary px-6 py-3 rounded-xl font-semibold">
                      📧 Ouvrir ma boîte email
                    </button>
                  ` : `
                    <button onclick="setState({emailConfig: {...state.emailConfig, isConfigured: true}}); alert('✅ Email configuré avec succès !\\n\\nVous pouvez maintenant accéder à votre boîte de réception.');" class="flex-1 btn-primary px-6 py-3 rounded-xl font-semibold">
                      💾 Enregistrer et connecter
                    </button>
                  `}
                </div>
              ` : ''}
            </div>
          </div>

          <!-- Interface & Background Customization -->
          <div class="glass rounded-2xl p-6">
            <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-3">
              🎨 Personnalisation de l'interface
            </h3>
            
            <div class="space-y-6">
              <!-- Background Color Scheme -->
              <div>
                <label class="block text-slate-400 text-sm mb-3">Couleur du fond animé</label>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                  ${['amber', 'blue', 'purple', 'green', 'cyan', 'rose'].map(scheme => {
                    const colors = {
                      amber: { bg: 'from-amber-500 to-amber-600', label: '🟡 Or/Ambre' },
                      blue: { bg: 'from-blue-500 to-blue-600', label: '🔵 Bleu' },
                      purple: { bg: 'from-purple-500 to-purple-600', label: '🟣 Violet' },
                      green: { bg: 'from-green-500 to-green-600', label: '🟢 Vert' },
                      cyan: { bg: 'from-cyan-500 to-cyan-600', label: '🔷 Cyan' },
                      rose: { bg: 'from-rose-500 to-rose-600', label: '🌸 Rose' }
                    };
                    const color = colors[scheme];
                    const isActive = state.customization.backgroundScheme === scheme;
                    
                    return `
                      <button
                        onclick="setState({customization: {...state.customization, backgroundScheme: '${scheme}'}})"
                        class='flex items-center gap-3 p-4 rounded-xl transition-all ${
                          isActive 
                            ? "bg-slate-700 border-2 border-amber-400 ring-2 ring-amber-400/30" 
                            : "bg-slate-800 border-2 border-slate-700 hover:border-slate-600"
                        }'
                      >
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br ${color.bg} flex-shrink-0"></div>
                        <div class="text-left">
                          <div class="text-white font-semibold text-sm">${color.label}</div>
                          ${isActive ? '<div class="text-amber-400 text-xs">✓ Actif</div>' : ''}
                        </div>
                      </button>
                    `;
                  }).join('')}
                </div>
                <p class="text-slate-500 text-xs mt-3">
                  ✨ La couleur du fond animé change en temps réel sur toutes les pages
                </p>
              </div>
            </div>
          </div>

          <!-- Danger Zone -->
          <div class="glass rounded-2xl p-6 border border-red-500/20">
            <h3 class="text-xl font-bold text-red-400 mb-4">Zone de danger</h3>
            <p class="text-slate-400 mb-4">Les actions ci-dessous sont irréversibles. Procédez avec prudence.</p>
            <div class="flex gap-3">
              <button class="px-6 py-3 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-xl font-semibold transition-all">
                Supprimer mon compte
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // Fonctions de gestion des collaborateurs
    function canAddCollaborator() {
      const plan = state.subscription.plans[state.subscription.currentPlan];
      const maxUsers = plan.limits.users;
      const currentUsers = state.collaborators.filter(c => c.status === 'active').length;
      
      if (maxUsers === -1) return true; // Illimité
      return currentUsers < maxUsers;
    }

    function addCollaborator() {
      if (!state.newCollaborator.name || !state.newCollaborator.email) {
        alert('⚠️ Veuillez remplir tous les champs');
        return;
      }

      if (!canAddCollaborator()) {
        const plan = state.subscription.plans[state.subscription.currentPlan];
        alert(`⚠️ Limite atteinte !\n\nVotre plan ${plan.name} autorise ${plan.limits.users === 0 ? 'aucun collaborateur' : plan.limits.users + ' collaborateur(s)'}.\n\nPassez à un plan supérieur pour ajouter plus de collaborateurs.`);
        return;
      }

      const collaborator = {
        id: state.collaborators.length + 1,
        name: state.newCollaborator.name,
        email: state.newCollaborator.email,
        role: state.newCollaborator.role,
        status: 'pending',
        invitedDate: new Date().toISOString().split('T')[0],
        lastLogin: null
      };

      setState({
        collaborators: [...state.collaborators, collaborator],
        showAddCollaborator: false,
        newCollaborator: { name: '', email: '', role: 'agent' }
      });

      alert(`✅ Invitation envoyée !\n\n${collaborator.name} recevra un email à ${collaborator.email} pour créer son compte.`);
    }

    function removeCollaborator(id) {
      if (confirm('⚠️ Êtes-vous sûr de vouloir retirer cet accès collaborateur ?')) {
        setState({
          collaborators: state.collaborators.filter(c => c.id !== id)
        });
        alert('✅ Collaborateur retiré avec succès');
      }
    }

    function resendInvitation(id) {
      const collab = state.collaborators.find(c => c.id === id);
      if (collab) {
        alert(`✅ Invitation renvoyée !\n\nUn nouvel email a été envoyé à ${collab.email}`);
      }
    }

    function renderCollaborators() {
      const plan = state.subscription.plans[state.subscription.currentPlan];
      const maxUsers = plan.limits.users;
      const activeCollaborators = state.collaborators.filter(c => c.status === 'active').length;
      const canAdd = canAddCollaborator();

      return `
        <div class="space-y-6">
          <!-- Header -->
          <div class="glass rounded-2xl p-6 bg-gradient-to-r from-blue-500/10 to-purple-500/10 border-blue-500/20">
            <div class="flex items-center gap-4 mb-4">
              <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white">
                👥
              </div>
              <div>
                <h2 class="text-2xl font-bold text-white mb-1">Gestion des Collaborateurs</h2>
                <p class="text-slate-300">Invitez et gérez les accès de votre équipe</p>
              </div>
            </div>
            
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-6">
                <div>
                  <div class="text-3xl font-bold text-white">${activeCollaborators}</div>
                  <div class="text-slate-400 text-sm">Actifs</div>
                </div>
                <div>
                  <div class="text-3xl font-bold text-amber-400">${maxUsers === -1 ? '∞' : maxUsers}</div>
                  <div class="text-slate-400 text-sm">Autorisés</div>
                </div>
              </div>
              
              <button 
                onclick="setState({showAddCollaborator: true})"
                class='px-6 py-3 btn-primary rounded-xl font-semibold flex items-center gap-2 ${!canAdd ? "opacity-50 cursor-not-allowed" : ""}'
                ${!canAdd ? 'disabled' : ''}
              >
                ${icons.plus} Inviter un collaborateur
              </button>
            </div>

            ${!canAdd ? `
              <div class="mt-4 bg-orange-500/10 border border-orange-500/30 rounded-lg p-4">
                <p class="text-orange-400 text-sm">
                  ⚠️ <strong>Limite atteinte !</strong> Votre plan ${plan.name} autorise ${maxUsers === 0 ? 'aucun collaborateur' : maxUsers + ' collaborateur(s)'}. 
                  <button onclick="setState({currentPage: 'subscription'})" class="underline hover:text-orange-300">Passer à un plan supérieur</button>
                </p>
              </div>
            ` : ''}
          </div>

          <!-- Liste des collaborateurs -->
          <div class="glass rounded-2xl p-6">
            <h3 class="text-xl font-bold text-white mb-6">Collaborateurs (${state.collaborators.length})</h3>
            
            ${state.collaborators.length === 0 ? `
              <div class="text-center py-12">
                <div class="text-6xl mb-4">👥</div>
                <p class="text-slate-400 mb-4">Aucun collaborateur pour le moment</p>
                <button onclick="setState({showAddCollaborator: true})" class="px-6 py-3 btn-primary rounded-xl font-semibold">
                  Inviter votre premier collaborateur
                </button>
              </div>
            ` : `
              <div class="space-y-3">
                ${state.collaborators.map(collab => `
                  <div class="flex items-center justify-between p-4 bg-slate-800/50 rounded-xl hover:bg-slate-800 transition-all">
                    <div class="flex items-center gap-4">
                      <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-lg">
                        ${collab.name.charAt(0)}
                      </div>
                      <div>
                        <div class="text-white font-semibold">${collab.name}</div>
                        <div class="text-slate-400 text-sm">${collab.email}</div>
                      </div>
                    </div>

                    <div class="flex items-center gap-4">
                      <div class="text-right">
                        <div class="text-sm">
                          ${collab.status === 'active' ? `
                            <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-xs font-semibold">
                              ✓ Actif
                            </span>
                          ` : `
                            <span class="px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full text-xs font-semibold">
                              ⏳ En attente
                            </span>
                          `}
                        </div>
                        <div class="text-slate-400 text-xs mt-1">
                          ${collab.status === 'active' 
                            ? `Dernière connexion : ${new Date(collab.lastLogin).toLocaleDateString('fr-FR')}`
                            : `Invité le ${new Date(collab.invitedDate).toLocaleDateString('fr-FR')}`
                          }
                        </div>
                      </div>

                      <div class="flex gap-2">
                        ${collab.status === 'pending' ? `
                          <button 
                            onclick="resendInvitation(${collab.id})"
                            class="px-3 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 rounded-lg text-sm font-semibold transition-all"
                            title="Renvoyer l'invitation"
                          >
                            📧
                          </button>
                        ` : ''}
                        <button 
                          onclick="removeCollaborator(${collab.id})"
                          class="px-3 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg text-sm font-semibold transition-all"
                          title="Retirer l'accès"
                        >
                          ${icons.x}
                        </button>
                      </div>
                    </div>
                  </div>
                `).join('')}
              </div>
            `}
          </div>

          <!-- Info box -->
          <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
            <h4 class="text-white font-semibold mb-2">💡 À savoir</h4>
            <ul class="text-slate-300 text-sm space-y-1">
              <li>• Les collaborateurs reçoivent un email d'invitation avec un lien d'inscription</li>
              <li>• Ils auront accès à toutes les fonctionnalités selon leur rôle</li>
              <li>• Vous pouvez retirer l'accès à tout moment</li>
              <li>• Le nombre de collaborateurs dépend de votre abonnement</li>
            </ul>
          </div>
        </div>
      `;
    }

    function renderSubscription() {
      const currentPlan = state.subscription.plans[state.subscription.currentPlan];
      const billingAmount = currentPlan.price[state.subscription.billingCycle];
      
      return `
        <div class="space-y-6">
          <!-- Current Plan Overview -->
          <div class="glass rounded-2xl p-6 bg-gradient-to-r from-amber-500/10 to-purple-500/10 border-amber-500/20">
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center gap-4">
                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-amber-500 to-purple-500 flex items-center justify-center text-white">
                  ${icons.crown}
                </div>
                <div>
                  <h2 class="text-2xl font-bold text-white mb-1">Mon Abonnement</h2>
                  <p class="text-slate-300">Gérez votre plan et facturation</p>
                </div>
              </div>
              <div class="text-right">
                <div class="text-3xl font-bold text-amber-400">${billingAmount} €</div>
                <div class="text-slate-400 text-sm">/ ${state.subscription.billingCycle === 'monthly' ? 'mois' : 'an'}</div>
              </div>
            </div>

            <div class="grid md:grid-cols-3 gap-4">
              <div class="bg-slate-800/50 rounded-xl p-4">
                <div class="flex items-center gap-2 mb-2">
                  ${icons.package}
                  <span class="text-slate-400 text-sm">Plan actuel</span>
                </div>
                <div class="text-white font-bold text-xl">${currentPlan.name}</div>
              </div>
              <div class="bg-slate-800/50 rounded-xl p-4">
                <div class="flex items-center gap-2 mb-2">
                  ${icons.calendar}
                  <span class="text-slate-400 text-sm">Prochain paiement</span>
                </div>
                <div class="text-white font-bold text-xl">${new Date(state.subscription.nextBillingDate).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' })}</div>
              </div>
              <div class="bg-slate-800/50 rounded-xl p-4">
                <div class="flex items-center gap-2 mb-2">
                  ${icons.creditCard}
                  <span class="text-slate-400 text-sm">Mode de paiement</span>
                </div>
                <div class="text-white font-bold">${state.subscription.paymentMethod}</div>
              </div>
            </div>
          </div>

          <!-- Billing Cycle Toggle -->
          <div class="flex justify-center">
            <div class="glass rounded-full p-1 inline-flex">
              <button 
                onclick="setState({subscription: {...state.subscription, billingCycle: 'monthly'}})"
                class='px-6 py-2 rounded-full transition-all ${state.subscription.billingCycle === "monthly" ? "bg-amber-400 text-slate-900 font-semibold" : "text-slate-400"}'
              >
                Mensuel
              </button>
              <button 
                onclick="setState({subscription: {...state.subscription, billingCycle: 'yearly'}})"
                class='px-6 py-2 rounded-full transition-all ${state.subscription.billingCycle === "yearly" ? "bg-amber-400 text-slate-900 font-semibold" : "text-slate-400"}'
              >
                Annuel <span class="text-green-400 text-xs ml-1">-17%</span>
              </button>
            </div>
          </div>

          <!-- Plans Comparison -->
          <div class="grid lg:grid-cols-3 gap-6">
            ${Object.entries(state.subscription.plans).map(([planKey, plan]) => {
              const isCurrentPlan = planKey === state.subscription.currentPlan;
              const price = plan.price[state.subscription.billingCycle];
              const savings = state.subscription.billingCycle === 'yearly' ? Math.round((plan.price.monthly * 12 - plan.price.yearly)) : 0;
              
              return `
                <div class='glass rounded-2xl p-6 ${isCurrentPlan ? "ring-2 ring-amber-400" : ""} ${plan.popular ? "relative" : ""} hover:scale-105 transition-transform'>
                  ${plan.popular ? `
                    <div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-gradient-to-r from-amber-500 to-purple-500 text-white px-4 py-1 rounded-full text-xs font-bold">
                      ⭐ POPULAIRE
                    </div>
                  ` : ''}
                  
                  <div class="text-center mb-6">
                    <div class='w-16 h-16 mx-auto mb-4 rounded-2xl ${
                      planKey === "starter" ? "bg-blue-500/20" :
                      planKey === "pro" ? "bg-amber-500/20" :
                      "bg-purple-500/20"
                    } flex items-center justify-center'>
                      ${planKey === 'starter' ? icons.package :
                        planKey === 'pro' ? icons.crown :
                        icons.award}
                    </div>
                    <h3 class="text-2xl font-bold text-white mb-2">${plan.name}</h3>
                    <div class="text-4xl font-bold text-amber-400 mb-2">${price} €</div>
                    <div class="text-slate-400 text-sm mb-4">/ ${state.subscription.billingCycle === 'monthly' ? 'mois' : 'an'}</div>
                    ${savings > 0 ? `
                      <div class="inline-block bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-xs font-semibold">
                        Économisez ${savings}€/an
                      </div>
                    ` : ''}
                  </div>

                  <ul class="space-y-3 mb-6">
                    ${plan.features.map(feature => `
                      <li class="flex items-start gap-2 text-slate-300 text-sm">
                        <div class="text-green-400 mt-0.5">${icons.checkCircle}</div>
                        <span>${feature}</span>
                      </li>
                    `).join('')}
                  </ul>

                  ${isCurrentPlan ? `
                    <button disabled class="w-full bg-slate-700 text-slate-400 px-6 py-3 rounded-xl font-semibold cursor-not-allowed">
                      Plan actuel
                    </button>
                  ` : planKey === 'enterprise' && state.subscription.currentPlan === 'pro' ? `
                    <button class="w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-6 py-3 rounded-xl font-semibold transition-all">
                      Passer à Enterprise
                    </button>
                  ` : planKey === 'pro' && state.subscription.currentPlan === 'starter' ? `
                    <button class="w-full bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white px-6 py-3 rounded-xl font-semibold transition-all">
                      Passer à Pro
                    </button>
                  ` : `
                    <button class="w-full bg-slate-700 hover:bg-slate-600 text-white px-6 py-3 rounded-xl font-semibold transition-all">
                      ${planKey === 'starter' ? 'Rétrograder' : 'En savoir plus'}
                    </button>
                  `}
                </div>
              `;
            }).join('')}
          </div>

          <!-- Billing History -->
          <div class="glass rounded-2xl p-6">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-10 h-10 rounded-xl bg-slate-700 flex items-center justify-center">
                ${icons.fileText}
              </div>
              <div>
                <h3 class="text-xl font-bold text-white">Historique de facturation</h3>
                <p class="text-slate-400 text-sm">Vos dernières transactions</p>
              </div>
            </div>

            <div class="space-y-3">
              ${[
                { date: '2026-01-29', amount: billingAmount, status: 'Payé', invoice: 'INV-2026-001' },
                { date: '2025-12-29', amount: billingAmount, status: 'Payé', invoice: 'INV-2025-012' },
                { date: '2025-11-29', amount: billingAmount, status: 'Payé', invoice: 'INV-2025-011' }
              ].map(bill => `
                <div class="bg-slate-800/50 rounded-xl p-4 flex items-center justify-between hover:bg-slate-800 transition-all">
                  <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center text-green-400">
                      ${icons.checkCircle}
                    </div>
                    <div>
                      <div class="text-white font-semibold">${bill.invoice}</div>
                      <div class="text-slate-400 text-sm">${new Date(bill.date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' })}</div>
                    </div>
                  </div>
                  <div class="flex items-center gap-4">
                    <div class="text-right">
                      <div class="text-white font-bold">${bill.amount} €</div>
                      <div class="text-green-400 text-xs font-semibold">${bill.status}</div>
                    </div>
                    <button class="p-2 hover:bg-slate-700 rounded-lg transition-colors text-slate-400 hover:text-white">
                      ${icons.eye}
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>

          <!-- Payment Method -->
          <div class="glass rounded-2xl p-6">
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-slate-700 flex items-center justify-center">
                  ${icons.creditCard}
                </div>
                <div>
                  <h3 class="text-xl font-bold text-white">Mode de paiement</h3>
                  <p class="text-slate-400 text-sm">Gérez vos moyens de paiement</p>
                </div>
              </div>
              <button class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-all flex items-center gap-2">
                ${icons.plus}
                Ajouter
              </button>
            </div>

            <div class="bg-slate-800/50 rounded-xl p-5 border-2 border-amber-400/50">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                  <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold">
                    VISA
                  </div>
                  <div>
                    <div class="text-white font-semibold">${state.subscription.paymentMethod}</div>
                    <div class="text-slate-400 text-sm">Expire 12/2028</div>
                  </div>
                </div>
                <div class="flex gap-2">
                  <button class="p-2 hover:bg-slate-700 rounded-lg transition-colors text-slate-400 hover:text-white">
                    ${icons.edit}
                  </button>
                  <button class="p-2 hover:bg-red-500/20 rounded-lg transition-colors text-slate-400 hover:text-red-400">
                    ${icons.trash}
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Cancel Subscription -->
          <div class="glass rounded-2xl p-6 border border-red-500/20">
            <div class="flex items-start justify-between">
              <div>
                <h3 class="text-lg font-bold text-white mb-2">Zone de danger</h3>
                <p class="text-slate-400 text-sm mb-4">Annulez votre abonnement à tout moment. Vous conserverez l'accès jusqu\'à la fin de la période de facturation.</p>
              </div>
              <button class="px-6 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg transition-all font-semibold whitespace-nowrap">
                Annuler l'abonnement
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function renderReports() {
      // Vérifier si l'utilisateur a l'abonnement Enterprise
      if (!hasEnterpriseAccess()) {
        return `
          <div class="flex items-center justify-center min-h-[60vh]">
            <div class="glass rounded-2xl p-8 max-w-2xl text-center border-2 border-amber-500/30">
              <div class="w-20 h-20 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center">
                ${icons.fileText}
              </div>
              <h3 class="text-3xl font-bold text-white mb-4">Rapports & Analytics</h3>
              <p class="text-slate-300 text-lg mb-6">
                Cette fonctionnalité est réservée aux abonnés <strong class="text-amber-400">Entreprise</strong>.
              </p>
              <div class="bg-slate-800/50 rounded-xl p-6 mb-6">
                <h4 class="text-white font-bold mb-3">Avec les Rapports & Analytics, accédez à :</h4>
                <ul class="text-slate-300 space-y-2 text-left">
                  <li>✅ Analyses de performance détaillées</li>
                  <li>✅ Suivi des objectifs en temps réel</li>
                  <li>✅ Rapports par agent</li>
                  <li>✅ Statistiques avancées</li>
                  <li>✅ Export des données</li>
                </ul>
              </div>
              <button onclick="setState({currentPage: 'subscription'})" class="btn-primary px-8 py-4 rounded-xl font-bold text-lg">
                ⬆️ Passer à Entreprise
              </button>
            </div>
          </div>
        `;
      }
      
      const advStats = getAdvancedStats();
      const stats = getStats();
      
      return `
        <div class="space-y-6">
          <!-- Revenue Overview -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="stat-card glass rounded-2xl p-6 animate-slideUp" style="animation-delay: 0.1s; opacity: 0">
              <div class="flex items-start justify-between mb-4">
                <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center text-white">
                  ${icons.dollarSign}
                </div>
                <div class="flex items-center gap-1 text-sm font-semibold text-green-500">
                  ${icons.trendUp}
                  23%
                </div>
              </div>
              <div class="text-3xl font-bold text-white mb-1">${(advStats.totalRevenue / 1000000).toFixed(2)}M €</div>
              <div class="text-slate-400 text-sm">Chiffre d'affaires total</div>
            </div>

            <div class="stat-card glass rounded-2xl p-6 animate-slideUp" style="animation-delay: 0.2s; opacity: 0">
              <div class="flex items-start justify-between mb-4">
                <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-white">
                  ${icons.target}
                </div>
                <div class="flex items-center gap-1 text-sm font-semibold text-green-500">
                  ${icons.trendUp}
                  8%
                </div>
              </div>
              <div class="text-3xl font-bold text-white mb-1">${advStats.conversionRate}%</div>
              <div class="text-slate-400 text-sm">Taux de conversion</div>
            </div>

            <div class="stat-card glass rounded-2xl p-6 animate-slideUp" style="animation-delay: 0.3s; opacity: 0">
              <div class="flex items-start justify-between mb-4">
                <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white">
                  ${icons.activity}
                </div>
                <div class="flex items-center gap-1 text-sm font-semibold text-green-500">
                  ${icons.trendUp}
                  12%
                </div>
              </div>
              <div class="text-3xl font-bold text-white mb-1">${advStats.avgDaysToSell}</div>
              <div class="text-slate-400 text-sm">Jours moyens de vente</div>
            </div>

            <div class="stat-card glass rounded-2xl p-6 animate-slideUp" style="animation-delay: 0.4s; opacity: 0">
              <div class="flex items-start justify-between mb-4">
                <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center text-white">
                  ${icons.pieChart}
                </div>
                <div class="flex items-center gap-1 text-sm font-semibold text-green-500">
                  ${icons.trendUp}
                  15%
                </div>
              </div>
              <div class="text-3xl font-bold text-white mb-1">${(advStats.totalCommissions / 1000).toFixed(0)}k €</div>
              <div class="text-slate-400 text-sm">Commissions générées</div>
            </div>
          </div>

          <!-- Performance des agents -->
          <div class="glass rounded-2xl p-6">
            <div class="flex justify-between items-center mb-6">
              <div>
                <h3 class="text-xl font-bold text-white">Performance des agents</h3>
                <p class="text-slate-400 text-sm mt-1">Classement par chiffre d'affaires</p>
              </div>
              <div class="flex items-center gap-2 text-amber-400">
                ${icons.userCheck}
                <span class="font-semibold">${state.agents.length} agents actifs</span>
              </div>
            </div>

            <div class="space-y-4">
              ${state.agents.map((agent, index) => `
                <div class="bg-slate-800/50 rounded-xl p-5 hover:bg-slate-800/70 transition-all">
                  <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-4">
                      <div class="w-12 h-12 rounded-full bg-gradient-to-br from-amber-400 to-amber-500 flex items-center justify-center text-white font-bold text-lg">
                        ${index + 1}
                      </div>
                      <div>
                        <div class="text-white font-bold text-lg">${agent.name}</div>
                        <div class="text-slate-400 text-sm">${agent.clients} clients • ${agent.sales} ventes</div>
                      </div>
                    </div>
                    <div class="text-right">
                      <div class="text-2xl font-bold text-amber-400">${(agent.revenue / 1000).toFixed(0)}k €</div>
                      <div class="text-slate-400 text-sm">Chiffre d'affaires</div>
                    </div>
                  </div>

                  <div class="flex items-center gap-3">
                    <div class="flex-1">
                      <div class="flex justify-between text-xs text-slate-400 mb-1">
                        <span>Performance</span>
                        <span>${agent.performance}%</span>
                      </div>
                      <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                        <div 
                          class="h-full bg-gradient-to-r from-green-500 to-green-400 transition-all duration-500"
                          style="width: ${agent.performance}%"
                        ></div>
                      </div>
                    </div>
                    ${index === 0 ? `
                      <div class="px-3 py-1 rounded-full bg-amber-400/20 text-amber-400 text-xs font-bold">
                        🏆 Top Agent
                      </div>
                    ` : ''}
                  </div>
                </div>
              `).join('')}
            </div>
          </div>

          <!-- Analytics détaillées -->
          <div class="grid lg:grid-cols-2 gap-6">
            <div class="glass rounded-2xl p-6">
              <h3 class="text-xl font-bold text-white mb-6">Répartition par type de bien</h3>
              <div class="space-y-4">
                ${['Villa', 'Appartement', 'Maison', 'Loft'].map(type => {
                  const count = state.properties.filter(p => p.type === type).length;
                  const percentage = ((count / state.properties.length) * 100).toFixed(0);
                  const colors = {
                    'Villa': 'from-purple-500 to-purple-400',
                    'Appartement': 'from-blue-500 to-blue-400',
                    'Maison': 'from-green-500 to-green-400',
                    'Loft': 'from-amber-500 to-amber-400'
                  };
                  return `
                    <div>
                      <div class="flex justify-between text-sm mb-2">
                        <span class="text-slate-300 font-medium">${type}</span>
                        <span class="text-white font-bold">${count} (${percentage}%)</span>
                      </div>
                      <div class="h-3 bg-slate-700 rounded-full overflow-hidden">
                        <div 
                          class="h-full bg-gradient-to-r ${colors[type]} transition-all duration-500"
                          style="width: ${percentage}%"
                        ></div>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>

            <div class="glass rounded-2xl p-6">
              <h3 class="text-xl font-bold text-white mb-6">Pipeline de ventes</h3>
              <div class="space-y-4">
                <div class="bg-slate-800/50 rounded-xl p-4">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center text-green-400">
                        ${icons.home}
                      </div>
                      <div>
                        <div class="text-white font-semibold">Biens actifs</div>
                        <div class="text-slate-400 text-sm">Disponibles à la vente</div>
                      </div>
                    </div>
                    <div class="text-2xl font-bold text-white">${advStats.activeListings}</div>
                  </div>
                </div>

                <div class="bg-slate-800/50 rounded-xl p-4">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 rounded-full bg-yellow-500/20 flex items-center justify-center text-yellow-400">
                        ${icons.activity}
                      </div>
                      <div>
                        <div class="text-white font-semibold">Affaires en cours</div>
                        <div class="text-slate-400 text-sm">Négociations actives</div>
                      </div>
                    </div>
                    <div class="text-2xl font-bold text-white">${advStats.pendingDeals}</div>
                  </div>
                </div>

                <div class="bg-slate-800/50 rounded-xl p-4">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400">
                        ${icons.userCheck}
                      </div>
                      <div>
                        <div class="text-white font-semibold">Ventes conclues</div>
                        <div class="text-slate-400 text-sm">Ce mois</div>
                      </div>
                    </div>
                    <div class="text-2xl font-bold text-white">${stats.soldProperties}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      `;
    }

    function renderVisits() {
      const currentYear = 2026;
      const months = [
        'Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin',
        'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'
      ];
      
      // Grouper les visites par mois
      const visitsByMonth = {};
      months.forEach((month, index) => {
        visitsByMonth[index] = state.visits.filter(v => {
          const visitMonth = parseInt(v.date.split('/')[1]) - 1;
          return visitMonth === index;
        });
      });
      
      return `
        <div class="space-y-6">
          <!-- Header -->
          <div class="flex justify-between items-center">
            <div>
              <h3 class="text-2xl font-bold text-white">📅 Calendrier Annuel ${currentYear}</h3>
              <p class="text-slate-400 mt-1">${state.visits.length} visites programmées cette année</p>
            </div>
            <button
              onclick="setState({showAddVisit: true})"
              class="btn-primary px-6 py-3 rounded-xl text-white font-semibold flex items-center gap-2"
            >
              ${icons.plus}
              Nouvelle visite
            </button>
          </div>

          <!-- Calendar Grid - 12 months -->
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            ${months.map((month, index) => {
              const monthVisits = visitsByMonth[index] || [];
              const hasVisits = monthVisits.length > 0;
              
              return `
                <div class="glass rounded-xl p-4 ${hasVisits ? 'border-2 border-purple-500/30' : 'border border-slate-700'} hover:border-purple-500/50 transition-all">
                  <!-- Month Header -->
                  <div class="flex items-center justify-between mb-3">
                    <h4 class="text-white font-bold">${month}</h4>
                    ${hasVisits ? `
                      <span class="px-2 py-1 bg-purple-500/20 text-purple-400 rounded-full text-xs font-bold">
                        ${monthVisits.length}
                      </span>
                    ` : `
                      <span class="text-slate-500 text-xs">0</span>
                    `}
                  </div>
                  
                  <!-- Visits List -->
                  <div class="space-y-2">
                    ${monthVisits.length === 0 ? `
                      <div class="text-center py-4 text-slate-500 text-sm">
                        Aucune visite
                      </div>
                    ` : monthVisits.slice(0, 3).map(visit => {
                      const property = state.properties.find(p => p.id === visit.propertyId);
                      const client = state.clients.find(c => c.id === visit.clientId);
                      const statusColors = {
                        'Terminée': 'bg-green-500/20 text-green-400 border-green-500/30',
                        'Programmée': 'bg-blue-500/20 text-blue-400 border-blue-500/30',
                        'Confirmée': 'bg-purple-500/20 text-purple-400 border-purple-500/30'
                      };
                      
                      return `
                        <div class="p-2 bg-slate-800/50 rounded-lg border ${statusColors[visit.status]} hover:scale-105 transition-all cursor-pointer">
                          <div class="flex items-center gap-2 mb-1">
                            <span class="text-lg">${property?.image}</span>
                            <div class="flex-1 min-w-0">
                              <div class="text-white text-xs font-semibold truncate">${property?.title}</div>
                              <div class="text-slate-400 text-xs truncate">${client?.name}</div>
                            </div>
                          </div>
                          <div class="flex items-center justify-between text-xs">
                            <span class="text-slate-400">${visit.date}</span>
                            <span class="text-purple-400 font-semibold">${visit.time}</span>
                          </div>
                        </div>
                      `;
                    }).join('')}
                    
                    ${monthVisits.length > 3 ? `
                      <div class="text-center">
                        <button class="text-purple-400 text-xs font-semibold hover:text-purple-300">
                          +${monthVisits.length - 3} autre${monthVisits.length - 3 > 1 ? 's' : ''}
                        </button>
                      </div>
                    ` : ''}
                  </div>
                </div>
              `;
            }).join('')}
          </div>
          
          <!-- Légende -->
          <div class="glass rounded-xl p-4">
            <h4 class="text-white font-bold mb-3">📊 Répartition annuelle</h4>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-green-500"></div>
                <span class="text-slate-300 text-sm">
                  Terminées: ${state.visits.filter(v => v.status === 'Terminée').length}
                </span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                <span class="text-slate-300 text-sm">
                  Programmées: ${state.visits.filter(v => v.status === 'Programmée').length}
                </span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-purple-500"></div>
                <span class="text-slate-300 text-sm">
                  Confirmées: ${state.visits.filter(v => v.status === 'Confirmée').length}
                </span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-amber-500"></div>
                <span class="text-slate-300 text-sm">
                  Total: ${state.visits.length}
                </span>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderModalAddProperty() {
      if (!state.showAddProperty) return '';
      return `
        <div class="fixed inset-0 bg-black/70 modal-backdrop flex items-center justify-center p-4 z-50 animate-fadeIn">
          <div class="bg-slate-800 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-8 animate-slideUp">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-2xl font-bold text-white">Ajouter un bien</h3>
              <button onclick="setState({showAddProperty: false})" class="text-slate-400 hover:text-white">
                ${icons.x}
              </button>
            </div>
            
            <div class="space-y-4">
              <div class="grid md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Titre *</label>
                  <input
                    type="text"
                    value="${state.newProperty.title}"
                    oninput="setState({newProperty: {...state.newProperty, title: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    placeholder="Villa Moderne Provence"
                  />
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Type *</label>
                  <select
                    value="${state.newProperty.type}"
                    onchange="setState({newProperty: {...state.newProperty, type: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  >
                    <option>Appartement</option>
                    <option>Maison</option>
                    <option>Villa</option>
                    <option>Loft</option>
                  </select>
                </div>
              </div>

              <div class="grid md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Prix (€) *</label>
                  <input
                    type="number"
                    value="${state.newProperty.price}"
                    oninput="setState({newProperty: {...state.newProperty, price: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    placeholder="350000"
                  />
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Surface (m²) *</label>
                  <input
                    type="number"
                    value="${state.newProperty.surface}"
                    oninput="setState({newProperty: {...state.newProperty, surface: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    placeholder="120"
                  />
                </div>
              </div>

              <div class="grid grid-cols-4 gap-4">
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Pièces *</label>
                  <input
                    type="number"
                    value="${state.newProperty.rooms}"
                    oninput="setState({newProperty: {...state.newProperty, rooms: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    placeholder="4"
                  />
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Chambres *</label>
                  <input
                    type="number"
                    value="${state.newProperty.bedrooms}"
                    oninput="setState({newProperty: {...state.newProperty, bedrooms: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    placeholder="3"
                  />
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Salles de bain *</label>
                  <input
                    type="number"
                    value="${state.newProperty.bathrooms}"
                    oninput="setState({newProperty: {...state.newProperty, bathrooms: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    placeholder="2"
                  />
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Parking</label>
                  <select
                    value="${state.newProperty.parking}"
                    onchange="setState({newProperty: {...state.newProperty, parking: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  >
                    <option value="0">Aucun</option>
                    <option value="1">1 place</option>
                    <option value="2">2 places</option>
                    <option value="3+">3+ places</option>
                  </select>
                </div>
              </div>

              <div class="grid md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Étage</label>
                  <input
                    type="text"
                    value="${state.newProperty.floor}"
                    oninput="setState({newProperty: {...state.newProperty, floor: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    placeholder="3"
                  />
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Nombre d'étages</label>
                  <input
                    type="text"
                    value="${state.newProperty.totalFloors}"
                    oninput="setState({newProperty: {...state.newProperty, totalFloors: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    placeholder="5"
                  />
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Année construction</label>
                  <input
                    type="number"
                    value="${state.newProperty.yearBuilt}"
                    oninput="setState({newProperty: {...state.newProperty, yearBuilt: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    placeholder="2020"
                  />
                </div>
              </div>

              <div class="grid md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Classe énergétique</label>
                  <select
                    value="${state.newProperty.energyClass}"
                    onchange="setState({newProperty: {...state.newProperty, energyClass: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  >
                    <option value="">Non spécifié</option>
                    <option value="A">A (Excellent)</option>
                    <option value="B">B (Très bon)</option>
                    <option value="C">C (Bon)</option>
                    <option value="D">D (Moyen)</option>
                    <option value="E">E (Passable)</option>
                    <option value="F">F (Médiocre)</option>
                    <option value="G">G (Mauvais)</option>
                  </select>
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Chauffage</label>
                  <select
                    value="${state.newProperty.heating}"
                    onchange="setState({newProperty: {...state.newProperty, heating: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  >
                    <option>Individuel</option>
                    <option>Collectif</option>
                    <option>Électrique</option>
                    <option>Gaz</option>
                    <option>Pompe à chaleur</option>
                  </select>
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Orientation</label>
                  <select
                    value="${state.newProperty.orientation}"
                    onchange="setState({newProperty: {...state.newProperty, orientation: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  >
                    <option value="">Non spécifié</option>
                    <option value="Nord">Nord</option>
                    <option value="Sud">Sud</option>
                    <option value="Est">Est</option>
                    <option value="Ouest">Ouest</option>
                    <option value="Sud-Ouest">Sud-Ouest</option>
                    <option value="Sud-Est">Sud-Est</option>
                  </select>
                </div>
              </div>

              <div class="grid md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Charges (€/mois)</label>
                  <input
                    type="number"
                    value="${state.newProperty.charges}"
                    oninput="setState({newProperty: {...state.newProperty, charges: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    placeholder="150"
                  />
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Taxe foncière (€/an)</label>
                  <input
                    type="number"
                    value="${state.newProperty.propertyTax}"
                    oninput="setState({newProperty: {...state.newProperty, propertyTax: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    placeholder="1200"
                  />
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Disponibilité</label>
                  <select
                    value="${state.newProperty.availability}"
                    onchange="setState({newProperty: {...state.newProperty, availability: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  >
                    <option>Immédiate</option>
                    <option>1 mois</option>
                    <option>3 mois</option>
                    <option>6 mois</option>
                  </select>
                </div>
              </div>

              <!-- Équipements et caractéristiques -->
              <div>
                <label class="block text-slate-400 text-sm mb-3">Équipements et caractéristiques</label>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                  <label class="flex items-center gap-2 p-3 bg-slate-700/50 rounded-lg cursor-pointer hover:bg-slate-700 transition-all">
                    <input
                      type="checkbox"
                      ${state.newProperty.balcony ? 'checked' : ''}
                      onchange="setState({newProperty: {...state.newProperty, balcony: event.target.checked}})"
                      class="rounded border-slate-600 text-amber-500 focus:ring-amber-400"
                    />
                    <span class="text-white text-sm">🏠 Balcon</span>
                  </label>
                  <label class="flex items-center gap-2 p-3 bg-slate-700/50 rounded-lg cursor-pointer hover:bg-slate-700 transition-all">
                    <input
                      type="checkbox"
                      ${state.newProperty.terrace ? 'checked' : ''}
                      onchange="setState({newProperty: {...state.newProperty, terrace: event.target.checked}})"
                      class="rounded border-slate-600 text-amber-500 focus:ring-amber-400"
                    />
                    <span class="text-white text-sm">☀️ Terrasse</span>
                  </label>
                  <label class="flex items-center gap-2 p-3 bg-slate-700/50 rounded-lg cursor-pointer hover:bg-slate-700 transition-all">
                    <input
                      type="checkbox"
                      ${state.newProperty.garden ? 'checked' : ''}
                      onchange="setState({newProperty: {...state.newProperty, garden: event.target.checked}})"
                      class="rounded border-slate-600 text-amber-500 focus:ring-amber-400"
                    />
                    <span class="text-white text-sm">🌳 Jardin</span>
                  </label>
                  <label class="flex items-center gap-2 p-3 bg-slate-700/50 rounded-lg cursor-pointer hover:bg-slate-700 transition-all">
                    <input
                      type="checkbox"
                      ${state.newProperty.elevator ? 'checked' : ''}
                      onchange="setState({newProperty: {...state.newProperty, elevator: event.target.checked}})"
                      class="rounded border-slate-600 text-amber-500 focus:ring-amber-400"
                    />
                    <span class="text-white text-sm">🛗 Ascenseur</span>
                  </label>
                  <label class="flex items-center gap-2 p-3 bg-slate-700/50 rounded-lg cursor-pointer hover:bg-slate-700 transition-all">
                    <input
                      type="checkbox"
                      ${state.newProperty.furnished ? 'checked' : ''}
                      onchange="setState({newProperty: {...state.newProperty, furnished: event.target.checked}})"
                      class="rounded border-slate-600 text-amber-500 focus:ring-amber-400"
                    />
                    <span class="text-white text-sm">🛋️ Meublé</span>
                  </label>
                  <label class="flex items-center gap-2 p-3 bg-slate-700/50 rounded-lg cursor-pointer hover:bg-slate-700 transition-all">
                    <input
                      type="checkbox"
                      ${state.newProperty.newConstruction ? 'checked' : ''}
                      onchange="setState({newProperty: {...state.newProperty, newConstruction: event.target.checked}})"
                      class="rounded border-slate-600 text-amber-500 focus:ring-amber-400"
                    />
                    <span class="text-white text-sm">🆕 Neuf</span>
                  </label>
                  <div>
                    <label class="block text-slate-400 text-sm mb-2">Statut</label>
                    <select
                      value="${state.newProperty.status}"
                      onchange="setState({newProperty: {...state.newProperty, status: event.target.value}})"
                      class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    >
                      <option>Disponible</option>
                      <option>Sous offre</option>
                      <option>Vendu</option>
                    </select>
                  </div>
                </div>
              </div>

              <div>
                <label class="block text-slate-400 text-sm mb-2">Localisation *</label>
                <input
                  type="text"
                  value="${state.newProperty.location}"
                  oninput="setState({newProperty: {...state.newProperty, location: event.target.value}})"
                  class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  placeholder="Aix-en-Provence"
                />
              </div>

              <div>
                <label class="block text-slate-400 text-sm mb-2">Description</label>
                <textarea
                  value="${state.newProperty.description}"
                  oninput="setState({newProperty: {...state.newProperty, description: event.target.value}})"
                  rows="4"
                  class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400 resize-none"
                  placeholder="Description détaillée du bien..."
                ></textarea>
              </div>

              <div class="flex gap-3 pt-4">
                <button
                  onclick="setState({showAddProperty: false})"
                  class="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all"
                >
                  Annuler
                </button>
                <button
                  onclick="addProperty()"
                  class="flex-1 btn-primary px-6 py-3 rounded-xl text-white font-semibold"
                >
                  Ajouter le bien
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderModalAddClient() {
      if (!state.showAddClient) return '';
      return `
        <div class="fixed inset-0 bg-black/70 modal-backdrop flex items-center justify-center p-4 z-50 animate-fadeIn">
          <div class="bg-slate-800 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-8 animate-slideUp">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-2xl font-bold text-white">Ajouter un client</h3>
              <button onclick="setState({showAddClient: false})" class="text-slate-400 hover:text-white">
                ${icons.x}
              </button>
            </div>
            
            <div class="space-y-4">
              <div>
                <label class="block text-slate-400 text-sm mb-2">Nom complet *</label>
                <input
                  type="text"
                  value="${state.newClient.name}"
                  oninput="setState({newClient: {...state.newClient, name: event.target.value}})"
                  class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  placeholder="Sophie Laurent"
                />
              </div>

              <div class="grid md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Email *</label>
                  <input
                    type="email"
                    value="${state.newClient.email}"
                    oninput="setState({newClient: {...state.newClient, email: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    placeholder="sophie.laurent@email.com"
                  />
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Téléphone *</label>
                  <input
                    type="tel"
                    value="${state.newClient.phone}"
                    oninput="setState({newClient: {...state.newClient, phone: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    placeholder="+33 6 12 34 56 78"
                  />
                </div>
              </div>

              <div class="grid md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Type *</label>
                  <select
                    value="${state.newClient.type}"
                    onchange="setState({newClient: {...state.newClient, type: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  >
                    <option>Acheteur</option>
                    <option>Vendeur</option>
                  </select>
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Budget</label>
                  <input
                    type="text"
                    value="${state.newClient.budget}"
                    oninput="setState({newClient: {...state.newClient, budget: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    placeholder="300-400k€"
                  />
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Statut</label>
                  <select
                    value="${state.newClient.status}"
                    onchange="setState({newClient: {...state.newClient, status: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  >
                    <option>Actif</option>
                    <option>En attente</option>
                    <option>Converti</option>
                  </select>
                </div>
              </div>

              <div>
                <label class="block text-slate-400 text-sm mb-2">Notes</label>
                <textarea
                  value="${state.newClient.notes}"
                  oninput="setState({newClient: {...state.newClient, notes: event.target.value}})"
                  rows="3"
                  class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400 resize-none"
                  placeholder="Notes sur le client..."
                ></textarea>
              </div>

              <div class="flex gap-3 pt-4">
                <button
                  onclick="setState({showAddClient: false})"
                  class="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all"
                >
                  Annuler
                </button>
                <button
                  onclick="addClient()"
                  class="flex-1 btn-primary px-6 py-3 rounded-xl text-white font-semibold"
                >
                  Ajouter le client
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderModalAddVisit() {
      if (!state.showAddVisit) return '';
      return `
        <div class="fixed inset-0 bg-black/70 modal-backdrop flex items-center justify-center p-4 z-50 animate-fadeIn">
          <div class="bg-slate-800 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-8 animate-slideUp">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-2xl font-bold text-white">Programmer une visite</h3>
              <button onclick="setState({showAddVisit: false})" class="text-slate-400 hover:text-white">
                ${icons.x}
              </button>
            </div>
            
            <div class="space-y-4">
              <div>
                <label class="block text-slate-400 text-sm mb-2">Bien *</label>
                <select
                  value="${state.newVisit.propertyId}"
                  onchange="setState({newVisit: {...state.newVisit, propertyId: event.target.value}})"
                  class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                >
                  <option value="">Sélectionner un bien</option>
                  ${state.properties.filter(p => p.status !== 'Vendu').map(p => 
                    `<option value="${p.id}">${p.title} - ${p.location}</option>`
                  ).join('')}
                </select>
              </div>

              <div>
                <label class="block text-slate-400 text-sm mb-2">Client *</label>
                <select
                  value="${state.newVisit.clientId}"
                  onchange="setState({newVisit: {...state.newVisit, clientId: event.target.value}})"
                  class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                >
                  <option value="">Sélectionner un client</option>
                  ${state.clients.filter(c => c.type === 'Acheteur').map(c => 
                    `<option value="${c.id}">${c.name} - ${c.budget}</option>`
                  ).join('')}
                </select>
              </div>

              <div class="grid md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Date *</label>
                  <input
                    type="date"
                    value="${state.newVisit.date}"
                    oninput="setState({newVisit: {...state.newVisit, date: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                    min="${new Date().toISOString().split('T')[0]}"
                  />
                </div>
                <div>
                  <label class="block text-slate-400 text-sm mb-2">Heure *</label>
                  <input
                    type="time"
                    value="${state.newVisit.time}"
                    oninput="setState({newVisit: {...state.newVisit, time: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  />
                </div>
              </div>

              <div>
                <label class="block text-slate-400 text-sm mb-2">Notes</label>
                <textarea
                  value="${state.newVisit.notes}"
                  oninput="setState({newVisit: {...state.newVisit, notes: event.target.value}})"
                  rows="3"
                  class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400 resize-none"
                  placeholder="Notes pour cette visite..."
                ></textarea>
              </div>

              <div class="flex gap-3 pt-4">
                <button
                  onclick="setState({showAddVisit: false})"
                  class="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all"
                >
                  Annuler
                </button>
                <button
                  onclick="addVisit()"
                  class="flex-1 btn-primary px-6 py-3 rounded-xl text-white font-semibold"
                >
                  Programmer
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Fonctions de gestion d'équipe
    function getCollaboratorLimit() {
      const plan = state.subscription.currentPlan;
      if (plan === 'starter') return 0;
      if (plan === 'pro') return 1;
      if (plan === 'enterprise') return -1; // illimité
      return 0;
    }

    function canAddMember() {
      const limit = getCollaboratorLimit();
      if (limit === -1) return true; // Illimité
      return state.teamMembers.length < limit;
    }

    function addTeamMember() {
      if (!state.newMember.name || !state.newMember.email) {
        alert('⚠️ Veuillez remplir au moins le nom et l\'email');
        return;
      }

      if (!canAddMember()) {
        const limit = getCollaboratorLimit();
        const planName = state.subscription.plans[state.subscription.currentPlan].name;
        alert(`⚠️ Limite atteinte !\n\nVotre plan ${planName} autorise ${limit === 0 ? 'aucun' : limit} collaborateur(s).\n\nPassez à un plan supérieur pour ajouter plus de collaborateurs.`);
        return;
      }

      const member = {
        id: Date.now(),
        name: state.newMember.name,
        email: state.newMember.email,
        role: state.newMember.role,
        phone: state.newMember.phone,
        status: 'pending',
        invitedDate: new Date().toISOString().split('T')[0],
        lastLogin: null
      };

      setState({
        teamMembers: [...state.teamMembers, member],
        showAddMember: false,
        newMember: { name: '', email: '', role: 'agent', phone: '' }
      });

      alert(`✅ Invitation envoyée !\n\n${member.name} recevra un email à ${member.email} pour créer son compte.`);
    }

    function removeMember(id) {
      if (confirm('⚠️ Êtes-vous sûr de vouloir retirer cet accès collaborateur ?\n\nCette action est irréversible.')) {
        setState({
          teamMembers: state.teamMembers.filter(m => m.id !== id)
        });
        alert('✅ Collaborateur retiré avec succès');
      }
    }

    function resendInvitation(id) {
      const member = state.teamMembers.find(m => m.id === id);
      if (member) {
        alert(`✅ Invitation renvoyée !\n\nUn nouvel email a été envoyé à ${member.email}`);
      }
    }

    function renderTeamManagement() {
      const limit = getCollaboratorLimit();
      const canAdd = canAddMember();
      const planName = state.subscription.plans[state.subscription.currentPlan].name;
      const activeMembers = state.teamMembers.filter(m => m.status === 'active').length;

      return `
        <div class="space-y-6">
          <!-- Header -->
          <div class="glass rounded-2xl p-6 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 border-blue-500/20">
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center gap-4">
                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white text-3xl">
                  👥
                </div>
                <div>
                  <h2 class="text-2xl font-bold text-white mb-1">Gestion de l'Équipe</h2>
                  <p class="text-slate-300">Invitez et gérez les accès de vos collaborateurs</p>
                </div>
              </div>
              
              <button 
                onclick="setState({showAddMember: true})"
                class='px-6 py-3 btn-primary rounded-xl font-semibold flex items-center gap-2 ${!canAdd ? "opacity-50 cursor-not-allowed" : ""}'
                ${!canAdd ? 'disabled title="Limite de collaborateurs atteinte"' : ''}
              >
                ${icons.plus} Ajouter un collaborateur
              </button>
            </div>

            <div class="grid grid-cols-3 gap-6">
              <div class="text-center">
                <div class="text-4xl font-bold text-white mb-1">${state.teamMembers.length}</div>
                <div class="text-slate-400 text-sm">Total</div>
              </div>
              <div class="text-center">
                <div class="text-4xl font-bold text-green-400 mb-1">${activeMembers}</div>
                <div class="text-slate-400 text-sm">Actifs</div>
              </div>
              <div class="text-center">
                <div class="text-4xl font-bold text-amber-400 mb-1">${limit === -1 ? '∞' : limit}</div>
                <div class="text-slate-400 text-sm">Autorisés (Plan ${planName})</div>
              </div>
            </div>

            ${!canAdd && limit !== -1 ? `
              <div class="mt-6 bg-orange-500/10 border border-orange-500/30 rounded-xl p-4">
                <p class="text-orange-400">
                  ⚠️ <strong>Limite atteinte !</strong> Votre plan ${planName} autorise ${limit === 0 ? 'aucun' : limit} collaborateur(s). 
                  <button onclick="setState({currentPage: 'subscription'})" class="underline hover:text-orange-300 font-semibold">Passer à un plan supérieur →</button>
                </p>
              </div>
            ` : ''}
          </div>

          <!-- Liste des collaborateurs -->
          <div class="glass rounded-2xl p-6">
            <h3 class="text-xl font-bold text-white mb-6">Collaborateurs (${state.teamMembers.length})</h3>
            
            ${state.teamMembers.length === 0 ? `
              <div class="text-center py-16">
                <div class="text-6xl mb-4 animate-float">👥</div>
                <h4 class="text-xl font-bold text-white mb-2">Aucun collaborateur</h4>
                <p class="text-slate-400 mb-6">Invitez des membres de votre équipe pour collaborer efficacement</p>
                ${canAdd ? `
                  <button onclick="setState({showAddMember: true})" class="px-8 py-4 btn-primary rounded-xl font-semibold text-lg">
                    ${icons.plus} Inviter votre premier collaborateur
                  </button>
                ` : `
                  <div class="inline-block px-6 py-3 bg-slate-800 rounded-xl">
                    <p class="text-slate-400">
                      Votre plan ${planName} ne permet pas d'ajouter de collaborateurs.
                      <button onclick="setState({currentPage: 'subscription'})" class="text-amber-400 underline hover:text-amber-300 ml-1">Changer de plan</button>
                    </p>
                  </div>
                `}
              </div>
            ` : `
              <div class="space-y-3">
                ${state.teamMembers.map((member, index) => `
                  <div class="flex items-center justify-between p-5 bg-slate-800/50 rounded-xl hover:bg-slate-800 transition-all animate-slideInRight" style="animation-delay: ${index * 0.1}s; opacity: 0">
                    <div class="flex items-center gap-4">
                      <div class="w-14 h-14 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold text-xl shadow-lg">
                        ${member.name.charAt(0).toUpperCase()}
                      </div>
                      <div>
                        <div class="text-white font-semibold text-lg">${member.name}</div>
                        <div class="text-slate-400 text-sm">${member.email}</div>
                        ${member.phone ? `<div class="text-slate-500 text-xs mt-1">📞 ${member.phone}</div>` : ''}
                      </div>
                    </div>

                    <div class="flex items-center gap-4">
                      <div class="text-right">
                        ${member.status === 'active' ? `
                          <span class="px-4 py-2 bg-green-500/20 text-green-400 rounded-lg text-sm font-semibold flex items-center gap-2">
                            <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                            Actif
                          </span>
                          <div class="text-slate-400 text-xs mt-2">
                            Dernière connexion : ${member.lastLogin ? new Date(member.lastLogin).toLocaleDateString('fr-FR') : 'Jamais'}
                          </div>
                        ` : `
                          <span class="px-4 py-2 bg-orange-500/20 text-orange-400 rounded-lg text-sm font-semibold flex items-center gap-2">
                            <span class="w-2 h-2 bg-orange-400 rounded-full"></span>
                            En attente
                          </span>
                          <div class="text-slate-400 text-xs mt-2">
                            Invité le ${new Date(member.invitedDate).toLocaleDateString('fr-FR')}
                          </div>
                        `}
                      </div>

                      <div class="flex gap-2">
                        ${member.status === 'pending' ? `
                          <button 
                            onclick="resendInvitation(${member.id})"
                            class="px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 rounded-lg font-semibold transition-all flex items-center gap-2"
                            title="Renvoyer l'invitation"
                          >
                            📧 Renvoyer
                          </button>
                        ` : ''}
                        <button 
                          onclick="removeMember(${member.id})"
                          class="px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg font-semibold transition-all"
                          title="Retirer l'accès"
                        >
                          ${icons.x}
                        </button>
                      </div>
                    </div>
                  </div>
                `).join('')}
              </div>
            `}
          </div>

          <!-- Comparaison des plans -->
          <div class="glass rounded-2xl p-6">
            <h3 class="text-xl font-bold text-white mb-4">💡 Limites par abonnement</h3>
            <div class="grid md:grid-cols-3 gap-4">
              <div class='p-4 bg-slate-800/50 rounded-xl ${state.subscription.currentPlan === "starter" ? "ring-2 ring-amber-400" : ""}'>
                <div class="text-lg font-bold text-white mb-2">Starter - 29€/mois</div>
                <div class="text-3xl font-bold text-red-400 mb-2">0</div>
                <div class="text-slate-400 text-sm">Aucun collaborateur</div>
              </div>
              <div class='p-4 bg-slate-800/50 rounded-xl ${state.subscription.currentPlan === "pro" ? "ring-2 ring-amber-400" : ""}'>
                <div class="text-lg font-bold text-white mb-2">Pro - 59€/mois ⭐</div>
                <div class="text-3xl font-bold text-blue-400 mb-2">1</div>
                <div class="text-slate-400 text-sm">1 collaborateur</div>
              </div>
              <div class='p-4 bg-slate-800/50 rounded-xl ${hasEnterpriseAccess() ? "ring-2 ring-amber-400" : ""}'>
                <div class="text-lg font-bold text-white mb-2">Entreprise - 169€/mois</div>
                <div class="text-3xl font-bold text-green-400 mb-2">∞</div>
                <div class="text-slate-400 text-sm">Collaborateurs illimités</div>
              </div>
            </div>
          </div>

          <!-- Info -->
          <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-5">
            <h4 class="text-white font-semibold mb-3 flex items-center gap-2">
              💡 Comment ça marche ?
            </h4>
            <ul class="text-slate-300 text-sm space-y-2">
              <li class="flex items-start gap-2">
                <span class="text-blue-400">•</span>
                <span>Les collaborateurs reçoivent un email d'invitation avec un lien sécurisé</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-blue-400">•</span>
                <span>Ils créent leur compte et accèdent immédiatement à l'application</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-blue-400">•</span>
                <span>Vous pouvez retirer l'accès à tout moment depuis cette page</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-blue-400">•</span>
                <span>Le nombre de collaborateurs autorisés dépend de votre abonnement</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- Modal Ajouter Collaborateur -->
        ${state.showAddMember ? `
          <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fadeIn" onclick="if(event.target === event.currentTarget) setState({showAddMember: false})">
            <div class="glass rounded-2xl max-w-2xl w-full p-8 animate-scaleIn">
              <div class="flex items-center justify-between mb-6">
                <div>
                  <h3 class="text-2xl font-bold text-white mb-2">Ajouter un collaborateur</h3>
                  <p class="text-slate-400">Invitez un membre de votre équipe</p>
                </div>
                <button onclick="setState({showAddMember: false})" class="text-slate-400 hover:text-white transition-all">
                  <div class="w-8 h-8">${icons.x}</div>
                </button>
              </div>

              <div class="space-y-4">
                <div>
                  <label class="block text-white font-semibold mb-2">Nom complet *</label>
                  <input
                    type="text"
                    value="${state.newMember.name}"
                    oninput="setState({newMember: {...state.newMember, name: event.target.value}})"
                    placeholder="Ex: Marie Dubois"
                    class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  />
                </div>

                <div>
                  <label class="block text-white font-semibold mb-2">Email professionnel *</label>
                  <input
                    type="email"
                    value="${state.newMember.email}"
                    oninput="setState({newMember: {...state.newMember, email: event.target.value}})"
                    placeholder="marie@agence.com"
                    class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  />
                </div>

                <div>
                  <label class="block text-white font-semibold mb-2">Téléphone (optionnel)</label>
                  <input
                    type="tel"
                    value="${state.newMember.phone}"
                    oninput="setState({newMember: {...state.newMember, phone: event.target.value}})"
                    placeholder="06 12 34 56 78"
                    class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  />
                </div>

                <div>
                  <label class="block text-white font-semibold mb-2">Rôle</label>
                  <select
                    value="${state.newMember.role}"
                    onchange="setState({newMember: {...state.newMember, role: event.target.value}})"
                    class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-amber-400"
                  >
                    <option value="agent">Agent immobilier</option>
                    <option value="assistant">Assistant(e)</option>
                    <option value="admin">Administratif</option>
                  </select>
                </div>

                <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
                  <p class="text-blue-400 text-sm">
                    💡 Un email d'invitation sera envoyé à cette adresse avec un lien pour créer son compte.
                  </p>
                </div>
              </div>

              <div class="flex gap-3 mt-6">
                <button 
                  onclick="setState({showAddMember: false})" 
                  class="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all"
                >
                  Annuler
                </button>
                <button 
                  onclick="addTeamMember()" 
                  class="flex-1 px-6 py-3 btn-primary rounded-xl font-semibold"
                >
                  📧 Envoyer l'invitation
                </button>
              </div>
            </div>
          </div>
        ` : ''}
      `;
    }

    function render() {
      const app = document.getElementById('app');
      
      // Loading screen
      if (state.isLoading) {
        app.innerHTML = `
          <div class="fixed inset-0 flex items-center justify-center z-50 overflow-hidden">
            <!-- Animated waves background -->
            <div class="wave-container">
              <svg class="wave-svg" viewBox="0 0 2000 1000" preserveAspectRatio="none">
                <!-- Wave 1 - Purple -->
                <path class="wave-path-1" d="M 0 500 Q 250 300, 500 500 T 1000 500 T 1500 500 T 2000 500" />
                <path class="wave-path-1" d="M 0 450 Q 300 250, 600 450 T 1200 450 T 1800 450 T 2400 450" />
                
                <!-- Wave 2 - Pink -->
                <path class="wave-path-2" d="M 0 550 Q 200 700, 400 550 T 800 550 T 1200 550 T 1600 550 T 2000 550" />
                <path class="wave-path-2" d="M 0 600 Q 350 750, 700 600 T 1400 600 T 2100 600" />
                
                <!-- Wave 3 - Deep Purple -->
                <path class="wave-path-3" d="M 0 400 Q 280 200, 560 400 T 1120 400 T 1680 400 T 2240 400" />
                
                <!-- Wave 4 - Deep Pink -->
                <path class="wave-path-4" d="M 0 650 Q 220 800, 440 650 T 880 650 T 1320 650 T 1760 650 T 2200 650" />
                
                <!-- Wave 5 - Light Purple -->
                <path class="wave-path-5" d="M 0 350 Q 320 180, 640 350 T 1280 350 T 1920 350" />
                <path class="wave-path-5" d="M 0 700 Q 240 850, 480 700 T 960 700 T 1440 700 T 1920 700" />
              </svg>
            </div>
            
            <!-- Bouton Connexion en haut à droite -->
            <div class="absolute top-8 right-8 z-20 animate-slideInRight">
              <button 
                onclick="setState({showLoginChoice: true})"
                class="login-btn-gold px-8 py-3 rounded-2xl font-bold text-lg transition-all flex items-center gap-2"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                Connexion
              </button>
            </div>
            
            <!-- Content -->
            <div class="text-center relative z-10 px-4">
              <!-- Company Name - HUGE -->
              <!-- Company Name - HUGE with brilliant effects -->
              <div class="relative inline-block mb-6">
                <!-- Particles around logo -->
                <div class="logo-particles">
                  ${Array.from({length: 12}, (_, i) => `
                    <div class="logo-particle" style="
                      animation-duration: ${4 + i * 0.5}s;
                      animation-delay: ${i * 0.3}s;
                    "></div>
                  `).join('')}
                </div>
                
                <h1 class="text-8xl md:text-9xl font-bold animate-slideInUp" style="
                  font-family: 'Raleway', sans-serif;
                  font-weight: 800;
                  letter-spacing: 0.05em;
                  background: linear-gradient(
                    90deg,
                    #fbbf24 0%,
                    #f59e0b 25%,
                    #fbbf24 50%,
                    #f59e0b 75%,
                    #fbbf24 100%
                  );
                  background-size: 200% auto;
                  -webkit-background-clip: text;
                  -webkit-text-fill-color: transparent;
                  background-clip: text;
                  animation: logoGlow 3s ease-in-out infinite, 
                             logoShimmer 4s linear infinite,
                             logoFloat 6s ease-in-out infinite;
                  text-shadow: 
                    0 0 10px rgba(251, 191, 36, 0.3),
                    0 0 20px rgba(251, 191, 36, 0.2),
                    0 0 30px rgba(251, 191, 36, 0.1);
                  position: relative;
                  z-index: 2;
                ">
                  Realtix Pro
                </h1>
              </div>
              
              <!-- Tagline 1 -->
              <h2 class="text-3xl md:text-4xl font-bold mb-4 animate-slideInUp" style="
                animation-delay: 0.1s;
                font-family: 'Outfit', sans-serif;
                font-weight: 800;
                background: linear-gradient(90deg, 
                  #d4a017 0%, #e8b84d 15%, #f4c89f 30%, #e8a5a5 45%,
                  #d8a5d8 60%, #a89bd8 75%, #8b7dd8 90%, #7b68d8 100%
                );
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
              ">
                Simplifiez la gestion de vos copropriétés
              </h2>
              
              <!-- Tagline 2 -->
              <p class="text-xl md:text-2xl mb-12 animate-slideInUp" style="
                animation-delay: 0.15s;
                font-family: 'Outfit', sans-serif;
                font-weight: 500;
                background: linear-gradient(90deg, 
                  #d4a017 0%, #e8b84d 15%, #f4c89f 30%, #e8a5a5 45%,
                  #d8a5d8 60%, #a89bd8 75%, #8b7dd8 90%, #7b68d8 100%
                );
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
              ">
                Une plateforme intuitive pour les syndics et les propriétaires
              </p>
              
              <!-- Enter Button -->
              <button 
                onclick="setState({isLoading: false, showPublicLanding: true})"
                class="px-12 py-5 rounded-2xl font-bold text-xl transition-all animate-slideInUp"
                style="
                  animation-delay: 0.2s;
                  background: linear-gradient(90deg, 
                    transparent 0%,
                    rgba(251, 191, 36, 0.1) 50%,
                    transparent 100%
                  );
                  background-size: 200% 100%;
                  border: 2px solid rgba(251, 191, 36, 0.6);
                  color: #fbbf24;
                  text-shadow: 0 0 20px rgba(251, 191, 36, 0.8);
                  animation: slideInUp 0.6s ease-out forwards 0.2s, buttonPulse 2s ease-in-out infinite 1s, buttonShine 3s linear infinite;
                  backdrop-filter: blur(10px);
                  cursor: pointer;
                "
                onmouseover="this.style.borderColor='rgba(251, 191, 36, 1)'; this.style.background='rgba(251, 191, 36, 0.15)'"
                onmouseout="this.style.borderColor='rgba(251, 191, 36, 0.6)'; this.style.background='linear-gradient(90deg, transparent 0%, rgba(251, 191, 36, 0.1) 50%, transparent 100%)'; this.style.backgroundSize='200% 100%'"
              >
                Entrer
              </button>
            </div>
            
            <!-- Modal de choix de connexion -->
            ${state.showLoginChoice ? `
              <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fadeIn" onclick="if(event.target === event.currentTarget) setState({showLoginChoice: false, loginEmail: ''})">
                <div class="glass rounded-3xl p-8 max-w-4xl w-full mx-4 animate-slideInUp" onclick="event.stopPropagation()">
                  
                  ${!state.loginEmail ? `
                    <!-- Étape 1: Demander l'email -->
                    <div class="text-center mb-8">
                      <h2 class="text-4xl font-bold text-white mb-3" style="
                        background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 50%, #fbbf24 100%);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                      ">
                        Connexion à Realtix Pro
                      </h2>
                      <p class="text-slate-300 text-lg mb-8">Entrez votre adresse email pour continuer</p>
                      
                      <div class="max-w-md mx-auto">
                        <input
                          type="email"
                          id="loginEmailInput"
                          placeholder="votre.email@exemple.com"
                          class="w-full px-6 py-4 bg-slate-800/50 border-2 border-slate-700 hover:border-amber-500/50 focus:border-amber-500 rounded-xl text-white text-lg placeholder-slate-500 focus:outline-none transition-all"
                          onkeypress="if(event.key === 'Enter') { const email = event.target.value; if(email) setState({loginEmail: email.toLowerCase()}); }"
                        />
                        <button
                          onclick="const email = document.getElementById('loginEmailInput').value; if(email) setState({loginEmail: email.toLowerCase()});"
                          class="w-full mt-4 px-8 py-4 bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-slate-900 font-bold text-lg rounded-xl transition-all hover:scale-105 shadow-lg hover:shadow-amber-500/50"
                        >
                          Continuer →
                        </button>
                      </div>
                    </div>
                  ` : `
                    <!-- Étape 2: Choix du rôle (selon les autorisations) -->
                    <div class="text-center mb-8">
                      <h2 class="text-4xl font-bold text-white mb-3" style="
                        background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 50%, #fbbf24 100%);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                      ">
                        Choisissez votre rôle
                      </h2>
                      <p class="text-slate-300 text-lg">
                        <span class="text-amber-400">${state.loginEmail}</span>
                      </p>
                    </div>
                    
                    <!-- Choix des rôles -->
                    <div class="grid ${isInvitedAgent(state.loginEmail) ? 'md:grid-cols-1 max-w-md mx-auto' : 'md:grid-cols-2'} gap-6 mb-6">
                      ${!isInvitedAgent(state.loginEmail) ? `
                        <!-- Gérant (seulement si pas un agent invité) -->
                        <button 
                          onclick="setState({currentUser: {name: 'Philippe Rousseau', role: 'manager', email: '${state.loginEmail}'}, currentPage: 'dashboard', showPublicLanding: false, isLoading: false, showLoginChoice: false, loginEmail: ''})"
                          class="group relative overflow-hidden bg-gradient-to-br from-purple-500/20 to-purple-600/20 hover:from-purple-500/30 hover:to-purple-600/30 border-2 border-purple-500/50 hover:border-purple-400 rounded-2xl p-8 transition-all hover:scale-105 hover:shadow-2xl hover:shadow-purple-500/30"
                        >
                          <div class="relative z-10">
                            <div class="w-24 h-24 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center text-5xl shadow-lg">
                              👔
                            </div>
                            <h3 class="text-2xl font-bold text-white mb-2 group-hover:text-purple-300 transition-colors">Gérant</h3>
                            <p class="text-slate-300 mb-4">Accès complet à toutes les fonctionnalités</p>
                            <div class="space-y-2 text-sm text-slate-400">
                              <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                <span>Gestion complète</span>
                              </div>
                              <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                <span>Tous les modules</span>
                              </div>
                              <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                <span>Gestion d'équipe</span>
                              </div>
                            </div>
                          </div>
                        </button>
                      ` : ''}
                      
                      <!-- Agent (toujours visible) -->
                      <button 
                        onclick="setState({currentUser: {name: '${getMemberByEmail(state.loginEmail)?.name || 'Agent Commercial'}', role: 'agent', email: '${state.loginEmail}'}, currentPage: 'dashboard', showPublicLanding: false, isLoading: false, showLoginChoice: false, loginEmail: ''})"
                        class="group relative overflow-hidden bg-gradient-to-br from-blue-500/20 to-blue-600/20 hover:from-blue-500/30 hover:to-blue-600/30 border-2 border-blue-500/50 hover:border-blue-400 rounded-2xl p-8 transition-all hover:scale-105 hover:shadow-2xl hover:shadow-blue-500/30"
                      >
                        <div class="relative z-10">
                          <div class="w-24 h-24 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-5xl shadow-lg">
                            🏢
                          </div>
                          <h3 class="text-2xl font-bold text-white mb-2 group-hover:text-blue-300 transition-colors">Agent</h3>
                          <p class="text-slate-300 mb-4">Accès aux fonctionnalités essentielles</p>
                          ${isInvitedAgent(state.loginEmail) ? `
                            <div class="mb-4 p-3 bg-green-500/20 border border-green-500/50 rounded-lg">
                              <p class="text-green-400 text-sm font-semibold">✓ Membre de l'équipe</p>
                            </div>
                          ` : ''}
                          <div class="space-y-2 text-sm text-slate-400">
                            <div class="flex items-center gap-2">
                              <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                              </svg>
                              <span>Gestion des biens</span>
                            </div>
                            <div class="flex items-center gap-2">
                              <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                              </svg>
                              <span>Gestion des visites</span>
                            </div>
                            <div class="flex items-center gap-2">
                              <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                              </svg>
                              <span>Suivi des clients</span>
                            </div>
                          </div>
                        </div>
                      </button>
                    </div>
                    
                    <!-- Bouton retour -->
                    <div class="text-center">
                      <button 
                        onclick="setState({loginEmail: ''})"
                        class="text-slate-400 hover:text-white transition-colors underline"
                      >
                        ← Changer d'email
                      </button>
                    </div>
                  `}
                  
                  ${!state.loginEmail ? `
                    <div class="text-center mt-6">
                      <button 
                        onclick="setState({showLoginChoice: false})"
                        class="text-slate-400 hover:text-white transition-colors underline"
                      >
                        Retour à l'accueil
                      </button>
                    </div>
                  ` : ''}
                </div>
              </div>
            ` : ''}
          </div>
        `;
        return;
      }
      
      // Appliquer le thème et la police
      document.body.className = `bg-slate-900 text-white theme-${state.customization.theme} font-${state.customization.fontFamily}`;
      
      // Pages publiques accessibles sans connexion
      if (['cgu', 'privacy', 'contact'].includes(state.currentPage)) {
        app.innerHTML = `
          <div class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 relative">
            ${renderNeonBackground()}
            
            <div class="relative z-10">
              <nav class="bg-slate-800/50 backdrop-blur-sm border-b border-slate-700 px-6 py-4">
                <div class="max-w-7xl mx-auto flex items-center justify-between">
                  <button onclick="setState({currentPage: 'login', showPublicLanding: true})" class="flex items-center gap-3 hover:opacity-80 transition-all">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center text-white font-bold text-xl">
                      R
                    </div>
                    <span class="text-xl font-bold text-white">Realtix Pro</span>
                  </button>
                  <button onclick="setState({currentPage: 'login', showPublicLanding: true})" class="text-blue-400 hover:text-blue-300 flex items-center gap-2">
                    ← Retour à l'accueil
                  </button>
                </div>
              </nav>
              <div class="p-6">
                ${state.currentPage === 'cgu' ? renderCGU() : ''}
                ${state.currentPage === 'privacy' ? renderPrivacy() : ''}
                ${state.currentPage === 'contact' ? renderContact() : ''}
              </div>
            </div>
          </div>
        `;
        return;
      }
      
      if (state.currentPage === 'login') {
        if (state.showPublicLanding) {
          app.innerHTML = renderPublicLandingPage();
        } else {
          app.innerHTML = renderLoginPage();
        }
        return;
      }

      const stats = getStats();
      const pageTitle = {
        'dashboard': 'Tableau de bord',
        'ai': 'Assistant IA',
        'reports': 'Rapports & Analytics',
        'properties': 'Gestion des biens',
        'clients': 'Gestion des clients',
        'visits': 'Calendrier des visites',
        'email-ai': 'IA Email - Générateur Automatique',
        'tools': 'Outils Avancés',
        'team': "Gestion d'Équipe",
        'subscription': 'Abonnement & Facturation',
        'settings': 'Mon Compte'
      }[state.currentPage] || 'Realtix Pro';

      app.innerHTML = `
        <div class="min-h-screen bg-slate-900 flex relative">
          ${renderNeonBackground()}
          
          <div class="relative z-10 flex w-full">
          <!-- Sidebar -->
          <div class='${state.mobileMenuOpen ? "translate-x-0" : "-translate-x-full"} md:translate-x-0 fixed md:static inset-y-0 left-0 z-50 w-72 bg-slate-800/30 backdrop-blur-md border-r border-slate-700/30 p-6 transition-transform duration-300'>
            <div class="flex items-center justify-between mb-8">
              <button onclick="setState({currentPage: 'dashboard', mobileMenuOpen: false})" class="flex items-center gap-3 hover:opacity-80 transition-all">
                <div class="text-amber-400">${icons.aiLogo}</div>
                <div>
                  <h1 class="text-xl font-bold text-white">Realtix</h1>
                  <p class="text-xs text-slate-400">Pro Edition</p>
                </div>
              </button>
              
              <button onclick="setState({mobileMenuOpen: false})" class="md:hidden text-slate-400">
                ${icons.x}
              </button>
            </div>

            <div class="mb-8 p-4 bg-slate-700/50 rounded-xl border border-slate-600">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 rounded-full bg-amber-400 flex items-center justify-center text-slate-900 font-bold">
                  ${state.currentUser.name.charAt(0)}
                </div>
                <div class="flex-1">
                  <div class="text-white font-semibold text-sm">${state.currentUser.name}</div>
                  <div class="text-slate-400 text-xs capitalize">${state.currentUser.role}</div>
                </div>
              </div>
            </div>

            <nav class="space-y-2 mb-8">
              <button onclick="setState({currentPage: 'dashboard', mobileMenuOpen: false})" class='w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${state.currentPage === "dashboard" ? "bg-amber-400 text-slate-900 font-semibold shadow-lg" : "text-slate-300 hover:bg-slate-700/50"}'>
                ${icons.chart}
                <span>Tableau de bord</span>
              </button>
              ${state.currentUser.role === 'manager' && hasEnterpriseAccess() ? `
              <button onclick="setState({currentPage: 'ai', mobileMenuOpen: false, onboardingChecklist: {...state.onboardingChecklist, exploreAI: true}})" class='w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${state.currentPage === "ai" ? "bg-amber-400 text-slate-900 font-semibold shadow-lg" : "text-slate-300 hover:bg-slate-700/50"}'>
                ${icons.brain}
                <span>IA Assistant</span>
                ${getHotLeadsCount() > 0 ? `<span class="ml-auto bg-red-500 text-white text-xs px-2 py-0.5 rounded-full font-bold animate-pulse">${getHotLeadsCount()} 🔥</span>` : ''}
              </button>
              ` : ''}${state.currentUser.role === 'manager' && hasEnterpriseAccess() ? `
              <button onclick="setState({currentPage: 'reports', mobileMenuOpen: false, onboardingChecklist: {...state.onboardingChecklist, viewReports: true}})" class='w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${state.currentPage === "reports" ? "bg-amber-400 text-slate-900 font-semibold shadow-lg" : "text-slate-300 hover:bg-slate-700/50"}'>
                ${icons.fileText}
                <span>Rapports & Analytics</span>
                <span class="ml-auto bg-amber-400/20 text-amber-400 text-xs px-2 py-0.5 rounded-full font-bold">ENTREPRISE</span>
              </button>
              ` : ''}
              <button onclick="setState({currentPage: 'properties', mobileMenuOpen: false})" class='w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${state.currentPage === "properties" ? "bg-amber-400 text-slate-900 font-semibold shadow-lg" : "text-slate-300 hover:bg-slate-700/50"}'>
                ${icons.home}
                <span>Biens</span>
              </button>
              <button onclick="setState({currentPage: 'clients', mobileMenuOpen: false})" class='w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${state.currentPage === "clients" ? "bg-amber-400 text-slate-900 font-semibold shadow-lg" : "text-slate-300 hover:bg-slate-700/50"}'>
                ${icons.users}
                <span>Clients</span>
              </button>
              <button onclick="setState({currentPage: 'visits', mobileMenuOpen: false})" class='w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${state.currentPage === "visits" ? "bg-amber-400 text-slate-900 font-semibold shadow-lg" : "text-slate-300 hover:bg-slate-700/50"}'>
                ${icons.calendar}
                <span>Visites</span>
                ${stats.upcomingVisits > 0 ? `<span class="ml-auto bg-red-500 text-white text-xs px-2 py-0.5 rounded-full font-bold">${stats.upcomingVisits}</span>` : ''}
              </button>
              <button onclick="setState({currentPage: 'email-ai', mobileMenuOpen: false})" class='w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${state.currentPage === "email-ai" ? "bg-amber-400 text-slate-900 font-semibold shadow-lg" : "text-slate-300 hover:bg-slate-700/50"}'>
                ${icons.mail}
                <span>IA Email</span>
                <span class="ml-auto text-purple-400 text-xl">✨</span>
              </button>
              <button onclick="setState({currentPage: 'tools', mobileMenuOpen: false})" class='w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${state.currentPage === "tools" ? "bg-amber-400 text-slate-900 font-semibold shadow-lg" : "text-slate-300 hover:bg-slate-700/50"}'>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                <span>Outils Avancés</span>
                <span class="ml-auto text-green-400 text-xs font-bold">PRO</span>
              </button>
            </nav>

            <div class="border-t border-slate-700 pt-4 space-y-2">
              ${(hasProAccess() || hasEnterpriseAccess()) ? `
                <button onclick="setState({currentPage: 'syndic', mobileMenuOpen: false})" class='w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${state.currentPage === "syndic" ? "bg-gradient-to-r from-purple-500 to-blue-500 text-white font-semibold shadow-lg" : "text-slate-300 hover:bg-slate-700/50"}'>
                  <div class="text-xl">🏢</div>
                  <span>Pro Syndic</span>
                  <span class="ml-auto text-purple-400 text-xs font-bold">PRO</span>
                </button>
              ` : ''}
              
              <button onclick="setState({currentPage: 'settings', mobileMenuOpen: false, onboardingChecklist: {...state.onboardingChecklist, profile: true}})" class='w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${state.currentPage === "settings" ? "bg-amber-400 text-slate-900 font-semibold shadow-lg" : "text-slate-300 hover:bg-slate-700/50"}'>
                <div class="w-5 h-5">${icons.user}</div>
                <span>Mon Compte</span>
              </button>
            </div>

            ${state.currentUser.role === 'manager' ? `
              <button
                onclick="setState({currentPage: 'team'})"
                class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all bg-gradient-to-r from-blue-500/20 to-cyan-500/20 border border-blue-500/30 hover:border-blue-500/50 text-white mb-4"
              >
                👥
                <span class="font-semibold">Mon Équipe</span>
                <span class="ml-auto bg-blue-500/30 text-blue-300 text-xs px-2 py-0.5 rounded-full font-bold">${state.teamMembers.length}</span>
              </button>
            ` : ''}

            ${state.currentUser.role === 'manager' ? `
            <button
              onclick="setState({currentPage: 'subscription'})"
              class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all bg-gradient-to-r from-purple-500/20 to-blue-500/20 border border-purple-500/30 hover:border-purple-500/50 text-white mb-4"
            >
              ${icons.creditCard}
              <span class="font-semibold">Mon abonnement</span>
            </button>
            ` : ''}

            <button onclick="setState({currentUser: null, currentPage: 'login'})" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-red-400 hover:bg-red-500/10 transition-all">
              ${icons.logout}
              <span>Déconnexion</span>
            </button>
          </div>

          <!-- Main Content -->
          <div class="flex-1 flex flex-col">
            <!-- Top Bar -->
            <div class="bg-slate-800/30 backdrop-blur-md border-b border-slate-700/30 px-6 py-4">
              <div class="flex items-center justify-between">
                <button onclick="setState({mobileMenuOpen: true})" class="md:hidden text-white">
                  ${icons.menu}
                </button>
                <div class="text-white">
                  <h2 class="text-2xl font-bold">${pageTitle}</h2>
                  <p class="text-slate-400 text-sm mt-1">${new Date().toLocaleDateString('fr-FR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                </div>
                <div class="flex items-center gap-3">
                  ${state.currentUser.role === 'manager' ? `
                    <button 
                      onclick="toggleMessaging()" 
                      class="flex items-center gap-2 px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 rounded-lg transition-all"
                      title="Messagerie Agents"
                    >
                      📧 <span class="hidden lg:inline">Agents</span>
                    </button>
                  ` : ''}
                  <button 
                    onclick="startTutorial()" 
                    class="hidden md:flex items-center gap-2 px-4 py-2 bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 rounded-lg transition-all"
                    title="Lancer le tutoriel"
                  >
                    🎓 <span class="hidden lg:inline">Tutoriel</span>
                  </button>
                  <button 
                    onclick="toggleChecklist()" 
                    class='relative flex items-center gap-2 px-4 py-2 ${state.showChecklist ? "bg-amber-500/30" : "bg-amber-500/20 hover:bg-amber-500/30"} text-amber-400 rounded-lg transition-all'
                    title="Checklist de démarrage"
                  >
                    ✓ <span class="hidden lg:inline">Checklist</span>
                    ${Object.values(state.onboardingChecklist).filter(v => v).length < Object.keys(state.onboardingChecklist).length ? `
                      <span class="absolute -top-1 -right-1 w-6 h-6 bg-gradient-to-br from-red-500 to-red-600 text-white text-xs rounded-full flex items-center justify-center font-bold shadow-lg ring-2 ring-red-500/50 animate-pulse">
                        ${Object.keys(state.onboardingChecklist).length - Object.values(state.onboardingChecklist).filter(v => v).length}
                      </span>
                    ` : ''}
                  </button>
                </div>
              </div>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto p-6">
              ${state.currentPage === 'dashboard' ? renderDashboard() : ''}
              ${state.currentPage === 'ai' ? renderAI() : ''}
              ${state.currentPage === 'reports' ? renderReports() : ''}
              ${state.currentPage === 'properties' ? renderProperties() : ''}
              ${state.currentPage === 'clients' ? renderClients() : ''}
              ${state.currentPage === 'visits' ? renderVisits() : ''}
              ${state.currentPage === 'email-ai' ? renderEmailAI() : ''}
              ${state.currentPage === 'tools' ? renderTools() : ''}
              ${state.currentPage === 'team' ? renderTeamManagement() : ''}
              ${state.currentPage === 'subscription' ? renderSubscription() : ''}
              ${state.currentPage === 'syndic' ? renderSyndic() : ''}
              ${state.currentPage === 'settings' ? renderSettings() : ''}
              ${state.currentPage === 'cgu' ? renderCGU() : ''}
              ${state.currentPage === 'privacy' ? renderPrivacy() : ''}
              ${state.currentPage === 'contact' ? renderContact() : ''}
            </div>
          </div>
        </div>

        ${renderModalAddProperty()}
        ${renderModalAddClient()}
        ${renderModalAddVisit()}

        <!-- Chat System -->
        ${renderChatSystem()}

        <!-- Tutorial Overlay -->
        ${renderTutorial()}

        <!-- Checklist -->
        ${renderChecklist()}

        <!-- Messaging Modal -->
        ${renderMessaging()}
        </div>
        <!-- End z-10 wrapper -->
      `;
    }

    // ===== PAGES LÉGALES =====

    function renderCGU() {
      const backPage = state.currentUser ? 'dashboard' : 'login';
      const backState = state.currentUser ? {currentPage: 'dashboard'} : {currentPage: 'login', showPublicLanding: true};
      return `
        <div class="max-w-4xl mx-auto">
          <div class="glass rounded-2xl p-8 animate-fadeInScale">
            <div class="mb-8">
              <button onclick='setState(${JSON.stringify(backState)})' class="text-blue-400 hover:text-blue-300 flex items-center gap-2 mb-4">
                ← Retour
              </button>
              <h1 class="text-4xl font-bold text-white mb-2">Conditions Générales d'Utilisation</h1>
              <p class="text-slate-400">Dernière mise à jour : 31 janvier 2026</p>
            </div>

            <div class="prose prose-invert max-w-none space-y-6 text-slate-300">
              <section>
                <h2 class="text-2xl font-bold text-white mb-4">1. Objet</h2>
                <p>Les présentes Conditions Générales d'Utilisation (ci-après « CGU ») régissent l'accès et l'utilisation de la plateforme Realtix Pro (ci-après « la Plateforme »), éditée par Realtix SAS.</p>
                <p>En accédant à la Plateforme, vous acceptez sans réserve les présentes CGU. Si vous n\'acceptez pas ces conditions, vous ne devez pas utiliser la Plateforme.</p>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">2. Description du Service</h2>
                <p>Realtix Pro est une plateforme SaaS (Software as a Service) destinée aux professionnels de l'immobilier, offrant :</p>
                <ul class="list-disc pl-6 space-y-2">
                  <li>Gestion de biens immobiliers et de clients</li>
                  <li>Planification et suivi des visites</li>
                  <li>Générateur d\'emails assisté par IA</li>
                  <li>Outils d'analyse et de reporting</li>
                  <li>Fonctionnalités de collaboration en équipe</li>
                  <li>Lead scoring et recommandations automatisées</li>
                </ul>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">3. Inscription et Compte Utilisateur</h2>
                <h3 class="text-xl font-semibold text-white mb-2">3.1 Conditions d'inscription</h3>
                <p>L'inscription est réservée aux professionnels de l'immobilier (agences, agents indépendants). Vous devez :</p>
                <ul class="list-disc pl-6 space-y-2">
                  <li>Être âgé de 18 ans minimum</li>
                  <li>Fournir des informations exactes et à jour</li>
                  <li>Disposer d\'une carte professionnelle d'agent immobilier en cours de validité</li>
                </ul>
                
                <h3 class="text-xl font-semibold text-white mb-2 mt-4">3.2 Sécurité du compte</h3>
                <p>Vous êtes responsable de la confidentialité de vos identifiants de connexion. Toute activité effectuée via votre compte est présumée avoir été effectuée par vous.</p>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">4. Abonnements et Tarification</h2>
                <h3 class="text-xl font-semibold text-white mb-2">4.1 Formules d'abonnement</h3>
                <p>Nous proposons trois formules d'abonnement :</p>
                <ul class="list-disc pl-6 space-y-2">
                  <li><strong>Starter</strong> : 29€/mois (290€/an)</li>
                  <li><strong>Pro</strong> : 79€/mois (790€/an)</li>
                  <li><strong>Entreprise</strong> : 149€/mois (1490€/an)</li>
                </ul>

                ${!state.subscription.hasUsedFreeTrial ? `
                  <h3 class="text-xl font-semibold text-white mb-2 mt-4">4.2 Essai gratuit</h3>
                  <p>Un essai gratuit de 7 jours avec accès complet aux fonctionnalités Entreprise est proposé, sans obligation de carte bancaire.</p>
                ` : ''}

                <h3 class="text-xl font-semibold text-white mb-2 mt-4">${!state.subscription.hasUsedFreeTrial ? '4.3' : '4.2'} Paiement</h3>
                <p>Les paiements sont effectués par carte bancaire via notre prestataire de paiement sécurisé Stripe. Les abonnements sont renouvelés automatiquement sauf annulation.</p>

                <h3 class="text-xl font-semibold text-white mb-2 mt-4">${!state.subscription.hasUsedFreeTrial ? '4.4' : '4.3'} Résiliation</h3>
                <p>Vous pouvez résilier votre abonnement à tout moment depuis votre espace "Mon abonnement". La résiliation prend effet à la fin de la période en cours.</p>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">5. Utilisation de la Plateforme</h2>
                <h3 class="text-xl font-semibold text-white mb-2">5.1 Utilisation autorisée</h3>
                <p>Vous vous engagez à utiliser la Plateforme uniquement à des fins professionnelles légitimes et conformément aux lois en vigueur.</p>

                <h3 class="text-xl font-semibold text-white mb-2 mt-4">5.2 Utilisation interdite</h3>
                <p>Il est strictement interdit de :</p>
                <ul class="list-disc pl-6 space-y-2">
                  <li>Utiliser la Plateforme à des fins illégales</li>
                  <li>Tenter d'accéder aux données d'autres utilisateurs</li>
                  <li>Perturber le fonctionnement de la Plateforme</li>
                  <li>Utiliser des robots, scrapers ou outils automatisés</li>
                  <li>Revendre ou sous-licencier l'accès à la Plateforme</li>
                </ul>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">6. Propriété Intellectuelle</h2>
                <p>La Plateforme, son contenu, ses fonctionnalités et tous les droits de propriété intellectuelle associés restent la propriété exclusive de Realtix SAS.</p>
                <p>Vous conservez tous les droits sur les données que vous importez sur la Plateforme.</p>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">7. Protection des Données</h2>
                <p>Nous nous engageons à protéger vos données personnelles conformément au RGPD. Pour plus d\'informations, consultez notre <a href="#" onclick="setState({currentPage: 'privacy'}); return false;" class="text-blue-400 hover:text-blue-300">Politique de Confidentialité</a>.</p>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">8. Garanties et Responsabilités</h2>
                <h3 class="text-xl font-semibold text-white mb-2">8.1 Disponibilité</h3>
                <p>Nous nous efforçons d'assurer une disponibilité de 99,9% de la Plateforme. Des interruptions peuvent survenir pour maintenance.</p>

                <h3 class="text-xl font-semibold text-white mb-2 mt-4">8.2 Limitation de responsabilité</h3>
                <p>Realtix Pro ne saurait être tenu responsable des dommages indirects, pertes de données ou manque à gagner résultant de l'utilisation de la Plateforme.</p>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">9. Modifications des CGU</h2>
                <p>Nous nous réservons le droit de modifier les présentes CGU à tout moment. Les modifications entrent en vigueur dès leur publication sur la Plateforme.</p>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">10. Droit Applicable et Juridiction</h2>
                <p>Les présentes CGU sont régies par le droit français. Tout litige sera soumis aux tribunaux compétents de Paris.</p>
              </section>

              <section class="bg-slate-800/50 rounded-xl p-6">
                <h2 class="text-2xl font-bold text-white mb-4">Contact</h2>
                <p><strong>Realtix SAS</strong></p>
                <p>Capital social : 50 000 €</p>
                <p>SIRET : 123 456 789 00012</p>
                <p>Email : realtixpro@gmail.com</p>
                <p>Adresse : 123 Avenue des Champs-Élysées, 75008 Paris, France</p>
              </section>
            </div>
          </div>
        </div>
      `;
    }

    function renderPrivacy() {
      const backState = state.currentUser ? {currentPage: 'dashboard'} : {currentPage: 'login', showPublicLanding: true};
      return `
        <div class="max-w-4xl mx-auto">
          <div class="glass rounded-2xl p-8 animate-fadeInScale">
            <div class="mb-8">
              <button onclick='setState(${JSON.stringify(backState)})' class="text-blue-400 hover:text-blue-300 flex items-center gap-2 mb-4">
                ← Retour
              </button>
              <h1 class="text-4xl font-bold text-white mb-2">Politique de Confidentialité</h1>
              <p class="text-slate-400">Dernière mise à jour : 31 janvier 2026</p>
            </div>

            <div class="prose prose-invert max-w-none space-y-6 text-slate-300">
              <section class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-6">
                <p class="text-lg"><strong>Chez Realtix Pro, nous prenons la protection de vos données personnelles très au sérieux.</strong> Cette politique explique comment nous collectons, utilisons et protégeons vos informations conformément au Règlement Général sur la Protection des Données (RGPD).</p>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">1. Responsable du Traitement</h2>
                <p><strong>Realtix SAS</strong></p>
                <p>123 Avenue des Champs-Élysées<br/>
                75008 Paris, France<br/>
                Email : realtixpro@gmail.com<br/>
                Téléphone : +33 1 23 45 67 89</p>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">2. Données Collectées</h2>
                <h3 class="text-xl font-semibold text-white mb-2">2.1 Données d'inscription</h3>
                <ul class="list-disc pl-6 space-y-2">
                  <li>Nom et prénom</li>
                  <li>Adresse email professionnelle</li>
                  <li>Numéro de téléphone</li>
                  <li>Nom de l'agence immobilière</li>
                  <li>Numéro de carte professionnelle</li>
                </ul>

                <h3 class="text-xl font-semibold text-white mb-2 mt-4">2.2 Données d'utilisation</h3>
                <ul class="list-disc pl-6 space-y-2">
                  <li>Logs de connexion (adresse IP, date, heure)</li>
                  <li>Interactions avec la plateforme</li>
                  <li>Préférences utilisateur</li>
                  <li>Statistiques d'utilisation anonymisées</li>
                </ul>

                <h3 class="text-xl font-semibold text-white mb-2 mt-4">2.3 Données professionnelles</h3>
                <ul class="list-disc pl-6 space-y-2">
                  <li>Biens immobiliers gérés</li>
                  <li>Clients et prospects</li>
                  <li>Visites et rendez-vous</li>
                  <li>Communications (emails, SMS)</li>
                </ul>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">3. Finalités du Traitement</h2>
                <p>Nous utilisons vos données pour :</p>
                <ul class="list-disc pl-6 space-y-2">
                  <li><strong>Fourniture du service</strong> : Accès à la plateforme et ses fonctionnalités</li>
                  <li><strong>Gestion du compte</strong> : Authentification, facturation, support client</li>
                  <li><strong>Amélioration du service</strong> : Analyse d'usage, développement de nouvelles fonctionnalités</li>
                  <li><strong>Communications</strong> : Notifications importantes, newsletters (avec consentement)</li>
                  <li><strong>Sécurité</strong> : Prévention des fraudes, protection des données</li>
                </ul>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">4. Base Légale du Traitement</h2>
                <p>Nous traitons vos données sur les bases suivantes :</p>
                <ul class="list-disc pl-6 space-y-2">
                  <li><strong>Exécution du contrat</strong> : Pour fournir le service</li>
                  <li><strong>Obligations légales</strong> : Conservation des données comptables, réponses aux autorités</li>
                  <li><strong>Intérêt légitime</strong> : Sécurité, amélioration du service</li>
                  <li><strong>Consentement</strong> : Newsletters, cookies non essentiels</li>
                </ul>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">5. Partage des Données</h2>
                <p>Vos données peuvent être partagées avec :</p>
                <ul class="list-disc pl-6 space-y-2">
                  <li><strong>Prestataires de services</strong> : Hébergement (OVH France), paiement (Stripe), emailing</li>
                  <li><strong>Membres de votre équipe</strong> : Agents et collaborateurs autorisés</li>
                  <li><strong>Autorités</strong> : Si requis par la loi</li>
                </ul>
                <p class="mt-4"><strong>Nous ne vendons jamais vos données à des tiers.</strong></p>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">6. Transferts Internationaux</h2>
                <p>Vos données sont hébergées en France (OVH). Certains sous-traitants peuvent être situés hors UE (exemple : Stripe pour les paiements). Dans ce cas, des garanties appropriées sont mises en place (clauses contractuelles types).</p>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">7. Durée de Conservation</h2>
                <table class="w-full text-left border border-slate-700 rounded-lg overflow-hidden">
                  <thead class="bg-slate-800">
                    <tr>
                      <th class="px-4 py-3 border-b border-slate-700">Type de données</th>
                      <th class="px-4 py-3 border-b border-slate-700">Durée</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="border-b border-slate-700">
                      <td class="px-4 py-3">Données de compte actif</td>
                      <td class="px-4 py-3">Durée de l'abonnement + 3 ans</td>
                    </tr>
                    <tr class="border-b border-slate-700">
                      <td class="px-4 py-3">Données de facturation</td>
                      <td class="px-4 py-3">10 ans (obligation légale)</td>
                    </tr>
                    <tr class="border-b border-slate-700">
                      <td class="px-4 py-3">Logs de connexion</td>
                      <td class="px-4 py-3">1 an</td>
                    </tr>
                    <tr>
                      <td class="px-4 py-3">Données de prospects</td>
                      <td class="px-4 py-3">3 ans après dernier contact</td>
                    </tr>
                  </tbody>
                </table>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">8. Vos Droits</h2>
                <p>Conformément au RGPD, vous disposez des droits suivants :</p>
                <ul class="list-disc pl-6 space-y-2">
                  <li><strong>Droit d'accès</strong> : Obtenir une copie de vos données</li>
                  <li><strong>Droit de rectification</strong> : Corriger vos données inexactes</li>
                  <li><strong>Droit à l'effacement</strong> : Supprimer vos données</li>
                  <li><strong>Droit à la limitation</strong> : Limiter le traitement</li>
                  <li><strong>Droit à la portabilité</strong> : Récupérer vos données dans un format structuré</li>
                  <li><strong>Droit d'opposition</strong> : S'opposer au traitement</li>
                  <li><strong>Droit de retirer le consentement</strong> : Pour les traitements basés sur le consentement</li>
                </ul>
                <p class="mt-4 bg-slate-800/50 rounded-lg p-4">
                  <strong>Pour exercer vos droits :</strong><br/>
                  Email : realtixpro@gmail.com<br/>
                  Ou via votre espace "Mon Compte" > "Mes Données"
                </p>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">9. Sécurité des Données</h2>
                <p>Nous mettons en œuvre des mesures techniques et organisationnelles appropriées :</p>
                <ul class="list-disc pl-6 space-y-2">
                  <li>Chiffrement SSL/TLS pour toutes les communications</li>
                  <li>Chiffrement des données sensibles en base</li>
                  <li>Sauvegardes quotidiennes chiffrées</li>
                  <li>Authentification forte (MFA disponible)</li>
                  <li>Contrôles d'accès stricts</li>
                  <li>Audits de sécurité réguliers</li>
                  <li>Formation du personnel à la protection des données</li>
                </ul>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">10. Cookies</h2>
                <p>Nous utilisons des cookies pour :</p>
                <ul class="list-disc pl-6 space-y-2">
                  <li><strong>Cookies essentiels</strong> : Authentification, sécurité (obligatoires)</li>
                  <li><strong>Cookies de performance</strong> : Analyse d'usage, amélioration du service (avec consentement)</li>
                </ul>
                <p class="mt-4">Vous pouvez gérer vos préférences cookies dans les paramètres de votre navigateur.</p>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">11. Modifications</h2>
                <p>Cette politique peut être mise à jour. Nous vous informerons de tout changement significatif par email ou notification sur la plateforme.</p>
              </section>

              <section>
                <h2 class="text-2xl font-bold text-white mb-4">12. Réclamation</h2>
                <p>Si vous estimez que vos droits ne sont pas respectés, vous pouvez introduire une réclamation auprès de la CNIL :</p>
                <p class="mt-2 bg-slate-800/50 rounded-lg p-4">
                  <strong>CNIL</strong><br/>
                  3 Place de Fontenoy<br/>
                  TSA 80715<br/>
                  75334 Paris Cedex 07<br/>
                  Téléphone : +33 1 53 73 22 22<br/>
                  <a href="https://www.cnil.fr" target="_blank" class="text-blue-400 hover:text-blue-300">www.cnil.fr</a>
                </p>
              </section>
            </div>
          </div>
        </div>
      `;
    }

    function renderContact() {
      const backState = state.currentUser ? {currentPage: 'dashboard'} : {currentPage: 'login', showPublicLanding: true};
      return `
        <div class="max-w-3xl mx-auto">
          <div class="glass rounded-2xl p-8 animate-fadeInScale">
            <div class="mb-8">
              <button onclick='setState(${JSON.stringify(backState)})' class="text-blue-400 hover:text-blue-300 flex items-center gap-2 mb-4">
                ← Retour
              </button>
              <h1 class="text-4xl font-bold text-white mb-2">Nous Contacter</h1>
              <p class="text-slate-400">Une question ? Une suggestion ? Nous sommes là pour vous aider !</p>
            </div>

            <div class="grid md:grid-cols-2 gap-8 mb-8">
              <div class="glass rounded-xl p-6">
                <div class="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400 text-2xl mb-4">
                  📧
                </div>
                <h3 class="text-xl font-bold text-white mb-2">Email</h3>
                <p class="text-slate-300 mb-2">Pour toute question ou support :</p>
                <a href="mailto:realtixpro@gmail.com" class="text-blue-400 hover:text-blue-300">realtixpro@gmail.com</a>
              </div>

              <div class="glass rounded-xl p-6">
                <div class="w-12 h-12 rounded-xl bg-green-500/20 flex items-center justify-center text-green-400 text-2xl mb-4">
                  📞
                </div>
                <h3 class="text-xl font-bold text-white mb-2">Téléphone</h3>
                <p class="text-slate-300 mb-2">Du lundi au vendredi, 9h-18h :</p>
                <a href="tel:+33123456789" class="text-green-400 hover:text-green-300">+33 1 23 45 67 89</a>
              </div>
            </div>

            <form class="space-y-6" onsubmit="handleContactSubmit(event)">
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-white font-semibold mb-2">Nom complet *</label>
                  <input 
                    type="text" 
                    required
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-400"
                    placeholder="Jean Dupont"
                  />
                </div>
                <div>
                  <label class="block text-white font-semibold mb-2">Email *</label>
                  <input 
                    type="email" 
                    required
                    class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-400"
                    placeholder="jean.dupont@agence.fr"
                  />
                </div>
              </div>

              <div>
                <label class="block text-white font-semibold mb-2">Téléphone</label>
                <input 
                  type="tel" 
                  class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-400"
                  placeholder="+33 6 12 34 56 78"
                />
              </div>

              <div>
                <label class="block text-white font-semibold mb-2">Agence</label>
                <input 
                  type="text" 
                  class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-400"
                  placeholder="Nom de votre agence"
                />
              </div>

              <div>
                <label class="block text-white font-semibold mb-2">Sujet *</label>
                <select 
                  required
                  class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-400"
                >
                  <option value="">Sélectionnez un sujet</option>
                  <option value="support">Support technique</option>
                  <option value="sales">Question commerciale</option>
                  <option value="billing">Facturation</option>
                  <option value="feature">Demande de fonctionnalité</option>
                  <option value="bug">Signaler un bug</option>
                  <option value="other">Autre</option>
                </select>
              </div>

              <div>
                <label class="block text-white font-semibold mb-2">Message *</label>
                <textarea 
                  required
                  rows="6"
                  class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-400 resize-none"
                  placeholder="Décrivez votre demande en détail..."
                ></textarea>
              </div>

              <div class="flex items-center gap-2">
                <input 
                  type="checkbox" 
                  id="consent"
                  required
                  class="w-5 h-5 rounded border-slate-600 text-blue-500 focus:ring-2 focus:ring-blue-400"
                />
                <label for="consent" class="text-slate-300 text-sm">
                  J'accepte que mes données soient utilisées pour traiter ma demande conformément à la 
                  <a href="#" onclick="setState({currentPage: 'privacy'}); return false;" class="text-blue-400 hover:text-blue-300">politique de confidentialité</a>.
                </label>
              </div>

              <button 
                type="submit"
                class="w-full btn-primary px-6 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2"
              >
                📨 Envoyer le message
              </button>
            </form>
          </div>
        </div>
      `;
    }

    function handleContactSubmit(event) {
      event.preventDefault();
      const form = event.target;
      const formData = new FormData(form);
      
      // Simuler l'envoi
      showToast('✅ Message envoyé ! Nous vous répondrons dans les 24h.');
      form.reset();
      
      // En production, envoyer via API
      // fetch('/api/contact', { method: 'POST', body: formData })
    }

    // ===== SYSTÈME DE CHAT =====
    
    function renderChatSystem() {
      if (!state.showChat) {
        return `
          <button onclick="setState({showChat: true})" class="fixed bottom-6 right-6 w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full shadow-2xl flex items-center justify-center text-white hover:scale-110 transition-all z-40 animate-pulse">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
            ${state.chatConversations.reduce((sum, conv) => sum + conv.unreadCount, 0) > 0 ? `
              <span class="absolute -top-1 -right-1 min-w-[28px] h-7 px-2 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center text-sm font-bold shadow-xl ring-4 ring-red-500/30 border-2 border-white z-10">
                ${state.chatConversations.reduce((sum, conv) => sum + conv.unreadCount, 0)}
              </span>
            ` : ''}
          </button>
        `;
      }

      const activeChat = state.activeChatId ? state.chatConversations.find(c => c.id === state.activeChatId) : null;

      return `
        <div class="fixed bottom-6 right-6 w-96 h-[600px] bg-slate-800 rounded-2xl shadow-2xl flex flex-col z-50 border border-slate-700">
          ${!activeChat ? `
            <!-- Chat List -->
            <div class="p-4 border-b border-slate-700 flex items-center justify-between">
              <h3 class="text-white font-bold text-lg">Messages</h3>
              <button onclick="setState({showChat: false})" class="text-slate-400 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
            <div class="flex-1 overflow-y-auto p-2">
              ${state.chatConversations.map(conv => `
                <button onclick="openChat(${conv.id})" class='w-full p-3 hover:bg-slate-700 rounded-xl flex items-start gap-3 text-left transition-all ${conv.unreadCount > 0 ? "bg-slate-700/50" : ""}'>
                  <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold flex-shrink-0">
                    ${conv.participantAvatar}
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center justify-between mb-1">
                      <span class="text-white font-semibold text-sm">${conv.participantName}</span>
                      <span class="text-xs text-slate-400">${formatTimeSince(conv.lastMessageTime)}</span>
                    </div>
                    <p class="text-slate-400 text-sm truncate">${conv.lastMessage}</p>
                  </div>
                  ${conv.unreadCount > 0 ? `
                    <span class="min-w-[24px] h-6 px-2 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center text-xs font-bold text-white flex-shrink-0 shadow-lg ring-2 ring-red-500/50">
                      ${conv.unreadCount}
                    </span>
                  ` : ''}
                </button>
              `).join('')}
            </div>
          ` : `
            <!-- Active Chat -->
            <div class="p-4 border-b border-slate-700 flex items-center gap-3">
              <button onclick="setState({activeChatId: null})" class="text-slate-400 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
              </button>
              <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold">
                ${activeChat.participantAvatar}
              </div>
              <div class="flex-1">
                <h3 class="text-white font-bold">${activeChat.participantName}</h3>
                <span class="text-xs text-green-400">● En ligne</span>
              </div>
              <button onclick="setState({showChat: false})" class="text-slate-400 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
            <div class="flex-1 overflow-y-auto p-4 space-y-3">
              ${activeChat.messages.map(msg => {
                const isMe = msg.senderId === 'me';
                return `
                  <div class='flex ${isMe ? "justify-end" : "justify-start"}'>
                    <div class='${isMe ? "bg-blue-500 text-white" : "bg-slate-700 text-white"} rounded-2xl px-4 py-2 max-w-[80%]'>
                      ${!isMe ? `<div class="text-xs opacity-70 mb-1">${msg.senderName}</div>` : ''}
                      <p class="text-sm">${msg.text}</p>
                      <div class="text-xs opacity-70 mt-1">${formatTime(msg.timestamp)}</div>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
            <div class="p-4 border-t border-slate-700">
              <div class="flex gap-2">
                <input
                  type="text"
                  placeholder="Tapez votre message..."
                  value="${state.chatMessage}"
                  oninput="setState({chatMessage: event.target.value})"
                  onkeypress="if(event.key === 'Enter') sendChatMessage()"
                  class="flex-1 px-4 py-2 bg-slate-700 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-400"
                />
                <button onclick="sendChatMessage()" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-xl text-white font-semibold transition-all">
                  Envoyer
                </button>
              </div>
            </div>
          `}
        </div>
      `;
    }

    function openChat(chatId) {
      const chat = state.chatConversations.find(c => c.id === chatId);
      if (chat) {
        chat.unreadCount = 0;
        chat.messages.forEach(m => m.read = true);
      }
      setState({ activeChatId: chatId, chatConversations: state.chatConversations });
    }

    function sendChatMessage() {
      if (!state.chatMessage.trim() || !state.activeChatId) return;
      
      const chat = state.chatConversations.find(c => c.id === state.activeChatId);
      if (chat) {
        chat.messages.push({
          id: chat.messages.length + 1,
          senderId: 'me',
          senderName: 'Vous',
          text: state.chatMessage,
          timestamp: new Date().toISOString(),
          read: true
        });
        chat.lastMessage = 'Vous : ' + state.chatMessage.substring(0, 50);
        chat.lastMessageTime = new Date().toISOString();
      }
      
      setState({ chatMessage: '', chatConversations: state.chatConversations });
    }

    function formatTimeSince(dateString) {
      const minutes = Math.floor((Date.now() - new Date(dateString)) / 60000);
      if (minutes < 1) return 'À l\'instant';
      if (minutes < 60) return minutes + 'min';
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return hours + 'h';
      const days = Math.floor(hours / 24);
      return days + 'j';
    }

    function formatTime(dateString) {
      return new Date(dateString).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
    }

    // ===== FONCTIONS IA EMAIL =====
    
    function generateAIEmail() {
      if (!state.selectedEmailClient || !state.emailType) {
        alert('Veuillez sélectionner un destinataire et un type d\'email');
        return;
      }

      const client = state.clients.find(c => c.id == state.selectedEmailClient);
      const property = state.emailProperty ? state.properties.find(p => p.id == state.emailProperty) : null;

      // Simulation de génération IA
      const emails = {
        presentation: {
          subject: `${property ? property.title + ' - ' : ''}Un bien qui pourrait vous intéresser`,
          body: `Bonjour ${client.name},\n\nJe me permets de vous contacter car ${property ? 'le bien "' + property.title + '"' : 'un nouveau bien'} correspond parfaitement à vos critères de recherche.\n\n${property ? '\n📍 Localisation : ' + property.location + '\n💰 Prix : ' + property.price.toLocaleString() + ' €\n📐 Surface : ' + property.surface + ' m²\n🛏️ ' + property.rooms + ' pièces\n\n' : ''}${state.emailAdditionalInfo ? '\nInformations complémentaires :\n' + state.emailAdditionalInfo + '\n\n' : ''}Je reste à votre entière disposition pour organiser une visite ou répondre à vos questions.\n\nCordialement,\n${state.currentUser.name}\nRealtix Pro`
        },
        followup: {
          subject: `Suite à votre visite ${property ? '- ' + property.title : ''}`,
          body: `Bonjour ${client.name},\n\nJ\'espère que vous avez apprécié la visite ${property ? 'de "' + property.title + '"' : "d\'hier"} !\n\nJe souhaitais prendre quelques minutes pour recueillir vos impressions et répondre à d\'éventuelles questions.\n\n${state.emailAdditionalInfo ? state.emailAdditionalInfo + '\n\n' : ''}N\'hésitez pas à me faire part de vos retours. Je suis là pour vous accompagner dans votre projet immobilier.\n\nCordialement,\n${state.currentUser.name}\nRealtix Pro`
        },
        relance: {
          subject: 'Votre projet immobilier avance-t-il ?',
          body: `Bonjour ${client.name},\n\nJe me permets de revenir vers vous concernant votre recherche immobilière.\n\nNous n\'avons pas eu de nouvelles depuis quelque temps et je voulais savoir si votre projet était toujours d\'actualité.\n\n${state.emailAdditionalInfo ? state.emailAdditionalInfo + '\n\n' : ''}De nouveaux biens correspondant à vos critères sont disponibles. Seriez-vous intéressé(e) par une présentation ?\n\nDans l\'attente de votre retour,\n\nCordialement,\n${state.currentUser.name}\nRealtix Pro`
        },
        offre: {
          subject: `Proposition ${property ? '- ' + property.title : 'personnalisée'}`,
          body: `Bonjour ${client.name},\n\nSuite à nos échanges, je vous propose ${property ? 'le bien "' + property.title + '"' : 'cette opportunité'} qui correspond parfaitement à votre budget et vos attentes.\n\n${property ? '\n💰 Prix négocié : ' + property.price.toLocaleString() + ' €\n📍 ' + property.location + '\n📐 ' + property.surface + ' m²\n\n' : ''}${state.emailAdditionalInfo ? 'Avantages de cette offre :\n' + state.emailAdditionalInfo + '\n\n' : ''}Cette offre est valable sous réserve de disponibilité. Je vous conseille de me recontacter rapidement pour ne pas la manquer.\n\nJe reste à votre disposition,\n\nCordialement,\n${state.currentUser.name}\nRealtix Pro`
        },
        newsletter: {
          subject: 'Votre newsletter immobilière mensuelle',
          body: `Bonjour ${client.name},\n\nVoici votre sélection mensuelle de biens immobiliers !\n\n🏠 Nouveautés du mois\n📊 Tendances du marché\n💡 Conseils d\'expert\n\n${state.emailAdditionalInfo ? state.emailAdditionalInfo + '\n\n' : ''}Pour plus d\'informations ou organiser des visites, contactez-moi directement.\n\nÀ très bientôt,\n\n${state.currentUser.name}\nRealtix Pro`
        },
        remerciement: {
          subject: 'Merci pour votre confiance !',
          body: `Bonjour ${client.name},\n\nJe tenais à vous remercier pour votre confiance et pour ${property ? 'l\'acquisition de "' + property.title + '"' : 'notre collaboration'}.\n\n${state.emailAdditionalInfo ? state.emailAdditionalInfo + '\n\n' : ''}Ce fut un réel plaisir de vous accompagner dans votre projet immobilier. N\'hésitez pas à me recommander à vos proches !\n\nJe reste à votre disposition pour toute question future.\n\nBien cordialement,\n${state.currentUser.name}\nRealtix Pro`
        }
      };

      const generated = emails[state.emailType] || emails.presentation;

      setState({
        generatedEmail: {
          recipientName: client.name,
          recipientEmail: client.email,
          subject: generated.subject,
          body: generated.body
        }
      });
    }

    function regenerateEmail() {
      generateAIEmail();
    }

    function copyEmailToClipboard() {
      const text = `À: ${state.generatedEmail.recipientEmail}\nObjet: ${state.generatedEmail.subject}\n\n${state.generatedEmail.body}`;
      navigator.clipboard.writeText(text).then(() => {
        alert('✅ Email copié dans le presse-papier !');
      });
    }

    function openInGmail() {
      const subject = encodeURIComponent(state.generatedEmail.subject);
      const body = encodeURIComponent(state.generatedEmail.body);
      const to = encodeURIComponent(state.generatedEmail.recipientEmail);
      const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${to}&su=${subject}&body=${body}`;
      window.open(gmailUrl, '_blank');
    }

    function loadTemplate(templateType) {
      // Pré-remplir selon le template
      const templates = {
        'quick-followup': { type: 'followup', tone: 'friendly' },
        'new-listing': { type: 'presentation', tone: 'formal' },
        'hot-lead': { type: 'offre', tone: 'friendly' }
      };
      
      const template = templates[templateType];
      if (template) {
        setState({
          emailType: template.type,
          emailTone: template.tone
        });
      }
    }

    // Gestion des actions complétées pour les clients
    function toggleActionCompletion(clientId, actionKey, actionName) {
      const client = state.clients.find(c => c.id === clientId);
      if (!client) return;

      // Initialiser completedActions si nécessaire
      if (!client.completedActions) {
        client.completedActions = [];
      }

      const isCompleted = client.completedActions.includes(actionKey);
      
      if (isCompleted) {
        // Décocher l'action
        client.completedActions = client.completedActions.filter(a => a !== actionKey);
      } else {
        // Cocher l'action et mettre à jour le score
        client.completedActions.push(actionKey);
        
        // Augmenter légèrement le score IA quand une action est complétée
        if (client.aiScore < 100) {
          client.aiScore = Math.min(100, client.aiScore + 2);
        }
        
        // Mettre à jour la date du dernier contact
        client.lastContact = new Date().toISOString().split('T')[0];
      }

      // Mettre à jour le state
      setState({
        clients: state.clients
      });

      // Notification visuelle
      const emoji = isCompleted ? '↩️' : '✅';
      const message = isCompleted ? 
        `Action "${actionName}" remise en attente` : 
        `Action "${actionName}" marquée comme complétée ! Score IA mis à jour : ${client.aiScore}`;
      
      // Toast notification (simple)
      showToast(emoji + ' ' + message);
    }

    // ===== MULTI-PORTAL FUNCTIONS =====
    
    function togglePortal(portalId) {
      const selectedPortals = [...state.multiPortal.selectedPortals];
      const index = selectedPortals.indexOf(portalId);
      
      if (index > -1) {
        selectedPortals.splice(index, 1);
      } else {
        selectedPortals.push(portalId);
      }
      
      setState({
        multiPortal: {
          ...state.multiPortal,
          selectedPortals
        }
      });
    }

    function selectAllPortals() {
      const allPortalIds = state.availablePortals
        .filter(p => p.status === 'active')
        .map(p => p.id);
      
      setState({
        multiPortal: {
          ...state.multiPortal,
          selectedPortals: allPortalIds
        }
      });
      showToast('✅ Tous les portails actifs sélectionnés');
    }

    function selectPremiumPortals() {
      const premiumPortalIds = state.availablePortals
        .filter(p => p.tier === 'premium' && p.status === 'active')
        .map(p => p.id);
      
      setState({
        multiPortal: {
          ...state.multiPortal,
          selectedPortals: premiumPortalIds
        }
      });
      showToast('⭐ Portails Premium sélectionnés');
    }

    function selectFreePortals() {
      const freePortalIds = state.availablePortals
        .filter(p => p.tier === 'free' && p.status === 'active')
        .map(p => p.id);
      
      setState({
        multiPortal: {
          ...state.multiPortal,
          selectedPortals: freePortalIds
        }
      });
      showToast('🆓 Portails gratuits sélectionnés');
    }

    async function publishToPortals() {
      if (!state.multiPortal.selectedProperty) {
        showToast('❌ Veuillez sélectionner un bien', 'error');
        return;
      }

      if (state.multiPortal.selectedPortals.length === 0) {
        showToast('❌ Veuillez sélectionner au moins un portail', 'error');
        return;
      }

      const property = state.properties.find(p => p.id === state.multiPortal.selectedProperty);
      const portalCount = state.multiPortal.selectedPortals.length;

      showToast(`🚀 Publication en cours sur ${portalCount} portails...`);

      // Simuler la publication (en production, ce serait des appels API réels)
      setTimeout(() => {
        const newPublication = {
          id: state.publications.length + 1,
          propertyId: property.id,
          propertyTitle: property.title,
          publishedDate: new Date().toISOString(),
          portals: state.multiPortal.selectedPortals.map(portalId => {
            const portal = state.availablePortals.find(p => p.id === portalId);
            // Simuler différents statuts
            const random = Math.random();
            let status = 'published';
            if (random < 0.1) status = 'pending';
            if (random < 0.05) status = 'error';

            return {
              name: portalId,
              status,
              views: status === 'published' ? Math.floor(Math.random() * 2000) : 0,
              contacts: status === 'published' ? Math.floor(Math.random() * 50) : 0,
              url: status === 'published' ? `https://${portalId}.com/property/${property.id}` : '',
              error: status === 'error' ? 'Erreur de connexion - Réessayer' : null
            };
          })
        };

        setState({
          publications: [newPublication, ...state.publications],
          multiPortal: {
            ...state.multiPortal,
            selectedProperty: null,
            selectedPortals: ['leboncoin', 'pap', 'paruvendu']
          }
        });

        const successCount = newPublication.portals.filter(p => p.status === 'published').length;
        showToast(`✅ Publié avec succès sur ${successCount}/${portalCount} portails !`);
      }, 2000);
    }

    function saveDraft() {
      showToast('💾 Brouillon enregistré - Vous pourrez le publier plus tard');
    }

    // ===== SYNDIC INTERVENTION FUNCTION =====
    function createIntervention() {
      const { coproId, type, description, cost } = state.newIntervention;
      
      if (!coproId || !type || !description) {
        showToast('❌ Veuillez remplir tous les champs obligatoires', 'error');
        return;
      }

      const newIntervention = {
        id: state.syndic.interventions.length + 1,
        coproId,
        type,
        description,
        date: new Date().toISOString().split('T')[0],
        status: 'pending',
        cost: parseInt(cost) || 0
      };

      setState({
        syndic: {
          ...state.syndic,
          interventions: [newIntervention, ...state.syndic.interventions]
        },
        showNewInterventionModal: false,
        newIntervention: {
          coproId: null,
          type: '',
          description: '',
          cost: ''
        }
      });

      showToast('✅ Intervention créée avec succès !');
    }

    // ===== SYNDIC MESSAGE FUNCTION =====
    function sendMessage() {
      const { coproId, recipients, subject, message } = state.newMessage;
      
      if (!coproId || !subject || !message) {
        showToast('❌ Veuillez remplir tous les champs obligatoires', 'error');
        return;
      }

      const copro = state.syndic.coproperties.find(c => c.id === coproId);
      let recipientCount = 0;
      
      if (recipients === 'all') {
        recipientCount = copro.lots;
      } else if (recipients === 'conseil') {
        recipientCount = state.syndic.residents.filter(r => r.coproId === coproId && r.role === 'conseil').length;
      } else {
        recipientCount = 5; // À calculer selon sélection
      }

      const newMessage = {
        id: state.syndic.messages.length + 1,
        coproId,
        subject,
        content: message,
        date: new Date().toISOString().split('T')[0],
        recipients: recipientCount,
        readBy: 0,
        author: state.currentUser.name
      };

      setState({
        syndic: {
          ...state.syndic,
          messages: [newMessage, ...state.syndic.messages]
        },
        showNewMessage: false,
        newMessage: {
          coproId: null,
          recipients: 'all',
          subject: '',
          message: ''
        }
      });

      showToast(`✅ Message envoyé à ${recipientCount} copropriétaire(s) !`);
    }

    // ===== SYNDIC SIGNALEMENT FUNCTION =====
    function createSignalement() {
      const { coproId, type, description, priority, createIntervention, informCopro } = state.newSignalement;
      
      if (!coproId || !type || !description) {
        showToast('❌ Veuillez remplir tous les champs obligatoires', 'error');
        return;
      }

      const newSignalement = {
        id: state.syndic.signalements.length + 1,
        coproId,
        type,
        description,
        status: 'Reçu',
        priority,
        date: new Date().toISOString().split('T')[0],
        author: state.currentUser.name,
        authorId: state.currentUser.id || 1,
        photos: [],
        createIntervention,
        informCopro,
        interventionId: createIntervention ? state.syndic.interventions.length + 1 : null,
        readBy: [state.currentUser.id || 1],
        relancesSent: 0,
        nextRelance: informCopro ? new Date(Date.now() + 7*24*60*60*1000).toISOString().split('T')[0] : null,
        comments: []
      };

      // Si création intervention, ajouter aussi l'intervention
      let newIntervention = null;
      if (createIntervention) {
        newIntervention = {
          id: state.syndic.interventions.length + 1,
          coproId,
          type: type,
          description: `Intervention suite au signalement: ${description}`,
          date: new Date().toISOString().split('T')[0],
          status: 'pending',
          cost: 0
        };
      }

      // Si information copro, créer aussi le message
      let newMessage = null;
      if (informCopro) {
        const copro = state.syndic.coproperties.find(c => c.id === coproId);
        newMessage = {
          id: state.syndic.messages.length + 1,
          coproId,
          subject: `Signalement: ${type}`,
          content: `Chers copropriétaires,\\n\\nNous vous informons qu\\'un signalement de type "${type}" a été enregistré.\\n\\nDescription: ${description}\\n\\nNous vous tiendrons informés de la suite.\\n\\nCordialement,\\n${state.currentUser.name}`,
          date: new Date().toISOString().split('T')[0],
          recipients: copro.lots,
          readBy: 0,
          author: state.currentUser.name
        };
      }

      setState({
        syndic: {
          ...state.syndic,
          signalements: [newSignalement, ...state.syndic.signalements],
          ...(newIntervention && { interventions: [newIntervention, ...state.syndic.interventions] }),
          ...(newMessage && { messages: [newMessage, ...state.syndic.messages] })
        },
        showNewSignalement: false,
        newSignalement: {
          coproId: null,
          type: '',
          description: '',
          priority: 'moyenne',
          photos: [],
          createIntervention: false,
          informCopro: false
        }
      });

      let message = '✅ Signalement créé !';
      if (createIntervention) message += ' + Intervention créée';
      if (informCopro) message += ' + Copropriété informée';
      showToast(message);
    }

    // ===== EXPORT PDF SIGNALEMENTS =====
    function exportSignalementsPDF() {
      showToast('📄 Export PDF des signalements en cours...');
      
      // Simulation d'export
      setTimeout(() => {
        showToast('✅ PDF téléchargé ! (signalements_' + new Date().toISOString().split('T')[0] + '.pdf)');
      }, 1500);
    }

    // ===== MODALS SUPPLÉMENTAIRES =====
    function renderModeleMessagesModal() {
      const modeles = [
        { id: 1, titre: 'Convocation AG', categorie: 'AG', contenu: 'Chers copropriétaires,\\n\\nVous êtes convoqués à l\'Assemblée Générale qui se tiendra le [DATE] à [HEURE].' },
        { id: 2, titre: 'Travaux planifiés', categorie: 'Travaux', contenu: 'Bonjour,\\n\\nDes travaux sont prévus du [DATE_DEBUT] au [DATE_FIN]. Merci de votre compréhension.' },
        { id: 3, titre: 'Rappel charges', categorie: 'Finances', contenu: 'Madame, Monsieur,\\n\\nNous constatons un retard dans le paiement de vos charges du trimestre [PERIODE].' },
        { id: 4, titre: 'Info urgente', categorie: 'Urgence', contenu: '⚠️ URGENT\\n\\n[MESSAGE]\\n\\nMerci de prendre connaissance rapidement.' },
        { id: 5, titre: 'Bienvenue nouveau copro', categorie: 'Accueil', contenu: 'Bienvenue dans notre résidence !\\n\\nVoici les informations importantes à connaître...' }
      ];

      return `
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50" onclick="if(event.target === event.currentTarget) setState({showModeleMessages: false})">
          <div class="glass rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-bold text-white">📝 Modèles de Messages</h2>
              <button onclick="setState({showModeleMessages: false})" class="text-slate-400 hover:text-white transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              ${modeles.map(modele => `
                <div class="glass rounded-xl p-5 hover:border-blue-400/50 transition-all">
                  <div class="flex items-start justify-between mb-3">
                    <div class="flex-1">
                      <h3 class="text-white font-bold text-lg mb-1">${modele.titre}</h3>
                      <span class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs">${modele.categorie}</span>
                    </div>
                  </div>
                  <p class="text-slate-300 text-sm mb-4 whitespace-pre-line">${modele.contenu.substring(0, 100)}...</p>
                  <div class="flex gap-2">
                    <button onclick="useModele(${modele.id})" class="flex-1 px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 rounded-lg font-semibold transition-all">
                      ✓ Utiliser
                    </button>
                    <button class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold transition-all">
                      ✏️
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>

            <button onclick="setState({showModeleMessages: false})" class="w-full mt-6 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all">
              Fermer
            </button>
          </div>
        </div>
      `;
    }

    function renderRappelsTravauxModal() {
      const rappels = state.syndic.interventions.filter(i => i.status === 'pending').map(int => {
        const copro = state.syndic.coproperties.find(c => c.id === int.coproId);
        const daysUntil = Math.ceil((new Date(int.date) - new Date()) / (1000*60*60*24));
        return { ...int, copro: copro?.name, daysUntil };
      });

      return `
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50" onclick="if(event.target === event.currentTarget) setState({showRappelsTravaux: false})">
          <div class="glass rounded-2xl p-8 max-w-3xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-bold text-white">⏰ Rappels Automatiques Travaux</h2>
              <button onclick="setState({showRappelsTravaux: false})" class="text-slate-400 hover:text-white transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <div class="glass rounded-xl p-5 mb-6 bg-amber-500/10 border-amber-500/20">
              <h3 class="text-white font-bold mb-2">⚙️ Configuration</h3>
              <div class="space-y-3">
                <label class="flex items-center gap-3">
                  <input type="checkbox" checked class="w-5 h-5" />
                  <div class="flex-1">
                    <div class="text-white font-semibold">Rappel J-7</div>
                    <div class="text-slate-400 text-sm">Notification 7 jours avant la date prévue</div>
                  </div>
                </label>
                <label class="flex items-center gap-3">
                  <input type="checkbox" checked class="w-5 h-5" />
                  <div class="flex-1">
                    <div class="text-white font-semibold">Rappel J-3</div>
                    <div class="text-slate-400 text-sm">Notification 3 jours avant la date prévue</div>
                  </div>
                </label>
                <label class="flex items-center gap-3">
                  <input type="checkbox" checked class="w-5 h-5" />
                  <div class="flex-1">
                    <div class="text-white font-semibold">Rappel J-1</div>
                    <div class="text-slate-400 text-sm">Notification la veille</div>
                  </div>
                </label>
              </div>
            </div>

            <h3 class="text-white font-bold mb-4">📋 Travaux programmés</h3>
            <div class="space-y-3">
              ${rappels.length > 0 ? rappels.map(rappel => `
                <div class="glass rounded-xl p-4">
                  <div class="flex items-start justify-between">
                    <div class="flex-1">
                      <h4 class="text-white font-semibold mb-1">${rappel.description}</h4>
                      <p class="text-slate-400 text-sm mb-2">${rappel.copro}</p>
                      <div class="flex items-center gap-3 text-xs">
                        <span class="text-slate-400">📅 ${new Date(rappel.date).toLocaleDateString('fr-FR')}</span>
                        <span class="px-2 py-1 ${rappel.daysUntil <= 3 ? 'bg-red-500/20 text-red-400' : rappel.daysUntil <= 7 ? 'bg-amber-500/20 text-amber-400' : 'bg-blue-500/20 text-blue-400'} rounded">
                          ${rappel.daysUntil > 0 ? `Dans ${rappel.daysUntil} jours` : rappel.daysUntil === 0 ? 'Aujourd\'hui' : `Retard de ${Math.abs(rappel.daysUntil)} jours`}
                        </span>
                      </div>
                    </div>
                    <button onclick="sendRappelTravaux(${rappel.id})" class="px-4 py-2 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 rounded-lg font-semibold transition-all">
                      🔔 Rappeler
                    </button>
                  </div>
                </div>
              `).join('') : '<p class="text-slate-400 text-center py-8">Aucun travaux en cours</p>'}
            </div>

            <button onclick="setState({showRappelsTravaux: false})" class="w-full mt-6 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-semibold transition-all">
              Fermer
            </button>
          </div>
        </div>
      `;
    }

    function useModele(modeleId) {
      setState({ 
        showModeleMessages: false,
        showNewMessage: true 
      });
      showToast('✅ Modèle chargé dans le nouveau message');
    }

    function sendRappelTravaux(interventionId) {
      showToast('📨 Rappel envoyé aux intervenants concernés');
    }


    // ===== END MULTI-PORTAL FUNCTIONS =====

    function handlePlanClick(button) {
      const isTrial = button.dataset.isTrial === 'true';
      const planKey = button.dataset.plan;
      
      if (isTrial) {
        startFreeTrial();
      } else {
        selectPlan(planKey);
      }
    }

    function startFreeTrial() {
      setState({
        showRegistrationModal: true,
        registrationData: {
          ...state.registrationData,
          selectedPlan: 'trial'
        }
      });
      setTimeout(() => {
        showToast('🎉 Commencez votre essai gratuit de 7 jours - Accès complet Entreprise !');
      }, 300);
    }

    function selectPlan(planKey) {
      setState({
        showRegistrationModal: true, 
        registrationData: {
          ...state.registrationData, 
          selectedPlan: planKey
        }
      });
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'fixed top-4 right-4 bg-slate-800 text-white px-6 py-4 rounded-xl shadow-2xl border border-slate-700 z-50 animate-slideInRight';
      toast.style.maxWidth = '400px';
      toast.innerHTML = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // ===== FONCTIONS CALLBACK POUR LES MODALS =====
    function sendDevisRequest() {
      showToast('📄 Demandes de devis envoyées avec succès !');
    }

    function assignArtisan() {
      showToast('🔧 Artisan assigné avec succès !');
    }

    function sendMessage() {
      showToast('💬 Message envoyé à tous les copropriétaires !');
    }

    function planifierIntervention() {
      showToast('📅 Intervention planifiée avec succès !');
    }

    function informerCoproprieteaires() {
      showToast('📢 Mise à jour envoyée à 45 copropriétaires avec succès !');
    }

    function setBackgroundTheme(themeId) {
      setState({
        customization: {
          ...state.customization,
          backgroundTheme: themeId
        }
      });
      showToast('🎨 Thème de couleur appliqué !');
    }

    // Initial render with loading animation
    render();
    
    // User must click button to enter (no automatic timeout)
  </script>
</body>
</html>
